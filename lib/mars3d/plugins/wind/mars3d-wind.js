/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.2
 * 编译日期：2024-01-29 17:15:28
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x25915f=_0x2ad9;(function(_0x4d8248,_0x309a16){const _0x345f84=_0x2ad9,_0x3c04f4=_0x4d8248();while(!![]){try{const _0x430166=-parseInt(_0x345f84(0x2c3))/0x1*(parseInt(_0x345f84(0x22a))/0x2)+parseInt(_0x345f84(0x209))/0x3+parseInt(_0x345f84(0x230))/0x4+-parseInt(_0x345f84(0x219))/0x5+-parseInt(_0x345f84(0x2d8))/0x6+-parseInt(_0x345f84(0x215))/0x7+parseInt(_0x345f84(0x23e))/0x8;if(_0x430166===_0x309a16)break;else _0x3c04f4['push'](_0x3c04f4['shift']());}catch(_0x9fa51d){_0x3c04f4['push'](_0x3c04f4['shift']());}}}(_0x4f93,0xf14aa));function _interopNamespace(_0x32af0c){const _0x44bb5d=_0x2ad9;if(_0x32af0c&&_0x32af0c[_0x44bb5d(0x2a3)])return _0x32af0c;var _0x35786b=Object['create'](null);return _0x32af0c&&Object['keys'](_0x32af0c)['forEach'](function(_0x5f6108){const _0xecac7a=_0x44bb5d;if(_0x5f6108!=='default'){var _0x5d07b3=Object[_0xecac7a(0x231)](_0x32af0c,_0x5f6108);Object['defineProperty'](_0x35786b,_0x5f6108,_0x5d07b3[_0xecac7a(0x1ee)]?_0x5d07b3:{'enumerable':!![],'get':function(){return _0x32af0c[_0x5f6108];}});}}),_0x35786b['default']=_0x32af0c,_0x35786b;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x6af510,_0x3005ab){const _0x1c4b02=_0x2ad9,_0x45c8fa=_0x6af510*Math[_0x1c4b02(0x21e)](Cesium$7['Math']['toRadians'](_0x3005ab));return _0x45c8fa;}function getV(_0x1c99ba,_0x3703e1){const _0x1533af=_0x2ad9,_0x10a8bc=_0x1c99ba*Math[_0x1533af(0x286)](Cesium$7['Math']['toRadians'](_0x3703e1));return _0x10a8bc;}function getSpeed(_0x44ff49,_0x246664){const _0x1ad4f3=_0x2ad9,_0x5c038e=Math['sqrt'](Math['pow'](_0x44ff49,0x2)+Math[_0x1ad4f3(0x256)](_0x246664,0x2));return _0x5c038e;}function getDirection(_0x223298,_0x19c7b4){const _0xb4d18d=_0x2ad9;let _0x46396c=Cesium$7['Math'][_0xb4d18d(0x299)](Math['atan2'](_0x19c7b4,_0x223298));return _0x46396c+=_0x46396c<0x0?0x168:0x0,_0x46396c;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x151228){const _0x4635a6=_0x2ad9;this[_0x4635a6(0x1eb)]=_0x151228[_0x4635a6(0x1eb)],this['geometry']=_0x151228['geometry'],this['attributeLocations']=_0x151228['attributeLocations'],this['primitiveType']=_0x151228['primitiveType'],this['uniformMap']=_0x151228['uniformMap'],this['vertexShaderSource']=_0x151228['vertexShaderSource'],this['fragmentShaderSource']=_0x151228[_0x4635a6(0x1fa)],this[_0x4635a6(0x200)]=_0x151228['rawRenderState'],this[_0x4635a6(0x222)]=_0x151228[_0x4635a6(0x222)],this['outputTexture']=_0x151228['outputTexture'],this['autoClear']=_0x151228['autoClear']??![],this['preExecute']=_0x151228[_0x4635a6(0x20c)],this['show']=!![],this[_0x4635a6(0x26a)]=undefined,this[_0x4635a6(0x1de)]=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x25915f(0x26d)](_0x51f6c3){const _0x2e9f3d=_0x25915f;switch(this[_0x2e9f3d(0x1eb)]){case'Draw':{const _0x56137e=Cesium$6['VertexArray']['fromGeometry']({'context':_0x51f6c3,'geometry':this[_0x2e9f3d(0x267)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x16a1d8=Cesium$6['ShaderProgram'][_0x2e9f3d(0x1d7)]({'context':_0x51f6c3,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x2e9f3d(0x1fa)]}),_0x2216c3=Cesium$6[_0x2e9f3d(0x238)]['fromCache'](this[_0x2e9f3d(0x200)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x16a1d8,'vertexArray':_0x56137e,'modelMatrix':Cesium$6[_0x2e9f3d(0x1fd)]['IDENTITY'],'renderState':_0x2216c3,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x2e9f3d(0x252)][_0x2e9f3d(0x2c6)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0x2e9f3d(0x2ad)],'outputTexture':this[_0x2e9f3d(0x2a1)],'persists':!![]});}}}[_0x25915f(0x2c9)](_0x5c5ac3,_0x20a004){const _0x59ff07=_0x25915f;this[_0x59ff07(0x267)]=_0x20a004;const _0x135f20=Cesium$6['VertexArray']['fromGeometry']({'context':_0x5c5ac3,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x59ff07(0x26a)][_0x59ff07(0x29f)]=_0x135f20;}['update'](_0x5a17eb){const _0x1670da=_0x25915f;if(!this[_0x1670da(0x2bd)])return;if(_0x5a17eb['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6[_0x1670da(0x24f)](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x5a17eb[_0x1670da(0x290)])),Cesium$6['defined'](this[_0x1670da(0x20c)])&&this['preExecute'](),Cesium$6['defined'](this[_0x1670da(0x1de)])&&_0x5a17eb['commandList'][_0x1670da(0x274)](this['clearCommand']),_0x5a17eb[_0x1670da(0x25f)]['push'](this['commandToExecute']);}[_0x25915f(0x29d)](){return![];}['destroy'](){const _0x5c004e=_0x25915f;if(this[_0x5c004e(0x1de)]){var _0x4613d4,_0x5d1503;(_0x4613d4=this[_0x5c004e(0x1de)])!==null&&_0x4613d4!==void 0x0&&_0x4613d4['vertexArray']&&this[_0x5c004e(0x1de)]['vertexArray']['destroy'](),(_0x5d1503=this['clearCommand'])!==null&&_0x5d1503!==void 0x0&&_0x5d1503[_0x5c004e(0x1f6)]&&this['clearCommand'][_0x5c004e(0x1f6)]['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0x5c004e(0x26a)]['shaderProgram'][_0x5c004e(0x26b)](),delete this[_0x5c004e(0x26a)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x25915f(0x240)],Util=(function(){const _0x2af9e1=function(){const _0x5b10d2=_0x2ad9,_0x3872a0=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x5b10d2(0x234)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x3872a0;},_0x23e66d=function(_0x3bafd7,_0x21c14b){const _0x3b1e55=_0x2ad9;if(Cesium$5['defined'](_0x21c14b)){const _0x3544bf={};_0x3544bf['arrayBufferView']=_0x21c14b,_0x3bafd7['source']=_0x3544bf;}const _0x58b4e0=new Cesium$5[(_0x3b1e55(0x239))](_0x3bafd7);return _0x58b4e0;},_0x92ad28=function(_0x44698c,_0x35bd8a,_0x470029){const _0x542b82=new Cesium$5['Framebuffer']({'context':_0x44698c,'colorTextures':[_0x35bd8a],'depthTexture':_0x470029});return _0x542b82;},_0x3b172e=function(_0x80d1ab){const _0x5552d2=_0x2ad9,_0x1171f5=!![],_0x539c17=![],_0x171555={'viewport':_0x80d1ab[_0x5552d2(0x225)],'depthTest':_0x80d1ab['depthTest'],'depthMask':_0x80d1ab['depthMask'],'blending':_0x80d1ab['blending']},_0x2d38a1=Cesium$5[_0x5552d2(0x22b)]['getDefaultRenderState'](_0x1171f5,_0x539c17,_0x171555);return _0x2d38a1;},_0x47c3ea=function(_0x196efc){const _0x2194c4=_0x2ad9,_0x10357f={},_0x531957=Cesium$5['Math']['mod'](_0x196efc['west'],Cesium$5['Math'][_0x2194c4(0x250)]),_0x79018c=Cesium$5[_0x2194c4(0x2b9)]['mod'](_0x196efc['east'],Cesium$5['Math']['TWO_PI']),_0x49e454=_0x196efc[_0x2194c4(0x23c)];let _0x3465ed,_0x181f40;_0x49e454>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x3465ed=0x0,_0x181f40=Cesium$5[_0x2194c4(0x2b9)]['TWO_PI']):_0x79018c-_0x531957<_0x49e454?(_0x3465ed=_0x531957,_0x181f40=_0x531957+_0x49e454):(_0x3465ed=_0x531957,_0x181f40=_0x79018c);_0x10357f['lon']={'min':Cesium$5[_0x2194c4(0x2b9)][_0x2194c4(0x299)](_0x3465ed),'max':Cesium$5[_0x2194c4(0x2b9)][_0x2194c4(0x299)](_0x181f40)};const _0x69e46b=_0x196efc['south'],_0x5672e1=_0x196efc['north'],_0x30eb47=_0x196efc['height'],_0x5ca84e=_0x30eb47>Cesium$5['Math']['PI']/0xc?_0x30eb47/0x2:0x0;let _0x425cb7=Cesium$5[_0x2194c4(0x2b9)]['clampToLatitudeRange'](_0x69e46b-_0x5ca84e),_0x1fb738=Cesium$5['Math']['clampToLatitudeRange'](_0x5672e1+_0x5ca84e);return _0x425cb7<-Cesium$5[_0x2194c4(0x2b9)]['PI_OVER_THREE']&&(_0x425cb7=-Cesium$5[_0x2194c4(0x2b9)][_0x2194c4(0x2b3)]),_0x1fb738>Cesium$5[_0x2194c4(0x2b9)]['PI_OVER_THREE']&&(_0x1fb738=Cesium$5['Math']['PI_OVER_TWO']),_0x10357f['lat']={'min':Cesium$5['Math']['toDegrees'](_0x425cb7),'max':Cesium$5['Math']['toDegrees'](_0x1fb738)},_0x10357f;};return{'getFullscreenQuad':_0x2af9e1,'createTexture':_0x23e66d,'createFramebuffer':_0x92ad28,'createRawRenderState':_0x3b172e,'viewRectangleToLonLatRange':_0x47c3ea};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x25915f(0x1d9);const Cesium$4=mars3d__namespace['Cesium'];function _0x4f93(){const _0x16e0fa=['WindUtil','Cesium','drawingBufferWidth','fixedHeight','scene','getUVByXY','fadeOpacity','wind','applyViewerParameters','ymin','drawingBufferHeight','grid','addPrimitives','lon','textures','pointerEvents','defined','TWO_PI','Draw','Pass','globalAlpha','trails','currentTrailsDepth','pow','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','canrefresh','dimensions','vdata','canvasContext','TextureMinificationFilter','_data','removeEventListener','commandList','_colorRamp','setOptions','updateSpeed','_mountedHook','0px','globe','createFramebuffer','geometry','segmentsDepth','LayerUtil','commandToExecute','destroy','postProcessingPosition','createCommand','postMessage','postProcessingSpeed','xmin','PixelDatatype','rgb(206,255,255)','lev','push','mouse_move','RGBA','_onMapWhellEvent','preRender','none','nextTrails','DomUtil','age','execute','viewerParameters','dropRate','randomizeParticles','_updateIng','xmax','forEach','length','_tomap','sin','TextureMagnificationFilter','currentTrails','keys','Cartesian3','_removedHook','refreshParticles','cols','_updateIng2','strokeStyle','context','register','stroke','createRawRenderState','clientHeight','particleSystem','wgs84ToWindowCoordinates','style','refreshTimer','toDegrees','canvas','abs','toGridXY','isDestroyed','_bilinearInterpolation','vertexArray','setData','outputTexture','windTextures','__esModule','_onMouseUpEvent','_map','fromGeometry','particlesRendering','_randomParticle','mouseUp','reverseY','Sampler','ShaderSource','uniformMap','canvasHeight','speedFactor','lonRange','particles','createSegmentsGeometry','PI_OVER_TWO','createParticlesTextures','height','min','computeViewRectangle','nextParticlesPosition','Math','_calc_speedRate','_canrefresh','getColor','show','_pointerEvents','ZERO','data','position','ymax','1785309jZnqoa','tlat','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','OPAQUE','_onMap_preRenderEvent','resize','setGeometry','EventType','particlesWind','moveTo','currentParticlesSpeed','DepthFunction','auto','_onMouseMoveEvent','wheel','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','_onMouseDownEvent','dropRateBump','mouseMove','udata','segmentsColor','6597186mBJgXj','speedRate','particlesNumber','currentParticlesPosition','mouseDown','fromCache','pointer-events','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','lineWidth','absolute','NEAREST','createTexture','clearCommand','requestAnimationFrame','LINEAR','Compute','ellipsoid','_speedRate','nextParticlesSpeed','depthTexture','globalCompositeOperation','getUVByPoint','rows','setDate','_addedHook','commandType','UNSIGNED_BYTE','cancelAnimationFrame','get','createRenderingTextures','windData','getExtent','framebuffers','worker','Cartesian2','off','shaderProgram','particlesTextures','lng','maxParticles','fragmentShaderSource','clear','colors','Matrix4','_createCanvas','createComputingPrimitives','rawRenderState','removeChild','latRange','_calcUV','WindLayer','getWind','mouse_down','round','BufferUsage','1882182oZPlYG','clearFramebuffers','updateViewerParameters','preExecute','update','particlesComputing','umax','floor','PixelFormat','primitives','color','DEPTH_COMPONENT','4436754hzrHpa','BaseLayer','windField','viewRectangleToLonLatRange','4527490qFdZeJ','isInExtent','pixelSize','segments','clientWidth','cos','tlng','blue','addEventListener','framebuffer','attributeLocations','maxAge','viewport','_drawLines','colorTable','camera','mode','2QsoYPc','Appearance','animateFrame','max','add','lat','3141844Pjwmod','getOwnPropertyDescriptor','onmessage','redraw','FLOAT','lineTo','removeAll','visibility','RenderState','Texture','speed','options','width','fromCssColorString','31997080ytFCxZ'];_0x4f93=function(){return _0x16e0fa;};return _0x4f93();}function _0x2ad9(_0x3eddf8,_0x43faab){const _0x4f93ed=_0x4f93();return _0x2ad9=function(_0x2ad90e,_0x386220){_0x2ad90e=_0x2ad90e-0x1d6;let _0x376fb6=_0x4f93ed[_0x2ad90e];return _0x376fb6;},_0x2ad9(_0x3eddf8,_0x43faab);}class ParticlesRendering{constructor(_0x20f448,_0x4fe96d,_0x571904,_0x44f61c,_0x267355){this['createRenderingTextures'](_0x20f448,_0x4fe96d,_0x571904['colors']),this['createRenderingFramebuffers'](_0x20f448),this['createRenderingPrimitives'](_0x20f448,_0x571904,_0x44f61c,_0x267355);}[_0x25915f(0x1ef)](_0x42cfa6,_0x4e57f9,_0x352cf6){const _0x516e15=_0x25915f,_0x29410f={'context':_0x42cfa6,'width':_0x42cfa6['drawingBufferWidth'],'height':_0x42cfa6['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x516e15(0x211)][_0x516e15(0x276)],'pixelDatatype':Cesium$4[_0x516e15(0x271)][_0x516e15(0x1ec)]},_0x18a585={'context':_0x42cfa6,'width':_0x42cfa6['drawingBufferWidth'],'height':_0x42cfa6[_0x516e15(0x249)],'pixelFormat':Cesium$4[_0x516e15(0x211)][_0x516e15(0x214)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x24f90e=_0x352cf6[_0x516e15(0x284)],_0x3f2e1=new Float32Array(_0x24f90e*0x3);for(let _0x524eb7=0x0;_0x524eb7<_0x24f90e;_0x524eb7++){const _0x3f53fb=Cesium$4['Color'][_0x516e15(0x23d)](_0x352cf6[_0x524eb7]);_0x3f2e1[0x3*_0x524eb7]=_0x3f53fb['red'],_0x3f2e1[0x3*_0x524eb7+0x1]=_0x3f53fb['green'],_0x3f2e1[0x3*_0x524eb7+0x2]=_0x3f53fb[_0x516e15(0x220)];}const _0x44847b={'context':_0x42cfa6,'width':_0x24f90e,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x516e15(0x1e0)],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x516e15(0x1e0)]})};this[_0x516e15(0x24d)]={'segmentsColor':Util['createTexture'](_0x29410f),'segmentsDepth':Util['createTexture'](_0x18a585),'currentTrailsColor':Util[_0x516e15(0x1dd)](_0x29410f),'currentTrailsDepth':Util['createTexture'](_0x18a585),'nextTrailsColor':Util['createTexture'](_0x29410f),'nextTrailsDepth':Util[_0x516e15(0x1dd)](_0x18a585),'colorTable':Util[_0x516e15(0x1dd)](_0x44847b,_0x3f2e1)};}['createRenderingFramebuffers'](_0xfd3f67){const _0x193912=_0x25915f;this['framebuffers']={'segments':Util['createFramebuffer'](_0xfd3f67,this['textures']['segmentsColor'],this['textures'][_0x193912(0x268)]),'currentTrails':Util['createFramebuffer'](_0xfd3f67,this['textures']['currentTrailsColor'],this['textures'][_0x193912(0x255)]),'nextTrails':Util[_0x193912(0x266)](_0xfd3f67,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x3d9ecc){const _0x35a17a=_0x25915f,_0x2e9f57=0x4;let _0x264a17=[];for(let _0x36106e=0x0;_0x36106e<_0x3d9ecc['particlesTextureSize'];_0x36106e++){for(let _0x183072=0x0;_0x183072<_0x3d9ecc['particlesTextureSize'];_0x183072++){for(let _0x205ab7=0x0;_0x205ab7<_0x2e9f57;_0x205ab7++){_0x264a17['push'](_0x36106e/_0x3d9ecc['particlesTextureSize']),_0x264a17['push'](_0x183072/_0x3d9ecc['particlesTextureSize']);}}}_0x264a17=new Float32Array(_0x264a17);let _0x22f632=[];const _0x46a9c4=[-0x1,0x1],_0x18234e=[-0x1,0x1];for(let _0x205c15=0x0;_0x205c15<_0x3d9ecc['maxParticles'];_0x205c15++){for(let _0x2cf839=0x0;_0x2cf839<_0x2e9f57/0x2;_0x2cf839++){for(let _0x44b542=0x0;_0x44b542<_0x2e9f57/0x2;_0x44b542++){_0x22f632['push'](_0x46a9c4[_0x2cf839]),_0x22f632['push'](_0x18234e[_0x44b542]),_0x22f632['push'](0x0);}}}_0x22f632=new Float32Array(_0x22f632);const _0x553baf=0x6*_0x3d9ecc['maxParticles'],_0x2a143d=new Uint32Array(_0x553baf);for(let _0x3fcce9=0x0,_0x41ab08=0x0,_0x1ea07e=0x0;_0x3fcce9<_0x3d9ecc['maxParticles'];_0x3fcce9++){_0x2a143d[_0x41ab08++]=_0x1ea07e+0x0,_0x2a143d[_0x41ab08++]=_0x1ea07e+0x1,_0x2a143d[_0x41ab08++]=_0x1ea07e+0x2,_0x2a143d[_0x41ab08++]=_0x1ea07e+0x2,_0x2a143d[_0x41ab08++]=_0x1ea07e+0x1,_0x2a143d[_0x41ab08++]=_0x1ea07e+0x3,_0x1ea07e+=0x4;}const _0x171129=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x35a17a(0x234)],'componentsPerAttribute':0x2,'values':_0x264a17}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x35a17a(0x234)],'componentsPerAttribute':0x3,'values':_0x22f632})}),'indices':_0x2a143d});return _0x171129;}['createRenderingPrimitives'](_0x14ef06,_0x1e6f01,_0x4e67f2,_0x1080b0){const _0x53499a=_0x25915f,_0x1451d2=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x53499a(0x251),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1e6f01),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x1080b0['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x207986=_0x53499a;return _0x1080b0[_0x207986(0x1f7)]['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x1080b0['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x522ba1=_0x53499a;return _0x1451d2[_0x522ba1(0x24d)]['colorTable'];},'aspect':function(){const _0x59fcab=_0x53499a;return _0x14ef06[_0x59fcab(0x241)]/_0x14ef06['drawingBufferHeight'];},'pixelSize':function(){return _0x4e67f2['pixelSize'];},'lineWidth':function(){return _0x1e6f01['lineWidth'];},'particleHeight':function(){return _0x1e6f01['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x34cbd8=_0x53499a;return _0x1451d2['textures'][_0x34cbd8(0x2d7)];},'segmentsDepthTexture':function(){return _0x1451d2['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x1451d2['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x11a298=_0x53499a;return _0x1451d2[_0x11a298(0x1f2)]['currentTrails'][_0x11a298(0x1e5)];},'fadeOpacity':function(){return _0x1e6f01['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x53499a(0x2ac))]({'defines':[_0x53499a(0x2d2)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x53499a(0x2ce)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x3184be=_0x53499a,_0x48bb29=_0x1451d2['framebuffers'][_0x3184be(0x288)];_0x1451d2['framebuffers']['currentTrails']=_0x1451d2[_0x3184be(0x1f2)]['nextTrails'],_0x1451d2[_0x3184be(0x1f2)][_0x3184be(0x27a)]=_0x48bb29,_0x1451d2['primitives']['trails'][_0x3184be(0x26a)][_0x3184be(0x222)]=_0x1451d2['framebuffers'][_0x3184be(0x27a)],_0x1451d2['primitives'][_0x3184be(0x254)]['clearCommand']['framebuffer']=_0x1451d2['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x1451d2['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x164ad0=_0x53499a;return _0x1451d2['framebuffers'][_0x164ad0(0x27a)][_0x164ad0(0x1e5)];}},'vertexShaderSource':new Cesium$4[(_0x53499a(0x2ac))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x53499a(0x2ac))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x53499a(0x293)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x25915f(0x257),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x25915f(0x2c5),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x25915f(0x240)];class ParticlesComputing{constructor(_0x1c0d5d,_0x1e683f,_0x5339f7,_0x22aa01){this['data']=_0x1e683f,this['createWindTextures'](_0x1c0d5d,_0x1e683f),this['createParticlesTextures'](_0x1c0d5d,_0x5339f7,_0x22aa01),this['createComputingPrimitives'](_0x1e683f,_0x5339f7,_0x22aa01);}['createWindTextures'](_0x3c17ec,_0xc98eba){const _0x15e6c3=_0x25915f,_0x413e8d={'context':_0x3c17ec,'width':_0xc98eba['dimensions'][_0x15e6c3(0x24c)],'height':_0xc98eba[_0x15e6c3(0x259)]['lat']*(_0xc98eba[_0x15e6c3(0x259)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x15e6c3(0x234)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x15e6c3(0x25c)][_0x15e6c3(0x1dc)],'magnificationFilter':Cesium$3[_0x15e6c3(0x287)][_0x15e6c3(0x1dc)]})};this[_0x15e6c3(0x2a2)]={'U':Util['createTexture'](_0x413e8d,_0xc98eba['U']['array']),'V':Util['createTexture'](_0x413e8d,_0xc98eba['V']['array'])};}[_0x25915f(0x2b4)](_0x128fc4,_0x1761d1,_0x4d2e9f){const _0xc82102=_0x25915f,_0x1da586={'context':_0x128fc4,'width':_0x1761d1['particlesTextureSize'],'height':_0x1761d1['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype'][_0xc82102(0x234)],'flipY':![],'sampler':new Cesium$3[(_0xc82102(0x2ab))]({'minificationFilter':Cesium$3[_0xc82102(0x25c)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0xc82102(0x1dc)]})},_0x1e8166=this['randomizeParticles'](_0x1761d1['maxParticles'],_0x4d2e9f),_0x148a10=new Float32Array(0x4*_0x1761d1[_0xc82102(0x1f9)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x1da586),'currentParticlesPosition':Util['createTexture'](_0x1da586,_0x1e8166),'nextParticlesPosition':Util[_0xc82102(0x1dd)](_0x1da586,_0x1e8166),'currentParticlesSpeed':Util['createTexture'](_0x1da586,_0x148a10),'nextParticlesSpeed':Util['createTexture'](_0x1da586,_0x148a10),'postProcessingPosition':Util['createTexture'](_0x1da586,_0x1e8166),'postProcessingSpeed':Util['createTexture'](_0x1da586,_0x148a10)};}[_0x25915f(0x280)](_0x2f6e84,_0x5da782){const _0xe66558=_0x25915f,_0x3cdc5a=new Float32Array(0x4*_0x2f6e84);for(let _0x3e971b=0x0;_0x3e971b<_0x2f6e84;_0x3e971b++){_0x3cdc5a[0x4*_0x3e971b]=Cesium$3[_0xe66558(0x2b9)]['randomBetween'](_0x5da782[_0xe66558(0x2b0)]['x'],_0x5da782['lonRange']['y']),_0x3cdc5a[0x4*_0x3e971b+0x1]=Cesium$3['Math']['randomBetween'](_0x5da782['latRange']['x'],_0x5da782['latRange']['y']),_0x3cdc5a[0x4*_0x3e971b+0x2]=Cesium$3[_0xe66558(0x2b9)]['randomBetween'](this['data']['lev']['min'],this['data']['lev']['max']),_0x3cdc5a[0x4*_0x3e971b+0x3]=0x0;}return _0x3cdc5a;}['destroyParticlesTextures'](){const _0x5e1a7e=_0x25915f;Object['keys'](this['particlesTextures'])[_0x5e1a7e(0x283)](_0x40976a=>{this['particlesTextures'][_0x40976a]['destroy']();});}[_0x25915f(0x1ff)](_0x2b4b9f,_0x70cfe2,_0x2a0720){const _0x4a0380=_0x25915f,_0x53cb39=new Cesium$3['Cartesian3'](_0x2b4b9f['dimensions']['lon'],_0x2b4b9f['dimensions']['lat'],_0x2b4b9f['dimensions'][_0x4a0380(0x273)]),_0x14d20c=new Cesium$3['Cartesian3'](_0x2b4b9f['lon'][_0x4a0380(0x2b6)],_0x2b4b9f[_0x4a0380(0x22f)][_0x4a0380(0x2b6)],_0x2b4b9f['lev']['min']),_0x3cf788=new Cesium$3['Cartesian3'](_0x2b4b9f['lon']['max'],_0x2b4b9f[_0x4a0380(0x22f)]['max'],_0x2b4b9f['lev']['max']),_0x357a39=new Cesium$3[(_0x4a0380(0x28a))]((_0x3cf788['x']-_0x14d20c['x'])/(_0x53cb39['x']-0x1),(_0x3cf788['y']-_0x14d20c['y'])/(_0x53cb39['y']-0x1),_0x53cb39['z']>0x1?(_0x3cf788['z']-_0x14d20c['z'])/(_0x53cb39['z']-0x1):0x1),_0x4b8dec=new Cesium$3[(_0x4a0380(0x1f4))](_0x2b4b9f['U']['min'],_0x2b4b9f['U'][_0x4a0380(0x22d)]),_0x3c334a=new Cesium$3[(_0x4a0380(0x1f4))](_0x2b4b9f['V'][_0x4a0380(0x2b6)],_0x2b4b9f['V']['max']),_0x318cda=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x4a0380(0x1e1),'uniformMap':{'U':function(){const _0x26af75=_0x4a0380;return _0x318cda[_0x26af75(0x2a2)]['U'];},'V':function(){return _0x318cda['windTextures']['V'];},'currentParticlesPosition':function(){const _0x1f5c87=_0x4a0380;return _0x318cda['particlesTextures'][_0x1f5c87(0x2db)];},'dimension':function(){return _0x53cb39;},'minimum':function(){return _0x14d20c;},'maximum':function(){return _0x3cf788;},'interval':function(){return _0x357a39;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x4a0380(0x2cb)],'preExecute':function(){_0x318cda['primitives']['getWind']['commandToExecute']['outputTexture']=_0x318cda['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x45ce00=_0x4a0380;return _0x318cda['particlesTextures'][_0x45ce00(0x2cd)];},'particlesWind':function(){return _0x318cda['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x4b8dec;},'vSpeedRange':function(){return _0x3c334a;},'pixelSize':function(){const _0x16a7bc=_0x4a0380;return _0x2a0720[_0x16a7bc(0x21b)];},'speedFactor':function(){return _0x70cfe2['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x4a0380(0x2ac))]({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x4a0380(0x1f7)]['nextParticlesSpeed'],'preExecute':function(){const _0x3fe370=_0x4a0380,_0x4d56b4=_0x318cda['particlesTextures']['currentParticlesSpeed'];_0x318cda['particlesTextures']['currentParticlesSpeed']=_0x318cda['particlesTextures'][_0x3fe370(0x26f)],_0x318cda[_0x3fe370(0x1f7)]['postProcessingSpeed']=_0x4d56b4,_0x318cda[_0x3fe370(0x212)][_0x3fe370(0x262)]['commandToExecute']['outputTexture']=_0x318cda[_0x3fe370(0x1f7)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x58a8ea=_0x4a0380;return _0x318cda['particlesTextures'][_0x58a8ea(0x2db)];},'currentParticlesSpeed':function(){const _0x4f4090=_0x4a0380;return _0x318cda[_0x4f4090(0x1f7)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x2173a1=_0x4a0380,_0x2b7b9f=_0x318cda['particlesTextures']['currentParticlesPosition'];_0x318cda['particlesTextures'][_0x2173a1(0x2db)]=_0x318cda['particlesTextures'][_0x2173a1(0x26c)],_0x318cda['particlesTextures']['postProcessingPosition']=_0x2b7b9f,_0x318cda['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x318cda[_0x2173a1(0x1f7)][_0x2173a1(0x2b8)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x318cda['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x318cda['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x2a0720['lonRange'];},'latRange':function(){const _0x3ad3cf=_0x4a0380;return _0x2a0720[_0x3ad3cf(0x202)];},'randomCoefficient':function(){const _0x42b361=Math['random']();return _0x42b361;},'dropRate':function(){const _0x40c9ee=_0x4a0380;return _0x70cfe2[_0x40c9ee(0x27f)];},'dropRateBump':function(){const _0x10b8b8=_0x4a0380;return _0x70cfe2[_0x10b8b8(0x2d4)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x5d025e=_0x4a0380;_0x318cda['primitives']['postProcessingPosition']['commandToExecute'][_0x5d025e(0x2a1)]=_0x318cda['particlesTextures'][_0x5d025e(0x26c)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x28062f=_0x4a0380;return _0x318cda[_0x28062f(0x1f7)]['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x33bb97=_0x4a0380;return _0x318cda['particlesTextures'][_0x33bb97(0x1e4)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x58ab8d=_0x4a0380;_0x318cda['primitives'][_0x58ab8d(0x26f)]['commandToExecute']['outputTexture']=_0x318cda['particlesTextures'][_0x58ab8d(0x26f)];}})};}}const Cesium$2=mars3d__namespace[_0x25915f(0x240)];class ParticleSystem{constructor(_0x50628d,_0x116912,_0x6fa83a,_0x4cf599){const _0x40e847=_0x25915f;this['context']=_0x50628d,_0x116912={..._0x116912},_0x116912['udata']&&_0x116912['vdata']&&(_0x116912[_0x40e847(0x259)]={},_0x116912['dimensions']['lon']=_0x116912['cols'],_0x116912[_0x40e847(0x259)]['lat']=_0x116912[_0x40e847(0x1e8)],_0x116912['dimensions'][_0x40e847(0x273)]=_0x116912['lev']||0x1,_0x116912['lon']={},_0x116912['lon']['min']=_0x116912[_0x40e847(0x270)],_0x116912['lon']['max']=_0x116912['xmax'],_0x116912['lat']={},_0x116912[_0x40e847(0x22f)]['min']=_0x116912[_0x40e847(0x248)],_0x116912['lat']['max']=_0x116912['ymax'],_0x116912[_0x40e847(0x273)]={},_0x116912['lev']['min']=_0x116912['levmin']??0x1,_0x116912[_0x40e847(0x273)]['max']=_0x116912['levmax']??0x1,_0x116912['U']={},_0x116912['U']['array']=new Float32Array(_0x116912[_0x40e847(0x2d6)]),_0x116912['U']['min']=_0x116912['umin']??Math['min'](..._0x116912['udata']),_0x116912['U']['max']=_0x116912[_0x40e847(0x20f)]??Math['max'](..._0x116912['udata']),_0x116912['V']={},_0x116912['V']['array']=new Float32Array(_0x116912[_0x40e847(0x25a)]),_0x116912['V']['min']=_0x116912['vmin']??Math['min'](..._0x116912[_0x40e847(0x25a)]),_0x116912['V']['max']=_0x116912['vmax']??Math['max'](..._0x116912['vdata'])),this['data']=_0x116912,this['options']=_0x6fa83a,this[_0x40e847(0x27e)]=_0x4cf599,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x40e847(0x2c0)],this[_0x40e847(0x23b)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x3d1124){const _0x29d89f=_0x25915f;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x29d89f(0x2a2)])['forEach'](_0x2a38b9=>{const _0x5779f0=_0x29d89f;this['particlesComputing'][_0x5779f0(0x2a2)][_0x2a38b9]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x29d89f(0x283)](_0x2021d9=>{this['particlesRendering']['framebuffers'][_0x2021d9]['destroy']();}),this['context']=_0x3d1124,this['particlesComputing']=new ParticlesComputing(this[_0x29d89f(0x290)],this['data'],this[_0x29d89f(0x23b)],this['viewerParameters']),this[_0x29d89f(0x2a7)]=new ParticlesRendering(this['context'],this['data'],this[_0x29d89f(0x23b)],this['viewerParameters'],this[_0x29d89f(0x20e)]);}[_0x25915f(0x20a)](){const _0x3f2755=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x3100ff=>{const _0x1977cd=_0x2ad9;_0x3f2755['framebuffer']=this['particlesRendering']['framebuffers'][_0x3100ff],_0x3f2755[_0x1977cd(0x27d)](this['context']);});}[_0x25915f(0x28c)](_0x7d9d99){const _0x4aeeee=_0x25915f;this[_0x4aeeee(0x20a)](),this[_0x4aeeee(0x20e)]['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x7d9d99){var _0x3a466e;const _0x14d8bf=this['particlesRendering'][_0x4aeeee(0x2b2)](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x14d8bf;const _0x5885e9=Cesium$2['VertexArray'][_0x4aeeee(0x2a6)]({'context':this['context'],'geometry':_0x14d8bf,'attributeLocations':this['particlesRendering'][_0x4aeeee(0x212)][_0x4aeeee(0x21c)][_0x4aeeee(0x223)],'bufferUsage':Cesium$2[_0x4aeeee(0x208)]['STATIC_DRAW']});(_0x3a466e=this['particlesRendering']['primitives'])!==null&&_0x3a466e!==void 0x0&&(_0x3a466e=_0x3a466e['segments'])!==null&&_0x3a466e!==void 0x0&&_0x3a466e['commandToExecute']&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x5885e9);}}['setOptions'](_0x24b519){const _0x53b6b7=_0x25915f;let _0x4c2eb9=![];this['options']['maxParticles']!==_0x24b519[_0x53b6b7(0x1f9)]&&(_0x4c2eb9=!![]),Object['keys'](_0x24b519)['forEach'](_0x45fcaa=>{this['options'][_0x45fcaa]=_0x24b519[_0x45fcaa];}),this['refreshParticles'](_0x4c2eb9);}[_0x25915f(0x247)](_0x5d9c0a){const _0x4365d6=_0x25915f;Object[_0x4365d6(0x289)](_0x5d9c0a)[_0x4365d6(0x283)](_0x34c3e9=>{this['viewerParameters'][_0x34c3e9]=_0x5d9c0a[_0x34c3e9];}),this[_0x4365d6(0x28c)](![]);}['destroy'](){const _0xce0b13=_0x25915f;clearTimeout(this[_0xce0b13(0x258)]),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x5a6fd3=>{const _0x257ea2=_0xce0b13;this[_0x257ea2(0x20e)]['windTextures'][_0x5a6fd3][_0x257ea2(0x26b)]();}),this['particlesRendering']['textures'][_0xce0b13(0x227)]['destroy'](),Object[_0xce0b13(0x289)](this[_0xce0b13(0x2a7)]['framebuffers'])['forEach'](_0x4cd3b6=>{this['particlesRendering']['framebuffers'][_0x4cd3b6]['destroy']();});for(const _0x1e2ebd in this){delete this[_0x1e2ebd];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x25915f(0x272)]};class WindLayer extends BaseLayer$1{constructor(_0x252e1e={}){_0x252e1e={...DEF_OPTIONS,..._0x252e1e},super(_0x252e1e),this['_setOptionsHook'](_0x252e1e);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x195a10){this['setData'](_0x195a10);}get['colors'](){return this['options']['colors'];}set['colors'](_0x33ef9b){const _0x260dca=_0x25915f;this['options'][_0x260dca(0x1fc)]=_0x33ef9b,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x33ef9b}),this['resize']();}[_0x25915f(0x263)](){}[_0x25915f(0x1ea)](){const _0x825125=_0x25915f;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this[_0x825125(0x212)]),this['viewerParameters']={'lonRange':new Cesium$1[(_0x825125(0x1f4))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x825125(0x2bf)],0.99*0x615299),this[_0x825125(0x20b)](),window[_0x825125(0x221)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0x825125(0x2d1)],this['_onMapWhellEvent'],this),this[_0x825125(0x2a5)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x825125(0x2a9)],this[_0x825125(0x2a4)],this),this[_0x825125(0x2a5)]['on'](mars3d__namespace[_0x825125(0x2ca)]['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x825125(0x25d)]&&this['setData'](this['_data']);}['_removedHook'](){const _0x670328=_0x25915f;window[_0x670328(0x25e)](_0x670328(0x2c8),this[_0x670328(0x2c8)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this[_0x670328(0x2a5)][_0x670328(0x1f5)](mars3d__namespace[_0x670328(0x2ca)]['wheel'],this[_0x670328(0x277)],this),this['_map'][_0x670328(0x1f5)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x670328(0x2a5)][_0x670328(0x1f5)](mars3d__namespace['EventType'][_0x670328(0x2a9)],this[_0x670328(0x2a4)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x670328(0x2d0)],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}[_0x25915f(0x2c8)](){const _0x37cec1=_0x25915f;if(!this['show']||!this[_0x37cec1(0x295)])return;this['primitives'][_0x37cec1(0x2bd)]=![],this['primitives'][_0x37cec1(0x236)](),this[_0x37cec1(0x2a5)]['once'](mars3d__namespace['EventType'][_0x37cec1(0x278)],this[_0x37cec1(0x2c7)],this);}[_0x25915f(0x2c7)](_0x2c254b){const _0x2e0db1=_0x25915f;this['particleSystem']['canvasResize'](this[_0x2e0db1(0x243)]['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x25915f(0x277)](_0x35fa60){const _0x526859=_0x25915f;clearTimeout(this[_0x526859(0x298)]);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x373bff=_0x526859;if(!this['show'])return;this[_0x373bff(0x233)]();},0xc8);}['_onMouseDownEvent'](_0x4024b1){this['mouse_down']=!![];}[_0x25915f(0x2d0)](_0x4b0d38){const _0x1e0f9d=_0x25915f;if(!this[_0x1e0f9d(0x2bd)]||!this[_0x1e0f9d(0x295)])return;this[_0x1e0f9d(0x206)]&&(this['primitives'][_0x1e0f9d(0x2bd)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x150f30){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x115f89=_0x25915f;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x115f89(0x2bd)]=!![];}['setData'](_0x64730b){const _0x39166f=_0x25915f;this[_0x39166f(0x25d)]=_0x64730b,this[_0x39166f(0x295)]&&this['particleSystem'][_0x39166f(0x26b)](),this[_0x39166f(0x295)]=new ParticleSystem(this[_0x39166f(0x243)]['context'],_0x64730b,this['getOptions'](),this[_0x39166f(0x27e)]),this[_0x39166f(0x24b)]();}['_setOptionsHook'](_0x5d4884,_0x3c3516){if(_0x5d4884)for(const _0x598f19 in _0x5d4884){this[_0x598f19]=_0x5d4884[_0x598f19];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x2e3fdc=_0x25915f,_0x49311c=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x49311c*_0x49311c,{'particlesTextureSize':_0x49311c,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x2e3fdc(0x245)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x2e3fdc(0x2af)],'lineWidth':this['lineWidth'],'colors':this[_0x2e3fdc(0x1fc)]};}['addPrimitives'](){const _0x338063=_0x25915f;this['primitives']['add'](this['particleSystem'][_0x338063(0x20e)][_0x338063(0x212)][_0x338063(0x205)]),this['primitives'][_0x338063(0x22e)](this[_0x338063(0x295)]['particlesComputing']['primitives']['updateSpeed']),this['primitives'][_0x338063(0x22e)](this[_0x338063(0x295)]['particlesComputing']['primitives']['updatePosition']),this[_0x338063(0x212)]['add'](this[_0x338063(0x295)]['particlesComputing'][_0x338063(0x212)]['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x338063(0x26f)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives'][_0x338063(0x22e)](this['particleSystem']['particlesRendering'][_0x338063(0x212)]['trails']),this[_0x338063(0x212)]['add'](this[_0x338063(0x295)]['particlesRendering'][_0x338063(0x212)]['screen']);}['updateViewerParameters'](){const _0x248968=_0x25915f;let _0x128b2f=this[_0x248968(0x228)][_0x248968(0x2b7)](this['scene'][_0x248968(0x265)]['ellipsoid']);if(!_0x128b2f){const _0x472ff9=this['_map'][_0x248968(0x1f1)]();_0x128b2f=Cesium$1['Rectangle']['fromDegrees'](_0x472ff9[_0x248968(0x270)],_0x472ff9[_0x248968(0x248)],_0x472ff9['xmax'],_0x472ff9['ymax']);}const _0x1da6e9=Util[_0x248968(0x218)](_0x128b2f);this[_0x248968(0x27e)]['lonRange']['x']=_0x1da6e9['lon']['min'],this[_0x248968(0x27e)]['lonRange']['y']=_0x1da6e9[_0x248968(0x24c)][_0x248968(0x22d)],this['viewerParameters']['latRange']['x']=_0x1da6e9['lat']['min'],this[_0x248968(0x27e)]['latRange']['y']=_0x1da6e9['lat']['max'];const _0x4fc5a1=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene'][_0x248968(0x249)]);_0x4fc5a1>0x0&&(this['viewerParameters']['pixelSize']=_0x4fc5a1);}}mars3d__namespace[_0x25915f(0x269)][_0x25915f(0x291)](_0x25915f(0x246),WindLayer),mars3d__namespace['layer'][_0x25915f(0x204)]=WindLayer;class CanvasParticle{constructor(){const _0x2349ad=_0x25915f;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x2349ad(0x2c4)]=null,this['age']=null,this[_0x2349ad(0x23a)]=null;}['destroy'](){for(const _0x3a3326 in this){delete this[_0x3a3326];}}}class CanvasWindField{constructor(_0x5498a1){this['setOptions'](_0x5498a1);}get['speedRate'](){const _0x222fee=_0x25915f;return this[_0x222fee(0x1e3)];}set['speedRate'](_0x5e0d69){const _0x5b751b=_0x25915f;this['_speedRate']=(0x64-(_0x5e0d69>0x63?0x63:_0x5e0d69))*0x64,this['_calc_speedRate']=[(this[_0x5b751b(0x282)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x53246){this['_maxAge']=_0x53246;}['setOptions'](_0x1803b2){const _0x3ef2c4=_0x25915f;this['options']=_0x1803b2,this['maxAge']=_0x1803b2['maxAge']||0x78,this[_0x3ef2c4(0x2d9)]=_0x1803b2['speedRate']||0x32,this[_0x3ef2c4(0x2b1)]=[];const _0x4ca6d4=_0x1803b2['particlesNumber']||0x1000;for(let _0x5ddbf8=0x0;_0x5ddbf8<_0x4ca6d4;_0x5ddbf8++){const _0x4fc242=this[_0x3ef2c4(0x2a8)](new CanvasParticle());this['particles']['push'](_0x4fc242);}}['setDate'](_0x2a6b49){const _0x13b938=_0x25915f;this['rows']=_0x2a6b49[_0x13b938(0x1e8)],this[_0x13b938(0x28d)]=_0x2a6b49[_0x13b938(0x28d)],this['xmin']=_0x2a6b49['xmin'],this[_0x13b938(0x282)]=_0x2a6b49['xmax'],this['ymin']=_0x2a6b49['ymin'],this['ymax']=_0x2a6b49[_0x13b938(0x2c2)],this['grid']=[];const _0x8d2526=_0x2a6b49[_0x13b938(0x2d6)],_0x444cfd=_0x2a6b49['vdata'];let _0x20ba32=![];_0x8d2526['length']===this['rows']&&_0x8d2526[0x0][_0x13b938(0x284)]===this['cols']&&(_0x20ba32=!![]);let _0x4a5c65=0x0,_0x8ed4d6=null,_0x4f2cdb=null;for(let _0x1bd8bf=0x0;_0x1bd8bf<this['rows'];_0x1bd8bf++){_0x8ed4d6=[];for(let _0x290d6=0x0;_0x290d6<this['cols'];_0x290d6++,_0x4a5c65++){_0x20ba32?_0x4f2cdb=this['_calcUV'](_0x8d2526[_0x1bd8bf][_0x290d6],_0x444cfd[_0x1bd8bf][_0x290d6]):_0x4f2cdb=this[_0x13b938(0x203)](_0x8d2526[_0x4a5c65],_0x444cfd[_0x4a5c65]),_0x8ed4d6[_0x13b938(0x274)](_0x4f2cdb);}this['grid'][_0x13b938(0x274)](_0x8ed4d6);}this[_0x13b938(0x23b)]['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x3402e5=_0x25915f;delete this['rows'],delete this[_0x3402e5(0x28d)],delete this['xmin'],delete this[_0x3402e5(0x282)],delete this['ymin'],delete this[_0x3402e5(0x2c2)],delete this[_0x3402e5(0x24a)],delete this['particles'];}[_0x25915f(0x29c)](_0x5ec746,_0x2a5785){const _0x359489=_0x25915f,_0x2f8561=(_0x5ec746-this['xmin'])/(this['xmax']-this[_0x359489(0x270)])*(this['cols']-0x1),_0x2345db=(this[_0x359489(0x2c2)]-_0x2a5785)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x2f8561,_0x2345db];}['getUVByXY'](_0x3f6b48,_0x4fd77b){const _0x1dc182=_0x25915f;if(_0x3f6b48<0x0||_0x3f6b48>=this['cols']||_0x4fd77b>=this[_0x1dc182(0x1e8)])return[0x0,0x0,0x0];const _0x1aada3=Math['floor'](_0x3f6b48),_0x279cba=Math[_0x1dc182(0x210)](_0x4fd77b);if(_0x1aada3===_0x3f6b48&&_0x279cba===_0x4fd77b)return this['grid'][_0x4fd77b][_0x3f6b48];const _0x1a210a=_0x1aada3+0x1,_0x3f040c=_0x279cba+0x1,_0x2659aa=this['getUVByXY'](_0x1aada3,_0x279cba),_0x4e347c=this['getUVByXY'](_0x1a210a,_0x279cba),_0x4db137=this['getUVByXY'](_0x1aada3,_0x3f040c),_0x780f68=this[_0x1dc182(0x244)](_0x1a210a,_0x3f040c);let _0x127dd7=null;try{_0x127dd7=this[_0x1dc182(0x29e)](_0x3f6b48-_0x1aada3,_0x4fd77b-_0x279cba,_0x2659aa,_0x4e347c,_0x4db137,_0x780f68);}catch(_0x5d7346){console['log'](_0x3f6b48,_0x4fd77b);}return _0x127dd7;}['_bilinearInterpolation'](_0x12edca,_0x3e6df6,_0x38dd22,_0x15fd90,_0x37066e,_0x116847){const _0x37497d=0x1-_0x12edca,_0x3c7207=0x1-_0x3e6df6,_0x666963=_0x37497d*_0x3c7207,_0x5ef7b0=_0x12edca*_0x3c7207,_0x361a8e=_0x37497d*_0x3e6df6,_0xbf5455=_0x12edca*_0x3e6df6,_0xca289e=_0x38dd22[0x0]*_0x666963+_0x15fd90[0x0]*_0x5ef7b0+_0x37066e[0x0]*_0x361a8e+_0x116847[0x0]*_0xbf5455,_0x2cbc30=_0x38dd22[0x1]*_0x666963+_0x15fd90[0x1]*_0x5ef7b0+_0x37066e[0x1]*_0x361a8e+_0x116847[0x1]*_0xbf5455;return this['_calcUV'](_0xca289e,_0x2cbc30);}[_0x25915f(0x203)](_0x3cafec,_0x2a10ed){return[+_0x3cafec,+_0x2a10ed,Math['sqrt'](_0x3cafec*_0x3cafec+_0x2a10ed*_0x2a10ed)];}[_0x25915f(0x1e7)](_0x3e2b17,_0x3b8b7e){const _0x311086=_0x25915f;if(!this[_0x311086(0x21a)](_0x3e2b17,_0x3b8b7e))return null;const _0x2ef5b7=this['toGridXY'](_0x3e2b17,_0x3b8b7e),_0x5ce278=this['getUVByXY'](_0x2ef5b7[0x0],_0x2ef5b7[0x1]);return _0x5ce278;}[_0x25915f(0x21a)](_0x2611e1,_0xb3b600){const _0x165036=_0x25915f;return _0x2611e1>=this['xmin']&&_0x2611e1<=this['xmax']&&_0xb3b600>=this['ymin']&&_0xb3b600<=this[_0x165036(0x2c2)]?!![]:![];}['getRandomLatLng'](){const _0x300e39=fRandomByfloat(this['xmin'],this['xmax']),_0x49508a=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x49508a,'lng':_0x300e39};}['getParticles'](){const _0xb31267=_0x25915f;let _0x1a4abd,_0x35becc,_0x541121;for(let _0x3a304d=0x0,_0x8a903c=this[_0xb31267(0x2b1)]['length'];_0x3a304d<_0x8a903c;_0x3a304d++){let _0x50974b=this['particles'][_0x3a304d];_0x50974b['age']<=0x0&&(_0x50974b=this[_0xb31267(0x2a8)](_0x50974b));if(_0x50974b['age']>0x0){const _0x16054c=_0x50974b[_0xb31267(0x21f)],_0x3385f5=_0x50974b['tlat'];_0x541121=this[_0xb31267(0x1e7)](_0x16054c,_0x3385f5),_0x541121?(_0x1a4abd=_0x16054c+this[_0xb31267(0x2ba)][0x0]*_0x541121[0x0],_0x35becc=_0x3385f5+this[_0xb31267(0x2ba)][0x1]*_0x541121[0x1],_0x50974b['lng']=_0x16054c,_0x50974b[_0xb31267(0x22f)]=_0x3385f5,_0x50974b['tlng']=_0x1a4abd,_0x50974b['tlat']=_0x35becc,_0x50974b[_0xb31267(0x23a)]=_0x541121[0x2],_0x50974b[_0xb31267(0x27c)]--):_0x50974b['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x4c3ba6){const _0x3ccdef=_0x25915f;let _0x2319a5,_0x2bfd90;for(let _0x18a1a0=0x0;_0x18a1a0<0x1e;_0x18a1a0++){_0x2319a5=this['getRandomLatLng'](),_0x2bfd90=this['getUVByPoint'](_0x2319a5[_0x3ccdef(0x1f8)],_0x2319a5['lat']);if(_0x2bfd90&&_0x2bfd90[0x2]>0x0)break;}if(!_0x2bfd90)return _0x4c3ba6;const _0x124418=_0x2319a5['lng']+this['_calc_speedRate'][0x0]*_0x2bfd90[0x0],_0x346e8c=_0x2319a5[_0x3ccdef(0x22f)]+this['_calc_speedRate'][0x1]*_0x2bfd90[0x1];return _0x4c3ba6['lng']=_0x2319a5['lng'],_0x4c3ba6['lat']=_0x2319a5['lat'],_0x4c3ba6['tlng']=_0x124418,_0x4c3ba6['tlat']=_0x346e8c,_0x4c3ba6['age']=Math[_0x3ccdef(0x207)](Math['random']()*this['maxAge']),_0x4c3ba6['speed']=_0x2bfd90[0x2],_0x4c3ba6;}['destroy'](){for(const _0x1176a5 in this){delete this[_0x1176a5];}}}function fRandomByfloat(_0x59b2a9,_0x12fd6a){return _0x59b2a9+Math['random']()*(_0x12fd6a-_0x59b2a9);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x25915f(0x216)];class CanvasWindLayer extends BaseLayer{constructor(_0x33458a={}){super(_0x33458a),this['_setOptionsHook'](_0x33458a),this['canvas']=null,_0x33458a['colors']&&_0x33458a['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x33458a));}['_setOptionsHook'](_0x5af544,_0x27e9e2){const _0x35f50b=_0x25915f;this['frameTime']=0x3e8/(_0x5af544['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x5af544['color']||'#ffffff',this['lineWidth']=_0x5af544['lineWidth']||0x1,this['fixedHeight']=_0x5af544['fixedHeight']??0x0,this[_0x35f50b(0x2aa)]=_0x5af544[_0x35f50b(0x2aa)]??![],this[_0x35f50b(0x217)]&&this['windField'][_0x35f50b(0x261)](_0x5af544);}get['layer'](){const _0x4c2701=_0x25915f;return this[_0x4c2701(0x29a)];}get['canvasWidth'](){const _0xeed08=_0x25915f;return this[_0xeed08(0x2a5)]['scene']['canvas'][_0xeed08(0x21d)];}get[_0x25915f(0x2ae)](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x25915f(0x24e)](){const _0x25e0a1=_0x25915f;return this[_0x25e0a1(0x2be)];}set[_0x25915f(0x24e)](_0x5b1a43){const _0x3f7f3e=_0x25915f;this['_pointerEvents']=_0x5b1a43;if(!this['canvas'])return;_0x5b1a43?this[_0x3f7f3e(0x29a)]['style']['pointer-events']='all':this['canvas']['style'][_0x3f7f3e(0x1d8)]=_0x3f7f3e(0x279);}get[_0x25915f(0x2da)](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x49dd7a){const _0xf9f36f=_0x25915f;this['options']['particlesNumber']=_0x49dd7a,clearTimeout(this[_0xf9f36f(0x2bb)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x25915f(0x2d9)](){return this['options']['speedRate'];}set['speedRate'](_0x38e7f7){this['options']['speedRate']=_0x38e7f7,this['windField']&&(this['windField']['speedRate']=_0x38e7f7);}get['maxAge'](){const _0x15f1e0=_0x25915f;return this['options'][_0x15f1e0(0x224)];}set['maxAge'](_0x1bb1e6){const _0x29dee1=_0x25915f;this['options']['maxAge']=_0x1bb1e6,this['windField']&&(this['windField'][_0x29dee1(0x224)]=_0x1bb1e6);}get['data'](){return this['windData'];}set['data'](_0x4ddbb5){const _0xc23b2d=_0x25915f;this[_0xc23b2d(0x2a0)](_0x4ddbb5);}['_showHook'](_0x2d2fad){const _0x5f3338=_0x25915f;_0x2d2fad?this[_0x5f3338(0x1ea)]():(this['windData']&&(this['options']['data']=this[_0x5f3338(0x1f0)]),this[_0x5f3338(0x28b)]());}['_mountedHook'](){const _0x49154d=_0x25915f;this['options'][_0x49154d(0x1f3)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x25915f(0x1ea)](){const _0x383ef9=_0x25915f;this['canvas']=this['_createCanvas'](),this[_0x383ef9(0x25b)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this[_0x383ef9(0x23b)][_0x383ef9(0x2c0)]);}['_removedHook'](){const _0x290a3a=_0x25915f;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container'][_0x290a3a(0x201)](this['canvas']),delete this['canvas']);}[_0x25915f(0x1fe)](){const _0x5c4832=_0x25915f,_0x481a62=mars3d__namespace[_0x5c4832(0x27b)]['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x481a62[_0x5c4832(0x297)][_0x5c4832(0x2c1)]=_0x5c4832(0x1db),_0x481a62[_0x5c4832(0x297)]['top']=_0x5c4832(0x264),_0x481a62['style']['left']='0px',_0x481a62['style'][_0x5c4832(0x23c)]=this['_map']['scene'][_0x5c4832(0x29a)]['clientWidth']+'px',_0x481a62['style']['height']=this[_0x5c4832(0x2a5)]['scene'][_0x5c4832(0x29a)]['clientHeight']+'px',_0x481a62['style'][_0x5c4832(0x24e)]=this['_pointerEvents']?_0x5c4832(0x2cf):'none',_0x481a62['style']['zIndex']=this[_0x5c4832(0x23b)]['zIndex']??0x9,_0x481a62['width']=this['_map'][_0x5c4832(0x243)][_0x5c4832(0x29a)]['clientWidth'],_0x481a62[_0x5c4832(0x2b5)]=this['_map']['scene']['canvas']['clientHeight'],_0x481a62;}[_0x25915f(0x2c8)](){const _0x2416c1=_0x25915f;this['canvas']&&(this[_0x2416c1(0x29a)]['style']['width']=this[_0x2416c1(0x2a5)]['scene']['canvas'][_0x2416c1(0x21d)]+'px',this['canvas']['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas'][_0x2416c1(0x21d)],this[_0x2416c1(0x29a)][_0x2416c1(0x2b5)]=this['_map']['scene']['canvas'][_0x2416c1(0x294)]);}['bindEvent'](){const _0x44145f=_0x25915f,_0x55bdaa=this;let _0x3a60c9=Date['now']();(function _0x27b240(){const _0x5d476e=_0x2ad9;_0x55bdaa['animateFrame']=window[_0x5d476e(0x1df)](_0x27b240);if(_0x55bdaa['show']&&_0x55bdaa['windField']){const _0x7dbd33=Date['now'](),_0x58db33=_0x7dbd33-_0x3a60c9;_0x58db33>_0x55bdaa['frameTime']&&(_0x3a60c9=_0x7dbd33-_0x58db33%_0x55bdaa['frameTime'],_0x55bdaa[_0x5d476e(0x20d)]());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this[_0x44145f(0x2a5)]['on'](mars3d__namespace[_0x44145f(0x2ca)]['wheel'],this['_onMapWhellEvent'],this),this[_0x44145f(0x2a5)]['on'](mars3d__namespace['EventType'][_0x44145f(0x1d6)],this[_0x44145f(0x2d3)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x44145f(0x2a9)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x474986=_0x25915f;window[_0x474986(0x1ed)](this[_0x474986(0x22c)]),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this[_0x474986(0x2a5)]['off'](mars3d__namespace[_0x474986(0x2ca)][_0x474986(0x2d1)],this[_0x474986(0x277)],this),this['_map'][_0x474986(0x1f5)](mars3d__namespace['EventType'][_0x474986(0x1d6)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x474986(0x2a9)],this['_onMouseUpEvent'],this),this['_map'][_0x474986(0x1f5)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x11dfa2){const _0x473240=_0x25915f;clearTimeout(this[_0x473240(0x298)]);if(!this['show']||!this[_0x473240(0x29a)])return;this['canvas'][_0x473240(0x297)][_0x473240(0x237)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x4cafb4=_0x473240;if(!this['show'])return;this['redraw'](),this['canvas'][_0x4cafb4(0x297)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x2643cc){const _0x34be3c=_0x25915f;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x34be3c(0x2d0)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x34be3c(0x2d5)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x344921){const _0x255cd0=_0x25915f;if(!this[_0x255cd0(0x2bd)]||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this[_0x255cd0(0x275)]=!![]);}['_onMouseUpEvent'](_0x201c00){const _0x5b2caf=_0x25915f;if(!this['show']||!this['canvas'])return;this[_0x5b2caf(0x2a5)]['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x5b2caf(0x2d0)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x5b2caf(0x237)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x429d7c){const _0x264845=_0x25915f;this[_0x264845(0x1fb)](),this['windData']=_0x429d7c,this['windField']['setDate'](_0x429d7c),this['redraw']();}[_0x25915f(0x233)](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}[_0x25915f(0x20d)](){const _0x4fa2ac=_0x25915f;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0x4fa2ac(0x1f3)])this['windField'][_0x4fa2ac(0x20d)]();else{const _0x558df4=this[_0x4fa2ac(0x217)]['getParticles']();this['_drawLines'](_0x558df4);}this[_0x4fa2ac(0x281)]=![];}[_0x25915f(0x226)](_0x3d16ef){const _0x329265=_0x25915f;this['canvasContext']['globalCompositeOperation']='destination-in',this[_0x329265(0x25b)]['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this[_0x329265(0x25b)][_0x329265(0x1e6)]='lighter',this['canvasContext'][_0x329265(0x253)]=0.9;const _0xbe9940=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x4f961c=this['canvasWidth']*0.25;if(this[_0x329265(0x260)])for(let _0x26740e=0x0,_0x365f56=_0x3d16ef['length'];_0x26740e<_0x365f56;_0x26740e++){const _0x1febff=_0x3d16ef[_0x26740e],_0x314b16=this['_tomap'](_0x1febff['lng'],_0x1febff[_0x329265(0x22f)],_0x1febff),_0x82de78=this['_tomap'](_0x1febff['tlng'],_0x1febff['tlat'],_0x1febff);if(!_0x314b16||!_0x82de78)continue;if(_0xbe9940&&Math[_0x329265(0x29b)](_0x314b16[0x0]-_0x82de78[0x0])>=_0x4f961c)continue;this[_0x329265(0x25b)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x329265(0x28f)]=this['_colorRamp'][_0x329265(0x2bc)](_0x1febff['speed']),this['canvasContext'][_0x329265(0x2cc)](_0x314b16[0x0],_0x314b16[0x1]),this['canvasContext']['lineTo'](_0x82de78[0x0],_0x82de78[0x1]),this[_0x329265(0x25b)][_0x329265(0x292)]();}else{this[_0x329265(0x25b)]['beginPath'](),this[_0x329265(0x25b)][_0x329265(0x1da)]=this[_0x329265(0x1da)],this['canvasContext']['strokeStyle']=this[_0x329265(0x213)];for(let _0x521060=0x0,_0x41967a=_0x3d16ef[_0x329265(0x284)];_0x521060<_0x41967a;_0x521060++){const _0x3b02c8=_0x3d16ef[_0x521060],_0x1842c0=this['_tomap'](_0x3b02c8['lng'],_0x3b02c8[_0x329265(0x22f)],_0x3b02c8),_0x1ff8ed=this['_tomap'](_0x3b02c8['tlng'],_0x3b02c8[_0x329265(0x2c4)],_0x3b02c8);if(!_0x1842c0||!_0x1ff8ed)continue;if(_0xbe9940&&Math[_0x329265(0x29b)](_0x1842c0[0x0]-_0x1ff8ed[0x0])>=_0x4f961c)continue;this['canvasContext']['moveTo'](_0x1842c0[0x0],_0x1842c0[0x1]),this['canvasContext'][_0x329265(0x235)](_0x1ff8ed[0x0],_0x1ff8ed[0x1]);}this['canvasContext'][_0x329265(0x292)]();}}[_0x25915f(0x285)](_0x98b694,_0x4420ef,_0x4055db){const _0x153b13=_0x25915f,_0x333afd=Cesium['Cartesian3']['fromDegrees'](_0x98b694,_0x4420ef,this[_0x153b13(0x242)]),_0x127bc8=this[_0x153b13(0x2a5)]['scene'];if(_0x127bc8[_0x153b13(0x229)]===Cesium['SceneMode']['SCENE3D']){const _0x38f194=new Cesium['EllipsoidalOccluder'](_0x127bc8['globe'][_0x153b13(0x1e2)],_0x127bc8[_0x153b13(0x228)]['positionWC']),_0x1975e8=_0x38f194['isPointVisible'](_0x333afd);if(!_0x1975e8)return _0x4055db['age']=0x0,null;}const _0x229fed=Cesium['SceneTransforms'][_0x153b13(0x296)](this['_map']['scene'],_0x333afd);return _0x229fed?[_0x229fed['x'],_0x229fed['y']]:null;}['clear'](){const _0x369dd9=_0x25915f;this[_0x369dd9(0x217)][_0x369dd9(0x1fb)](),delete this['windData'];}['initWorker'](){const _0x3ed105=_0x25915f;this[_0x3ed105(0x1f3)]=new Worker(this[_0x3ed105(0x23b)][_0x3ed105(0x1f3)]),this['worker'][_0x3ed105(0x232)]=_0x340d4c=>{const _0x109398=_0x3ed105;this[_0x109398(0x226)](_0x340d4c['data'][_0x109398(0x2b1)]),this[_0x109398(0x28e)]=![];},this['windField']={'init':_0x2289ef=>{const _0x33680e=_0x3ed105;this['worker'][_0x33680e(0x26e)]({'type':'init','options':_0x2289ef});},'setOptions':_0x4546f3=>{this['worker']['postMessage']({'type':'setOptions','options':_0x4546f3});},'setDate':_0x790e08=>{const _0xb274d9=_0x3ed105;this['worker'][_0xb274d9(0x26e)]({'type':_0xb274d9(0x1e9),'data':_0x790e08});},'update':()=>{const _0x28882b=_0x3ed105;if(this[_0x28882b(0x28e)])return;this['_updateIng2']=!![],this[_0x28882b(0x1f3)]['postMessage']({'type':_0x28882b(0x20d)});},'clear':()=>{const _0x514f9e=_0x3ed105;this['worker']['postMessage']({'type':_0x514f9e(0x1fb)});}},this[_0x3ed105(0x217)]['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x25915f(0x23f)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
