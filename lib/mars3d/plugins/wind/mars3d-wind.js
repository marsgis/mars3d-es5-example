/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.10
 * 编译日期：2023-10-23 17:28:11
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0xd3c246=_0x46ca;(function(_0x862608,_0x1c2cf1){const _0x1a9968=_0x46ca,_0xef1770=_0x862608();while(!![]){try{const _0x263caa=parseInt(_0x1a9968(0x192))/0x1*(-parseInt(_0x1a9968(0xf5))/0x2)+parseInt(_0x1a9968(0x16c))/0x3*(parseInt(_0x1a9968(0xd7))/0x4)+-parseInt(_0x1a9968(0x104))/0x5*(parseInt(_0x1a9968(0x111))/0x6)+parseInt(_0x1a9968(0x175))/0x7+-parseInt(_0x1a9968(0xde))/0x8+-parseInt(_0x1a9968(0x163))/0x9+parseInt(_0x1a9968(0x189))/0xa;if(_0x263caa===_0x1c2cf1)break;else _0xef1770['push'](_0xef1770['shift']());}catch(_0x389314){_0xef1770['push'](_0xef1770['shift']());}}}(_0x32f3,0x65313));function _0x32f3(){const _0x1e6d32=['red','destroy','push','create','udata','framebuffers','update','ymax','PixelFormat','fromCache','pointerEvents','currentParticlesSpeed','getUVByXY','removeAll','get','TextureMinificationFilter','particlesComputing','refreshTimer','Sampler','mouse_down','setOptions','_data','randomBetween','arrayBufferView','pow','vmin','tlat','all','RGB','fragmentShaderSource','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','DepthFunction','pointer-events','register','dimensions','particlesNumber','ALWAYS','0px','ShaderSource','Cesium','outputTexture','strokeStyle','lev','NEAREST','updateViewerParameters','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','stroke','speedRate','absolute','context','particlesTextureSize','uniformMap','wind','depthTexture','viewport','textures','reverse','_setOptionsHook','PrimitiveType','getWind','mode','resize','LINEAR','Cartesian2','viewerParameters','Math','_onMouseDownEvent','requestAnimationFrame','getOwnPropertyDescriptor','currentTrails','_drawLines','2164509usCUtj','steps','add','segments','speedFactor','canvasWidth','getFullscreenQuad','remove','Cartesian3','3RHzrwF','worker','toRadians','style','isInExtent','_onMap_preRenderEvent','postProcessingSpeed','particlesTextures','particlesRendering','5643575QgoZSh','PixelDatatype','_addedHook','_onMapWhellEvent','xmax','color','mod','xmin','tlng','windField','destroyParticlesTextures','colors','createRenderingPrimitives','fromGeometry','vertexShaderSource','defined','DISABLE_GL_POSITION_LOG_DEPTH','lon','GeometryAttribute','ymin','9910040gCpgns','speed','windTextures','latRange','Compute','_map','init','vertexArray','RenderState','189341HLeudo','camera','geometry','FLOAT','UNSIGNED_BYTE','_randomParticle','options','createWindTextures','redraw','ellipsoid','ComponentDatatype','currentParticlesPosition','EventType','defineProperty','moveTo','destination-in','BufferUsage','keys','updateSpeed','nextTrails','SCENE3D','lineWidth','mouseMove','particles','commandToExecute','getParticles','clampToLatitudeRange','array','beginPath','layer','framebuffer','createRenderingFramebuffers','createRenderingTextures','lat','maxParticles','mouseDown','refreshParticles','_onMouseMoveEvent','sqrt','TWO_PI','getColor','canvas','setDate','lineTo','Matrix4','postProcessingPosition','trails','__esModule','PI_OVER_THREE','1632116aMXZzx','min','addPrimitives','getUVByPoint','rawRenderState','PI_OVER_TWO','_pointerEvents','4125576zRvVzG','_onMouseUpEvent','nextParticlesPosition','nextParticlesSpeed','getOptions','execute','TextureMagnificationFilter','vdata','south','toDegrees','max','rows','removeChild','clientHeight','blending','frameTime','off','mouse_move','_createCanvas','maxAge','createParticlesTextures','floor','show','6EykBdn','drawingBufferWidth','forEach','colorTable','fixedHeight','cols','lonRange','createTexture','_tomap','grid','width','_colorRamp','_calc_speedRate','lng','shaderProgram','10jBLhvu','clearCommand','PrimitiveCollection','primitives','data','getContext','dropRate','clearFramebuffers','mouseUp','height','segmentsColor','particleSystem','none','1399662PWODVv','particlesWind','unbindEvent','scene','wheel','primitiveType','canvasContext','_canrefresh','age','_updateIng2','initWorker'];_0x32f3=function(){return _0x1e6d32;};return _0x32f3();}function _interopNamespace(_0x5571e4){const _0x50dd6f=_0x46ca;if(_0x5571e4&&_0x5571e4[_0x50dd6f(0xd5)])return _0x5571e4;var _0x2c2e19=Object[_0x50dd6f(0x11f)](null);return _0x5571e4&&Object['keys'](_0x5571e4)['forEach'](function(_0xa5e770){const _0x50a8ef=_0x50dd6f;if(_0xa5e770!=='default'){var _0x454775=Object[_0x50a8ef(0x160)](_0x5571e4,_0xa5e770);Object[_0x50a8ef(0xb3)](_0x2c2e19,_0xa5e770,_0x454775[_0x50a8ef(0x12a)]?_0x454775:{'enumerable':!![],'get':function(){return _0x5571e4[_0xa5e770];}});}}),_0x2c2e19['default']=_0x5571e4,_0x2c2e19;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x1dd474,_0x210b21){const _0x5d6892=_0x46ca,_0x1f149c=_0x1dd474*Math['cos'](Cesium$7[_0x5d6892(0x15d)]['toRadians'](_0x210b21));return _0x1f149c;}function getV(_0x300dc6,_0x192784){const _0x16b4a1=_0x46ca,_0x1b9e61=_0x300dc6*Math['sin'](Cesium$7['Math'][_0x16b4a1(0x16e)](_0x192784));return _0x1b9e61;}function getSpeed(_0x58068f,_0x55c8ad){const _0x1c3d06=_0x46ca,_0x2942ec=Math['sqrt'](Math['pow'](_0x58068f,0x2)+Math[_0x1c3d06(0x134)](_0x55c8ad,0x2));return _0x2942ec;}function getDirection(_0x4c581f,_0x26c1c8){const _0x116adb=_0x46ca;let _0x3d9715=Cesium$7['Math'][_0x116adb(0xe7)](Math['atan2'](_0x26c1c8,_0x4c581f));return _0x3d9715+=_0x3d9715<0x0?0x168:0x0,_0x3d9715;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x88c2c9){const _0x2eb579=_0x46ca;this['commandType']=_0x88c2c9['commandType'],this['geometry']=_0x88c2c9[_0x2eb579(0x194)],this['attributeLocations']=_0x88c2c9['attributeLocations'],this['primitiveType']=_0x88c2c9['primitiveType'],this[_0x2eb579(0x14f)]=_0x88c2c9['uniformMap'],this['vertexShaderSource']=_0x88c2c9[_0x2eb579(0x183)],this[_0x2eb579(0x139)]=_0x88c2c9['fragmentShaderSource'],this['rawRenderState']=_0x88c2c9['rawRenderState'],this[_0x2eb579(0xc4)]=_0x88c2c9['framebuffer'],this['outputTexture']=_0x88c2c9['outputTexture'],this['autoClear']=_0x88c2c9['autoClear']??![],this['preExecute']=_0x88c2c9['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x323af5){const _0x1f7163=_0x46ca;switch(this['commandType']){case'Draw':{const _0x271b3c=Cesium$6['VertexArray'][_0x1f7163(0x182)]({'context':_0x323af5,'geometry':this[_0x1f7163(0x194)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0xe31920=Cesium$6['ShaderProgram'][_0x1f7163(0x125)]({'context':_0x323af5,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x1f7163(0x183)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x3c33f4=Cesium$6[_0x1f7163(0x191)]['fromCache'](this[_0x1f7163(0xdb)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x1f7163(0x116)],'shaderProgram':_0xe31920,'vertexArray':_0x271b3c,'modelMatrix':Cesium$6[_0x1f7163(0xd2)]['IDENTITY'],'renderState':_0x3c33f4,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x1f7163(0x18d):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0xae25fd,_0x5dae96){const _0x5812a7=_0x46ca;this['geometry']=_0x5dae96;const _0x183227=Cesium$6['VertexArray'][_0x5812a7(0x182)]({'context':_0xae25fd,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x183227;}[_0xd3c246(0x122)](_0x14384f){const _0x4b1ea9=_0xd3c246;if(!this['show'])return;if(_0x14384f['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this[_0x4b1ea9(0xbe)])&&(this[_0x4b1ea9(0xbe)]=this['createCommand'](_0x14384f['context'])),Cesium$6[_0x4b1ea9(0x184)](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x14384f['commandList']['push'](this[_0x4b1ea9(0x105)]),_0x14384f['commandList']['push'](this[_0x4b1ea9(0xbe)]);}['isDestroyed'](){return![];}[_0xd3c246(0x11d)](){const _0x199d2b=_0xd3c246;if(this['clearCommand']){var _0x253ad8,_0x4b0610;(_0x253ad8=this['clearCommand'])!==null&&_0x253ad8!==void 0x0&&_0x253ad8[_0x199d2b(0x190)]&&this['clearCommand'][_0x199d2b(0x190)]['destroy'](),(_0x4b0610=this[_0x199d2b(0x105)])!==null&&_0x4b0610!==void 0x0&&_0x4b0610['shaderProgram']&&this[_0x199d2b(0x105)][_0x199d2b(0x103)]['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this[_0x199d2b(0xbe)]['vertexArray']['destroy'](),this[_0x199d2b(0xbe)]['shaderProgram']&&this['commandToExecute'][_0x199d2b(0x103)][_0x199d2b(0x11d)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0xd3c246(0x143)],Util=(function(){const _0x32a532=function(){const _0x3dbccf=_0x46ca,_0x2e929a=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x3dbccf(0xb0)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2e929a;},_0x366ea4=function(_0x3bb152,_0xf9f040){const _0x43e186=_0x46ca;if(Cesium$5['defined'](_0xf9f040)){const _0x201987={};_0x201987[_0x43e186(0x133)]=_0xf9f040,_0x3bb152['source']=_0x201987;}const _0x3c0922=new Cesium$5['Texture'](_0x3bb152);return _0x3c0922;},_0x12a63d=function(_0x286d7e,_0x581604,_0x23a0ec){const _0x128dfa=new Cesium$5['Framebuffer']({'context':_0x286d7e,'colorTextures':[_0x581604],'depthTexture':_0x23a0ec});return _0x128dfa;},_0xf304b9=function(_0xf3dfd5){const _0x497c86=_0x46ca,_0x2d2030=!![],_0x566798=![],_0x4d3988={'viewport':_0xf3dfd5[_0x497c86(0x152)],'depthTest':_0xf3dfd5['depthTest'],'depthMask':_0xf3dfd5['depthMask'],'blending':_0xf3dfd5[_0x497c86(0xec)]},_0xf6c706=Cesium$5['Appearance']['getDefaultRenderState'](_0x2d2030,_0x566798,_0x4d3988);return _0xf6c706;},_0x5b5722=function(_0x4f201b){const _0x11269d=_0x46ca,_0x352f8b={},_0xd2b67d=Cesium$5['Math'][_0x11269d(0x17b)](_0x4f201b['west'],Cesium$5[_0x11269d(0x15d)][_0x11269d(0xcd)]),_0x54639d=Cesium$5['Math']['mod'](_0x4f201b['east'],Cesium$5[_0x11269d(0x15d)]['TWO_PI']),_0x2d038f=_0x4f201b['width'];let _0x3534db,_0x1243dd;_0x2d038f>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x3534db=0x0,_0x1243dd=Cesium$5[_0x11269d(0x15d)]['TWO_PI']):_0x54639d-_0xd2b67d<_0x2d038f?(_0x3534db=_0xd2b67d,_0x1243dd=_0xd2b67d+_0x2d038f):(_0x3534db=_0xd2b67d,_0x1243dd=_0x54639d);_0x352f8b[_0x11269d(0x186)]={'min':Cesium$5['Math']['toDegrees'](_0x3534db),'max':Cesium$5[_0x11269d(0x15d)][_0x11269d(0xe7)](_0x1243dd)};const _0x22b23d=_0x4f201b[_0x11269d(0xe6)],_0x465302=_0x4f201b['north'],_0x5e0a0e=_0x4f201b[_0x11269d(0x10d)],_0x29bf57=_0x5e0a0e>Cesium$5['Math']['PI']/0xc?_0x5e0a0e/0x2:0x0;let _0x5b167d=Cesium$5['Math']['clampToLatitudeRange'](_0x22b23d-_0x29bf57),_0xc2b75f=Cesium$5['Math'][_0x11269d(0xc0)](_0x465302+_0x29bf57);return _0x5b167d<-Cesium$5['Math'][_0x11269d(0xd6)]&&(_0x5b167d=-Cesium$5['Math'][_0x11269d(0xdc)]),_0xc2b75f>Cesium$5['Math']['PI_OVER_THREE']&&(_0xc2b75f=Cesium$5['Math']['PI_OVER_TWO']),_0x352f8b[_0x11269d(0xc7)]={'min':Cesium$5[_0x11269d(0x15d)]['toDegrees'](_0x5b167d),'max':Cesium$5['Math']['toDegrees'](_0xc2b75f)},_0x352f8b;};return{'getFullscreenQuad':_0x32a532,'createTexture':_0x366ea4,'createFramebuffer':_0x12a63d,'createRawRenderState':_0xf304b9,'viewRectangleToLonLatRange':_0x5b5722};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0xd3c246(0x149),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0xd3c246(0x143)];class ParticlesRendering{constructor(_0x528e92,_0xb9795d,_0x38cd87,_0x582801,_0x2db40a){const _0x25a1c1=_0xd3c246;this['createRenderingTextures'](_0x528e92,_0xb9795d,_0x38cd87['colors']),this[_0x25a1c1(0xc5)](_0x528e92),this['createRenderingPrimitives'](_0x528e92,_0x38cd87,_0x582801,_0x2db40a);}[_0xd3c246(0xc6)](_0x35f4d7,_0x1fab12,_0x18d62c){const _0x587b36=_0xd3c246,_0x18a5e6={'context':_0x35f4d7,'width':_0x35f4d7['drawingBufferWidth'],'height':_0x35f4d7['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x587b36(0xaa)]},_0x54aada={'context':_0x35f4d7,'width':_0x35f4d7['drawingBufferWidth'],'height':_0x35f4d7['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x587b36(0x124)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x587b36(0x176)]['UNSIGNED_INT']},_0x2ba59d=_0x18d62c['length'],_0x4b59df=new Float32Array(_0x2ba59d*0x3);for(let _0x428a7b=0x0;_0x428a7b<_0x2ba59d;_0x428a7b++){const _0x33b60a=Cesium$4['Color']['fromCssColorString'](_0x18d62c[_0x428a7b]);_0x4b59df[0x3*_0x428a7b]=_0x33b60a[_0x587b36(0x11c)],_0x4b59df[0x3*_0x428a7b+0x1]=_0x33b60a['green'],_0x4b59df[0x3*_0x428a7b+0x2]=_0x33b60a['blue'];}const _0x39a7c2={'context':_0x35f4d7,'width':_0x2ba59d,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x587b36(0x138)],'pixelDatatype':Cesium$4[_0x587b36(0x176)][_0x587b36(0xa9)],'sampler':new Cesium$4[(_0x587b36(0x12e))]({'minificationFilter':Cesium$4[_0x587b36(0x12b)][_0x587b36(0x15a)],'magnificationFilter':Cesium$4[_0x587b36(0xe4)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x18a5e6),'segmentsDepth':Util['createTexture'](_0x54aada),'currentTrailsColor':Util['createTexture'](_0x18a5e6),'currentTrailsDepth':Util['createTexture'](_0x54aada),'nextTrailsColor':Util['createTexture'](_0x18a5e6),'nextTrailsDepth':Util[_0x587b36(0xfc)](_0x54aada),'colorTable':Util['createTexture'](_0x39a7c2,_0x4b59df)};}[_0xd3c246(0xc5)](_0x268c48){const _0x25c99b=_0xd3c246;this['framebuffers']={'segments':Util['createFramebuffer'](_0x268c48,this[_0x25c99b(0x153)][_0x25c99b(0x10e)],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x268c48,this[_0x25c99b(0x153)]['currentTrailsColor'],this[_0x25c99b(0x153)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x268c48,this[_0x25c99b(0x153)]['nextTrailsColor'],this[_0x25c99b(0x153)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x40157a){const _0x21e413=_0xd3c246,_0x1c1863=0x4;let _0x192a8e=[];for(let _0x4386f7=0x0;_0x4386f7<_0x40157a['particlesTextureSize'];_0x4386f7++){for(let _0x45c7a5=0x0;_0x45c7a5<_0x40157a[_0x21e413(0x14e)];_0x45c7a5++){for(let _0x399d93=0x0;_0x399d93<_0x1c1863;_0x399d93++){_0x192a8e['push'](_0x4386f7/_0x40157a['particlesTextureSize']),_0x192a8e['push'](_0x45c7a5/_0x40157a[_0x21e413(0x14e)]);}}}_0x192a8e=new Float32Array(_0x192a8e);let _0xbfbefd=[];const _0x122bf4=[-0x1,0x1],_0xde3103=[-0x1,0x1];for(let _0x4ad596=0x0;_0x4ad596<_0x40157a['maxParticles'];_0x4ad596++){for(let _0x4dc9d1=0x0;_0x4dc9d1<_0x1c1863/0x2;_0x4dc9d1++){for(let _0x590dc9=0x0;_0x590dc9<_0x1c1863/0x2;_0x590dc9++){_0xbfbefd['push'](_0x122bf4[_0x4dc9d1]),_0xbfbefd[_0x21e413(0x11e)](_0xde3103[_0x590dc9]),_0xbfbefd['push'](0x0);}}}_0xbfbefd=new Float32Array(_0xbfbefd);const _0x539ef5=0x6*_0x40157a['maxParticles'],_0x511759=new Uint32Array(_0x539ef5);for(let _0x39a247=0x0,_0x2e9c20=0x0,_0x2bc0ac=0x0;_0x39a247<_0x40157a['maxParticles'];_0x39a247++){_0x511759[_0x2e9c20++]=_0x2bc0ac+0x0,_0x511759[_0x2e9c20++]=_0x2bc0ac+0x1,_0x511759[_0x2e9c20++]=_0x2bc0ac+0x2,_0x511759[_0x2e9c20++]=_0x2bc0ac+0x2,_0x511759[_0x2e9c20++]=_0x2bc0ac+0x1,_0x511759[_0x2e9c20++]=_0x2bc0ac+0x3,_0x2bc0ac+=0x4;}const _0x293fc3=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x192a8e}),'normal':new Cesium$4[(_0x21e413(0x187))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0xbfbefd})}),'indices':_0x511759});return _0x293fc3;}[_0xd3c246(0x181)](_0x8decea,_0x39e261,_0xdea216,_0x58ad7b){const _0x49248a=_0xd3c246,_0x50b048=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x39e261),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x58ad7b['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x58ad7b['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x58ad7b['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x3c92dd=_0x46ca;return _0x50b048[_0x3c92dd(0x153)]['colorTable'];},'aspect':function(){const _0x46d989=_0x46ca;return _0x8decea[_0x46d989(0xf6)]/_0x8decea['drawingBufferHeight'];},'pixelSize':function(){return _0xdea216['pixelSize'];},'lineWidth':function(){const _0x704916=_0x46ca;return _0x39e261[_0x704916(0xbb)];},'particleHeight':function(){return _0x39e261['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x49248a(0x142))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x49248a(0x169)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x5bb434=_0x49248a;return _0x50b048['textures'][_0x5bb434(0x10e)];},'segmentsDepthTexture':function(){return _0x50b048['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x50b048['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x331eb8=_0x49248a;return _0x50b048[_0x331eb8(0x121)]['currentTrails'][_0x331eb8(0x151)];},'fadeOpacity':function(){return _0x39e261['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x49248a(0x185)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x49248a(0x13b)][_0x49248a(0x140)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0xb08770=_0x49248a,_0x18362e=_0x50b048['framebuffers'][_0xb08770(0x161)];_0x50b048['framebuffers']['currentTrails']=_0x50b048['framebuffers']['nextTrails'],_0x50b048['framebuffers'][_0xb08770(0xb9)]=_0x18362e,_0x50b048['primitives']['trails']['commandToExecute']['framebuffer']=_0x50b048[_0xb08770(0x121)]['nextTrails'],_0x50b048['primitives'][_0xb08770(0xd4)][_0xb08770(0x105)]['framebuffer']=_0x50b048['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x49248a(0x156)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x1bb109=_0x49248a;return _0x50b048[_0x1bb109(0x121)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x50b048['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x49248a(0x185)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0xd3c246(0x13a),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x47fbce,_0x2636b3,_0x487831,_0x449c25){this['data']=_0x2636b3,this['createWindTextures'](_0x47fbce,_0x2636b3),this['createParticlesTextures'](_0x47fbce,_0x487831,_0x449c25),this['createComputingPrimitives'](_0x2636b3,_0x487831,_0x449c25);}[_0xd3c246(0xad)](_0x4c14e0,_0x263e85){const _0xf5e67d=_0xd3c246,_0x414d3e={'context':_0x4c14e0,'width':_0x263e85['dimensions'][_0xf5e67d(0x186)],'height':_0x263e85['dimensions'][_0xf5e67d(0xc7)]*(_0x263e85['dimensions'][_0xf5e67d(0x146)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0xf5e67d(0xa9)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0xf5e67d(0xe4)][_0xf5e67d(0x147)]})};this['windTextures']={'U':Util['createTexture'](_0x414d3e,_0x263e85['U']['array']),'V':Util[_0xf5e67d(0xfc)](_0x414d3e,_0x263e85['V'][_0xf5e67d(0xc1)])};}[_0xd3c246(0xf2)](_0x5a191f,_0x253f33,_0x5b7d7e){const _0x3bfe3a=_0xd3c246,_0x59a8e9={'context':_0x5a191f,'width':_0x253f33['particlesTextureSize'],'height':_0x253f33[_0x3bfe3a(0x14e)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3[_0x3bfe3a(0x176)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x32dff5=this['randomizeParticles'](_0x253f33[_0x3bfe3a(0xc8)],_0x5b7d7e),_0x1cc745=new Float32Array(0x4*_0x253f33[_0x3bfe3a(0xc8)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x59a8e9),'currentParticlesPosition':Util['createTexture'](_0x59a8e9,_0x32dff5),'nextParticlesPosition':Util[_0x3bfe3a(0xfc)](_0x59a8e9,_0x32dff5),'currentParticlesSpeed':Util[_0x3bfe3a(0xfc)](_0x59a8e9,_0x1cc745),'nextParticlesSpeed':Util['createTexture'](_0x59a8e9,_0x1cc745),'postProcessingPosition':Util[_0x3bfe3a(0xfc)](_0x59a8e9,_0x32dff5),'postProcessingSpeed':Util['createTexture'](_0x59a8e9,_0x1cc745)};}['randomizeParticles'](_0x4a6af7,_0x59d12c){const _0x59b3be=_0xd3c246,_0x1556c2=new Float32Array(0x4*_0x4a6af7);for(let _0x4a39d1=0x0;_0x4a39d1<_0x4a6af7;_0x4a39d1++){_0x1556c2[0x4*_0x4a39d1]=Cesium$3['Math']['randomBetween'](_0x59d12c['lonRange']['x'],_0x59d12c['lonRange']['y']),_0x1556c2[0x4*_0x4a39d1+0x1]=Cesium$3['Math'][_0x59b3be(0x132)](_0x59d12c[_0x59b3be(0x18c)]['x'],_0x59d12c[_0x59b3be(0x18c)]['y']),_0x1556c2[0x4*_0x4a39d1+0x2]=Cesium$3[_0x59b3be(0x15d)]['randomBetween'](this[_0x59b3be(0x108)][_0x59b3be(0x146)][_0x59b3be(0xd8)],this[_0x59b3be(0x108)]['lev']['max']),_0x1556c2[0x4*_0x4a39d1+0x3]=0x0;}return _0x1556c2;}[_0xd3c246(0x17f)](){const _0x396742=_0xd3c246;Object['keys'](this[_0x396742(0x173)])['forEach'](_0x106fa3=>{this['particlesTextures'][_0x106fa3]['destroy']();});}['createComputingPrimitives'](_0x4db70c,_0x10c873,_0x3241cd){const _0x5553dd=_0xd3c246,_0x14ec18=new Cesium$3['Cartesian3'](_0x4db70c['dimensions'][_0x5553dd(0x186)],_0x4db70c['dimensions']['lat'],_0x4db70c['dimensions']['lev']),_0x15fcdd=new Cesium$3['Cartesian3'](_0x4db70c['lon'][_0x5553dd(0xd8)],_0x4db70c['lat']['min'],_0x4db70c[_0x5553dd(0x146)]['min']),_0xb8c822=new Cesium$3['Cartesian3'](_0x4db70c['lon']['max'],_0x4db70c['lat'][_0x5553dd(0xe8)],_0x4db70c[_0x5553dd(0x146)]['max']),_0x1dc447=new Cesium$3['Cartesian3']((_0xb8c822['x']-_0x15fcdd['x'])/(_0x14ec18['x']-0x1),(_0xb8c822['y']-_0x15fcdd['y'])/(_0x14ec18['y']-0x1),_0x14ec18['z']>0x1?(_0xb8c822['z']-_0x15fcdd['z'])/(_0x14ec18['z']-0x1):0x1),_0x1a7f14=new Cesium$3[(_0x5553dd(0x15b))](_0x4db70c['U'][_0x5553dd(0xd8)],_0x4db70c['U']['max']),_0x449206=new Cesium$3['Cartesian2'](_0x4db70c['V']['min'],_0x4db70c['V']['max']),_0x48b2ab=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x5553dd(0x18d),'uniformMap':{'U':function(){return _0x48b2ab['windTextures']['U'];},'V':function(){return _0x48b2ab['windTextures']['V'];},'currentParticlesPosition':function(){return _0x48b2ab['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x14ec18;},'minimum':function(){return _0x15fcdd;},'maximum':function(){return _0xb8c822;},'interval':function(){return _0x1dc447;}},'fragmentShaderSource':new Cesium$3[(_0x5553dd(0x142))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x11cbab=_0x5553dd;_0x48b2ab['primitives'][_0x11cbab(0x157)]['commandToExecute'][_0x11cbab(0x144)]=_0x48b2ab['particlesTextures'][_0x11cbab(0x112)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x48b2ab['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x48b2ab['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x1a7f14;},'vSpeedRange':function(){return _0x449206;},'pixelSize':function(){return _0x3241cd['pixelSize'];},'speedFactor':function(){return _0x10c873['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x6c8db3=_0x5553dd,_0x4fabd3=_0x48b2ab['particlesTextures'][_0x6c8db3(0x127)];_0x48b2ab[_0x6c8db3(0x173)]['currentParticlesSpeed']=_0x48b2ab['particlesTextures'][_0x6c8db3(0x172)],_0x48b2ab[_0x6c8db3(0x173)][_0x6c8db3(0x172)]=_0x4fabd3,_0x48b2ab['primitives'][_0x6c8db3(0xb8)][_0x6c8db3(0xbe)]['outputTexture']=_0x48b2ab[_0x6c8db3(0x173)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x48b2ab['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x48b2ab['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x24f7ab=_0x5553dd,_0x4af5f7=_0x48b2ab['particlesTextures'][_0x24f7ab(0xb1)];_0x48b2ab[_0x24f7ab(0x173)][_0x24f7ab(0xb1)]=_0x48b2ab['particlesTextures']['postProcessingPosition'],_0x48b2ab['particlesTextures'][_0x24f7ab(0xd3)]=_0x4af5f7,_0x48b2ab['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x48b2ab['particlesTextures'][_0x24f7ab(0xe0)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x48b2ab['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0xc2262e=_0x5553dd;return _0x48b2ab[_0xc2262e(0x173)]['nextParticlesSpeed'];},'lonRange':function(){return _0x3241cd['lonRange'];},'latRange':function(){return _0x3241cd['latRange'];},'randomCoefficient':function(){const _0x4b56b8=Math['random']();return _0x4b56b8;},'dropRate':function(){const _0x1d674a=_0x5553dd;return _0x10c873[_0x1d674a(0x10a)];},'dropRateBump':function(){return _0x10c873['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x5553dd(0x173)]['postProcessingPosition'],'preExecute':function(){const _0x197b03=_0x5553dd;_0x48b2ab['primitives']['postProcessingPosition'][_0x197b03(0xbe)]['outputTexture']=_0x48b2ab[_0x197b03(0x173)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x5553dd(0x18d),'uniformMap':{'postProcessingPosition':function(){const _0x248624=_0x5553dd;return _0x48b2ab['particlesTextures'][_0x248624(0xd3)];},'nextParticlesSpeed':function(){const _0x2b5774=_0x5553dd;return _0x48b2ab[_0x2b5774(0x173)][_0x2b5774(0xe1)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x31b90b=_0x5553dd;_0x48b2ab['primitives']['postProcessingSpeed'][_0x31b90b(0xbe)]['outputTexture']=_0x48b2ab['particlesTextures'][_0x31b90b(0x172)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0xf27437,_0x44b4ed,_0x4dfed4,_0x501571){const _0x14df6a=_0xd3c246;this['context']=_0xf27437,_0x44b4ed={..._0x44b4ed},_0x44b4ed['udata']&&_0x44b4ed[_0x14df6a(0xe5)]&&(_0x44b4ed[_0x14df6a(0x13e)]={},_0x44b4ed[_0x14df6a(0x13e)]['lon']=_0x44b4ed['cols'],_0x44b4ed[_0x14df6a(0x13e)]['lat']=_0x44b4ed['rows'],_0x44b4ed['dimensions']['lev']=_0x44b4ed['lev']||0x1,_0x44b4ed['lon']={},_0x44b4ed[_0x14df6a(0x186)][_0x14df6a(0xd8)]=_0x44b4ed['xmin'],_0x44b4ed['lon'][_0x14df6a(0xe8)]=_0x44b4ed['xmax'],_0x44b4ed['lat']={},_0x44b4ed['lat']['min']=_0x44b4ed['ymin'],_0x44b4ed['lat'][_0x14df6a(0xe8)]=_0x44b4ed['ymax'],_0x44b4ed['lev']={},_0x44b4ed['lev']['min']=_0x44b4ed['levmin']??0x1,_0x44b4ed[_0x14df6a(0x146)]['max']=_0x44b4ed['levmax']??0x1,_0x44b4ed['U']={},_0x44b4ed['U']['array']=new Float32Array(_0x44b4ed[_0x14df6a(0x120)]),_0x44b4ed['U']['min']=_0x44b4ed['umin']??Math['min'](..._0x44b4ed['udata']),_0x44b4ed['U'][_0x14df6a(0xe8)]=_0x44b4ed['umax']??Math[_0x14df6a(0xe8)](..._0x44b4ed[_0x14df6a(0x120)]),_0x44b4ed['V']={},_0x44b4ed['V'][_0x14df6a(0xc1)]=new Float32Array(_0x44b4ed['vdata']),_0x44b4ed['V']['min']=_0x44b4ed[_0x14df6a(0x135)]??Math['min'](..._0x44b4ed['vdata']),_0x44b4ed['V'][_0x14df6a(0xe8)]=_0x44b4ed['vmax']??Math[_0x14df6a(0xe8)](..._0x44b4ed['vdata'])),this['data']=_0x44b4ed,this['options']=_0x4dfed4,this['viewerParameters']=_0x501571,this['particlesComputing']=new ParticlesComputing(this[_0x14df6a(0x14d)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x14df6a(0x14d)],this['data'],this[_0x14df6a(0xac)],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x615c04){const _0x486db8=_0xd3c246;this['particlesComputing']['destroyParticlesTextures'](),Object[_0x486db8(0xb7)](this[_0x486db8(0x12c)][_0x486db8(0x18b)])['forEach'](_0x37e5ef=>{const _0x1635db=_0x486db8;this[_0x1635db(0x12c)]['windTextures'][_0x37e5ef]['destroy']();}),this['particlesRendering'][_0x486db8(0x153)][_0x486db8(0xf8)]['destroy'](),Object['keys'](this[_0x486db8(0x174)][_0x486db8(0x121)])[_0x486db8(0xf7)](_0x24492e=>{const _0x3793c5=_0x486db8;this[_0x3793c5(0x174)]['framebuffers'][_0x24492e][_0x3793c5(0x11d)]();}),this['context']=_0x615c04,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x486db8(0xac)],this[_0x486db8(0x15c)]),this['particlesRendering']=new ParticlesRendering(this[_0x486db8(0x14d)],this['data'],this['options'],this['viewerParameters'],this[_0x486db8(0x12c)]);}[_0xd3c246(0x10b)](){const _0x56a0a6=_0xd3c246,_0x5d9644=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x56a0a6(0xb7)](this['particlesRendering'][_0x56a0a6(0x121)])['forEach'](_0x519625=>{const _0x5254e8=_0x56a0a6;_0x5d9644[_0x5254e8(0xc4)]=this['particlesRendering']['framebuffers'][_0x519625],_0x5d9644[_0x5254e8(0xe3)](this['context']);});}['refreshParticles'](_0x183a68){const _0x24b265=_0xd3c246;this['clearFramebuffers'](),this['particlesComputing'][_0x24b265(0x17f)](),this['particlesComputing'][_0x24b265(0xf2)](this[_0x24b265(0x14d)],this['options'],this['viewerParameters']);if(_0x183a68){var _0x45d337;const _0x421150=this['particlesRendering']['createSegmentsGeometry'](this[_0x24b265(0xac)]);this['particlesRendering']['primitives']['segments']['geometry']=_0x421150;const _0x39b7f9=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x421150,'attributeLocations':this['particlesRendering']['primitives'][_0x24b265(0x166)]['attributeLocations'],'bufferUsage':Cesium$2[_0x24b265(0xb6)]['STATIC_DRAW']});(_0x45d337=this[_0x24b265(0x174)]['primitives'])!==null&&_0x45d337!==void 0x0&&(_0x45d337=_0x45d337['segments'])!==null&&_0x45d337!==void 0x0&&_0x45d337['commandToExecute']&&(this['particlesRendering'][_0x24b265(0x107)][_0x24b265(0x166)]['commandToExecute'][_0x24b265(0x190)]=_0x39b7f9);}}[_0xd3c246(0x130)](_0x188121){const _0x5de572=_0xd3c246;let _0x481b1c=![];this['options']['maxParticles']!==_0x188121['maxParticles']&&(_0x481b1c=!![]),Object['keys'](_0x188121)['forEach'](_0x188f30=>{this['options'][_0x188f30]=_0x188121[_0x188f30];}),this[_0x5de572(0xca)](_0x481b1c);}['applyViewerParameters'](_0x2d3dd9){Object['keys'](_0x2d3dd9)['forEach'](_0x2d7fe1=>{this['viewerParameters'][_0x2d7fe1]=_0x2d3dd9[_0x2d7fe1];}),this['refreshParticles'](![]);}['destroy'](){const _0x2bb080=_0xd3c246;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x62b935=>{const _0x2368d9=_0x46ca;this['particlesComputing'][_0x2368d9(0x18b)][_0x62b935]['destroy']();}),this[_0x2bb080(0x174)]['textures']['colorTable'][_0x2bb080(0x11d)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x2e77f4=>{const _0x35a7af=_0x2bb080;this[_0x35a7af(0x174)][_0x35a7af(0x121)][_0x2e77f4]['destroy']();});for(const _0x1630f7 in this){delete this[_0x1630f7];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0xd3c246(0xc3)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x497cd5={}){_0x497cd5={...DEF_OPTIONS,..._0x497cd5},super(_0x497cd5),this['_setOptionsHook'](_0x497cd5);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x54d802){this['setData'](_0x54d802);}get['colors'](){const _0x311f5d=_0xd3c246;return this[_0x311f5d(0xac)][_0x311f5d(0x180)];}set[_0xd3c246(0x180)](_0x57dc38){const _0x2ff2a2=_0xd3c246;this['options']['colors']=_0x57dc38,this['particleSystem']&&this[_0x2ff2a2(0x10f)]['setOptions']({'colors':_0x57dc38}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x25fbae=_0xd3c246;this['scene']=this[_0x25fbae(0x18e)][_0x25fbae(0x114)],this['camera']=this['_map'][_0x25fbae(0x193)],this['primitives']=new Cesium$1[(_0x25fbae(0x106))](),this['_map'][_0x25fbae(0x114)]['primitives'][_0x25fbae(0x165)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x25fbae(0x15b))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this[_0x25fbae(0x12f)]=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x25fbae(0xdf)],this),this[_0x25fbae(0x18e)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x25fbae(0x131)]&&this['setData'](this['_data']);}['_removedHook'](){const _0x4ebe3a=_0xd3c246;window['removeEventListener']('resize',this['resize']),this[_0x4ebe3a(0x18e)][_0x4ebe3a(0xee)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x4ebe3a(0x115)],this[_0x4ebe3a(0x178)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x4ebe3a(0xc9)],this[_0x4ebe3a(0x15e)],this),this['_map']['off'](mars3d__namespace[_0x4ebe3a(0xb2)]['mouseUp'],this[_0x4ebe3a(0xdf)],this),this['_map']['off'](mars3d__namespace[_0x4ebe3a(0xb2)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map'][_0x4ebe3a(0x114)]['primitives'][_0x4ebe3a(0x16a)](this['primitives']);}['resize'](){const _0x19b2d9=_0xd3c246;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives'][_0x19b2d9(0x129)](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x19b2d9(0x171)],this);}['_onMap_preRenderEvent'](_0x53a43d){const _0x248fa5=_0xd3c246;this['particleSystem']['canvasResize'](this[_0x248fa5(0x114)][_0x248fa5(0x14d)]),this[_0x248fa5(0xd9)](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x367f05){const _0x1ef98e=_0xd3c246;clearTimeout(this[_0x1ef98e(0x12d)]);if(!this[_0x1ef98e(0xf4)]||!this[_0x1ef98e(0x10f)])return;this[_0x1ef98e(0x107)]['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x2e282d=_0x1ef98e;if(!this[_0x2e282d(0xf4)])return;this[_0x2e282d(0xae)]();},0xc8);}['_onMouseDownEvent'](_0x13e4e2){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x260f7c){const _0xb8db3a=_0xd3c246;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this[_0xb8db3a(0x107)][_0xb8db3a(0xf4)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x11a57c){const _0x41fe5c=_0xd3c246;if(!this[_0x41fe5c(0xf4)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x41fe5c(0xf4)]=!![],this['mouse_down']=![],this[_0x41fe5c(0xef)]=![];}[_0xd3c246(0xae)](){const _0x4d4828=_0xd3c246;if(!this[_0x4d4828(0x18e)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this[_0x4d4828(0x15c)]),this['primitives']['show']=!![];}['setData'](_0x5b6e37){const _0x12f6e1=_0xd3c246;this['_data']=_0x5b6e37,this[_0x12f6e1(0x10f)]&&this[_0x12f6e1(0x10f)]['destroy'](),this[_0x12f6e1(0x10f)]=new ParticleSystem(this['scene']['context'],_0x5b6e37,this[_0x12f6e1(0xe2)](),this[_0x12f6e1(0x15c)]),this['addPrimitives']();}['_setOptionsHook'](_0x38b87a,_0x589245){if(_0x38b87a)for(const _0x3c2ca3 in _0x38b87a){this[_0x3c2ca3]=_0x38b87a[_0x3c2ca3];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0xd3c246(0xe2)](){const _0x237f13=_0xd3c246,_0x393d66=Math['ceil'](Math[_0x237f13(0xcc)](this['particlesNumber']));return this['particlesNumber']=_0x393d66*_0x393d66,{'particlesTextureSize':_0x393d66,'maxParticles':this[_0x237f13(0x13f)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x237f13(0x167)],'lineWidth':this['lineWidth'],'colors':this[_0x237f13(0x180)]};}['addPrimitives'](){const _0x9133ee=_0xd3c246;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x9133ee(0x157)]),this[_0x9133ee(0x107)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x9133ee(0xb8)]),this['primitives']['add'](this[_0x9133ee(0x10f)][_0x9133ee(0x12c)]['primitives']['updatePosition']),this['primitives'][_0x9133ee(0x165)](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this[_0x9133ee(0x107)]['add'](this['particleSystem']['particlesComputing'][_0x9133ee(0x107)]['postProcessingSpeed']),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives'][_0x9133ee(0x165)](this['particleSystem'][_0x9133ee(0x174)]['primitives']['trails']),this[_0x9133ee(0x107)]['add'](this['particleSystem'][_0x9133ee(0x174)][_0x9133ee(0x107)]['screen']);}[_0xd3c246(0x148)](){const _0x4fc11a=_0xd3c246;let _0x5af8f3=this['camera']['computeViewRectangle'](this['scene']['globe'][_0x4fc11a(0xaf)]);if(!_0x5af8f3){const _0x3df95a=this['_map']['getExtent']();_0x5af8f3=Cesium$1['Rectangle']['fromDegrees'](_0x3df95a['xmin'],_0x3df95a[_0x4fc11a(0x188)],_0x3df95a['xmax'],_0x3df95a['ymax']);}const _0x1decfc=Util['viewRectangleToLonLatRange'](_0x5af8f3);this['viewerParameters'][_0x4fc11a(0xfb)]['x']=_0x1decfc['lon']['min'],this['viewerParameters'][_0x4fc11a(0xfb)]['y']=_0x1decfc['lon']['max'],this['viewerParameters']['latRange']['x']=_0x1decfc['lat'][_0x4fc11a(0xd8)],this['viewerParameters']['latRange']['y']=_0x1decfc['lat']['max'];const _0x9e87a3=this['camera']['getPixelSize'](this['globeBoundingSphere'],this[_0x4fc11a(0x114)]['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x9e87a3>0x0&&(this[_0x4fc11a(0x15c)]['pixelSize']=_0x9e87a3);}}mars3d__namespace['LayerUtil'][_0xd3c246(0x13d)](_0xd3c246(0x150),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x154b88=_0xd3c246;this['lng']=null,this['lat']=null,this[_0x154b88(0x17d)]=null,this['tlat']=null,this['age']=null,this['speed']=null;}[_0xd3c246(0x11d)](){for(const _0x28f3d4 in this){delete this[_0x28f3d4];}}}function _0x46ca(_0xbf0031,_0x1df3d4){const _0x32f32e=_0x32f3();return _0x46ca=function(_0x46ca64,_0x43c23b){_0x46ca64=_0x46ca64-0xa9;let _0x1e4ba1=_0x32f32e[_0x46ca64];return _0x1e4ba1;},_0x46ca(_0xbf0031,_0x1df3d4);}class CanvasWindField{constructor(_0x5e5247){const _0x59924a=_0xd3c246;this[_0x59924a(0x130)](_0x5e5247);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x5eedb4){const _0x44bbce=_0xd3c246;this['_speedRate']=(0x64-(_0x5eedb4>0x63?0x63:_0x5eedb4))*0x64,this['_calc_speedRate']=[(this[_0x44bbce(0x179)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set[_0xd3c246(0xf1)](_0x19e589){this['_maxAge']=_0x19e589;}['setOptions'](_0x55af22){const _0x1078f7=_0xd3c246;this['options']=_0x55af22,this['maxAge']=_0x55af22[_0x1078f7(0xf1)]||0x78,this['speedRate']=_0x55af22['speedRate']||0x32,this[_0x1078f7(0xbd)]=[];const _0x44d4de=_0x55af22['particlesNumber']||0x1000;for(let _0x2a109d=0x0;_0x2a109d<_0x44d4de;_0x2a109d++){const _0x3fbeba=this[_0x1078f7(0xab)](new CanvasParticle());this['particles']['push'](_0x3fbeba);}}['setDate'](_0x55260f){const _0x48e0f4=_0xd3c246;this[_0x48e0f4(0xe9)]=_0x55260f[_0x48e0f4(0xe9)],this[_0x48e0f4(0xfa)]=_0x55260f[_0x48e0f4(0xfa)],this['xmin']=_0x55260f['xmin'],this['xmax']=_0x55260f[_0x48e0f4(0x179)],this['ymin']=_0x55260f['ymin'],this['ymax']=_0x55260f[_0x48e0f4(0x123)],this[_0x48e0f4(0xfe)]=[];const _0x3a0fd5=_0x55260f['udata'],_0x502f37=_0x55260f[_0x48e0f4(0xe5)];let _0x5293bf=![];_0x3a0fd5['length']===this[_0x48e0f4(0xe9)]&&_0x3a0fd5[0x0]['length']===this[_0x48e0f4(0xfa)]&&(_0x5293bf=!![]);let _0x4e649f=0x0,_0x19395b=null,_0x150d61=null;for(let _0x5d33db=0x0;_0x5d33db<this['rows'];_0x5d33db++){_0x19395b=[];for(let _0x58295a=0x0;_0x58295a<this['cols'];_0x58295a++,_0x4e649f++){_0x5293bf?_0x150d61=this['_calcUV'](_0x3a0fd5[_0x5d33db][_0x58295a],_0x502f37[_0x5d33db][_0x58295a]):_0x150d61=this['_calcUV'](_0x3a0fd5[_0x4e649f],_0x502f37[_0x4e649f]),_0x19395b['push'](_0x150d61);}this['grid'][_0x48e0f4(0x11e)](_0x19395b);}this['options']['reverseY']&&this['grid'][_0x48e0f4(0x154)]();}['clear'](){const _0x199198=_0xd3c246;delete this['rows'],delete this['cols'],delete this[_0x199198(0x17c)],delete this[_0x199198(0x179)],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x3e188f,_0x1b8093){const _0x31d01a=_0xd3c246,_0x20e1d4=(_0x3e188f-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x2bab0f=(this['ymax']-_0x1b8093)/(this['ymax']-this['ymin'])*(this[_0x31d01a(0xe9)]-0x1);return[_0x20e1d4,_0x2bab0f];}['getUVByXY'](_0xcc269a,_0x33e904){const _0x7cb094=_0xd3c246;if(_0xcc269a<0x0||_0xcc269a>=this['cols']||_0x33e904>=this['rows'])return[0x0,0x0,0x0];const _0xcd2473=Math[_0x7cb094(0xf3)](_0xcc269a),_0x256561=Math['floor'](_0x33e904);if(_0xcd2473===_0xcc269a&&_0x256561===_0x33e904)return this[_0x7cb094(0xfe)][_0x33e904][_0xcc269a];const _0x2778e5=_0xcd2473+0x1,_0x1ed117=_0x256561+0x1,_0x904a7a=this[_0x7cb094(0x128)](_0xcd2473,_0x256561),_0x1a7bfe=this['getUVByXY'](_0x2778e5,_0x256561),_0x1f40f6=this['getUVByXY'](_0xcd2473,_0x1ed117),_0x43e0b9=this['getUVByXY'](_0x2778e5,_0x1ed117);let _0x2ff689=null;try{_0x2ff689=this['_bilinearInterpolation'](_0xcc269a-_0xcd2473,_0x33e904-_0x256561,_0x904a7a,_0x1a7bfe,_0x1f40f6,_0x43e0b9);}catch(_0x2eea0c){console['log'](_0xcc269a,_0x33e904);}return _0x2ff689;}['_bilinearInterpolation'](_0x47407c,_0x1c7fe7,_0x24d4a6,_0x966e7b,_0x167084,_0x26251b){const _0x472690=0x1-_0x47407c,_0x20c7c4=0x1-_0x1c7fe7,_0x26627f=_0x472690*_0x20c7c4,_0x20ae4a=_0x47407c*_0x20c7c4,_0xc6506=_0x472690*_0x1c7fe7,_0x4b2134=_0x47407c*_0x1c7fe7,_0x265ef5=_0x24d4a6[0x0]*_0x26627f+_0x966e7b[0x0]*_0x20ae4a+_0x167084[0x0]*_0xc6506+_0x26251b[0x0]*_0x4b2134,_0xefb881=_0x24d4a6[0x1]*_0x26627f+_0x966e7b[0x1]*_0x20ae4a+_0x167084[0x1]*_0xc6506+_0x26251b[0x1]*_0x4b2134;return this['_calcUV'](_0x265ef5,_0xefb881);}['_calcUV'](_0x479f2d,_0x6d47e2){return[+_0x479f2d,+_0x6d47e2,Math['sqrt'](_0x479f2d*_0x479f2d+_0x6d47e2*_0x6d47e2)];}['getUVByPoint'](_0x111686,_0x483e47){if(!this['isInExtent'](_0x111686,_0x483e47))return null;const _0x19b403=this['toGridXY'](_0x111686,_0x483e47),_0x5c3db3=this['getUVByXY'](_0x19b403[0x0],_0x19b403[0x1]);return _0x5c3db3;}[_0xd3c246(0x170)](_0x3cbf53,_0x271239){const _0x85e557=_0xd3c246;return _0x3cbf53>=this['xmin']&&_0x3cbf53<=this['xmax']&&_0x271239>=this['ymin']&&_0x271239<=this[_0x85e557(0x123)]?!![]:![];}['getRandomLatLng'](){const _0x1e5c78=fRandomByfloat(this['xmin'],this['xmax']),_0x465a78=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x465a78,'lng':_0x1e5c78};}[_0xd3c246(0xbf)](){const _0x2d32d3=_0xd3c246;let _0x317bf9,_0x182476,_0x30fdb8;for(let _0x143c58=0x0,_0x2f7433=this['particles']['length'];_0x143c58<_0x2f7433;_0x143c58++){let _0xe0b50d=this[_0x2d32d3(0xbd)][_0x143c58];_0xe0b50d[_0x2d32d3(0x119)]<=0x0&&(_0xe0b50d=this['_randomParticle'](_0xe0b50d));if(_0xe0b50d['age']>0x0){const _0x198805=_0xe0b50d['tlng'],_0xd690b8=_0xe0b50d['tlat'];_0x30fdb8=this[_0x2d32d3(0xda)](_0x198805,_0xd690b8),_0x30fdb8?(_0x317bf9=_0x198805+this['_calc_speedRate'][0x0]*_0x30fdb8[0x0],_0x182476=_0xd690b8+this[_0x2d32d3(0x101)][0x1]*_0x30fdb8[0x1],_0xe0b50d['lng']=_0x198805,_0xe0b50d['lat']=_0xd690b8,_0xe0b50d['tlng']=_0x317bf9,_0xe0b50d['tlat']=_0x182476,_0xe0b50d[_0x2d32d3(0x18a)]=_0x30fdb8[0x2],_0xe0b50d['age']--):_0xe0b50d['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x7519ac){const _0x5aed3b=_0xd3c246;let _0x25d34f,_0x238d37;for(let _0x2793c0=0x0;_0x2793c0<0x1e;_0x2793c0++){_0x25d34f=this['getRandomLatLng'](),_0x238d37=this['getUVByPoint'](_0x25d34f[_0x5aed3b(0x102)],_0x25d34f['lat']);if(_0x238d37&&_0x238d37[0x2]>0x0)break;}if(!_0x238d37)return _0x7519ac;const _0x5521ac=_0x25d34f['lng']+this['_calc_speedRate'][0x0]*_0x238d37[0x0],_0x10bf28=_0x25d34f[_0x5aed3b(0xc7)]+this['_calc_speedRate'][0x1]*_0x238d37[0x1];return _0x7519ac['lng']=_0x25d34f['lng'],_0x7519ac['lat']=_0x25d34f[_0x5aed3b(0xc7)],_0x7519ac[_0x5aed3b(0x17d)]=_0x5521ac,_0x7519ac[_0x5aed3b(0x136)]=_0x10bf28,_0x7519ac[_0x5aed3b(0x119)]=Math['round'](Math['random']()*this[_0x5aed3b(0xf1)]),_0x7519ac['speed']=_0x238d37[0x2],_0x7519ac;}['destroy'](){for(const _0xd5866a in this){delete this[_0xd5866a];}}}function fRandomByfloat(_0x38a800,_0x282493){return _0x38a800+Math['random']()*(_0x282493-_0x38a800);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x84639d={}){const _0x2b1681=_0xd3c246;super(_0x84639d),this[_0x2b1681(0x155)](_0x84639d),this[_0x2b1681(0xcf)]=null,_0x84639d['colors']&&_0x84639d[_0x2b1681(0x164)]&&(this[_0x2b1681(0x100)]=new mars3d__namespace['ColorRamp'](_0x84639d));}['_setOptionsHook'](_0x1b71bb,_0x3bd1a9){const _0x38db19=_0xd3c246;this[_0x38db19(0xed)]=0x3e8/(_0x1b71bb['frameRate']||0xa),this[_0x38db19(0xdd)]=this['options'][_0x38db19(0x126)]??![],this[_0x38db19(0x17a)]=_0x1b71bb[_0x38db19(0x17a)]||'#ffffff',this[_0x38db19(0xbb)]=_0x1b71bb['lineWidth']||0x1,this[_0x38db19(0xf9)]=_0x1b71bb[_0x38db19(0xf9)]??0x0,this['reverseY']=_0x1b71bb['reverseY']??![],this[_0x38db19(0x17e)]&&this['windField']['setOptions'](_0x1b71bb);}get[_0xd3c246(0xc3)](){return this['canvas'];}get['canvasWidth'](){const _0x43ac4d=_0xd3c246;return this[_0x43ac4d(0x18e)][_0x43ac4d(0x114)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x182b90=_0xd3c246;return this['_map'][_0x182b90(0x114)]['canvas'][_0x182b90(0xeb)];}get[_0xd3c246(0x126)](){const _0x1f2214=_0xd3c246;return this[_0x1f2214(0xdd)];}set['pointerEvents'](_0x2339b5){const _0xac7e23=_0xd3c246;this['_pointerEvents']=_0x2339b5;if(!this['canvas'])return;_0x2339b5?this['canvas']['style'][_0xac7e23(0x13c)]=_0xac7e23(0x137):this[_0xac7e23(0xcf)]['style']['pointer-events']=_0xac7e23(0x110);}get['particlesNumber'](){const _0x3a904c=_0xd3c246;return this['options'][_0x3a904c(0x13f)];}set['particlesNumber'](_0x4bda26){const _0x571d2f=_0xd3c246;this['options'][_0x571d2f(0x13f)]=_0x4bda26,clearTimeout(this[_0x571d2f(0x118)]),this[_0x571d2f(0x118)]=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0xd3c246(0x14b)](){return this['options']['speedRate'];}set['speedRate'](_0x41e5a6){this['options']['speedRate']=_0x41e5a6,this['windField']&&(this['windField']['speedRate']=_0x41e5a6);}get[_0xd3c246(0xf1)](){return this['options']['maxAge'];}set['maxAge'](_0x542b3a){const _0x42fc68=_0xd3c246;this[_0x42fc68(0xac)]['maxAge']=_0x542b3a,this['windField']&&(this['windField']['maxAge']=_0x542b3a);}get['data'](){return this['windData'];}set['data'](_0x6d3366){this['setData'](_0x6d3366);}['_showHook'](_0x4f5597){const _0x55553b=_0xd3c246;_0x4f5597?this[_0x55553b(0x177)]():(this['windData']&&(this[_0x55553b(0xac)]['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x309fea=_0xd3c246;this['options'][_0x309fea(0x16d)]?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x481934=_0xd3c246;this['canvas']=this['_createCanvas'](),this['canvasContext']=this[_0x481934(0xcf)][_0x481934(0x109)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x149287=_0xd3c246;this['clear'](),this['unbindEvent'](),this['canvas']&&(this[_0x149287(0x18e)]['container'][_0x149287(0xea)](this['canvas']),delete this['canvas']);}[_0xd3c246(0xf0)](){const _0xb76374=_0xd3c246,_0x88e845=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x88e845['style']['position']=_0xb76374(0x14c),_0x88e845[_0xb76374(0x16f)]['top']=_0xb76374(0x141),_0x88e845['style']['left']=_0xb76374(0x141),_0x88e845['style'][_0xb76374(0xff)]=this['_map'][_0xb76374(0x114)][_0xb76374(0xcf)]['clientWidth']+'px',_0x88e845['style'][_0xb76374(0x10d)]=this['_map']['scene']['canvas'][_0xb76374(0xeb)]+'px',_0x88e845[_0xb76374(0x16f)]['pointerEvents']=this['_pointerEvents']?'auto':_0xb76374(0x110),_0x88e845[_0xb76374(0x16f)]['zIndex']=this['options']['zIndex']??0x9,_0x88e845['width']=this['_map'][_0xb76374(0x114)]['canvas']['clientWidth'],_0x88e845['height']=this['_map'][_0xb76374(0x114)]['canvas'][_0xb76374(0xeb)],_0x88e845;}['resize'](){const _0x5a3637=_0xd3c246;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this[_0x5a3637(0x18e)]['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas']['clientWidth'],this[_0x5a3637(0xcf)]['height']=this['_map'][_0x5a3637(0x114)][_0x5a3637(0xcf)][_0x5a3637(0xeb)]);}['bindEvent'](){const _0x163e95=_0xd3c246,_0x41c927=this;let _0x4b9ad5=Date['now']();(function _0x9090b7(){const _0x51fb47=_0x46ca;_0x41c927['animateFrame']=window[_0x51fb47(0x15f)](_0x9090b7);if(_0x41c927[_0x51fb47(0xf4)]&&_0x41c927['windField']){const _0x2280f7=Date['now'](),_0x5e1799=_0x2280f7-_0x4b9ad5;_0x5e1799>_0x41c927['frameTime']&&(_0x4b9ad5=_0x2280f7-_0x5e1799%_0x41c927['frameTime'],_0x41c927['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this[_0x163e95(0x12f)]=![],this['mouse_move']=![],this[_0x163e95(0xac)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0x163e95(0x115)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x163e95(0xc9)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x163e95(0xdf)],this)));}[_0xd3c246(0x113)](){const _0x4f2bd1=_0xd3c246;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x4f2bd1(0x159)]),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x4f2bd1(0xb2)]['mouseDown'],this['_onMouseDownEvent'],this),this[_0x4f2bd1(0x18e)]['off'](mars3d__namespace['EventType'][_0x4f2bd1(0x10c)],this['_onMouseUpEvent'],this),this[_0x4f2bd1(0x18e)]['off'](mars3d__namespace['EventType'][_0x4f2bd1(0xbc)],this['_onMouseMoveEvent'],this));}[_0xd3c246(0x178)](_0x3bf42b){clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x3359d9=_0x46ca;if(!this['show'])return;this['redraw'](),this['canvas'][_0x3359d9(0x16f)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x55efc7){const _0x23f0fd=_0xd3c246;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x23f0fd(0xcb)],this),this[_0x23f0fd(0x18e)]['on'](mars3d__namespace[_0x23f0fd(0xb2)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x9063c0){const _0x19ae4e=_0xd3c246;if(!this['show']||!this['canvas'])return;this['mouse_down']&&(this['canvas'][_0x19ae4e(0x16f)]['visibility']='hidden',this[_0x19ae4e(0xef)]=!![]);}['_onMouseUpEvent'](_0x354d6c){const _0x426fd7=_0xd3c246;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace[_0x426fd7(0xb2)][_0x426fd7(0xbc)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x426fd7(0xef)]&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this[_0x426fd7(0xef)]=![];}['setData'](_0x177f0c){const _0x479c96=_0xd3c246;this['clear'](),this['windData']=_0x177f0c,this['windField'][_0x479c96(0xd0)](_0x177f0c),this['redraw']();}['redraw'](){const _0x5b3445=_0xd3c246;if(!this['show'])return;this['windField']['setOptions'](this[_0x5b3445(0xac)]),this['update']();}[_0xd3c246(0x122)](){const _0x1f69f3=_0xd3c246;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0xc4bb52=this['windField'][_0x1f69f3(0xbf)]();this['_drawLines'](_0xc4bb52);}this['_updateIng']=![];}[_0xd3c246(0x162)](_0x12cfa5){const _0x3a3b52=_0xd3c246;this['canvasContext']['globalCompositeOperation']=_0x3a3b52(0xb5),this['canvasContext']['fillRect'](0x0,0x0,this[_0x3a3b52(0x168)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x3a3b52(0x117)]['globalAlpha']=0.9;const _0x278b44=this['_map']['scene']['mode']!==Cesium['SceneMode'][_0x3a3b52(0xba)],_0x27c90f=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x37e680=0x0,_0x29fccb=_0x12cfa5['length'];_0x37e680<_0x29fccb;_0x37e680++){const _0x68dd58=_0x12cfa5[_0x37e680],_0x5744d8=this[_0x3a3b52(0xfd)](_0x68dd58['lng'],_0x68dd58['lat'],_0x68dd58),_0x454a71=this['_tomap'](_0x68dd58['tlng'],_0x68dd58['tlat'],_0x68dd58);if(!_0x5744d8||!_0x454a71)continue;if(_0x278b44&&Math['abs'](_0x5744d8[0x0]-_0x454a71[0x0])>=_0x27c90f)continue;this[_0x3a3b52(0x117)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x3a3b52(0x117)][_0x3a3b52(0x145)]=this['_colorRamp'][_0x3a3b52(0xce)](_0x68dd58['speed']),this['canvasContext'][_0x3a3b52(0xb4)](_0x5744d8[0x0],_0x5744d8[0x1]),this['canvasContext']['lineTo'](_0x454a71[0x0],_0x454a71[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x3a3b52(0xc2)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x3a3b52(0x145)]=this['color'];for(let _0x2a4917=0x0,_0x22f25c=_0x12cfa5['length'];_0x2a4917<_0x22f25c;_0x2a4917++){const _0x1cf056=_0x12cfa5[_0x2a4917],_0xc86cf6=this[_0x3a3b52(0xfd)](_0x1cf056[_0x3a3b52(0x102)],_0x1cf056[_0x3a3b52(0xc7)],_0x1cf056),_0x48898e=this['_tomap'](_0x1cf056['tlng'],_0x1cf056['tlat'],_0x1cf056);if(!_0xc86cf6||!_0x48898e)continue;if(_0x278b44&&Math['abs'](_0xc86cf6[0x0]-_0x48898e[0x0])>=_0x27c90f)continue;this['canvasContext']['moveTo'](_0xc86cf6[0x0],_0xc86cf6[0x1]),this['canvasContext'][_0x3a3b52(0xd1)](_0x48898e[0x0],_0x48898e[0x1]);}this[_0x3a3b52(0x117)][_0x3a3b52(0x14a)]();}}['_tomap'](_0x414fc1,_0x25efd2,_0xb26a08){const _0x34573f=_0xd3c246,_0x2de24c=Cesium[_0x34573f(0x16b)]['fromDegrees'](_0x414fc1,_0x25efd2,this[_0x34573f(0xf9)]),_0x116d1c=this[_0x34573f(0x18e)]['scene'];if(_0x116d1c[_0x34573f(0x158)]===Cesium['SceneMode'][_0x34573f(0xba)]){const _0x2c4571=new Cesium['EllipsoidalOccluder'](_0x116d1c['globe']['ellipsoid'],_0x116d1c[_0x34573f(0x193)]['positionWC']),_0x104307=_0x2c4571['isPointVisible'](_0x2de24c);if(!_0x104307)return _0xb26a08[_0x34573f(0x119)]=0x0,null;}const _0x216706=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x2de24c);return _0x216706?[_0x216706['x'],_0x216706['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}[_0xd3c246(0x11b)](){const _0x412fee=_0xd3c246;this['worker']=new Worker(this[_0x412fee(0xac)][_0x412fee(0x16d)]),this[_0x412fee(0x16d)]['onmessage']=_0x57fbfb=>{this['_drawLines'](_0x57fbfb['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x103458=>{const _0x1f7ec2=_0x412fee;this[_0x1f7ec2(0x16d)]['postMessage']({'type':_0x1f7ec2(0x18f),'options':_0x103458});},'setOptions':_0x363283=>{this['worker']['postMessage']({'type':'setOptions','options':_0x363283});},'setDate':_0x16a342=>{this['worker']['postMessage']({'type':'setDate','data':_0x16a342});},'update':()=>{const _0x2b256f=_0x412fee;if(this['_updateIng2'])return;this[_0x2b256f(0x11a)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this[_0x412fee(0xac)]);}}mars3d__namespace['LayerUtil'][_0xd3c246(0x13d)]('canvasWind',CanvasWindLayer),mars3d__namespace[_0xd3c246(0xc3)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0xd3c246(0xd5),{'value':!![]});
}));
