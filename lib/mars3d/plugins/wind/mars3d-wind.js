/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.11
 * 编译日期：2023-11-02 17:46:52
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x10d56c=_0x2fe1;(function(_0x34536d,_0x405a2e){const _0x4e89ae=_0x2fe1,_0x5ba267=_0x34536d();while(!![]){try{const _0x12fb66=parseInt(_0x4e89ae(0x1a0))/0x1+parseInt(_0x4e89ae(0x14b))/0x2*(parseInt(_0x4e89ae(0x124))/0x3)+parseInt(_0x4e89ae(0x175))/0x4+parseInt(_0x4e89ae(0x162))/0x5*(parseInt(_0x4e89ae(0x178))/0x6)+-parseInt(_0x4e89ae(0x128))/0x7*(parseInt(_0x4e89ae(0x1db))/0x8)+parseInt(_0x4e89ae(0x17c))/0x9*(-parseInt(_0x4e89ae(0x143))/0xa)+-parseInt(_0x4e89ae(0x14a))/0xb;if(_0x12fb66===_0x405a2e)break;else _0x5ba267['push'](_0x5ba267['shift']());}catch(_0x52851e){_0x5ba267['push'](_0x5ba267['shift']());}}}(_0x149d,0x33892));function _interopNamespace(_0x277318){const _0x367f19=_0x2fe1;if(_0x277318&&_0x277318[_0x367f19(0x1e5)])return _0x277318;var _0x1c9c6b=Object['create'](null);return _0x277318&&Object[_0x367f19(0x142)](_0x277318)['forEach'](function(_0x26a0fc){const _0x22e721=_0x367f19;if(_0x26a0fc!=='default'){var _0x40501d=Object['getOwnPropertyDescriptor'](_0x277318,_0x26a0fc);Object[_0x22e721(0x1c8)](_0x1c9c6b,_0x26a0fc,_0x40501d['get']?_0x40501d:{'enumerable':!![],'get':function(){return _0x277318[_0x26a0fc];}});}}),_0x1c9c6b['default']=_0x277318,_0x1c9c6b;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x4fd7bf,_0x47313d){const _0x453e9e=_0x2fe1,_0x173b8a=_0x4fd7bf*Math['cos'](Cesium$7['Math'][_0x453e9e(0x195)](_0x47313d));return _0x173b8a;}function getV(_0x5ab082,_0x491f7a){const _0x60a87a=_0x5ab082*Math['sin'](Cesium$7['Math']['toRadians'](_0x491f7a));return _0x60a87a;}function getSpeed(_0x3da178,_0x492b7f){const _0x1af42a=Math['sqrt'](Math['pow'](_0x3da178,0x2)+Math['pow'](_0x492b7f,0x2));return _0x1af42a;}function getDirection(_0x236117,_0x4f685a){const _0x1bb6fe=_0x2fe1;let _0x1c1909=Cesium$7[_0x1bb6fe(0x1f8)]['toDegrees'](Math['atan2'](_0x4f685a,_0x236117));return _0x1c1909+=_0x1c1909<0x0?0x168:0x0,_0x1c1909;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x2bf8b6){const _0x59f2d7=_0x2fe1;this['commandType']=_0x2bf8b6['commandType'],this['geometry']=_0x2bf8b6['geometry'],this['attributeLocations']=_0x2bf8b6['attributeLocations'],this['primitiveType']=_0x2bf8b6['primitiveType'],this['uniformMap']=_0x2bf8b6['uniformMap'],this['vertexShaderSource']=_0x2bf8b6['vertexShaderSource'],this['fragmentShaderSource']=_0x2bf8b6['fragmentShaderSource'],this['rawRenderState']=_0x2bf8b6['rawRenderState'],this[_0x59f2d7(0x15a)]=_0x2bf8b6['framebuffer'],this[_0x59f2d7(0x1f7)]=_0x2bf8b6[_0x59f2d7(0x1f7)],this['autoClear']=_0x2bf8b6[_0x59f2d7(0x173)]??![],this['preExecute']=_0x2bf8b6['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6[(_0x59f2d7(0x20d))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x10d56c(0x1cb)](_0x235331){const _0x1af271=_0x10d56c;switch(this['commandType']){case'Draw':{const _0x52748d=Cesium$6['VertexArray']['fromGeometry']({'context':_0x235331,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x2aab65=Cesium$6['ShaderProgram']['fromCache']({'context':_0x235331,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x180e3c=Cesium$6[_0x1af271(0x13d)][_0x1af271(0x189)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x2aab65,'vertexArray':_0x52748d,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x180e3c,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x1af271(0x155)],'pickOnly':!![],'owner':this});}case _0x1af271(0x1c6):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0x1af271(0x138)],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x3bc4c8,_0xe3254e){const _0x4290ac=_0x10d56c;this[_0x4290ac(0x1e4)]=_0xe3254e;const _0x154f99=Cesium$6['VertexArray'][_0x4290ac(0x12f)]({'context':_0x3bc4c8,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x4290ac(0x1c1)]});this['commandToExecute'][_0x4290ac(0x13f)]=_0x154f99;}['update'](_0x28677f){const _0x50f039=_0x10d56c;if(!this['show'])return;if(_0x28677f['mode']!==Cesium$6['SceneMode'][_0x50f039(0x209)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x28677f['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x50f039(0x208)])&&_0x28677f[_0x50f039(0x167)]['push'](this['clearCommand']),_0x28677f['commandList']['push'](this[_0x50f039(0x1b9)]);}['isDestroyed'](){return![];}['destroy'](){const _0x4beccf=_0x10d56c;if(this[_0x4beccf(0x208)]){var _0x2f0d1f,_0x13912d;(_0x2f0d1f=this[_0x4beccf(0x208)])!==null&&_0x2f0d1f!==void 0x0&&_0x2f0d1f['vertexArray']&&this[_0x4beccf(0x208)]['vertexArray']['destroy'](),(_0x13912d=this[_0x4beccf(0x208)])!==null&&_0x13912d!==void 0x0&&_0x13912d['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this[_0x4beccf(0x1b9)]&&(this[_0x4beccf(0x1b9)][_0x4beccf(0x13f)]&&this['commandToExecute']['vertexArray']['destroy'](),this[_0x4beccf(0x1b9)]['shaderProgram']&&this[_0x4beccf(0x1b9)]['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x13249a=function(){const _0x1e67cb=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x1e67cb;},_0x51f7c0=function(_0x1adae8,_0x2df18b){const _0xe16b7c=_0x2fe1;if(Cesium$5[_0xe16b7c(0x190)](_0x2df18b)){const _0x1a03d1={};_0x1a03d1['arrayBufferView']=_0x2df18b,_0x1adae8['source']=_0x1a03d1;}const _0x5315bf=new Cesium$5['Texture'](_0x1adae8);return _0x5315bf;},_0x55443a=function(_0x478f75,_0x4f788b,_0x1a23d2){const _0x8c2ecb=_0x2fe1,_0x1bd151=new Cesium$5[(_0x8c2ecb(0x134))]({'context':_0x478f75,'colorTextures':[_0x4f788b],'depthTexture':_0x1a23d2});return _0x1bd151;},_0x2df87e=function(_0x7cc624){const _0x37403e=_0x2fe1,_0x521258=!![],_0x33e05f=![],_0x17fcfd={'viewport':_0x7cc624['viewport'],'depthTest':_0x7cc624[_0x37403e(0x1ea)],'depthMask':_0x7cc624['depthMask'],'blending':_0x7cc624['blending']},_0x1d26a1=Cesium$5[_0x37403e(0x12a)]['getDefaultRenderState'](_0x521258,_0x33e05f,_0x17fcfd);return _0x1d26a1;},_0x42f7ac=function(_0x37a9da){const _0x42adcb=_0x2fe1,_0x3b8a11={},_0x5e5302=Cesium$5['Math']['mod'](_0x37a9da['west'],Cesium$5['Math']['TWO_PI']),_0x5655d9=Cesium$5['Math'][_0x42adcb(0x14d)](_0x37a9da['east'],Cesium$5[_0x42adcb(0x1f8)]['TWO_PI']),_0x5c4988=_0x37a9da[_0x42adcb(0x1cd)];let _0x2e8471,_0x3bd815;_0x5c4988>Cesium$5['Math'][_0x42adcb(0x1f6)]?(_0x2e8471=0x0,_0x3bd815=Cesium$5['Math']['TWO_PI']):_0x5655d9-_0x5e5302<_0x5c4988?(_0x2e8471=_0x5e5302,_0x3bd815=_0x5e5302+_0x5c4988):(_0x2e8471=_0x5e5302,_0x3bd815=_0x5655d9);_0x3b8a11['lon']={'min':Cesium$5[_0x42adcb(0x1f8)][_0x42adcb(0x151)](_0x2e8471),'max':Cesium$5['Math']['toDegrees'](_0x3bd815)};const _0xc0f44c=_0x37a9da['south'],_0x3742f9=_0x37a9da['north'],_0x21d26b=_0x37a9da['height'],_0x348982=_0x21d26b>Cesium$5['Math']['PI']/0xc?_0x21d26b/0x2:0x0;let _0x390acb=Cesium$5['Math']['clampToLatitudeRange'](_0xc0f44c-_0x348982),_0xe7e6b7=Cesium$5['Math']['clampToLatitudeRange'](_0x3742f9+_0x348982);return _0x390acb<-Cesium$5[_0x42adcb(0x1f8)][_0x42adcb(0x13a)]&&(_0x390acb=-Cesium$5['Math'][_0x42adcb(0x1bf)]),_0xe7e6b7>Cesium$5['Math']['PI_OVER_THREE']&&(_0xe7e6b7=Cesium$5['Math'][_0x42adcb(0x1bf)]),_0x3b8a11['lat']={'min':Cesium$5['Math']['toDegrees'](_0x390acb),'max':Cesium$5[_0x42adcb(0x1f8)]['toDegrees'](_0xe7e6b7)},_0x3b8a11;};return{'getFullscreenQuad':_0x13249a,'createTexture':_0x51f7c0,'createFramebuffer':_0x55443a,'createRawRenderState':_0x2df87e,'viewRectangleToLonLatRange':_0x42f7ac};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x10d56c(0x1e1),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x5ac7c5,_0x23830e,_0xec8b2e,_0x566ff0,_0x4c4e71){const _0x1e31cc=_0x10d56c;this[_0x1e31cc(0x153)](_0x5ac7c5,_0x23830e,_0xec8b2e['colors']),this['createRenderingFramebuffers'](_0x5ac7c5),this['createRenderingPrimitives'](_0x5ac7c5,_0xec8b2e,_0x566ff0,_0x4c4e71);}['createRenderingTextures'](_0x3de196,_0x438908,_0x5df517){const _0x1af2f6=_0x10d56c,_0x2d41dc={'context':_0x3de196,'width':_0x3de196['drawingBufferWidth'],'height':_0x3de196['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x1af2f6(0x1d7)][_0x1af2f6(0x1bc)]},_0x5bfaa0={'context':_0x3de196,'width':_0x3de196['drawingBufferWidth'],'height':_0x3de196[_0x1af2f6(0x17e)],'pixelFormat':Cesium$4[_0x1af2f6(0x133)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x1af2f6(0x152)]},_0xb92c9e=_0x5df517[_0x1af2f6(0x1ac)],_0x5b8599=new Float32Array(_0xb92c9e*0x3);for(let _0x33e072=0x0;_0x33e072<_0xb92c9e;_0x33e072++){const _0x895ef3=Cesium$4['Color'][_0x1af2f6(0x127)](_0x5df517[_0x33e072]);_0x5b8599[0x3*_0x33e072]=_0x895ef3['red'],_0x5b8599[0x3*_0x33e072+0x1]=_0x895ef3['green'],_0x5b8599[0x3*_0x33e072+0x2]=_0x895ef3[_0x1af2f6(0x1de)];}const _0x3603f4={'context':_0x3de196,'width':_0xb92c9e,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x1af2f6(0x1aa)],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x2d41dc),'segmentsDepth':Util['createTexture'](_0x5bfaa0),'currentTrailsColor':Util['createTexture'](_0x2d41dc),'currentTrailsDepth':Util[_0x1af2f6(0x1cf)](_0x5bfaa0),'nextTrailsColor':Util['createTexture'](_0x2d41dc),'nextTrailsDepth':Util['createTexture'](_0x5bfaa0),'colorTable':Util['createTexture'](_0x3603f4,_0x5b8599)};}['createRenderingFramebuffers'](_0x2f26b5){const _0x37fc4f=_0x10d56c;this['framebuffers']={'segments':Util[_0x37fc4f(0x207)](_0x2f26b5,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x2f26b5,this['textures']['currentTrailsColor'],this['textures'][_0x37fc4f(0x1a6)]),'nextTrails':Util['createFramebuffer'](_0x2f26b5,this[_0x37fc4f(0x1ec)][_0x37fc4f(0x16f)],this[_0x37fc4f(0x1ec)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0xcff0fc){const _0x46a90c=_0x10d56c,_0xc66a06=0x4;let _0x26d750=[];for(let _0x2f8257=0x0;_0x2f8257<_0xcff0fc[_0x46a90c(0x12e)];_0x2f8257++){for(let _0x57c662=0x0;_0x57c662<_0xcff0fc[_0x46a90c(0x12e)];_0x57c662++){for(let _0x1fd2ce=0x0;_0x1fd2ce<_0xc66a06;_0x1fd2ce++){_0x26d750['push'](_0x2f8257/_0xcff0fc['particlesTextureSize']),_0x26d750['push'](_0x57c662/_0xcff0fc['particlesTextureSize']);}}}_0x26d750=new Float32Array(_0x26d750);let _0x1cd4b7=[];const _0x237895=[-0x1,0x1],_0x258c2d=[-0x1,0x1];for(let _0x4c7019=0x0;_0x4c7019<_0xcff0fc[_0x46a90c(0x16b)];_0x4c7019++){for(let _0x40f7d8=0x0;_0x40f7d8<_0xc66a06/0x2;_0x40f7d8++){for(let _0x4a871a=0x0;_0x4a871a<_0xc66a06/0x2;_0x4a871a++){_0x1cd4b7['push'](_0x237895[_0x40f7d8]),_0x1cd4b7[_0x46a90c(0x1ef)](_0x258c2d[_0x4a871a]),_0x1cd4b7[_0x46a90c(0x1ef)](0x0);}}}_0x1cd4b7=new Float32Array(_0x1cd4b7);const _0x4c8db5=0x6*_0xcff0fc['maxParticles'],_0x443711=new Uint32Array(_0x4c8db5);for(let _0x41da11=0x0,_0x7848ba=0x0,_0x245575=0x0;_0x41da11<_0xcff0fc[_0x46a90c(0x16b)];_0x41da11++){_0x443711[_0x7848ba++]=_0x245575+0x0,_0x443711[_0x7848ba++]=_0x245575+0x1,_0x443711[_0x7848ba++]=_0x245575+0x2,_0x443711[_0x7848ba++]=_0x245575+0x2,_0x443711[_0x7848ba++]=_0x245575+0x1,_0x443711[_0x7848ba++]=_0x245575+0x3,_0x245575+=0x4;}const _0x8c320=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x46a90c(0x1f4))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x26d750}),'normal':new Cesium$4[(_0x46a90c(0x1f4))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x1cd4b7})}),'indices':_0x443711});return _0x8c320;}[_0x10d56c(0x1ae)](_0x32ad2d,_0x1affb2,_0x41926d,_0x186e47){const _0x3e7b0c=_0x10d56c,_0x488803=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1affb2),'primitiveType':Cesium$4['PrimitiveType'][_0x3e7b0c(0x1be)],'uniformMap':{'currentParticlesPosition':function(){return _0x186e47['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x552e6d=_0x3e7b0c;return _0x186e47[_0x552e6d(0x19f)]['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x186e47['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x488803['textures']['colorTable'];},'aspect':function(){return _0x32ad2d['drawingBufferWidth']/_0x32ad2d['drawingBufferHeight'];},'pixelSize':function(){return _0x41926d['pixelSize'];},'lineWidth':function(){return _0x1affb2['lineWidth'];},'particleHeight':function(){return _0x1affb2['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x3e7b0c(0x1f1),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x18c42d=_0x3e7b0c;return _0x488803['textures'][_0x18c42d(0x1f3)];},'segmentsDepthTexture':function(){return _0x488803['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x29f1ef=_0x3e7b0c;return _0x488803['framebuffers'][_0x29f1ef(0x192)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x488803['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x2d65a9=_0x3e7b0c;return _0x1affb2[_0x2d65a9(0x140)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x3e7b0c(0x1e9)][_0x3e7b0c(0x16a)]},'depthMask':!![]}),'framebuffer':this[_0x3e7b0c(0x193)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0xa6cb0f=_0x3e7b0c,_0x56955b=_0x488803['framebuffers'][_0xa6cb0f(0x192)];_0x488803['framebuffers'][_0xa6cb0f(0x192)]=_0x488803['framebuffers']['nextTrails'],_0x488803['framebuffers'][_0xa6cb0f(0x19a)]=_0x56955b,_0x488803['primitives']['trails']['commandToExecute']['framebuffer']=_0x488803['framebuffers'][_0xa6cb0f(0x19a)],_0x488803['primitives']['trails']['clearCommand']['framebuffer']=_0x488803[_0xa6cb0f(0x193)][_0xa6cb0f(0x19a)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x3e7b0c(0x1be)],'uniformMap':{'trailsColorTexture':function(){const _0x1d0f7c=_0x3e7b0c;return _0x488803['framebuffers'][_0x1d0f7c(0x19a)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x49c255=_0x3e7b0c;return _0x488803['framebuffers'][_0x49c255(0x19a)]['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0x3e7b0c(0x1fb))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x3e7b0c(0x1ad)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}function _0x2fe1(_0x4eaf9d,_0x32f442){const _0x149d1b=_0x149d();return _0x2fe1=function(_0x2fe1fd,_0x16ac9d){_0x2fe1fd=_0x2fe1fd-0x123;let _0x3afc76=_0x149d1b[_0x2fe1fd];return _0x3afc76;},_0x2fe1(_0x4eaf9d,_0x32f442);}var getWind_frag=_0x10d56c(0x132),updateSpeed_frag=_0x10d56c(0x1f2),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x10d56c(0x179),postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x3293cc,_0x2aec3d,_0x1b489a,_0x9de2d6){const _0x328c36=_0x10d56c;this[_0x328c36(0x1d8)]=_0x2aec3d,this['createWindTextures'](_0x3293cc,_0x2aec3d),this['createParticlesTextures'](_0x3293cc,_0x1b489a,_0x9de2d6),this['createComputingPrimitives'](_0x2aec3d,_0x1b489a,_0x9de2d6);}['createWindTextures'](_0x504bc7,_0xf2cd8b){const _0x33b951=_0x10d56c,_0x379ef5={'context':_0x504bc7,'width':_0xf2cd8b['dimensions'][_0x33b951(0x1f9)],'height':_0xf2cd8b['dimensions'][_0x33b951(0x13b)]*(_0xf2cd8b['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x379ef5,_0xf2cd8b['U']['array']),'V':Util['createTexture'](_0x379ef5,_0xf2cd8b['V']['array'])};}['createParticlesTextures'](_0x183131,_0x522555,_0x45af38){const _0x1b68ca=_0x10d56c,_0x59e0d5={'context':_0x183131,'width':_0x522555['particlesTextureSize'],'height':_0x522555['particlesTextureSize'],'pixelFormat':Cesium$3[_0x1b68ca(0x133)]['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x1b68ca(0x139))]({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x1b68ca(0x176)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x51f8bd=this['randomizeParticles'](_0x522555['maxParticles'],_0x45af38),_0x58d581=new Float32Array(0x4*_0x522555[_0x1b68ca(0x16b)])['fill'](0x0);this[_0x1b68ca(0x19f)]={'particlesWind':Util['createTexture'](_0x59e0d5),'currentParticlesPosition':Util[_0x1b68ca(0x1cf)](_0x59e0d5,_0x51f8bd),'nextParticlesPosition':Util['createTexture'](_0x59e0d5,_0x51f8bd),'currentParticlesSpeed':Util[_0x1b68ca(0x1cf)](_0x59e0d5,_0x58d581),'nextParticlesSpeed':Util[_0x1b68ca(0x1cf)](_0x59e0d5,_0x58d581),'postProcessingPosition':Util['createTexture'](_0x59e0d5,_0x51f8bd),'postProcessingSpeed':Util['createTexture'](_0x59e0d5,_0x58d581)};}[_0x10d56c(0x1ee)](_0x17a5b8,_0x267c71){const _0x44d3b9=_0x10d56c,_0x5c3286=new Float32Array(0x4*_0x17a5b8);for(let _0xe7576f=0x0;_0xe7576f<_0x17a5b8;_0xe7576f++){_0x5c3286[0x4*_0xe7576f]=Cesium$3['Math'][_0x44d3b9(0x201)](_0x267c71['lonRange']['x'],_0x267c71['lonRange']['y']),_0x5c3286[0x4*_0xe7576f+0x1]=Cesium$3['Math']['randomBetween'](_0x267c71[_0x44d3b9(0x1fd)]['x'],_0x267c71['latRange']['y']),_0x5c3286[0x4*_0xe7576f+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev'][_0x44d3b9(0x13c)],this['data']['lev'][_0x44d3b9(0x200)]),_0x5c3286[0x4*_0xe7576f+0x3]=0x0;}return _0x5c3286;}[_0x10d56c(0x17f)](){const _0x36698d=_0x10d56c;Object[_0x36698d(0x142)](this[_0x36698d(0x19f)])['forEach'](_0x18c490=>{this['particlesTextures'][_0x18c490]['destroy']();});}['createComputingPrimitives'](_0x2af9ba,_0x13b978,_0x459fa8){const _0x2be2b5=_0x10d56c,_0x2e0dac=new Cesium$3['Cartesian3'](_0x2af9ba['dimensions']['lon'],_0x2af9ba['dimensions']['lat'],_0x2af9ba['dimensions'][_0x2be2b5(0x18e)]),_0x5adddc=new Cesium$3[(_0x2be2b5(0x1ab))](_0x2af9ba['lon']['min'],_0x2af9ba['lat']['min'],_0x2af9ba[_0x2be2b5(0x18e)]['min']),_0x14bb00=new Cesium$3['Cartesian3'](_0x2af9ba['lon']['max'],_0x2af9ba['lat']['max'],_0x2af9ba['lev'][_0x2be2b5(0x200)]),_0x5e0608=new Cesium$3[(_0x2be2b5(0x1ab))]((_0x14bb00['x']-_0x5adddc['x'])/(_0x2e0dac['x']-0x1),(_0x14bb00['y']-_0x5adddc['y'])/(_0x2e0dac['y']-0x1),_0x2e0dac['z']>0x1?(_0x14bb00['z']-_0x5adddc['z'])/(_0x2e0dac['z']-0x1):0x1),_0x365d19=new Cesium$3['Cartesian2'](_0x2af9ba['U']['min'],_0x2af9ba['U']['max']),_0x426fa3=new Cesium$3['Cartesian2'](_0x2af9ba['V'][_0x2be2b5(0x13c)],_0x2af9ba['V'][_0x2be2b5(0x200)]),_0x4bca1d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x4bca1d['windTextures']['U'];},'V':function(){return _0x4bca1d['windTextures']['V'];},'currentParticlesPosition':function(){return _0x4bca1d['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x2e0dac;},'minimum':function(){return _0x5adddc;},'maximum':function(){return _0x14bb00;},'interval':function(){return _0x5e0608;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x47cb3d=_0x2be2b5;_0x4bca1d['primitives'][_0x47cb3d(0x1bd)]['commandToExecute']['outputTexture']=_0x4bca1d['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x4bca1d['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x451e1c=_0x2be2b5;return _0x4bca1d[_0x451e1c(0x19f)][_0x451e1c(0x19b)];},'uSpeedRange':function(){return _0x365d19;},'vSpeedRange':function(){return _0x426fa3;},'pixelSize':function(){return _0x459fa8['pixelSize'];},'speedFactor':function(){return _0x13b978['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x2be2b5(0x180)],'preExecute':function(){const _0x4aca8a=_0x2be2b5,_0x177540=_0x4bca1d['particlesTextures']['currentParticlesSpeed'];_0x4bca1d[_0x4aca8a(0x19f)]['currentParticlesSpeed']=_0x4bca1d['particlesTextures'][_0x4aca8a(0x1a3)],_0x4bca1d[_0x4aca8a(0x19f)]['postProcessingSpeed']=_0x177540,_0x4bca1d[_0x4aca8a(0x191)][_0x4aca8a(0x205)]['commandToExecute']['outputTexture']=_0x4bca1d['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x4bca1d['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x4bca1d['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x1c354b=_0x2be2b5,_0x40f063=_0x4bca1d['particlesTextures']['currentParticlesPosition'];_0x4bca1d['particlesTextures']['currentParticlesPosition']=_0x4bca1d['particlesTextures']['postProcessingPosition'],_0x4bca1d['particlesTextures']['postProcessingPosition']=_0x40f063,_0x4bca1d['primitives'][_0x1c354b(0x1ed)]['commandToExecute'][_0x1c354b(0x1f7)]=_0x4bca1d['particlesTextures'][_0x1c354b(0x210)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x4bca1d['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x49fd25=_0x2be2b5;return _0x4bca1d[_0x49fd25(0x19f)]['nextParticlesSpeed'];},'lonRange':function(){return _0x459fa8['lonRange'];},'latRange':function(){return _0x459fa8['latRange'];},'randomCoefficient':function(){const _0x3deaec=Math['random']();return _0x3deaec;},'dropRate':function(){return _0x13b978['dropRate'];},'dropRateBump':function(){return _0x13b978['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x2be2b5(0x1fb))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x46c77f=_0x2be2b5;_0x4bca1d[_0x46c77f(0x191)]['postProcessingPosition']['commandToExecute'][_0x46c77f(0x1f7)]=_0x4bca1d[_0x46c77f(0x19f)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x4bca1d['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x35c371=_0x2be2b5;return _0x4bca1d['particlesTextures'][_0x35c371(0x180)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x2be2b5(0x19f)][_0x2be2b5(0x1a3)],'preExecute':function(){const _0x496b90=_0x2be2b5;_0x4bca1d['primitives']['postProcessingSpeed'][_0x496b90(0x1b9)][_0x496b90(0x1f7)]=_0x4bca1d['particlesTextures']['postProcessingSpeed'];}})};}}function _0x149d(){const _0x340cc3=['off','refreshTimer','stroke','beginPath','nextTrails','particlesWind','particlesComputing','grid','xmin','particlesTextures','233520IsUuer','mode','isInExtent','postProcessingSpeed','tlng','_tomap','currentTrailsDepth','mouseDown','lineTo','particlesRendering','FLOAT','Cartesian3','length','createRawRenderState','createRenderingPrimitives','_onMouseDownEvent','getUVByXY','setDate','options','camera','scene','positionWC','lonRange','cols','canvasResize','commandToExecute','dropRateBump','mouse_move','UNSIGNED_BYTE','getWind','TRIANGLES','PI_OVER_TWO','_calc_speedRate','STATIC_DRAW','SceneTransforms','speedRate','visibility','create','Compute','lineWidth','defineProperty','_updateIng2','_onMap_preRenderEvent','createCommand','screen','width','add','createTexture','now','random','redraw','updateViewerParameters','segments','toGridXY','_onMouseUpEvent','PixelDatatype','data','forEach','clientHeight','248JDbfRo','mouseHidden','frameTime','blue','_map','top','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','particleSystem','clear','geometry','__esModule','globeBoundingSphere','xmax','mouse_down','DepthFunction','depthTest','canvasWind','textures','updatePosition','randomizeParticles','push','canvasContext','Draw','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','segmentsColor','GeometryAttribute','none','THREE_PI_OVER_TWO','outputTexture','Math','lon','DomUtil','ShaderSource','_onMapWhellEvent','latRange','LayerUtil','_bilinearInterpolation','max','randomBetween','ymin','particlesNumber','windTextures','updateSpeed','rows','createFramebuffer','clearCommand','SCENE3D','canvas','worker','WindUtil','ClearCommand','clientWidth','maxAge','nextParticlesPosition','update','656787RawEfz','vdata','SceneMode','fromCssColorString','67641SSDpKp','_setOptionsHook','Appearance','show','Cesium','createSegmentsGeometry','particlesTextureSize','fromGeometry','windField','addEventListener','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','PixelFormat','Framebuffer','absolute','addPrimitives','lng','uniformMap','Sampler','PI_OVER_THREE','lat','min','RenderState','style','vertexArray','fadeOpacity','trails','keys','1405960qtuJlj','remove','getRandomLatLng','floor','WindLayer','colors','pointer-events','1236301cCXniJ','2GSgLWF','destroy','mod','_showHook','refreshParticles','age','toDegrees','UNSIGNED_INT','createRenderingTextures','particles','OPAQUE','Cartesian2','initWorker','postMessage','CanvasWindField','framebuffer','viewRectangleToLonLatRange','mouseUp','_createCanvas','setOptions','globalCompositeOperation','ZERO','applyViewerParameters','72055VrkigO','_removedHook','context','EventType','abs','commandList','0px','zIndex','ALWAYS','maxParticles','udata','round','tlat','nextTrailsColor','reverse','wind','mouseMove','autoClear','ceil','841216Njbdga','NEAREST','ymax','42moHykm','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','resize','viewerParameters','9YfePvt','init','drawingBufferHeight','destroyParticlesTextures','nextParticlesSpeed','_randomParticle','array','setData','rgb(206,255,255)','getOptions','BaseLayer','height','windData','fromCache','moveTo','_updateIng','speed','wheel','lev','_onMouseMoveEvent','defined','primitives','currentTrails','framebuffers','EllipsoidalOccluder','toRadians'];_0x149d=function(){return _0x340cc3;};return _0x149d();}const Cesium$2=mars3d__namespace[_0x10d56c(0x12c)];class ParticleSystem{constructor(_0x317e68,_0x387660,_0x4b7576,_0x34348e){const _0x4c2c50=_0x10d56c;this['context']=_0x317e68,_0x387660={..._0x387660},_0x387660['udata']&&_0x387660['vdata']&&(_0x387660['dimensions']={},_0x387660['dimensions'][_0x4c2c50(0x1f9)]=_0x387660[_0x4c2c50(0x1b7)],_0x387660['dimensions']['lat']=_0x387660['rows'],_0x387660['dimensions']['lev']=_0x387660[_0x4c2c50(0x18e)]||0x1,_0x387660[_0x4c2c50(0x1f9)]={},_0x387660['lon'][_0x4c2c50(0x13c)]=_0x387660[_0x4c2c50(0x19e)],_0x387660['lon']['max']=_0x387660['xmax'],_0x387660[_0x4c2c50(0x13b)]={},_0x387660['lat'][_0x4c2c50(0x13c)]=_0x387660['ymin'],_0x387660['lat'][_0x4c2c50(0x200)]=_0x387660['ymax'],_0x387660['lev']={},_0x387660[_0x4c2c50(0x18e)]['min']=_0x387660['levmin']??0x1,_0x387660['lev'][_0x4c2c50(0x200)]=_0x387660['levmax']??0x1,_0x387660['U']={},_0x387660['U']['array']=new Float32Array(_0x387660['udata']),_0x387660['U']['min']=_0x387660['umin']??Math[_0x4c2c50(0x13c)](..._0x387660[_0x4c2c50(0x16c)]),_0x387660['U']['max']=_0x387660['umax']??Math['max'](..._0x387660['udata']),_0x387660['V']={},_0x387660['V'][_0x4c2c50(0x182)]=new Float32Array(_0x387660[_0x4c2c50(0x125)]),_0x387660['V']['min']=_0x387660['vmin']??Math['min'](..._0x387660['vdata']),_0x387660['V']['max']=_0x387660['vmax']??Math['max'](..._0x387660['vdata'])),this[_0x4c2c50(0x1d8)]=_0x387660,this['options']=_0x4b7576,this['viewerParameters']=_0x34348e,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x4c2c50(0x1b2)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x4c2c50(0x164)],this['data'],this['options'],this[_0x4c2c50(0x17b)],this['particlesComputing']);}[_0x10d56c(0x1b8)](_0x47904e){const _0x5ae541=_0x10d56c;this[_0x5ae541(0x19c)]['destroyParticlesTextures'](),Object[_0x5ae541(0x142)](this['particlesComputing'][_0x5ae541(0x204)])['forEach'](_0x45edb6=>{const _0xb860c6=_0x5ae541;this['particlesComputing']['windTextures'][_0x45edb6][_0xb860c6(0x14c)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x5ae541(0x1d9)](_0x2f9483=>{this['particlesRendering']['framebuffers'][_0x2f9483]['destroy']();}),this[_0x5ae541(0x164)]=_0x47904e,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0x5ae541(0x1a9)]=new ParticlesRendering(this['context'],this[_0x5ae541(0x1d8)],this[_0x5ae541(0x1b2)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0x4d3979=_0x10d56c,_0x3f6454=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x4d3979(0x155)]});Object['keys'](this['particlesRendering']['framebuffers'])[_0x4d3979(0x1d9)](_0x4a5e08=>{_0x3f6454['framebuffer']=this['particlesRendering']['framebuffers'][_0x4a5e08],_0x3f6454['execute'](this['context']);});}[_0x10d56c(0x14f)](_0x1cb021){const _0xc33ce5=_0x10d56c;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this[_0xc33ce5(0x164)],this['options'],this['viewerParameters']);if(_0x1cb021){var _0x2bce5b;const _0x5cf586=this['particlesRendering'][_0xc33ce5(0x12d)](this['options']);this[_0xc33ce5(0x1a9)]['primitives']['segments']['geometry']=_0x5cf586;const _0x59cc53=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x5cf586,'attributeLocations':this[_0xc33ce5(0x1a9)][_0xc33ce5(0x191)][_0xc33ce5(0x1d4)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x2bce5b=this['particlesRendering']['primitives'])!==null&&_0x2bce5b!==void 0x0&&(_0x2bce5b=_0x2bce5b[_0xc33ce5(0x1d4)])!==null&&_0x2bce5b!==void 0x0&&_0x2bce5b[_0xc33ce5(0x1b9)]&&(this[_0xc33ce5(0x1a9)]['primitives']['segments']['commandToExecute']['vertexArray']=_0x59cc53);}}['setOptions'](_0x3f508f){const _0x37d57d=_0x10d56c;let _0x5ba1f5=![];this[_0x37d57d(0x1b2)]['maxParticles']!==_0x3f508f['maxParticles']&&(_0x5ba1f5=!![]),Object['keys'](_0x3f508f)['forEach'](_0x198b5d=>{this['options'][_0x198b5d]=_0x3f508f[_0x198b5d];}),this[_0x37d57d(0x14f)](_0x5ba1f5);}[_0x10d56c(0x161)](_0x2a60d6){const _0x1bd544=_0x10d56c;Object['keys'](_0x2a60d6)[_0x1bd544(0x1d9)](_0x50b567=>{this['viewerParameters'][_0x50b567]=_0x2a60d6[_0x50b567];}),this['refreshParticles'](![]);}['destroy'](){const _0x134d32=_0x10d56c;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object[_0x134d32(0x142)](this['particlesComputing']['windTextures'])[_0x134d32(0x1d9)](_0x1923c9=>{const _0x440cba=_0x134d32;this['particlesComputing'][_0x440cba(0x204)][_0x1923c9]['destroy']();}),this[_0x134d32(0x1a9)][_0x134d32(0x1ec)]['colorTable'][_0x134d32(0x14c)](),Object[_0x134d32(0x142)](this['particlesRendering']['framebuffers'])['forEach'](_0x480458=>{this['particlesRendering']['framebuffers'][_0x480458]['destroy']();});for(const _0x3fafb5 in this){delete this[_0x3fafb5];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x10d56c(0x184)]};class WindLayer extends BaseLayer$1{constructor(_0x24f5a2={}){_0x24f5a2={...DEF_OPTIONS,..._0x24f5a2},super(_0x24f5a2),this['_setOptionsHook'](_0x24f5a2);}get['layer'](){return this['primitives'];}get[_0x10d56c(0x1d8)](){return this['_data'];}set[_0x10d56c(0x1d8)](_0x4e226b){const _0x4d019d=_0x10d56c;this[_0x4d019d(0x183)](_0x4e226b);}get['colors'](){const _0x490894=_0x10d56c;return this[_0x490894(0x1b2)]['colors'];}set['colors'](_0x467a39){const _0x23340d=_0x10d56c;this['options'][_0x23340d(0x148)]=_0x467a39,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x467a39}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x289a5b=_0x10d56c;this['scene']=this['_map']['scene'],this['camera']=this['_map'][_0x289a5b(0x1b3)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x289a5b(0x1b4)]['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x289a5b(0x156))](),'latRange':new Cesium$1[(_0x289a5b(0x156))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x289a5b(0x160)],0.99*0x615299),this[_0x289a5b(0x1d3)](),window[_0x289a5b(0x131)]('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x289a5b(0x165)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x289a5b(0x165)][_0x289a5b(0x15c)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}[_0x10d56c(0x163)](){const _0x5630fd=_0x10d56c;window['removeEventListener']('resize',this['resize']),this[_0x5630fd(0x1df)]['off'](mars3d__namespace['EventType']['preRender'],this[_0x5630fd(0x1ca)],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x5630fd(0x1df)]['off'](mars3d__namespace['EventType'][_0x5630fd(0x1a7)],this['_onMouseDownEvent'],this),this['_map'][_0x5630fd(0x196)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x5630fd(0x1df)]['off'](mars3d__namespace['EventType'][_0x5630fd(0x172)],this['_onMouseMoveEvent'],this),this[_0x5630fd(0x191)]['removeAll'](),this['_map'][_0x5630fd(0x1b4)][_0x5630fd(0x191)][_0x5630fd(0x144)](this['primitives']);}['resize'](){const _0x1c44bd=_0x10d56c;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x1c44bd(0x191)]['removeAll'](),this[_0x1c44bd(0x1df)]['once'](mars3d__namespace['EventType']['preRender'],this[_0x1c44bd(0x1ca)],this);}['_onMap_preRenderEvent'](_0x4b0cda){const _0x459b42=_0x10d56c;this['particleSystem']['canvasResize'](this['scene'][_0x459b42(0x164)]),this['addPrimitives'](),this['primitives'][_0x459b42(0x12b)]=!![];}[_0x10d56c(0x1fc)](_0x2e8e37){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x2c90d9){const _0x120cc3=_0x10d56c;this[_0x120cc3(0x1e8)]=!![];}['_onMouseMoveEvent'](_0x44f1ea){const _0x4d82db=_0x10d56c;if(!this['show']||!this['particleSystem'])return;this[_0x4d82db(0x1e8)]&&(this['primitives'][_0x4d82db(0x12b)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x459477){const _0x394078=_0x10d56c;if(!this[_0x394078(0x12b)]||!this['particleSystem'])return;this[_0x394078(0x1e8)]&&this[_0x394078(0x1bb)]&&this['redraw'](),this[_0x394078(0x191)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x1de1d5=_0x10d56c;if(!this['_map']||!this['show'])return;this[_0x1de1d5(0x1d3)](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x1de1d5(0x12b)]=!![];}['setData'](_0x284ddf){const _0x346b17=_0x10d56c;this['_data']=_0x284ddf,this['particleSystem']&&this[_0x346b17(0x1e2)]['destroy'](),this[_0x346b17(0x1e2)]=new ParticleSystem(this['scene']['context'],_0x284ddf,this[_0x346b17(0x185)](),this['viewerParameters']),this[_0x346b17(0x136)]();}['_setOptionsHook'](_0x113182,_0x3193e4){if(_0x113182)for(const _0xdbc31a in _0x113182){this[_0xdbc31a]=_0x113182[_0xdbc31a];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x10d56c(0x185)](){const _0x286230=_0x10d56c,_0x4b15b4=Math[_0x286230(0x174)](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x4b15b4*_0x4b15b4,{'particlesTextureSize':_0x4b15b4,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this[_0x286230(0x1ba)],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x209ab0=_0x10d56c;this['primitives'][_0x209ab0(0x1ce)](this['particleSystem'][_0x209ab0(0x19c)][_0x209ab0(0x191)]['getWind']),this[_0x209ab0(0x191)]['add'](this['particleSystem']['particlesComputing'][_0x209ab0(0x191)]['updateSpeed']),this[_0x209ab0(0x191)]['add'](this['particleSystem']['particlesComputing'][_0x209ab0(0x191)]['updatePosition']),this[_0x209ab0(0x191)]['add'](this['particleSystem']['particlesComputing'][_0x209ab0(0x191)]['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x209ab0(0x1a3)]),this[_0x209ab0(0x191)]['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x209ab0(0x191)][_0x209ab0(0x141)]),this[_0x209ab0(0x191)]['add'](this[_0x209ab0(0x1e2)]['particlesRendering'][_0x209ab0(0x191)][_0x209ab0(0x1cc)]);}['updateViewerParameters'](){const _0x2b1f33=_0x10d56c;let _0x1b8454=this[_0x2b1f33(0x1b3)]['computeViewRectangle'](this[_0x2b1f33(0x1b4)]['globe']['ellipsoid']);if(!_0x1b8454){const _0xfb47c7=this['_map']['getExtent']();_0x1b8454=Cesium$1['Rectangle']['fromDegrees'](_0xfb47c7['xmin'],_0xfb47c7['ymin'],_0xfb47c7[_0x2b1f33(0x1e7)],_0xfb47c7['ymax']);}const _0x5ee2de=Util[_0x2b1f33(0x15b)](_0x1b8454);this[_0x2b1f33(0x17b)]['lonRange']['x']=_0x5ee2de[_0x2b1f33(0x1f9)][_0x2b1f33(0x13c)],this['viewerParameters'][_0x2b1f33(0x1b6)]['y']=_0x5ee2de['lon'][_0x2b1f33(0x200)],this[_0x2b1f33(0x17b)]['latRange']['x']=_0x5ee2de['lat'][_0x2b1f33(0x13c)],this['viewerParameters'][_0x2b1f33(0x1fd)]['y']=_0x5ee2de['lat']['max'];const _0x548fd2=this[_0x2b1f33(0x1b3)]['getPixelSize'](this[_0x2b1f33(0x1e6)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x548fd2>0x0&&(this['viewerParameters']['pixelSize']=_0x548fd2);}}mars3d__namespace['LayerUtil']['register'](_0x10d56c(0x171),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x21eaef=_0x10d56c;this[_0x21eaef(0x137)]=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x4196bc in this){delete this[_0x4196bc];}}}class CanvasWindField{constructor(_0x23db7f){this['setOptions'](_0x23db7f);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x1e0488){const _0x2feb67=_0x10d56c;this['_speedRate']=(0x64-(_0x1e0488>0x63?0x63:_0x1e0488))*0x64,this['_calc_speedRate']=[(this[_0x2feb67(0x1e7)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get[_0x10d56c(0x20f)](){return this['_maxAge'];}set[_0x10d56c(0x20f)](_0x4dc106){this['_maxAge']=_0x4dc106;}[_0x10d56c(0x15e)](_0x3fa63b){const _0x230613=_0x10d56c;this['options']=_0x3fa63b,this[_0x230613(0x20f)]=_0x3fa63b['maxAge']||0x78,this['speedRate']=_0x3fa63b[_0x230613(0x1c3)]||0x32,this['particles']=[];const _0x568ac7=_0x3fa63b[_0x230613(0x203)]||0x1000;for(let _0x4d156f=0x0;_0x4d156f<_0x568ac7;_0x4d156f++){const _0x3b85f7=this['_randomParticle'](new CanvasParticle());this[_0x230613(0x154)]['push'](_0x3b85f7);}}['setDate'](_0x56b9e8){const _0x2443ff=_0x10d56c;this['rows']=_0x56b9e8[_0x2443ff(0x206)],this[_0x2443ff(0x1b7)]=_0x56b9e8[_0x2443ff(0x1b7)],this['xmin']=_0x56b9e8['xmin'],this['xmax']=_0x56b9e8['xmax'],this[_0x2443ff(0x202)]=_0x56b9e8['ymin'],this[_0x2443ff(0x177)]=_0x56b9e8['ymax'],this['grid']=[];const _0x41124a=_0x56b9e8['udata'],_0x527773=_0x56b9e8[_0x2443ff(0x125)];let _0x47fd54=![];_0x41124a[_0x2443ff(0x1ac)]===this[_0x2443ff(0x206)]&&_0x41124a[0x0][_0x2443ff(0x1ac)]===this['cols']&&(_0x47fd54=!![]);let _0x3cdf00=0x0,_0x77ad35=null,_0x23c3a3=null;for(let _0x33af2b=0x0;_0x33af2b<this[_0x2443ff(0x206)];_0x33af2b++){_0x77ad35=[];for(let _0x4db7a0=0x0;_0x4db7a0<this[_0x2443ff(0x1b7)];_0x4db7a0++,_0x3cdf00++){_0x47fd54?_0x23c3a3=this['_calcUV'](_0x41124a[_0x33af2b][_0x4db7a0],_0x527773[_0x33af2b][_0x4db7a0]):_0x23c3a3=this['_calcUV'](_0x41124a[_0x3cdf00],_0x527773[_0x3cdf00]),_0x77ad35[_0x2443ff(0x1ef)](_0x23c3a3);}this['grid']['push'](_0x77ad35);}this['options']['reverseY']&&this['grid'][_0x2443ff(0x170)]();}[_0x10d56c(0x1e3)](){const _0x2b0848=_0x10d56c;delete this['rows'],delete this['cols'],delete this[_0x2b0848(0x19e)],delete this['xmax'],delete this[_0x2b0848(0x202)],delete this['ymax'],delete this[_0x2b0848(0x19d)],delete this[_0x2b0848(0x154)];}[_0x10d56c(0x1d5)](_0x271423,_0x4785df){const _0xc6519b=_0x10d56c,_0x503a9e=(_0x271423-this['xmin'])/(this['xmax']-this[_0xc6519b(0x19e)])*(this[_0xc6519b(0x1b7)]-0x1),_0x1181c1=(this['ymax']-_0x4785df)/(this[_0xc6519b(0x177)]-this[_0xc6519b(0x202)])*(this[_0xc6519b(0x206)]-0x1);return[_0x503a9e,_0x1181c1];}['getUVByXY'](_0x5b3ec4,_0x5bf33b){const _0x3cc072=_0x10d56c;if(_0x5b3ec4<0x0||_0x5b3ec4>=this['cols']||_0x5bf33b>=this['rows'])return[0x0,0x0,0x0];const _0x2acc7e=Math[_0x3cc072(0x146)](_0x5b3ec4),_0x5656bd=Math['floor'](_0x5bf33b);if(_0x2acc7e===_0x5b3ec4&&_0x5656bd===_0x5bf33b)return this[_0x3cc072(0x19d)][_0x5bf33b][_0x5b3ec4];const _0x48d080=_0x2acc7e+0x1,_0x2bf02f=_0x5656bd+0x1,_0x4c4cdc=this['getUVByXY'](_0x2acc7e,_0x5656bd),_0x1aabd4=this[_0x3cc072(0x1b0)](_0x48d080,_0x5656bd),_0x12926c=this['getUVByXY'](_0x2acc7e,_0x2bf02f),_0x1b69f7=this['getUVByXY'](_0x48d080,_0x2bf02f);let _0x5326d5=null;try{_0x5326d5=this['_bilinearInterpolation'](_0x5b3ec4-_0x2acc7e,_0x5bf33b-_0x5656bd,_0x4c4cdc,_0x1aabd4,_0x12926c,_0x1b69f7);}catch(_0x48f5d5){console['log'](_0x5b3ec4,_0x5bf33b);}return _0x5326d5;}[_0x10d56c(0x1ff)](_0x491cc3,_0x93d9c0,_0x59aac3,_0x2b0d55,_0x3a693f,_0x25091c){const _0x4688d6=0x1-_0x491cc3,_0x52a0e3=0x1-_0x93d9c0,_0x5bec0c=_0x4688d6*_0x52a0e3,_0x2f1d09=_0x491cc3*_0x52a0e3,_0x5a99fe=_0x4688d6*_0x93d9c0,_0x3c857c=_0x491cc3*_0x93d9c0,_0x579367=_0x59aac3[0x0]*_0x5bec0c+_0x2b0d55[0x0]*_0x2f1d09+_0x3a693f[0x0]*_0x5a99fe+_0x25091c[0x0]*_0x3c857c,_0x3de33a=_0x59aac3[0x1]*_0x5bec0c+_0x2b0d55[0x1]*_0x2f1d09+_0x3a693f[0x1]*_0x5a99fe+_0x25091c[0x1]*_0x3c857c;return this['_calcUV'](_0x579367,_0x3de33a);}['_calcUV'](_0x56ec43,_0x398bc9){return[+_0x56ec43,+_0x398bc9,Math['sqrt'](_0x56ec43*_0x56ec43+_0x398bc9*_0x398bc9)];}['getUVByPoint'](_0x931fd4,_0x1d35fb){const _0x1f5f61=_0x10d56c;if(!this[_0x1f5f61(0x1a2)](_0x931fd4,_0x1d35fb))return null;const _0x4bd810=this['toGridXY'](_0x931fd4,_0x1d35fb),_0x5a0031=this[_0x1f5f61(0x1b0)](_0x4bd810[0x0],_0x4bd810[0x1]);return _0x5a0031;}['isInExtent'](_0x1759fa,_0x237850){const _0xaaa10d=_0x10d56c;return _0x1759fa>=this[_0xaaa10d(0x19e)]&&_0x1759fa<=this[_0xaaa10d(0x1e7)]&&_0x237850>=this['ymin']&&_0x237850<=this['ymax']?!![]:![];}[_0x10d56c(0x145)](){const _0x34bdd2=fRandomByfloat(this['xmin'],this['xmax']),_0x223c32=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x223c32,'lng':_0x34bdd2};}['getParticles'](){const _0x5c110b=_0x10d56c;let _0x14b99c,_0x151905,_0x1765a1;for(let _0x77e22a=0x0,_0x3f5ce0=this[_0x5c110b(0x154)]['length'];_0x77e22a<_0x3f5ce0;_0x77e22a++){let _0x1211e4=this['particles'][_0x77e22a];_0x1211e4['age']<=0x0&&(_0x1211e4=this[_0x5c110b(0x181)](_0x1211e4));if(_0x1211e4['age']>0x0){const _0x2ce675=_0x1211e4['tlng'],_0x2621f2=_0x1211e4['tlat'];_0x1765a1=this['getUVByPoint'](_0x2ce675,_0x2621f2),_0x1765a1?(_0x14b99c=_0x2ce675+this['_calc_speedRate'][0x0]*_0x1765a1[0x0],_0x151905=_0x2621f2+this['_calc_speedRate'][0x1]*_0x1765a1[0x1],_0x1211e4['lng']=_0x2ce675,_0x1211e4['lat']=_0x2621f2,_0x1211e4[_0x5c110b(0x1a4)]=_0x14b99c,_0x1211e4['tlat']=_0x151905,_0x1211e4['speed']=_0x1765a1[0x2],_0x1211e4['age']--):_0x1211e4['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x463d62){const _0x10e664=_0x10d56c;let _0x178a75,_0xb7e977;for(let _0x11746e=0x0;_0x11746e<0x1e;_0x11746e++){_0x178a75=this['getRandomLatLng'](),_0xb7e977=this['getUVByPoint'](_0x178a75[_0x10e664(0x137)],_0x178a75['lat']);if(_0xb7e977&&_0xb7e977[0x2]>0x0)break;}if(!_0xb7e977)return _0x463d62;const _0x4b9bee=_0x178a75['lng']+this['_calc_speedRate'][0x0]*_0xb7e977[0x0],_0x26b952=_0x178a75['lat']+this[_0x10e664(0x1c0)][0x1]*_0xb7e977[0x1];return _0x463d62['lng']=_0x178a75['lng'],_0x463d62['lat']=_0x178a75['lat'],_0x463d62['tlng']=_0x4b9bee,_0x463d62['tlat']=_0x26b952,_0x463d62['age']=Math[_0x10e664(0x16d)](Math[_0x10e664(0x1d1)]()*this['maxAge']),_0x463d62['speed']=_0xb7e977[0x2],_0x463d62;}['destroy'](){for(const _0x659524 in this){delete this[_0x659524];}}}function fRandomByfloat(_0x299200,_0x42d8ac){return _0x299200+Math['random']()*(_0x42d8ac-_0x299200);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x10d56c(0x186)];class CanvasWindLayer extends BaseLayer{constructor(_0x118bf5={}){super(_0x118bf5),this['_setOptionsHook'](_0x118bf5),this['canvas']=null,_0x118bf5['colors']&&_0x118bf5['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x118bf5));}[_0x10d56c(0x129)](_0x538c26,_0x3381e5){const _0x1081db=_0x10d56c;this['frameTime']=0x3e8/(_0x538c26['frameRate']||0xa),this['_pointerEvents']=this[_0x1081db(0x1b2)]['pointerEvents']??![],this['color']=_0x538c26['color']||'#ffffff',this['lineWidth']=_0x538c26['lineWidth']||0x1,this['fixedHeight']=_0x538c26['fixedHeight']??0x0,this['reverseY']=_0x538c26['reverseY']??![],this[_0x1081db(0x130)]&&this['windField']['setOptions'](_0x538c26);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x460c6e=_0x10d56c;return this[_0x460c6e(0x1df)][_0x460c6e(0x1b4)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x582a5b=_0x10d56c;return this[_0x582a5b(0x1df)]['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x51b7a5){const _0x1fbd44=_0x10d56c;this['_pointerEvents']=_0x51b7a5;if(!this['canvas'])return;_0x51b7a5?this[_0x1fbd44(0x20a)]['style'][_0x1fbd44(0x149)]='all':this['canvas'][_0x1fbd44(0x13e)]['pointer-events']='none';}get['particlesNumber'](){const _0x1599c8=_0x10d56c;return this[_0x1599c8(0x1b2)]['particlesNumber'];}set['particlesNumber'](_0x3c40b7){const _0x46b7f7=_0x10d56c;this[_0x46b7f7(0x1b2)]['particlesNumber']=_0x3c40b7,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x10d56c(0x1c3)](){const _0x10e3df=_0x10d56c;return this['options'][_0x10e3df(0x1c3)];}set['speedRate'](_0x466eb7){const _0x20b6d6=_0x10d56c;this[_0x20b6d6(0x1b2)]['speedRate']=_0x466eb7,this['windField']&&(this['windField'][_0x20b6d6(0x1c3)]=_0x466eb7);}get[_0x10d56c(0x20f)](){const _0x392677=_0x10d56c;return this[_0x392677(0x1b2)]['maxAge'];}set['maxAge'](_0x1b7f72){const _0x2421a5=_0x10d56c;this['options']['maxAge']=_0x1b7f72,this['windField']&&(this[_0x2421a5(0x130)]['maxAge']=_0x1b7f72);}get['data'](){return this['windData'];}set[_0x10d56c(0x1d8)](_0x190751){this['setData'](_0x190751);}[_0x10d56c(0x14e)](_0x191101){const _0x22caa9=_0x10d56c;_0x191101?this['_addedHook']():(this[_0x22caa9(0x188)]&&(this[_0x22caa9(0x1b2)]['data']=this[_0x22caa9(0x188)]),this[_0x22caa9(0x163)]());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x2f40ab=_0x10d56c;this[_0x2f40ab(0x20a)]=this[_0x2f40ab(0x15d)](),this['canvasContext']=this[_0x2f40ab(0x20a)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x2f40ab(0x1d8)]&&this['setData'](this['options']['data']);}[_0x10d56c(0x163)](){const _0x24c02a=_0x10d56c;this['clear'](),this['unbindEvent'](),this[_0x24c02a(0x20a)]&&(this['_map']['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x4b2b47=_0x10d56c,_0x5a3c0e=mars3d__namespace[_0x4b2b47(0x1fa)][_0x4b2b47(0x1c5)]('canvas','mars3d-canvasWind',this[_0x4b2b47(0x1df)]['container']);return _0x5a3c0e['style']['position']=_0x4b2b47(0x135),_0x5a3c0e['style'][_0x4b2b47(0x1e0)]=_0x4b2b47(0x168),_0x5a3c0e['style']['left']=_0x4b2b47(0x168),_0x5a3c0e['style']['width']=this[_0x4b2b47(0x1df)]['scene']['canvas'][_0x4b2b47(0x20e)]+'px',_0x5a3c0e[_0x4b2b47(0x13e)][_0x4b2b47(0x187)]=this[_0x4b2b47(0x1df)]['scene']['canvas']['clientHeight']+'px',_0x5a3c0e['style']['pointerEvents']=this['_pointerEvents']?'auto':_0x4b2b47(0x1f5),_0x5a3c0e[_0x4b2b47(0x13e)][_0x4b2b47(0x169)]=this[_0x4b2b47(0x1b2)]['zIndex']??0x9,_0x5a3c0e['width']=this['_map']['scene'][_0x4b2b47(0x20a)]['clientWidth'],_0x5a3c0e[_0x4b2b47(0x187)]=this[_0x4b2b47(0x1df)]['scene']['canvas'][_0x4b2b47(0x1da)],_0x5a3c0e;}['resize'](){const _0x3f1be4=_0x10d56c;this[_0x3f1be4(0x20a)]&&(this[_0x3f1be4(0x20a)][_0x3f1be4(0x13e)]['width']=this['_map']['scene']['canvas'][_0x3f1be4(0x20e)]+'px',this[_0x3f1be4(0x20a)][_0x3f1be4(0x13e)]['height']=this['_map']['scene'][_0x3f1be4(0x20a)][_0x3f1be4(0x1da)]+'px',this['canvas']['width']=this[_0x3f1be4(0x1df)][_0x3f1be4(0x1b4)]['canvas'][_0x3f1be4(0x20e)],this[_0x3f1be4(0x20a)]['height']=this['_map']['scene'][_0x3f1be4(0x20a)][_0x3f1be4(0x1da)]);}['bindEvent'](){const _0x3be894=_0x10d56c,_0x569d66=this;let _0x4e4afa=Date['now']();(function _0x205805(){const _0xa61587=_0x2fe1;_0x569d66['animateFrame']=window['requestAnimationFrame'](_0x205805);if(_0x569d66['show']&&_0x569d66[_0xa61587(0x130)]){const _0x1e577a=Date[_0xa61587(0x1d0)](),_0x4fc85d=_0x1e577a-_0x4e4afa;_0x4fc85d>_0x569d66[_0xa61587(0x1dd)]&&(_0x4e4afa=_0x1e577a-_0x4fc85d%_0x569d66['frameTime'],_0x569d66[_0xa61587(0x123)]());}}(),window[_0x3be894(0x131)](_0x3be894(0x17a),this['resize']['bind'](this),![]),this[_0x3be894(0x1e8)]=![],this['mouse_move']=![],this['options'][_0x3be894(0x1dc)]&&(this[_0x3be894(0x1df)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x3be894(0x1a7)],this[_0x3be894(0x1af)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x3be894(0x1d6)],this)));}['unbindEvent'](){const _0x4e9716=_0x10d56c;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this[_0x4e9716(0x17a)]),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType'][_0x4e9716(0x18d)],this[_0x4e9716(0x1fc)],this),this['_map']['off'](mars3d__namespace[_0x4e9716(0x165)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x4e9716(0x196)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x5cfd05){const _0xcf13e=_0x10d56c;clearTimeout(this[_0xcf13e(0x197)]);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x24e44f=_0xcf13e;if(!this[_0x24e44f(0x12b)])return;this[_0x24e44f(0x1d2)](),this[_0x24e44f(0x20a)]['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x7d4cf8){const _0x5b9f70=_0x10d56c;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x5b9f70(0x165)][_0x5b9f70(0x172)],this['_onMouseMoveEvent'],this),this[_0x5b9f70(0x1df)]['on'](mars3d__namespace['EventType'][_0x5b9f70(0x172)],this[_0x5b9f70(0x18f)],this);}[_0x10d56c(0x18f)](_0x35c096){const _0x2b19d=_0x10d56c;if(!this[_0x2b19d(0x12b)]||!this[_0x2b19d(0x20a)])return;this['mouse_down']&&(this['canvas'][_0x2b19d(0x13e)][_0x2b19d(0x1c4)]='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x4841be){const _0x11f736=_0x10d56c;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x11f736(0x1c4)]='visible',this[_0x11f736(0x1e8)]=![],this[_0x11f736(0x1bb)]=![];}['setData'](_0x45a79c){const _0x2e9894=_0x10d56c;this['clear'](),this[_0x2e9894(0x188)]=_0x45a79c,this[_0x2e9894(0x130)][_0x2e9894(0x1b1)](_0x45a79c),this[_0x2e9894(0x1d2)]();}['redraw'](){const _0xd3e4cc=_0x10d56c;if(!this[_0xd3e4cc(0x12b)])return;this['windField'][_0xd3e4cc(0x15e)](this['options']),this[_0xd3e4cc(0x123)]();}['update'](){const _0x6f59f0=_0x10d56c;if(this['_updateIng'])return;this[_0x6f59f0(0x18b)]=!![];if(this['worker'])this[_0x6f59f0(0x130)]['update']();else{const _0x74bd15=this['windField']['getParticles']();this['_drawLines'](_0x74bd15);}this['_updateIng']=![];}['_drawLines'](_0x36dfa1){const _0x2e390b=_0x10d56c;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext'][_0x2e390b(0x15f)]='lighter',this[_0x2e390b(0x1f0)]['globalAlpha']=0.9;const _0xfde129=this['_map']['scene'][_0x2e390b(0x1a1)]!==Cesium[_0x2e390b(0x126)][_0x2e390b(0x209)],_0x4a8e3e=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x13b108=0x0,_0x501824=_0x36dfa1['length'];_0x13b108<_0x501824;_0x13b108++){const _0x1aa0a7=_0x36dfa1[_0x13b108],_0x219076=this['_tomap'](_0x1aa0a7['lng'],_0x1aa0a7['lat'],_0x1aa0a7),_0xf86923=this['_tomap'](_0x1aa0a7[_0x2e390b(0x1a4)],_0x1aa0a7['tlat'],_0x1aa0a7);if(!_0x219076||!_0xf86923)continue;if(_0xfde129&&Math[_0x2e390b(0x166)](_0x219076[0x0]-_0xf86923[0x0])>=_0x4a8e3e)continue;this['canvasContext']['beginPath'](),this['canvasContext'][_0x2e390b(0x1c7)]=this[_0x2e390b(0x1c7)],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x1aa0a7[_0x2e390b(0x18c)]),this['canvasContext'][_0x2e390b(0x18a)](_0x219076[0x0],_0x219076[0x1]),this['canvasContext']['lineTo'](_0xf86923[0x0],_0xf86923[0x1]),this['canvasContext'][_0x2e390b(0x198)]();}else{this['canvasContext'][_0x2e390b(0x199)](),this['canvasContext']['lineWidth']=this[_0x2e390b(0x1c7)],this['canvasContext']['strokeStyle']=this['color'];for(let _0x2001f4=0x0,_0x4fda46=_0x36dfa1['length'];_0x2001f4<_0x4fda46;_0x2001f4++){const _0x217d79=_0x36dfa1[_0x2001f4],_0x2cee98=this['_tomap'](_0x217d79[_0x2e390b(0x137)],_0x217d79['lat'],_0x217d79),_0xaab219=this[_0x2e390b(0x1a5)](_0x217d79['tlng'],_0x217d79[_0x2e390b(0x16e)],_0x217d79);if(!_0x2cee98||!_0xaab219)continue;if(_0xfde129&&Math['abs'](_0x2cee98[0x0]-_0xaab219[0x0])>=_0x4a8e3e)continue;this[_0x2e390b(0x1f0)]['moveTo'](_0x2cee98[0x0],_0x2cee98[0x1]),this['canvasContext'][_0x2e390b(0x1a8)](_0xaab219[0x0],_0xaab219[0x1]);}this['canvasContext'][_0x2e390b(0x198)]();}}['_tomap'](_0xc74f79,_0x2d8c0e,_0x827e9c){const _0x205f53=_0x10d56c,_0x3a36ce=Cesium['Cartesian3']['fromDegrees'](_0xc74f79,_0x2d8c0e,this['fixedHeight']),_0x5ccb0f=this['_map']['scene'];if(_0x5ccb0f['mode']===Cesium['SceneMode'][_0x205f53(0x209)]){const _0x438b99=new Cesium[(_0x205f53(0x194))](_0x5ccb0f['globe']['ellipsoid'],_0x5ccb0f[_0x205f53(0x1b3)][_0x205f53(0x1b5)]),_0x53596d=_0x438b99['isPointVisible'](_0x3a36ce);if(!_0x53596d)return _0x827e9c[_0x205f53(0x150)]=0x0,null;}const _0x2af130=Cesium[_0x205f53(0x1c2)]['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x3a36ce);return _0x2af130?[_0x2af130['x'],_0x2af130['y']]:null;}[_0x10d56c(0x1e3)](){this['windField']['clear'](),delete this['windData'];}[_0x10d56c(0x157)](){const _0x501fa2=_0x10d56c;this['worker']=new Worker(this['options']['worker']),this[_0x501fa2(0x20b)]['onmessage']=_0x4ebdcf=>{this['_drawLines'](_0x4ebdcf['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x5b9c9c=>{this['worker']['postMessage']({'type':'init','options':_0x5b9c9c});},'setOptions':_0xc4776f=>{const _0x4fdb81=_0x501fa2;this[_0x4fdb81(0x20b)]['postMessage']({'type':_0x4fdb81(0x15e),'options':_0xc4776f});},'setDate':_0x4ac573=>{const _0x249ff0=_0x501fa2;this['worker'][_0x249ff0(0x158)]({'type':'setDate','data':_0x4ac573});},'update':()=>{const _0x4f5dc3=_0x501fa2;if(this[_0x4f5dc3(0x1c9)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x34dd2c=_0x501fa2;this['worker'][_0x34dd2c(0x158)]({'type':_0x34dd2c(0x1e3)});}},this[_0x501fa2(0x130)][_0x501fa2(0x17d)](this['options']);}}mars3d__namespace[_0x10d56c(0x1fe)]['register'](_0x10d56c(0x1eb),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x10d56c(0x159)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x10d56c(0x147)]=WindLayer,exports[_0x10d56c(0x20c)]=WindUtil,Object[_0x10d56c(0x1c8)](exports,_0x10d56c(0x1e5),{'value':!![]});
}));
