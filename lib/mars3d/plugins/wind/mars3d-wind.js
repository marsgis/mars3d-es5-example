/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.0
 * 编译日期：2024-01-14 21:58:24
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x3f687f=_0x48cd;(function(_0x4788bb,_0x2cb8e0){const _0x3af4d4=_0x48cd,_0x1e5f36=_0x4788bb();while(!![]){try{const _0x481d69=parseInt(_0x3af4d4(0xac))/0x1+parseInt(_0x3af4d4(0x159))/0x2+-parseInt(_0x3af4d4(0xcc))/0x3+parseInt(_0x3af4d4(0xdb))/0x4+-parseInt(_0x3af4d4(0xee))/0x5*(parseInt(_0x3af4d4(0xdf))/0x6)+parseInt(_0x3af4d4(0xcf))/0x7+-parseInt(_0x3af4d4(0x15a))/0x8;if(_0x481d69===_0x2cb8e0)break;else _0x1e5f36['push'](_0x1e5f36['shift']());}catch(_0x53aa30){_0x1e5f36['push'](_0x1e5f36['shift']());}}}(_0x4dc0,0xbca66));function _interopNamespace(_0x56ae4c){const _0x1b9a73=_0x48cd;if(_0x56ae4c&&_0x56ae4c['__esModule'])return _0x56ae4c;var _0x461501=Object[_0x1b9a73(0x14b)](null);return _0x56ae4c&&Object['keys'](_0x56ae4c)['forEach'](function(_0x3e9da5){const _0x2098ca=_0x1b9a73;if(_0x3e9da5!=='default'){var _0x14550e=Object[_0x2098ca(0x15b)](_0x56ae4c,_0x3e9da5);Object[_0x2098ca(0x18d)](_0x461501,_0x3e9da5,_0x14550e['get']?_0x14550e:{'enumerable':!![],'get':function(){return _0x56ae4c[_0x3e9da5];}});}}),_0x461501[_0x1b9a73(0x132)]=_0x56ae4c,_0x461501;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0xcacce5,_0x35eaae){const _0x87d238=_0x48cd,_0x115973=_0xcacce5*Math[_0x87d238(0xe1)](Cesium$7['Math']['toRadians'](_0x35eaae));return _0x115973;}function getV(_0x5170a6,_0x31a510){const _0x2aa1d1=_0x5170a6*Math['sin'](Cesium$7['Math']['toRadians'](_0x31a510));return _0x2aa1d1;}function getSpeed(_0x441324,_0x31add6){const _0x44a684=_0x48cd,_0x140c5d=Math['sqrt'](Math[_0x44a684(0x148)](_0x441324,0x2)+Math['pow'](_0x31add6,0x2));return _0x140c5d;}function getDirection(_0x2b94c4,_0x330a01){const _0x29354d=_0x48cd;let _0x5dbee8=Cesium$7[_0x29354d(0xa4)]['toDegrees'](Math[_0x29354d(0xf8)](_0x330a01,_0x2b94c4));return _0x5dbee8+=_0x5dbee8<0x0?0x168:0x0,_0x5dbee8;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x27ed47){const _0x1ba346=_0x48cd;this[_0x1ba346(0x156)]=_0x27ed47['commandType'],this['geometry']=_0x27ed47['geometry'],this['attributeLocations']=_0x27ed47['attributeLocations'],this[_0x1ba346(0xd0)]=_0x27ed47['primitiveType'],this[_0x1ba346(0xbb)]=_0x27ed47['uniformMap'],this['vertexShaderSource']=_0x27ed47['vertexShaderSource'],this['fragmentShaderSource']=_0x27ed47['fragmentShaderSource'],this['rawRenderState']=_0x27ed47['rawRenderState'],this['framebuffer']=_0x27ed47[_0x1ba346(0x117)],this['outputTexture']=_0x27ed47['outputTexture'],this['autoClear']=_0x27ed47[_0x1ba346(0xcb)]??![],this['preExecute']=_0x27ed47['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x1ba346(0xcb)]&&(this['clearCommand']=new Cesium$6[(_0x1ba346(0xa7))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x3f687f(0x17a)](_0x505d9e){const _0x5e4df3=_0x3f687f;switch(this['commandType']){case'Draw':{const _0x26a4f1=Cesium$6['VertexArray']['fromGeometry']({'context':_0x505d9e,'geometry':this['geometry'],'attributeLocations':this[_0x5e4df3(0x141)],'bufferUsage':Cesium$6[_0x5e4df3(0xec)]['STATIC_DRAW']}),_0x2c01f8=Cesium$6[_0x5e4df3(0x160)][_0x5e4df3(0xff)]({'context':_0x505d9e,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x5e4df3(0xaa)]}),_0x31c25e=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x2c01f8,'vertexArray':_0x26a4f1,'modelMatrix':Cesium$6[_0x5e4df3(0x13e)]['IDENTITY'],'renderState':_0x31c25e,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x5e4df3(0xef)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x5e4df3(0xaa)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x3f687f(0xfa)](_0xea6942,_0x2e6a66){const _0x450d35=_0x3f687f;this['geometry']=_0x2e6a66;const _0x3a6353=Cesium$6['VertexArray']['fromGeometry']({'context':_0xea6942,'geometry':this[_0x450d35(0x183)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x450d35(0x119)]});this['commandToExecute']['vertexArray']=_0x3a6353;}['update'](_0x1ec3d9){const _0x1f02d5=_0x3f687f;if(!this['show'])return;if(_0x1ec3d9[_0x1f02d5(0xf0)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this[_0x1f02d5(0x107)])&&(this['commandToExecute']=this[_0x1f02d5(0x17a)](_0x1ec3d9['context'])),Cesium$6['defined'](this[_0x1f02d5(0x16f)])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x1ec3d9[_0x1f02d5(0x154)]['push'](this[_0x1f02d5(0x158)]),_0x1ec3d9[_0x1f02d5(0x154)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x10d619=_0x3f687f;if(this['clearCommand']){var _0x57a24c,_0x3f62c5;(_0x57a24c=this[_0x10d619(0x158)])!==null&&_0x57a24c!==void 0x0&&_0x57a24c['vertexArray']&&this[_0x10d619(0x158)]['vertexArray']['destroy'](),(_0x3f62c5=this['clearCommand'])!==null&&_0x3f62c5!==void 0x0&&_0x3f62c5['shaderProgram']&&this[_0x10d619(0x158)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this[_0x10d619(0x107)][_0x10d619(0x17d)]&&this[_0x10d619(0x107)][_0x10d619(0x17d)][_0x10d619(0xfd)](),delete this[_0x10d619(0x107)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x6b162e=function(){const _0xa1c9e6=_0x48cd,_0x3e5488=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0xa1c9e6(0x15c)][_0xa1c9e6(0x163)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x3e5488;},_0x2ec0fc=function(_0x274a20,_0x15f9e3){if(Cesium$5['defined'](_0x15f9e3)){const _0x19e448={};_0x19e448['arrayBufferView']=_0x15f9e3,_0x274a20['source']=_0x19e448;}const _0x93f05b=new Cesium$5['Texture'](_0x274a20);return _0x93f05b;},_0x291427=function(_0x3287d2,_0x139afc,_0x341f66){const _0x207b1c=new Cesium$5['Framebuffer']({'context':_0x3287d2,'colorTextures':[_0x139afc],'depthTexture':_0x341f66});return _0x207b1c;},_0x846569=function(_0x1f6024){const _0x232b24=_0x48cd,_0x2851bc=!![],_0x32cde7=![],_0x22dcef={'viewport':_0x1f6024['viewport'],'depthTest':_0x1f6024[_0x232b24(0xcd)],'depthMask':_0x1f6024[_0x232b24(0xd1)],'blending':_0x1f6024['blending']},_0x26eca7=Cesium$5['Appearance']['getDefaultRenderState'](_0x2851bc,_0x32cde7,_0x22dcef);return _0x26eca7;},_0x235530=function(_0x7f4ca6){const _0x4cf4c4=_0x48cd,_0x211956={},_0x15f0d2=Cesium$5[_0x4cf4c4(0xa4)]['mod'](_0x7f4ca6['west'],Cesium$5[_0x4cf4c4(0xa4)]['TWO_PI']),_0x5789f1=Cesium$5['Math'][_0x4cf4c4(0x16a)](_0x7f4ca6[_0x4cf4c4(0xe2)],Cesium$5['Math']['TWO_PI']),_0x2e5e42=_0x7f4ca6['width'];let _0x32268c,_0x601ab0;_0x2e5e42>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x32268c=0x0,_0x601ab0=Cesium$5['Math']['TWO_PI']):_0x5789f1-_0x15f0d2<_0x2e5e42?(_0x32268c=_0x15f0d2,_0x601ab0=_0x15f0d2+_0x2e5e42):(_0x32268c=_0x15f0d2,_0x601ab0=_0x5789f1);_0x211956['lon']={'min':Cesium$5[_0x4cf4c4(0xa4)]['toDegrees'](_0x32268c),'max':Cesium$5['Math'][_0x4cf4c4(0xe5)](_0x601ab0)};const _0x4cce9b=_0x7f4ca6['south'],_0x42ec8d=_0x7f4ca6['north'],_0x138082=_0x7f4ca6['height'],_0x1eec37=_0x138082>Cesium$5['Math']['PI']/0xc?_0x138082/0x2:0x0;let _0x22a7b4=Cesium$5['Math']['clampToLatitudeRange'](_0x4cce9b-_0x1eec37),_0x27e59b=Cesium$5['Math'][_0x4cf4c4(0x11b)](_0x42ec8d+_0x1eec37);return _0x22a7b4<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x22a7b4=-Cesium$5[_0x4cf4c4(0xa4)]['PI_OVER_TWO']),_0x27e59b>Cesium$5['Math']['PI_OVER_THREE']&&(_0x27e59b=Cesium$5['Math']['PI_OVER_TWO']),_0x211956['lat']={'min':Cesium$5['Math'][_0x4cf4c4(0xe5)](_0x22a7b4),'max':Cesium$5['Math']['toDegrees'](_0x27e59b)},_0x211956;};return{'getFullscreenQuad':_0x6b162e,'createTexture':_0x2ec0fc,'createFramebuffer':_0x291427,'createRawRenderState':_0x846569,'viewRectangleToLonLatRange':_0x235530};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x3f687f(0x138),trailDraw_frag=_0x3f687f(0x145),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x2a89c6,_0x1d0452,_0x5dddcc,_0x19b8f3,_0x231810){const _0x5ebc08=_0x3f687f;this[_0x5ebc08(0x146)](_0x2a89c6,_0x1d0452,_0x5dddcc['colors']),this[_0x5ebc08(0xd4)](_0x2a89c6),this[_0x5ebc08(0x16e)](_0x2a89c6,_0x5dddcc,_0x19b8f3,_0x231810);}['createRenderingTextures'](_0x51279a,_0xb217e8,_0x2df056){const _0x291b1b=_0x3f687f,_0x4711ff={'context':_0x51279a,'width':_0x51279a['drawingBufferWidth'],'height':_0x51279a['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x54fd0a={'context':_0x51279a,'width':_0x51279a['drawingBufferWidth'],'height':_0x51279a['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x291b1b(0xa9)]['UNSIGNED_INT']},_0x914ec7=_0x2df056['length'],_0xc80f01=new Float32Array(_0x914ec7*0x3);for(let _0xc95d48=0x0;_0xc95d48<_0x914ec7;_0xc95d48++){const _0x862336=Cesium$4[_0x291b1b(0x15f)][_0x291b1b(0x179)](_0x2df056[_0xc95d48]);_0xc80f01[0x3*_0xc95d48]=_0x862336[_0x291b1b(0xed)],_0xc80f01[0x3*_0xc95d48+0x1]=_0x862336['green'],_0xc80f01[0x3*_0xc95d48+0x2]=_0x862336['blue'];}const _0x15f125={'context':_0x51279a,'width':_0x914ec7,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x291b1b(0xa9)][_0x291b1b(0x163)],'sampler':new Cesium$4[(_0x291b1b(0x122))]({'minificationFilter':Cesium$4[_0x291b1b(0xe9)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x291b1b(0x11a)]})};this[_0x291b1b(0xc5)]={'segmentsColor':Util['createTexture'](_0x4711ff),'segmentsDepth':Util['createTexture'](_0x54fd0a),'currentTrailsColor':Util[_0x291b1b(0x10e)](_0x4711ff),'currentTrailsDepth':Util[_0x291b1b(0x10e)](_0x54fd0a),'nextTrailsColor':Util['createTexture'](_0x4711ff),'nextTrailsDepth':Util[_0x291b1b(0x10e)](_0x54fd0a),'colorTable':Util['createTexture'](_0x15f125,_0xc80f01)};}['createRenderingFramebuffers'](_0x1fbf16){const _0x16eaa4=_0x3f687f;this['framebuffers']={'segments':Util[_0x16eaa4(0x144)](_0x1fbf16,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util[_0x16eaa4(0x144)](_0x1fbf16,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util[_0x16eaa4(0x144)](_0x1fbf16,this['textures'][_0x16eaa4(0xb6)],this[_0x16eaa4(0xc5)]['nextTrailsDepth'])};}[_0x3f687f(0x110)](_0x20282b){const _0x3db8b4=_0x3f687f,_0x3f1a7e=0x4;let _0x3eff3c=[];for(let _0x593821=0x0;_0x593821<_0x20282b['particlesTextureSize'];_0x593821++){for(let _0x263438=0x0;_0x263438<_0x20282b['particlesTextureSize'];_0x263438++){for(let _0x2ab7b2=0x0;_0x2ab7b2<_0x3f1a7e;_0x2ab7b2++){_0x3eff3c['push'](_0x593821/_0x20282b['particlesTextureSize']),_0x3eff3c['push'](_0x263438/_0x20282b[_0x3db8b4(0x10f)]);}}}_0x3eff3c=new Float32Array(_0x3eff3c);let _0x110b6b=[];const _0x50b58e=[-0x1,0x1],_0x39ecb7=[-0x1,0x1];for(let _0x35a1fd=0x0;_0x35a1fd<_0x20282b['maxParticles'];_0x35a1fd++){for(let _0x1c85b0=0x0;_0x1c85b0<_0x3f1a7e/0x2;_0x1c85b0++){for(let _0x43b82e=0x0;_0x43b82e<_0x3f1a7e/0x2;_0x43b82e++){_0x110b6b[_0x3db8b4(0x113)](_0x50b58e[_0x1c85b0]),_0x110b6b['push'](_0x39ecb7[_0x43b82e]),_0x110b6b['push'](0x0);}}}_0x110b6b=new Float32Array(_0x110b6b);const _0x830051=0x6*_0x20282b['maxParticles'],_0x3466e1=new Uint32Array(_0x830051);for(let _0x268a39=0x0,_0x5a7fbf=0x0,_0x317c50=0x0;_0x268a39<_0x20282b['maxParticles'];_0x268a39++){_0x3466e1[_0x5a7fbf++]=_0x317c50+0x0,_0x3466e1[_0x5a7fbf++]=_0x317c50+0x1,_0x3466e1[_0x5a7fbf++]=_0x317c50+0x2,_0x3466e1[_0x5a7fbf++]=_0x317c50+0x2,_0x3466e1[_0x5a7fbf++]=_0x317c50+0x1,_0x3466e1[_0x5a7fbf++]=_0x317c50+0x3,_0x317c50+=0x4;}const _0x426ace=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x3eff3c}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x3db8b4(0x15c)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x110b6b})}),'indices':_0x3466e1});return _0x426ace;}[_0x3f687f(0x16e)](_0x1eee23,_0x19c37e,_0x426f75,_0x4fe6fd){const _0xe33cf0=_0x3f687f,_0x15f772=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0xe33cf0(0x142),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x19c37e),'primitiveType':Cesium$4['PrimitiveType'][_0xe33cf0(0x14d)],'uniformMap':{'currentParticlesPosition':function(){const _0x1f359b=_0xe33cf0;return _0x4fe6fd['particlesTextures'][_0x1f359b(0xc3)];},'postProcessingPosition':function(){const _0x4d7ef7=_0xe33cf0;return _0x4fe6fd[_0x4d7ef7(0x189)]['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x4fe6fd['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x15f772['textures']['colorTable'];},'aspect':function(){const _0x4eedb4=_0xe33cf0;return _0x1eee23[_0x4eedb4(0xb5)]/_0x1eee23['drawingBufferHeight'];},'pixelSize':function(){return _0x426f75['pixelSize'];},'lineWidth':function(){const _0x1ab4da=_0xe33cf0;return _0x19c37e[_0x1ab4da(0xce)];},'particleHeight':function(){const _0x4a79b4=_0xe33cf0;return _0x19c37e[_0x4a79b4(0x172)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0xe33cf0(0x167)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0xe33cf0(0x18a)][_0xe33cf0(0x14d)],'uniformMap':{'segmentsColorTexture':function(){const _0x33842b=_0xe33cf0;return _0x15f772[_0x33842b(0xc5)][_0x33842b(0x102)];},'segmentsDepthTexture':function(){const _0x1c6e3e=_0xe33cf0;return _0x15f772['textures'][_0x1c6e3e(0x140)];},'currentTrailsColor':function(){return _0x15f772['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x1d716a=_0xe33cf0;return _0x15f772[_0x1d716a(0x17f)]['currentTrails'][_0x1d716a(0x11d)];},'fadeOpacity':function(){return _0x19c37e['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0xe33cf0(0x137))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0xe33cf0(0x13a)],'autoClear':!![],'preExecute':function(){const _0x5d306c=_0xe33cf0,_0x282499=_0x15f772['framebuffers']['currentTrails'];_0x15f772['framebuffers']['currentTrails']=_0x15f772[_0x5d306c(0x17f)][_0x5d306c(0x13a)],_0x15f772[_0x5d306c(0x17f)]['nextTrails']=_0x282499,_0x15f772['primitives']['trails']['commandToExecute']['framebuffer']=_0x15f772[_0x5d306c(0x17f)]['nextTrails'],_0x15f772[_0x5d306c(0xfc)]['trails']['clearCommand']['framebuffer']=_0x15f772['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0xe33cf0(0x14d)],'uniformMap':{'trailsColorTexture':function(){const _0x560614=_0xe33cf0;return _0x15f772['framebuffers'][_0x560614(0x13a)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x15f772['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x3f687f(0x12e);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x4e303c,_0x3f7e52,_0x3978bf,_0x1c3b4b){const _0x3f467e=_0x3f687f;this['data']=_0x3f7e52,this[_0x3f467e(0x175)](_0x4e303c,_0x3f7e52),this['createParticlesTextures'](_0x4e303c,_0x3978bf,_0x1c3b4b),this['createComputingPrimitives'](_0x3f7e52,_0x3978bf,_0x1c3b4b);}['createWindTextures'](_0x44d949,_0x3e17ff){const _0x27b3d6=_0x3f687f,_0x54a404={'context':_0x44d949,'width':_0x3e17ff['dimensions']['lon'],'height':_0x3e17ff['dimensions'][_0x27b3d6(0x17c)]*(_0x3e17ff['dimensions'][_0x27b3d6(0xdc)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x27b3d6(0x122))]({'minificationFilter':Cesium$3[_0x27b3d6(0xe9)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x27b3d6(0x136)]})};this['windTextures']={'U':Util[_0x27b3d6(0x10e)](_0x54a404,_0x3e17ff['U']['array']),'V':Util['createTexture'](_0x54a404,_0x3e17ff['V']['array'])};}['createParticlesTextures'](_0x41b82c,_0x433131,_0x276ca1){const _0x2ed06b=_0x3f687f,_0x123630={'context':_0x41b82c,'width':_0x433131['particlesTextureSize'],'height':_0x433131['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3[_0x2ed06b(0xa9)]['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x2ed06b(0x122))]({'minificationFilter':Cesium$3[_0x2ed06b(0xe9)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x2ed06b(0x136)]})},_0x2844bb=this[_0x2ed06b(0x13f)](_0x433131[_0x2ed06b(0x187)],_0x276ca1),_0x82f882=new Float32Array(0x4*_0x433131['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x123630),'currentParticlesPosition':Util['createTexture'](_0x123630,_0x2844bb),'nextParticlesPosition':Util[_0x2ed06b(0x10e)](_0x123630,_0x2844bb),'currentParticlesSpeed':Util['createTexture'](_0x123630,_0x82f882),'nextParticlesSpeed':Util['createTexture'](_0x123630,_0x82f882),'postProcessingPosition':Util['createTexture'](_0x123630,_0x2844bb),'postProcessingSpeed':Util['createTexture'](_0x123630,_0x82f882)};}['randomizeParticles'](_0x4b2a78,_0x20ce6c){const _0x1c5386=_0x3f687f,_0x28d8a9=new Float32Array(0x4*_0x4b2a78);for(let _0x5daf72=0x0;_0x5daf72<_0x4b2a78;_0x5daf72++){_0x28d8a9[0x4*_0x5daf72]=Cesium$3[_0x1c5386(0xa4)][_0x1c5386(0x100)](_0x20ce6c[_0x1c5386(0x165)]['x'],_0x20ce6c['lonRange']['y']),_0x28d8a9[0x4*_0x5daf72+0x1]=Cesium$3['Math']['randomBetween'](_0x20ce6c['latRange']['x'],_0x20ce6c[_0x1c5386(0xc6)]['y']),_0x28d8a9[0x4*_0x5daf72+0x2]=Cesium$3[_0x1c5386(0xa4)][_0x1c5386(0x100)](this['data'][_0x1c5386(0xdc)]['min'],this['data'][_0x1c5386(0xdc)]['max']),_0x28d8a9[0x4*_0x5daf72+0x3]=0x0;}return _0x28d8a9;}['destroyParticlesTextures'](){const _0x1db98a=_0x3f687f;Object['keys'](this[_0x1db98a(0x189)])[_0x1db98a(0xd7)](_0xf95bc9=>{this['particlesTextures'][_0xf95bc9]['destroy']();});}[_0x3f687f(0x15d)](_0x33c8b1,_0x5958d1,_0x856fc2){const _0x5f510a=_0x3f687f,_0x5853ae=new Cesium$3[(_0x5f510a(0x12b))](_0x33c8b1['dimensions']['lon'],_0x33c8b1[_0x5f510a(0x166)]['lat'],_0x33c8b1[_0x5f510a(0x166)]['lev']),_0x134fd7=new Cesium$3[(_0x5f510a(0x12b))](_0x33c8b1['lon']['min'],_0x33c8b1[_0x5f510a(0x17c)][_0x5f510a(0xbf)],_0x33c8b1['lev']['min']),_0x210606=new Cesium$3['Cartesian3'](_0x33c8b1['lon'][_0x5f510a(0x180)],_0x33c8b1[_0x5f510a(0x17c)]['max'],_0x33c8b1['lev']['max']),_0x317d4a=new Cesium$3['Cartesian3']((_0x210606['x']-_0x134fd7['x'])/(_0x5853ae['x']-0x1),(_0x210606['y']-_0x134fd7['y'])/(_0x5853ae['y']-0x1),_0x5853ae['z']>0x1?(_0x210606['z']-_0x134fd7['z'])/(_0x5853ae['z']-0x1):0x1),_0x113667=new Cesium$3['Cartesian2'](_0x33c8b1['U']['min'],_0x33c8b1['U']['max']),_0x565d5f=new Cesium$3['Cartesian2'](_0x33c8b1['V'][_0x5f510a(0xbf)],_0x33c8b1['V']['max']),_0x1be6ff=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x4b05f7=_0x5f510a;return _0x1be6ff[_0x4b05f7(0x162)]['U'];},'V':function(){return _0x1be6ff['windTextures']['V'];},'currentParticlesPosition':function(){return _0x1be6ff['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x5853ae;},'minimum':function(){return _0x134fd7;},'maximum':function(){return _0x210606;},'interval':function(){return _0x317d4a;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x5f510a(0x189)]['particlesWind'],'preExecute':function(){_0x1be6ff['primitives']['getWind']['commandToExecute']['outputTexture']=_0x1be6ff['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x5919cb=_0x5f510a;return _0x1be6ff[_0x5919cb(0x189)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x1be6ff['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x113667;},'vSpeedRange':function(){return _0x565d5f;},'pixelSize':function(){return _0x856fc2['pixelSize'];},'speedFactor':function(){return _0x5958d1['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x5f510a(0x137))]({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x5f510a(0x189)]['nextParticlesSpeed'],'preExecute':function(){const _0x53401c=_0x5f510a,_0x14f7fb=_0x1be6ff[_0x53401c(0x189)]['currentParticlesSpeed'];_0x1be6ff[_0x53401c(0x189)]['currentParticlesSpeed']=_0x1be6ff['particlesTextures']['postProcessingSpeed'],_0x1be6ff['particlesTextures'][_0x53401c(0xe6)]=_0x14f7fb,_0x1be6ff['primitives']['updateSpeed'][_0x53401c(0x107)]['outputTexture']=_0x1be6ff[_0x53401c(0x189)][_0x53401c(0x15e)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x1be6ff['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x4b7826=_0x5f510a;return _0x1be6ff['particlesTextures'][_0x4b7826(0x10d)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x586add=_0x5f510a,_0x19382d=_0x1be6ff['particlesTextures']['currentParticlesPosition'];_0x1be6ff['particlesTextures'][_0x586add(0xc3)]=_0x1be6ff['particlesTextures']['postProcessingPosition'],_0x1be6ff['particlesTextures'][_0x586add(0x152)]=_0x19382d,_0x1be6ff[_0x586add(0xfc)]['updatePosition']['commandToExecute'][_0x586add(0xbe)]=_0x1be6ff['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x1be6ff['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x1be6ff['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x856fc2['lonRange'];},'latRange':function(){return _0x856fc2['latRange'];},'randomCoefficient':function(){const _0x383d09=Math['random']();return _0x383d09;},'dropRate':function(){const _0x166feb=_0x5f510a;return _0x5958d1[_0x166feb(0xfe)];},'dropRateBump':function(){return _0x5958d1['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x5f510a(0x137))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x5f510a(0x189)]['postProcessingPosition'],'preExecute':function(){const _0x5d72c1=_0x5f510a;_0x1be6ff[_0x5d72c1(0xfc)]['postProcessingPosition']['commandToExecute'][_0x5d72c1(0xbe)]=_0x1be6ff['particlesTextures'][_0x5d72c1(0x152)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x5f510a(0x177),'uniformMap':{'postProcessingPosition':function(){const _0x29ecb9=_0x5f510a;return _0x1be6ff[_0x29ecb9(0x189)]['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x1be6ff['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x5f510a(0x189)]['postProcessingSpeed'],'preExecute':function(){const _0x54159d=_0x5f510a;_0x1be6ff['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x1be6ff[_0x54159d(0x189)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x4acc38,_0x1f26fc,_0x26613c,_0x4f2cf2){const _0x58f4a1=_0x3f687f;this['context']=_0x4acc38,_0x1f26fc={..._0x1f26fc},_0x1f26fc['udata']&&_0x1f26fc[_0x58f4a1(0x12d)]&&(_0x1f26fc[_0x58f4a1(0x166)]={},_0x1f26fc[_0x58f4a1(0x166)]['lon']=_0x1f26fc[_0x58f4a1(0x126)],_0x1f26fc['dimensions']['lat']=_0x1f26fc['rows'],_0x1f26fc['dimensions']['lev']=_0x1f26fc['lev']||0x1,_0x1f26fc['lon']={},_0x1f26fc['lon']['min']=_0x1f26fc[_0x58f4a1(0xbc)],_0x1f26fc['lon']['max']=_0x1f26fc['xmax'],_0x1f26fc['lat']={},_0x1f26fc['lat']['min']=_0x1f26fc['ymin'],_0x1f26fc['lat'][_0x58f4a1(0x180)]=_0x1f26fc[_0x58f4a1(0x178)],_0x1f26fc['lev']={},_0x1f26fc['lev'][_0x58f4a1(0xbf)]=_0x1f26fc[_0x58f4a1(0x114)]??0x1,_0x1f26fc['lev'][_0x58f4a1(0x180)]=_0x1f26fc[_0x58f4a1(0xdd)]??0x1,_0x1f26fc['U']={},_0x1f26fc['U']['array']=new Float32Array(_0x1f26fc['udata']),_0x1f26fc['U']['min']=_0x1f26fc['umin']??Math['min'](..._0x1f26fc['udata']),_0x1f26fc['U']['max']=_0x1f26fc['umax']??Math[_0x58f4a1(0x180)](..._0x1f26fc['udata']),_0x1f26fc['V']={},_0x1f26fc['V']['array']=new Float32Array(_0x1f26fc['vdata']),_0x1f26fc['V'][_0x58f4a1(0xbf)]=_0x1f26fc['vmin']??Math['min'](..._0x1f26fc[_0x58f4a1(0x12d)]),_0x1f26fc['V']['max']=_0x1f26fc['vmax']??Math[_0x58f4a1(0x180)](..._0x1f26fc[_0x58f4a1(0x12d)])),this['data']=_0x1f26fc,this['options']=_0x26613c,this['viewerParameters']=_0x4f2cf2,this['particlesComputing']=new ParticlesComputing(this[_0x58f4a1(0x106)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x501e9b){const _0x475da6=_0x3f687f;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x475da6(0x164)]['windTextures'])['forEach'](_0x4aec51=>{this['particlesComputing']['windTextures'][_0x4aec51]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x475da6(0xd7)](_0x3c4675=>{this['particlesRendering']['framebuffers'][_0x3c4675]['destroy']();}),this[_0x475da6(0x106)]=_0x501e9b,this['particlesComputing']=new ParticlesComputing(this[_0x475da6(0x106)],this['data'],this['options'],this['viewerParameters']),this[_0x475da6(0x135)]=new ParticlesRendering(this['context'],this[_0x475da6(0x11c)],this[_0x475da6(0xc7)],this['viewerParameters'],this[_0x475da6(0x164)]);}[_0x3f687f(0x103)](){const _0x332662=_0x3f687f,_0x5038d3=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x332662(0x15f))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])[_0x332662(0xd7)](_0x5ab809=>{const _0x32008e=_0x332662;_0x5038d3['framebuffer']=this['particlesRendering'][_0x32008e(0x17f)][_0x5ab809],_0x5038d3['execute'](this['context']);});}['refreshParticles'](_0x37e2b6){const _0x243e40=_0x3f687f;this['clearFramebuffers'](),this['particlesComputing'][_0x243e40(0x131)](),this['particlesComputing'][_0x243e40(0xd5)](this['context'],this['options'],this[_0x243e40(0xe3)]);if(_0x37e2b6){var _0x5b469a;const _0x2635c9=this[_0x243e40(0x135)]['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x2635c9;const _0x5d45b7=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x2635c9,'attributeLocations':this[_0x243e40(0x135)]['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x5b469a=this['particlesRendering']['primitives'])!==null&&_0x5b469a!==void 0x0&&(_0x5b469a=_0x5b469a[_0x243e40(0x153)])!==null&&_0x5b469a!==void 0x0&&_0x5b469a[_0x243e40(0x107)]&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x5d45b7);}}['setOptions'](_0x469db9){const _0x5761a8=_0x3f687f;let _0x5bb058=![];this[_0x5761a8(0xc7)]['maxParticles']!==_0x469db9['maxParticles']&&(_0x5bb058=!![]),Object[_0x5761a8(0xb9)](_0x469db9)['forEach'](_0x2033a9=>{this['options'][_0x2033a9]=_0x469db9[_0x2033a9];}),this['refreshParticles'](_0x5bb058);}['applyViewerParameters'](_0x52a473){Object['keys'](_0x52a473)['forEach'](_0xf97ef6=>{this['viewerParameters'][_0xf97ef6]=_0x52a473[_0xf97ef6];}),this['refreshParticles'](![]);}['destroy'](){const _0xc7d3d0=_0x3f687f;clearTimeout(this[_0xc7d3d0(0x104)]),this[_0xc7d3d0(0x164)]['destroyParticlesTextures'](),Object[_0xc7d3d0(0xb9)](this['particlesComputing']['windTextures'])[_0xc7d3d0(0xd7)](_0x55bc54=>{const _0x3d757f=_0xc7d3d0;this['particlesComputing']['windTextures'][_0x55bc54][_0x3d757f(0xfd)]();}),this[_0xc7d3d0(0x135)][_0xc7d3d0(0xc5)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x54531a=>{const _0x34c978=_0xc7d3d0;this['particlesRendering']['framebuffers'][_0x54531a][_0x34c978(0xfd)]();});for(const _0x2cf812 in this){delete this[_0x2cf812];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x3f687f(0xf1)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x2b7359={}){_0x2b7359={...DEF_OPTIONS,..._0x2b7359},super(_0x2b7359),this['_setOptionsHook'](_0x2b7359);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x3f687f(0x11c)](_0x370948){this['setData'](_0x370948);}get['colors'](){const _0x6e7afa=_0x3f687f;return this[_0x6e7afa(0xc7)]['colors'];}set['colors'](_0x2257db){const _0x47d3b5=_0x3f687f;this['options'][_0x47d3b5(0xf4)]=_0x2257db,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x2257db}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x2b8b15=_0x3f687f;this[_0x2b8b15(0x168)]=this['_map']['scene'],this['camera']=this[_0x2b8b15(0xf5)][_0x2b8b15(0xc9)],this[_0x2b8b15(0xfc)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x2b8b15(0x169)]=new Cesium$1[(_0x2b8b15(0x186))](Cesium$1[_0x2b8b15(0x12b)][_0x2b8b15(0x173)],0.99*0x615299),this[_0x2b8b15(0x13b)](),window[_0x2b8b15(0x171)](_0x2b8b15(0xea),this[_0x2b8b15(0xea)][_0x2b8b15(0xb0)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x2b8b15(0xf5)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x2b8b15(0xf5)]['on'](mars3d__namespace['EventType'][_0x2b8b15(0x181)],this['_onMouseDownEvent'],this),this[_0x2b8b15(0xf5)]['on'](mars3d__namespace['EventType'][_0x2b8b15(0xb8)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace[_0x2b8b15(0xd6)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x2b8b15(0x157)](this['_data']);}['_removedHook'](){const _0x4f0d3b=_0x3f687f;window['removeEventListener']('resize',this[_0x4f0d3b(0xea)]),this['_map'][_0x4f0d3b(0xd2)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x4f0d3b(0x176)],this),this[_0x4f0d3b(0xf5)][_0x4f0d3b(0xd2)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x4f0d3b(0xf5)]['off'](mars3d__namespace[_0x4f0d3b(0xd6)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x4f0d3b(0xf7)],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this[_0x4f0d3b(0xfc)]);}['resize'](){const _0x13ec72=_0x3f687f;if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x13ec72(0xe0)]=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}[_0x3f687f(0xd8)](_0x84a11){this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x3f687f(0x176)](_0x596bfd){const _0x2b9b21=_0x3f687f;clearTimeout(this[_0x2b9b21(0x188)]);if(!this['show']||!this['particleSystem'])return;this[_0x2b9b21(0xfc)][_0x2b9b21(0xe0)]=![],this['refreshTimer']=setTimeout(()=>{const _0x47c07c=_0x2b9b21;if(!this[_0x47c07c(0xe0)])return;this[_0x47c07c(0xa6)]();},0xc8);}['_onMouseDownEvent'](_0x155b81){this['mouse_down']=!![];}[_0x3f687f(0xf7)](_0x2201fa){const _0x5090df=_0x3f687f;if(!this['show']||!this[_0x5090df(0xc0)])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x2f73d9){const _0x47a3ba=_0x3f687f;if(!this['show']||!this['particleSystem'])return;this[_0x47a3ba(0x10c)]&&this['mouse_move']&&this['redraw'](),this[_0x47a3ba(0xfc)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x3463f2=_0x3f687f;if(!this['_map']||!this[_0x3463f2(0xe0)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x28bce9){this['_data']=_0x28bce9,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x28bce9,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x5a3fae,_0x541e13){if(_0x5a3fae)for(const _0x4f208f in _0x5a3fae){this[_0x4f208f]=_0x5a3fae[_0x4f208f];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x3f687f(0x11e)](){const _0x3b4281=_0x3f687f,_0x69118e=Math['ceil'](Math[_0x3b4281(0x116)](this[_0x3b4281(0xca)]));return this['particlesNumber']=_0x69118e*_0x69118e,{'particlesTextureSize':_0x69118e,'maxParticles':this[_0x3b4281(0xca)],'particleHeight':this[_0x3b4281(0x13d)],'fadeOpacity':this[_0x3b4281(0x10b)],'dropRate':this[_0x3b4281(0xfe)],'dropRateBump':this[_0x3b4281(0x111)],'speedFactor':this['speedFactor'],'lineWidth':this[_0x3b4281(0xce)],'colors':this[_0x3b4281(0xf4)]};}['addPrimitives'](){const _0xde8271=_0x3f687f;this['primitives']['add'](this['particleSystem'][_0xde8271(0x164)]['primitives']['getWind']),this['primitives'][_0xde8271(0x14c)](this['particleSystem'][_0xde8271(0x164)]['primitives']['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0xde8271(0x164)]['primitives']['updatePosition']),this['primitives'][_0xde8271(0x14c)](this[_0xde8271(0xc0)]['particlesComputing'][_0xde8271(0xfc)][_0xde8271(0x152)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives'][_0xde8271(0x14c)](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives'][_0xde8271(0x14c)](this[_0xde8271(0xc0)]['particlesRendering']['primitives']['trails']),this['primitives']['add'](this['particleSystem'][_0xde8271(0x135)]['primitives']['screen']);}['updateViewerParameters'](){const _0x5a7663=_0x3f687f;let _0xe8adef=this['camera']['computeViewRectangle'](this[_0x5a7663(0x168)]['globe']['ellipsoid']);if(!_0xe8adef){const _0x1149a8=this['_map']['getExtent']();_0xe8adef=Cesium$1['Rectangle']['fromDegrees'](_0x1149a8['xmin'],_0x1149a8['ymin'],_0x1149a8['xmax'],_0x1149a8['ymax']);}const _0x108bce=Util['viewRectangleToLonLatRange'](_0xe8adef);this['viewerParameters']['lonRange']['x']=_0x108bce[_0x5a7663(0xeb)]['min'],this['viewerParameters']['lonRange']['y']=_0x108bce['lon']['max'],this['viewerParameters']['latRange']['x']=_0x108bce['lat'][_0x5a7663(0xbf)],this['viewerParameters'][_0x5a7663(0xc6)]['y']=_0x108bce[_0x5a7663(0x17c)]['max'];const _0x68e664=this[_0x5a7663(0xc9)]['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x68e664>0x0&&(this['viewerParameters']['pixelSize']=_0x68e664);}}function _0x48cd(_0x515ddb,_0x1f65c0){const _0x4dc005=_0x4dc0();return _0x48cd=function(_0x48cdf3,_0x25cc9d){_0x48cdf3=_0x48cdf3-0xa4;let _0x14bdd8=_0x4dc005[_0x48cdf3];return _0x14bdd8;},_0x48cd(_0x515ddb,_0x1f65c0);}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace[_0x3f687f(0x149)][_0x3f687f(0xe8)]=WindLayer;class CanvasParticle{constructor(){const _0x4c793=_0x3f687f;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this[_0x4c793(0x130)]=null;}['destroy'](){for(const _0x2233a1 in this){delete this[_0x2233a1];}}}class CanvasWindField{constructor(_0x47770f){const _0x3b2b32=_0x3f687f;this[_0x3b2b32(0x161)](_0x47770f);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x1402df){const _0x60adb5=_0x3f687f;this['_speedRate']=(0x64-(_0x1402df>0x63?0x63:_0x1402df))*0x64,this[_0x60adb5(0xab)]=[(this[_0x60adb5(0xb3)]-this[_0x60adb5(0xbc)])/this['_speedRate'],(this[_0x60adb5(0x178)]-this['ymin'])/this[_0x60adb5(0x105)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x1931a3){this['_maxAge']=_0x1931a3;}[_0x3f687f(0x161)](_0x260187){const _0x40e76d=_0x3f687f;this['options']=_0x260187,this['maxAge']=_0x260187['maxAge']||0x78,this['speedRate']=_0x260187['speedRate']||0x32,this['particles']=[];const _0x3dfb6d=_0x260187['particlesNumber']||0x1000;for(let _0x119ee3=0x0;_0x119ee3<_0x3dfb6d;_0x119ee3++){const _0x2398d4=this['_randomParticle'](new CanvasParticle());this['particles'][_0x40e76d(0x113)](_0x2398d4);}}['setDate'](_0x5f3560){const _0x1363fb=_0x3f687f;this['rows']=_0x5f3560['rows'],this[_0x1363fb(0x126)]=_0x5f3560['cols'],this[_0x1363fb(0xbc)]=_0x5f3560[_0x1363fb(0xbc)],this[_0x1363fb(0xb3)]=_0x5f3560['xmax'],this['ymin']=_0x5f3560['ymin'],this['ymax']=_0x5f3560['ymax'],this['grid']=[];const _0x587c2a=_0x5f3560['udata'],_0x541ebf=_0x5f3560['vdata'];let _0x48d835=![];_0x587c2a['length']===this['rows']&&_0x587c2a[0x0][_0x1363fb(0x18f)]===this['cols']&&(_0x48d835=!![]);let _0x2eec9c=0x0,_0x4e271a=null,_0x4a1cf1=null;for(let _0x31e6ce=0x0;_0x31e6ce<this['rows'];_0x31e6ce++){_0x4e271a=[];for(let _0x5edb08=0x0;_0x5edb08<this[_0x1363fb(0x126)];_0x5edb08++,_0x2eec9c++){_0x48d835?_0x4a1cf1=this['_calcUV'](_0x587c2a[_0x31e6ce][_0x5edb08],_0x541ebf[_0x31e6ce][_0x5edb08]):_0x4a1cf1=this[_0x1363fb(0xc4)](_0x587c2a[_0x2eec9c],_0x541ebf[_0x2eec9c]),_0x4e271a[_0x1363fb(0x113)](_0x4a1cf1);}this['grid']['push'](_0x4e271a);}this[_0x1363fb(0xc7)][_0x1363fb(0xd3)]&&this['grid']['reverse']();}['clear'](){const _0xbeca11=_0x3f687f;delete this[_0xbeca11(0xd9)],delete this[_0xbeca11(0x126)],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this['particles'];}[_0x3f687f(0x139)](_0x56bf2f,_0x47ea4a){const _0x255a0a=_0x3f687f,_0x2e4238=(_0x56bf2f-this['xmin'])/(this[_0x255a0a(0xb3)]-this['xmin'])*(this['cols']-0x1),_0x4c0896=(this['ymax']-_0x47ea4a)/(this['ymax']-this[_0x255a0a(0x18c)])*(this['rows']-0x1);return[_0x2e4238,_0x4c0896];}[_0x3f687f(0x125)](_0xa6d13,_0x190b70){const _0x15df8d=_0x3f687f;if(_0xa6d13<0x0||_0xa6d13>=this[_0x15df8d(0x126)]||_0x190b70>=this['rows'])return[0x0,0x0,0x0];const _0x245cc6=Math[_0x15df8d(0xf3)](_0xa6d13),_0xc5a774=Math[_0x15df8d(0xf3)](_0x190b70);if(_0x245cc6===_0xa6d13&&_0xc5a774===_0x190b70)return this['grid'][_0x190b70][_0xa6d13];const _0x463bbc=_0x245cc6+0x1,_0x2a55d4=_0xc5a774+0x1,_0x56db9d=this['getUVByXY'](_0x245cc6,_0xc5a774),_0x3201c7=this['getUVByXY'](_0x463bbc,_0xc5a774),_0x20a90c=this['getUVByXY'](_0x245cc6,_0x2a55d4),_0x3507c9=this['getUVByXY'](_0x463bbc,_0x2a55d4);let _0x4d61fe=null;try{_0x4d61fe=this['_bilinearInterpolation'](_0xa6d13-_0x245cc6,_0x190b70-_0xc5a774,_0x56db9d,_0x3201c7,_0x20a90c,_0x3507c9);}catch(_0x1ddae8){console['log'](_0xa6d13,_0x190b70);}return _0x4d61fe;}[_0x3f687f(0x16d)](_0x58e36c,_0x16f403,_0x23a804,_0x598922,_0x3dd96e,_0x4946cc){const _0xa48334=0x1-_0x58e36c,_0x2c8e58=0x1-_0x16f403,_0x70418b=_0xa48334*_0x2c8e58,_0x37c4af=_0x58e36c*_0x2c8e58,_0x65f9f8=_0xa48334*_0x16f403,_0x3a7b0f=_0x58e36c*_0x16f403,_0x21ae17=_0x23a804[0x0]*_0x70418b+_0x598922[0x0]*_0x37c4af+_0x3dd96e[0x0]*_0x65f9f8+_0x4946cc[0x0]*_0x3a7b0f,_0x56110d=_0x23a804[0x1]*_0x70418b+_0x598922[0x1]*_0x37c4af+_0x3dd96e[0x1]*_0x65f9f8+_0x4946cc[0x1]*_0x3a7b0f;return this['_calcUV'](_0x21ae17,_0x56110d);}['_calcUV'](_0x5815ca,_0x5e91d6){const _0x5ec034=_0x3f687f;return[+_0x5815ca,+_0x5e91d6,Math[_0x5ec034(0x116)](_0x5815ca*_0x5815ca+_0x5e91d6*_0x5e91d6)];}[_0x3f687f(0x185)](_0x4fedf6,_0x4d2403){const _0x4f14c0=_0x3f687f;if(!this[_0x4f14c0(0xde)](_0x4fedf6,_0x4d2403))return null;const _0x43ad00=this['toGridXY'](_0x4fedf6,_0x4d2403),_0x407670=this['getUVByXY'](_0x43ad00[0x0],_0x43ad00[0x1]);return _0x407670;}['isInExtent'](_0x32bf41,_0x1eca35){const _0x18a43a=_0x3f687f;return _0x32bf41>=this['xmin']&&_0x32bf41<=this['xmax']&&_0x1eca35>=this['ymin']&&_0x1eca35<=this[_0x18a43a(0x178)]?!![]:![];}[_0x3f687f(0xc1)](){const _0x2eee96=_0x3f687f,_0x573d32=fRandomByfloat(this[_0x2eee96(0xbc)],this['xmax']),_0x2f3be7=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x2f3be7,'lng':_0x573d32};}['getParticles'](){const _0x3be5dc=_0x3f687f;let _0x286699,_0x104ea9,_0x446af4;for(let _0x22a3d6=0x0,_0x53f80d=this['particles']['length'];_0x22a3d6<_0x53f80d;_0x22a3d6++){let _0x216e11=this['particles'][_0x22a3d6];_0x216e11['age']<=0x0&&(_0x216e11=this['_randomParticle'](_0x216e11));if(_0x216e11['age']>0x0){const _0x5d8298=_0x216e11['tlng'],_0x437a56=_0x216e11[_0x3be5dc(0x184)];_0x446af4=this['getUVByPoint'](_0x5d8298,_0x437a56),_0x446af4?(_0x286699=_0x5d8298+this['_calc_speedRate'][0x0]*_0x446af4[0x0],_0x104ea9=_0x437a56+this['_calc_speedRate'][0x1]*_0x446af4[0x1],_0x216e11['lng']=_0x5d8298,_0x216e11['lat']=_0x437a56,_0x216e11['tlng']=_0x286699,_0x216e11[_0x3be5dc(0x184)]=_0x104ea9,_0x216e11['speed']=_0x446af4[0x2],_0x216e11['age']--):_0x216e11['age']=0x0;}}return this['particles'];}['_randomParticle'](_0xb52b32){const _0x6e1fb=_0x3f687f;let _0x4f2a66,_0x5bddb9;for(let _0x207ea1=0x0;_0x207ea1<0x1e;_0x207ea1++){_0x4f2a66=this['getRandomLatLng'](),_0x5bddb9=this['getUVByPoint'](_0x4f2a66[_0x6e1fb(0xc2)],_0x4f2a66[_0x6e1fb(0x17c)]);if(_0x5bddb9&&_0x5bddb9[0x2]>0x0)break;}if(!_0x5bddb9)return _0xb52b32;const _0xa1055b=_0x4f2a66['lng']+this['_calc_speedRate'][0x0]*_0x5bddb9[0x0],_0x252e94=_0x4f2a66[_0x6e1fb(0x17c)]+this['_calc_speedRate'][0x1]*_0x5bddb9[0x1];return _0xb52b32[_0x6e1fb(0xc2)]=_0x4f2a66['lng'],_0xb52b32['lat']=_0x4f2a66['lat'],_0xb52b32['tlng']=_0xa1055b,_0xb52b32['tlat']=_0x252e94,_0xb52b32['age']=Math['round'](Math['random']()*this[_0x6e1fb(0xaf)]),_0xb52b32['speed']=_0x5bddb9[0x2],_0xb52b32;}['destroy'](){for(const _0x5737ea in this){delete this[_0x5737ea];}}}function fRandomByfloat(_0x2360b2,_0x55a484){const _0x43c6f8=_0x3f687f;return _0x2360b2+Math[_0x43c6f8(0xe7)]()*(_0x55a484-_0x2360b2);}function _0x4dc0(){const _0x321f84=['802616MMcqil','lineTo','canvas','maxAge','bind','clientHeight','pointerEvents','xmax','ColorRamp','drawingBufferWidth','nextTrailsColor','ellipsoid','mouseUp','keys','strokeStyle','uniformMap','xmin','0px','outputTexture','min','particleSystem','getRandomLatLng','lng','currentParticlesPosition','_calcUV','textures','latRange','options','mouseHidden','camera','particlesNumber','autoClear','3014868WYYFkL','depthTest','lineWidth','6291397WBMsmM','primitiveType','depthMask','off','reverseY','createRenderingFramebuffers','createParticlesTextures','EventType','forEach','_onMap_preRenderEvent','rows','now','4354396EhcSsX','lev','levmax','isInExtent','8562972OinurS','show','cos','east','viewerParameters','canvasContext','toDegrees','postProcessingSpeed','random','WindLayer','TextureMinificationFilter','resize','lon','BufferUsage','red','5bxvmdP','OPAQUE','mode','BaseLayer','_updateIng','floor','colors','_map','clientWidth','_onMouseMoveEvent','atan2','canvasWidth','setGeometry','getParticles','primitives','destroy','dropRate','fromCache','randomBetween','_colorRamp','segmentsColor','clearFramebuffers','canrefresh','_speedRate','context','commandToExecute','EllipsoidalOccluder','removeChild','mars3d-canvasWind','fadeOpacity','mouse_down','currentParticlesSpeed','createTexture','particlesTextureSize','createSegmentsGeometry','dropRateBump','none','push','levmin','worker','sqrt','framebuffer','height','STATIC_DRAW','LINEAR','clampToLatitudeRange','data','depthTexture','getOptions','unbindEvent','_pointerEvents','canvasHeight','Sampler','Cesium','setDate','getUVByXY','cols','bindEvent','stroke','_onMouseDownEvent','hidden','Cartesian3','update','vdata','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','_mountedHook','speed','destroyParticlesTextures','default','#ffffff','moveTo','particlesRendering','NEAREST','ShaderSource','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','toGridXY','nextTrails','updateViewerParameters','width','fixedHeight','Matrix4','randomizeParticles','segmentsDepth','attributeLocations','Draw','_onMouseUpEvent','createFramebuffer','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','createRenderingTextures','container','pow','layer','_updateIng2','create','add','TRIANGLES','visible','animateFrame','_removedHook','_drawLines','postProcessingPosition','segments','commandList','abs','commandType','setData','clearCommand','1617158HoXMti','3149896RVGcFa','getOwnPropertyDescriptor','ComponentDatatype','createComputingPrimitives','nextParticlesSpeed','Color','ShaderProgram','setOptions','windTextures','FLOAT','particlesComputing','lonRange','dimensions','createRawRenderState','scene','globeBoundingSphere','mod','__esModule','style','_bilinearInterpolation','createRenderingPrimitives','preExecute','speedRate','addEventListener','particleHeight','ZERO','color','createWindTextures','_onMapWhellEvent','Compute','ymax','fromCssColorString','createCommand','zIndex','lat','shaderProgram','pointer-events','framebuffers','max','mouseDown','_setOptionsHook','geometry','tlat','getUVByPoint','BoundingSphere','maxParticles','refreshTimer','particlesTextures','PrimitiveType','_showHook','ymin','defineProperty','windField','length','Math','_tomap','redraw','ClearCommand','frameTime','PixelDatatype','fragmentShaderSource','_calc_speedRate'];_0x4dc0=function(){return _0x321f84;};return _0x4dc0();}const Cesium=mars3d__namespace[_0x3f687f(0x123)],BaseLayer=mars3d__namespace[_0x3f687f(0x149)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x34a88b={}){const _0x1b7a5a=_0x3f687f;super(_0x34a88b),this['_setOptionsHook'](_0x34a88b),this['canvas']=null,_0x34a88b[_0x1b7a5a(0xf4)]&&_0x34a88b['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x1b7a5a(0xb4))](_0x34a88b));}[_0x3f687f(0x182)](_0x138ef1,_0x1f7bc5){const _0xa120ee=_0x3f687f;this[_0xa120ee(0xa8)]=0x3e8/(_0x138ef1['frameRate']||0xa),this[_0xa120ee(0x120)]=this['options']['pointerEvents']??![],this[_0xa120ee(0x174)]=_0x138ef1['color']||_0xa120ee(0x133),this['lineWidth']=_0x138ef1[_0xa120ee(0xce)]||0x1,this['fixedHeight']=_0x138ef1[_0xa120ee(0x13d)]??0x0,this['reverseY']=_0x138ef1[_0xa120ee(0xd3)]??![],this['windField']&&this['windField']['setOptions'](_0x138ef1);}get['layer'](){return this['canvas'];}get[_0x3f687f(0xf9)](){const _0x25f9ad=_0x3f687f;return this[_0x25f9ad(0xf5)][_0x25f9ad(0x168)][_0x25f9ad(0xae)][_0x25f9ad(0xf6)];}get[_0x3f687f(0x121)](){const _0x434ed4=_0x3f687f;return this[_0x434ed4(0xf5)][_0x434ed4(0x168)][_0x434ed4(0xae)]['clientHeight'];}get['pointerEvents'](){const _0x213cca=_0x3f687f;return this[_0x213cca(0x120)];}set[_0x3f687f(0xb2)](_0x316726){const _0xf75674=_0x3f687f;this['_pointerEvents']=_0x316726;if(!this['canvas'])return;_0x316726?this[_0xf75674(0xae)][_0xf75674(0x16c)][_0xf75674(0x17e)]='all':this['canvas'][_0xf75674(0x16c)]['pointer-events']=_0xf75674(0x112);}get[_0x3f687f(0xca)](){const _0x110572=_0x3f687f;return this[_0x110572(0xc7)]['particlesNumber'];}set['particlesNumber'](_0x44ea43){this['options']['particlesNumber']=_0x44ea43,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x2a24ea=_0x3f687f;return this[_0x2a24ea(0xc7)]['speedRate'];}set['speedRate'](_0x6c4381){const _0x3f8240=_0x3f687f;this['options'][_0x3f8240(0x170)]=_0x6c4381,this['windField']&&(this[_0x3f8240(0x18e)][_0x3f8240(0x170)]=_0x6c4381);}get[_0x3f687f(0xaf)](){const _0x34f9e2=_0x3f687f;return this['options'][_0x34f9e2(0xaf)];}set[_0x3f687f(0xaf)](_0x29a831){this['options']['maxAge']=_0x29a831,this['windField']&&(this['windField']['maxAge']=_0x29a831);}get['data'](){return this['windData'];}set[_0x3f687f(0x11c)](_0x1a31bf){this['setData'](_0x1a31bf);}[_0x3f687f(0x18b)](_0x8b0e11){const _0x5e3450=_0x3f687f;_0x8b0e11?this['_addedHook']():(this['windData']&&(this['options'][_0x5e3450(0x11c)]=this['windData']),this[_0x5e3450(0x150)]());}[_0x3f687f(0x12f)](){const _0x27c5ed=_0x3f687f;this[_0x27c5ed(0xc7)]['worker']?this['initWorker']():this[_0x27c5ed(0x18e)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x429dab=_0x3f687f;this['canvas']=this['_createCanvas'](),this['canvasContext']=this[_0x429dab(0xae)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x429dab(0x11c)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x5b1e51=_0x3f687f;this['clear'](),this[_0x5b1e51(0x11f)](),this['canvas']&&(this['_map']['container'][_0x5b1e51(0x109)](this[_0x5b1e51(0xae)]),delete this['canvas']);}['_createCanvas'](){const _0x56f90a=_0x3f687f,_0x20b0a0=mars3d__namespace['DomUtil']['create']('canvas',_0x56f90a(0x10a),this['_map'][_0x56f90a(0x147)]);return _0x20b0a0['style']['position']='absolute',_0x20b0a0['style']['top']='0px',_0x20b0a0['style']['left']=_0x56f90a(0xbd),_0x20b0a0['style'][_0x56f90a(0x13c)]=this[_0x56f90a(0xf5)][_0x56f90a(0x168)]['canvas']['clientWidth']+'px',_0x20b0a0[_0x56f90a(0x16c)][_0x56f90a(0x118)]=this['_map'][_0x56f90a(0x168)]['canvas']['clientHeight']+'px',_0x20b0a0['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x20b0a0['style'][_0x56f90a(0x17b)]=this[_0x56f90a(0xc7)]['zIndex']??0x9,_0x20b0a0['width']=this[_0x56f90a(0xf5)][_0x56f90a(0x168)]['canvas']['clientWidth'],_0x20b0a0['height']=this[_0x56f90a(0xf5)]['scene']['canvas']['clientHeight'],_0x20b0a0;}['resize'](){const _0x301374=_0x3f687f;this['canvas']&&(this['canvas']['style']['width']=this['_map'][_0x301374(0x168)]['canvas'][_0x301374(0xf6)]+'px',this['canvas']['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this[_0x301374(0xf5)]['scene']['canvas'][_0x301374(0xf6)],this['canvas'][_0x301374(0x118)]=this['_map'][_0x301374(0x168)]['canvas'][_0x301374(0xb1)]);}[_0x3f687f(0x127)](){const _0x10d518=_0x3f687f,_0x3562fb=this;let _0x8ec39c=Date[_0x10d518(0xda)]();(function _0x341212(){const _0x479e9b=_0x10d518;_0x3562fb[_0x479e9b(0x14f)]=window['requestAnimationFrame'](_0x341212);if(_0x3562fb['show']&&_0x3562fb['windField']){const _0x35e9ed=Date[_0x479e9b(0xda)](),_0x4f3b8b=_0x35e9ed-_0x8ec39c;_0x4f3b8b>_0x3562fb['frameTime']&&(_0x8ec39c=_0x35e9ed-_0x4f3b8b%_0x3562fb['frameTime'],_0x3562fb['update']());}}(),window['addEventListener'](_0x10d518(0xea),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x10d518(0xc7)]['mouseHidden']&&(this[_0x10d518(0xf5)]['on'](mars3d__namespace[_0x10d518(0xd6)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x10d518(0xd6)]['mouseDown'],this[_0x10d518(0x129)],this),this[_0x10d518(0xf5)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}[_0x3f687f(0x11f)](){const _0x4ecab2=_0x3f687f;window['cancelAnimationFrame'](this[_0x4ecab2(0x14f)]),delete this[_0x4ecab2(0x14f)],window['removeEventListener']('resize',this['resize']),this['options'][_0x4ecab2(0xc8)]&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x4ecab2(0x176)],this),this[_0x4ecab2(0xf5)]['off'](mars3d__namespace['EventType'][_0x4ecab2(0x181)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x203024){const _0x5edb13=_0x3f687f;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this[_0x5edb13(0xae)]['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x324a02=_0x5edb13;if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']=_0x324a02(0x14e);},0xc8);}['_onMouseDownEvent'](_0x3da409){const _0x204399=_0x3f687f;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x204399(0xd6)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x204399(0xd6)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x4f4656){const _0x4cb813=_0x3f687f;if(!this[_0x4cb813(0xe0)]||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']=_0x4cb813(0x12a),this['mouse_move']=!![]);}[_0x3f687f(0x143)](_0x303029){const _0x1eb3f1=_0x3f687f;if(!this['show']||!this['canvas'])return;this['_map'][_0x1eb3f1(0xd2)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this[_0x1eb3f1(0xa6)](),this['canvas']['style']['visibility']='visible',this[_0x1eb3f1(0x10c)]=![],this['mouse_move']=![];}[_0x3f687f(0x157)](_0x4c2f61){const _0xd6a8f=_0x3f687f;this['clear'](),this['windData']=_0x4c2f61,this['windField'][_0xd6a8f(0x124)](_0x4c2f61),this['redraw']();}[_0x3f687f(0xa6)](){const _0x424d7e=_0x3f687f;if(!this[_0x424d7e(0xe0)])return;this[_0x424d7e(0x18e)]['setOptions'](this['options']),this['update']();}[_0x3f687f(0x12c)](){const _0x363f1f=_0x3f687f;if(this[_0x363f1f(0xf2)])return;this['_updateIng']=!![];if(this[_0x363f1f(0x115)])this[_0x363f1f(0x18e)]['update']();else{const _0x881157=this['windField'][_0x363f1f(0xfb)]();this['_drawLines'](_0x881157);}this[_0x363f1f(0xf2)]=![];}[_0x3f687f(0x151)](_0x163399){const _0x5ab854=_0x3f687f;this['canvasContext']['globalCompositeOperation']='destination-in',this[_0x5ab854(0xe4)]['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x4a7e75=this['_map'][_0x5ab854(0x168)][_0x5ab854(0xf0)]!==Cesium['SceneMode']['SCENE3D'],_0x3d430d=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x234aac=0x0,_0x3c108e=_0x163399['length'];_0x234aac<_0x3c108e;_0x234aac++){const _0x537090=_0x163399[_0x234aac],_0x1c6d26=this['_tomap'](_0x537090['lng'],_0x537090['lat'],_0x537090),_0x353c82=this[_0x5ab854(0xa5)](_0x537090['tlng'],_0x537090['tlat'],_0x537090);if(!_0x1c6d26||!_0x353c82)continue;if(_0x4a7e75&&Math['abs'](_0x1c6d26[0x0]-_0x353c82[0x0])>=_0x3d430d)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x5ab854(0xe4)]['strokeStyle']=this[_0x5ab854(0x101)]['getColor'](_0x537090[_0x5ab854(0x130)]),this['canvasContext'][_0x5ab854(0x134)](_0x1c6d26[0x0],_0x1c6d26[0x1]),this['canvasContext']['lineTo'](_0x353c82[0x0],_0x353c82[0x1]),this['canvasContext'][_0x5ab854(0x128)]();}else{this[_0x5ab854(0xe4)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x5ab854(0xba)]=this['color'];for(let _0x355493=0x0,_0x3ed1a8=_0x163399['length'];_0x355493<_0x3ed1a8;_0x355493++){const _0x2bdbb4=_0x163399[_0x355493],_0x13fda8=this[_0x5ab854(0xa5)](_0x2bdbb4['lng'],_0x2bdbb4[_0x5ab854(0x17c)],_0x2bdbb4),_0x781589=this['_tomap'](_0x2bdbb4['tlng'],_0x2bdbb4['tlat'],_0x2bdbb4);if(!_0x13fda8||!_0x781589)continue;if(_0x4a7e75&&Math[_0x5ab854(0x155)](_0x13fda8[0x0]-_0x781589[0x0])>=_0x3d430d)continue;this[_0x5ab854(0xe4)]['moveTo'](_0x13fda8[0x0],_0x13fda8[0x1]),this[_0x5ab854(0xe4)][_0x5ab854(0xad)](_0x781589[0x0],_0x781589[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x7edf6,_0x5abe6c,_0x2d7ce1){const _0x52e5a7=_0x3f687f,_0x20b9fa=Cesium['Cartesian3']['fromDegrees'](_0x7edf6,_0x5abe6c,this[_0x52e5a7(0x13d)]),_0x189a41=this['_map']['scene'];if(_0x189a41[_0x52e5a7(0xf0)]===Cesium['SceneMode']['SCENE3D']){const _0x183bf9=new Cesium[(_0x52e5a7(0x108))](_0x189a41['globe'][_0x52e5a7(0xb7)],_0x189a41[_0x52e5a7(0xc9)]['positionWC']),_0x4f7c5d=_0x183bf9['isPointVisible'](_0x20b9fa);if(!_0x4f7c5d)return _0x2d7ce1['age']=0x0,null;}const _0x2d38de=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this[_0x52e5a7(0xf5)][_0x52e5a7(0x168)],_0x20b9fa);return _0x2d38de?[_0x2d38de['x'],_0x2d38de['y']]:null;}['clear'](){const _0x3bedcc=_0x3f687f;this[_0x3bedcc(0x18e)]['clear'](),delete this['windData'];}['initWorker'](){const _0x51defb=_0x3f687f;this['worker']=new Worker(this['options']['worker']),this[_0x51defb(0x115)]['onmessage']=_0xab4bf5=>{const _0x4f1171=_0x51defb;this['_drawLines'](_0xab4bf5[_0x4f1171(0x11c)]['particles']),this['_updateIng2']=![];},this[_0x51defb(0x18e)]={'init':_0x1667f4=>{this['worker']['postMessage']({'type':'init','options':_0x1667f4});},'setOptions':_0xf85360=>{const _0x561a22=_0x51defb;this['worker']['postMessage']({'type':_0x561a22(0x161),'options':_0xf85360});},'setDate':_0x14327b=>{const _0x375e14=_0x51defb;this['worker']['postMessage']({'type':_0x375e14(0x124),'data':_0x14327b});},'update':()=>{const _0x54c133=_0x51defb;if(this[_0x54c133(0x14a)])return;this[_0x54c133(0x14a)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x3f687f(0x16b),{'value':!![]});
}));
