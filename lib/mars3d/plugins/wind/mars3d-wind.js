/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.14
 * 编译日期：2023-11-28 09:42:50
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x2d18a1=_0x3671;(function(_0x490b86,_0xbbdbc8){const _0x26dfb3=_0x3671,_0x358d4e=_0x490b86();while(!![]){try{const _0x5eb973=parseInt(_0x26dfb3(0x1d1))/0x1+-parseInt(_0x26dfb3(0x173))/0x2+-parseInt(_0x26dfb3(0x22d))/0x3+-parseInt(_0x26dfb3(0x1e8))/0x4+parseInt(_0x26dfb3(0x1a2))/0x5*(parseInt(_0x26dfb3(0x1e4))/0x6)+parseInt(_0x26dfb3(0x196))/0x7+parseInt(_0x26dfb3(0x208))/0x8;if(_0x5eb973===_0xbbdbc8)break;else _0x358d4e['push'](_0x358d4e['shift']());}catch(_0x2788b1){_0x358d4e['push'](_0x358d4e['shift']());}}}(_0x4179,0x49437));function _interopNamespace(_0x31fc42){const _0x5c70da=_0x3671;if(_0x31fc42&&_0x31fc42[_0x5c70da(0x1cb)])return _0x31fc42;var _0x157ebd=Object['create'](null);return _0x31fc42&&Object['keys'](_0x31fc42)['forEach'](function(_0x4ebb50){const _0x3da7f4=_0x5c70da;if(_0x4ebb50!=='default'){var _0xee2a9c=Object['getOwnPropertyDescriptor'](_0x31fc42,_0x4ebb50);Object[_0x3da7f4(0x202)](_0x157ebd,_0x4ebb50,_0xee2a9c['get']?_0xee2a9c:{'enumerable':!![],'get':function(){return _0x31fc42[_0x4ebb50];}});}}),_0x157ebd['default']=_0x31fc42,_0x157ebd;}function _0x4179(){const _0x27e353=['_updateIng2','ComputeCommand','clearCommand','ellipsoid','resize','getWind','lonRange','age','destroyObject','_onMapWhellEvent','_tomap','speedFactor','height','show','_colorRamp','lev','hidden','setData','updatePosition','Math','vdata','clearFramebuffers','particlesWind','refreshTimer','bindEvent','colors','abs','speedRate','particlesRendering','umin','width','2450707axuASi','data','mode','canvas','_addedHook','particleSystem','update','forEach','THREE_PI_OVER_TWO','lat','toRadians','_updateIng','5hXyHqH','Draw','mouse_down','Cesium','rawRenderState','pointer-events','NEAREST','array','getFullscreenQuad','WindUtil','EventType','fromCssColorString','mouseHidden','umax','#ffffff','_onMouseUpEvent','xmin','ceil','defined','createRawRenderState','refreshParticles','push','_onMouseMoveEvent','geometry','Sampler','PI_OVER_THREE','Matrix4','cols','globalCompositeOperation','mouseMove','updateViewerParameters','clear','visible','visibility','LayerUtil','attributeLocations','sqrt','grid','Cartesian2','ymin','SCENE3D','__esModule','FLOAT','viewRectangleToLonLatRange','lighter','fragmentShaderSource','createComputingPrimitives','209026Lsctov','frameTime','PixelFormat','particles','outputTexture','getUVByPoint','getRandomLatLng','tlng','redraw','segmentsDepth','postProcessingSpeed','createCommand','PrimitiveCollection','TextureMagnificationFilter','nextParticlesPosition','ymax','_mountedHook','_maxAge','textures','1630914CzyiwW','windData','sin','lng','1482692oARLqI','dimensions','pointerEvents','_map','windField','add','PixelDatatype','Texture','vertexShaderSource','ShaderSource','pow','context','source','screen','particlesNumber','_createCanvas','TRIANGLES','max','primitiveType','rows','stroke','canvasContext','strokeStyle','TWO_PI','layer','RGBA','defineProperty','PrimitiveType','Cartesian3','primitives','bind','ComponentDatatype','4296016jqhVAf','_calcUV','latRange','isDestroyed','windTextures','setOptions','destroy','animateFrame','createTexture','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','keys','BoundingSphere','destroyParticlesTextures','Appearance','color','particlesTextures','fixedHeight','commandList','SceneTransforms','trails','viewerParameters','mouse_move','options','canvasHeight','postProcessingPosition','maxParticles','_data','fromGeometry','reverse','container','onmessage','off','mouseUp','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','preExecute','style','_onMap_preRenderEvent','557367LWprMO','_randomParticle','_canrefresh','particlesTextureSize','vmin','camera','applyViewerParameters','atan2','tlat','CanvasWindLayer','LINEAR','updateSpeed','GeometryAttribute','DISABLE_GL_POSITION_LOG_DEPTH','nextTrails','lineWidth','commandToExecute','min','framebuffers','Compute','create','particlesComputing','Color','VertexArray','randomizeParticles','uniformMap','speed','_pointerEvents','scene','_calc_speedRate','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','createRenderingFramebuffers','fromDegrees','floor','worker','getPixelSize','udata','lon','BaseLayer','maxAge','xmax','_setOptionsHook','random','vertexArray','1022798pRFxuk','zIndex','blending','unbindEvent'];_0x4179=function(){return _0x27e353;};return _0x4179();}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x1fb192,_0x426612){const _0x56fa91=_0x3671,_0xeca2db=_0x1fb192*Math['cos'](Cesium$7[_0x56fa91(0x18a)][_0x56fa91(0x1a0)](_0x426612));return _0xeca2db;}function getV(_0x111cc2,_0x1e261a){const _0x3f35ef=_0x3671,_0x56862c=_0x111cc2*Math[_0x3f35ef(0x1e6)](Cesium$7['Math']['toRadians'](_0x1e261a));return _0x56862c;}function getSpeed(_0x402471,_0x79119d){const _0x4611ff=_0x3671,_0x5dab21=Math['sqrt'](Math['pow'](_0x402471,0x2)+Math[_0x4611ff(0x1f2)](_0x79119d,0x2));return _0x5dab21;}function getDirection(_0x5af420,_0x507b0a){const _0x1005c6=_0x3671;let _0x413f76=Cesium$7[_0x1005c6(0x18a)]['toDegrees'](Math[_0x1005c6(0x14e)](_0x507b0a,_0x5af420));return _0x413f76+=_0x413f76<0x0?0x168:0x0,_0x413f76;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x2d18a1(0x1a5)];function _0x3671(_0x5c28f1,_0x2e78b4){const _0x417990=_0x4179();return _0x3671=function(_0x36715a,_0x7e8aac){_0x36715a=_0x36715a-0x149;let _0x46b7c6=_0x417990[_0x36715a];return _0x46b7c6;},_0x3671(_0x5c28f1,_0x2e78b4);}class CustomPrimitive{constructor(_0x5a3c17){const _0x377b5c=_0x2d18a1;this['commandType']=_0x5a3c17['commandType'],this['geometry']=_0x5a3c17[_0x377b5c(0x1b9)],this['attributeLocations']=_0x5a3c17[_0x377b5c(0x1c5)],this[_0x377b5c(0x1fa)]=_0x5a3c17['primitiveType'],this['uniformMap']=_0x5a3c17['uniformMap'],this['vertexShaderSource']=_0x5a3c17[_0x377b5c(0x1f0)],this['fragmentShaderSource']=_0x5a3c17['fragmentShaderSource'],this['rawRenderState']=_0x5a3c17[_0x377b5c(0x1a6)],this['framebuffer']=_0x5a3c17['framebuffer'],this[_0x377b5c(0x1d5)]=_0x5a3c17['outputTexture'],this['autoClear']=_0x5a3c17['autoClear']??![],this['preExecute']=_0x5a3c17['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x377b5c(0x179)]=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x377b5c(0x15d))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x2d18a1(0x1dc)](_0x4dd6e2){const _0x3b0994=_0x2d18a1;switch(this['commandType']){case _0x3b0994(0x1a3):{const _0x14479f=Cesium$6['VertexArray']['fromGeometry']({'context':_0x4dd6e2,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x5a18f0=Cesium$6['ShaderProgram']['fromCache']({'context':_0x4dd6e2,'attributeLocations':this[_0x3b0994(0x1c5)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x3b0994(0x1cf)]}),_0x2d8175=Cesium$6['RenderState']['fromCache'](this[_0x3b0994(0x1a6)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x3b0994(0x1fa)],'shaderProgram':_0x5a18f0,'vertexArray':_0x14479f,'modelMatrix':Cesium$6[_0x3b0994(0x1bc)]['IDENTITY'],'renderState':_0x2d8175,'uniformMap':this[_0x3b0994(0x160)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x3b0994(0x178))]({'owner':this,'fragmentShaderSource':this[_0x3b0994(0x1cf)],'uniformMap':this[_0x3b0994(0x160)],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x72cd94,_0x168127){const _0x321c2b=_0x2d18a1;this[_0x321c2b(0x1b9)]=_0x168127;const _0x3f47eb=Cesium$6[_0x321c2b(0x15e)]['fromGeometry']({'context':_0x72cd94,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x3f47eb;}['update'](_0x2c3b18){const _0x74eac7=_0x2d18a1;if(!this['show'])return;if(_0x2c3b18['mode']!==Cesium$6['SceneMode'][_0x74eac7(0x1ca)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x2c3b18[_0x74eac7(0x1f3)])),Cesium$6['defined'](this[_0x74eac7(0x22a)])&&this[_0x74eac7(0x22a)](),Cesium$6['defined'](this[_0x74eac7(0x179)])&&_0x2c3b18['commandList']['push'](this['clearCommand']),_0x2c3b18[_0x74eac7(0x219)]['push'](this['commandToExecute']);}[_0x2d18a1(0x20b)](){return![];}[_0x2d18a1(0x20e)](){const _0x35bf90=_0x2d18a1;if(this['clearCommand']){var _0x58a70d,_0x326e5c;(_0x58a70d=this[_0x35bf90(0x179)])!==null&&_0x58a70d!==void 0x0&&_0x58a70d['vertexArray']&&this[_0x35bf90(0x179)][_0x35bf90(0x172)][_0x35bf90(0x20e)](),(_0x326e5c=this[_0x35bf90(0x179)])!==null&&_0x326e5c!==void 0x0&&_0x326e5c['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x35bf90(0x20e)](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0x35bf90(0x157)]['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6[_0x35bf90(0x17f)](this);}}const Cesium$5=mars3d__namespace[_0x2d18a1(0x1a5)],Util=(function(){const _0x369438=function(){const _0x329cb7=_0x3671,_0x45b674=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x329cb7(0x153))]({'componentDatatype':Cesium$5[_0x329cb7(0x207)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x45b674;},_0x30aab6=function(_0x5884fe,_0x325189){const _0x5c96ed=_0x3671;if(Cesium$5[_0x5c96ed(0x1b4)](_0x325189)){const _0x2c6be6={};_0x2c6be6['arrayBufferView']=_0x325189,_0x5884fe[_0x5c96ed(0x1f4)]=_0x2c6be6;}const _0x5b4013=new Cesium$5[(_0x5c96ed(0x1ef))](_0x5884fe);return _0x5b4013;},_0x36fe87=function(_0x1867ab,_0x1cb664,_0x24e73f){const _0x1f0a86=new Cesium$5['Framebuffer']({'context':_0x1867ab,'colorTextures':[_0x1cb664],'depthTexture':_0x24e73f});return _0x1f0a86;},_0x5a9e60=function(_0x19b40a){const _0x594c81=_0x3671,_0xe1f72b=!![],_0x516408=![],_0x4d7a7e={'viewport':_0x19b40a['viewport'],'depthTest':_0x19b40a['depthTest'],'depthMask':_0x19b40a['depthMask'],'blending':_0x19b40a[_0x594c81(0x175)]},_0x53a4e1=Cesium$5[_0x594c81(0x215)]['getDefaultRenderState'](_0xe1f72b,_0x516408,_0x4d7a7e);return _0x53a4e1;},_0x171db4=function(_0x3a699b){const _0x4b8523=_0x3671,_0x3989b3={},_0x170d04=Cesium$5[_0x4b8523(0x18a)]['mod'](_0x3a699b['west'],Cesium$5['Math']['TWO_PI']),_0x32c55a=Cesium$5['Math']['mod'](_0x3a699b['east'],Cesium$5['Math'][_0x4b8523(0x1ff)]),_0x1245d0=_0x3a699b['width'];let _0x3bdd7e,_0x43a891;_0x1245d0>Cesium$5[_0x4b8523(0x18a)][_0x4b8523(0x19e)]?(_0x3bdd7e=0x0,_0x43a891=Cesium$5['Math']['TWO_PI']):_0x32c55a-_0x170d04<_0x1245d0?(_0x3bdd7e=_0x170d04,_0x43a891=_0x170d04+_0x1245d0):(_0x3bdd7e=_0x170d04,_0x43a891=_0x32c55a);_0x3989b3['lon']={'min':Cesium$5[_0x4b8523(0x18a)]['toDegrees'](_0x3bdd7e),'max':Cesium$5['Math']['toDegrees'](_0x43a891)};const _0x780539=_0x3a699b['south'],_0x5119e9=_0x3a699b['north'],_0x808b57=_0x3a699b['height'],_0xa5cbf2=_0x808b57>Cesium$5[_0x4b8523(0x18a)]['PI']/0xc?_0x808b57/0x2:0x0;let _0xca5818=Cesium$5['Math']['clampToLatitudeRange'](_0x780539-_0xa5cbf2),_0xdc7801=Cesium$5['Math']['clampToLatitudeRange'](_0x5119e9+_0xa5cbf2);return _0xca5818<-Cesium$5['Math'][_0x4b8523(0x1bb)]&&(_0xca5818=-Cesium$5['Math']['PI_OVER_TWO']),_0xdc7801>Cesium$5[_0x4b8523(0x18a)]['PI_OVER_THREE']&&(_0xdc7801=Cesium$5['Math']['PI_OVER_TWO']),_0x3989b3[_0x4b8523(0x19f)]={'min':Cesium$5['Math']['toDegrees'](_0xca5818),'max':Cesium$5['Math']['toDegrees'](_0xdc7801)},_0x3989b3;};return{'getFullscreenQuad':_0x369438,'createTexture':_0x30aab6,'createFramebuffer':_0x36fe87,'createRawRenderState':_0x5a9e60,'viewRectangleToLonLatRange':_0x171db4};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x2d18a1(0x229);const Cesium$4=mars3d__namespace[_0x2d18a1(0x1a5)];class ParticlesRendering{constructor(_0x31eb57,_0x794133,_0x11217b,_0xd4bac1,_0x4095d9){const _0x4e9539=_0x2d18a1;this['createRenderingTextures'](_0x31eb57,_0x794133,_0x11217b[_0x4e9539(0x190)]),this[_0x4e9539(0x166)](_0x31eb57),this['createRenderingPrimitives'](_0x31eb57,_0x11217b,_0xd4bac1,_0x4095d9);}['createRenderingTextures'](_0x23b279,_0x4038ab,_0x459a9e){const _0x452679=_0x2d18a1,_0x1efab8={'context':_0x23b279,'width':_0x23b279['drawingBufferWidth'],'height':_0x23b279['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x452679(0x1ee)]['UNSIGNED_BYTE']},_0x1f7ff6={'context':_0x23b279,'width':_0x23b279['drawingBufferWidth'],'height':_0x23b279['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x452679(0x1d3)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x5d5f6f=_0x459a9e['length'],_0x2fcc00=new Float32Array(_0x5d5f6f*0x3);for(let _0x15d320=0x0;_0x15d320<_0x5d5f6f;_0x15d320++){const _0x203103=Cesium$4[_0x452679(0x15d)][_0x452679(0x1ad)](_0x459a9e[_0x15d320]);_0x2fcc00[0x3*_0x15d320]=_0x203103['red'],_0x2fcc00[0x3*_0x15d320+0x1]=_0x203103['green'],_0x2fcc00[0x3*_0x15d320+0x2]=_0x203103['blue'];}const _0x333af9={'context':_0x23b279,'width':_0x5d5f6f,'height':0x1,'pixelFormat':Cesium$4[_0x452679(0x1d3)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x452679(0x1ba))]({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x452679(0x151)],'magnificationFilter':Cesium$4[_0x452679(0x1de)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x1efab8),'segmentsDepth':Util[_0x452679(0x210)](_0x1f7ff6),'currentTrailsColor':Util[_0x452679(0x210)](_0x1efab8),'currentTrailsDepth':Util[_0x452679(0x210)](_0x1f7ff6),'nextTrailsColor':Util['createTexture'](_0x1efab8),'nextTrailsDepth':Util['createTexture'](_0x1f7ff6),'colorTable':Util[_0x452679(0x210)](_0x333af9,_0x2fcc00)};}[_0x2d18a1(0x166)](_0x3bf467){const _0x247dce=_0x2d18a1;this['framebuffers']={'segments':Util['createFramebuffer'](_0x3bf467,this['textures']['segmentsColor'],this[_0x247dce(0x1e3)][_0x247dce(0x1da)]),'currentTrails':Util['createFramebuffer'](_0x3bf467,this[_0x247dce(0x1e3)]['currentTrailsColor'],this[_0x247dce(0x1e3)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x3bf467,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x5c99e7){const _0x279862=_0x2d18a1,_0x58fc89=0x4;let _0x1c8eef=[];for(let _0x51f4ea=0x0;_0x51f4ea<_0x5c99e7['particlesTextureSize'];_0x51f4ea++){for(let _0x3a09fe=0x0;_0x3a09fe<_0x5c99e7[_0x279862(0x14a)];_0x3a09fe++){for(let _0x312cc8=0x0;_0x312cc8<_0x58fc89;_0x312cc8++){_0x1c8eef[_0x279862(0x1b7)](_0x51f4ea/_0x5c99e7['particlesTextureSize']),_0x1c8eef['push'](_0x3a09fe/_0x5c99e7[_0x279862(0x14a)]);}}}_0x1c8eef=new Float32Array(_0x1c8eef);let _0x347e30=[];const _0x20f4aa=[-0x1,0x1],_0x41cd10=[-0x1,0x1];for(let _0x13eba1=0x0;_0x13eba1<_0x5c99e7['maxParticles'];_0x13eba1++){for(let _0x5de84b=0x0;_0x5de84b<_0x58fc89/0x2;_0x5de84b++){for(let _0x3ba1e6=0x0;_0x3ba1e6<_0x58fc89/0x2;_0x3ba1e6++){_0x347e30['push'](_0x20f4aa[_0x5de84b]),_0x347e30['push'](_0x41cd10[_0x3ba1e6]),_0x347e30[_0x279862(0x1b7)](0x0);}}}_0x347e30=new Float32Array(_0x347e30);const _0x2d1928=0x6*_0x5c99e7['maxParticles'],_0x16e91b=new Uint32Array(_0x2d1928);for(let _0x4479ce=0x0,_0x279a37=0x0,_0x1c1531=0x0;_0x4479ce<_0x5c99e7['maxParticles'];_0x4479ce++){_0x16e91b[_0x279a37++]=_0x1c1531+0x0,_0x16e91b[_0x279a37++]=_0x1c1531+0x1,_0x16e91b[_0x279a37++]=_0x1c1531+0x2,_0x16e91b[_0x279a37++]=_0x1c1531+0x2,_0x16e91b[_0x279a37++]=_0x1c1531+0x1,_0x16e91b[_0x279a37++]=_0x1c1531+0x3,_0x1c1531+=0x4;}const _0x1807ba=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x279862(0x207)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x1c8eef}),'normal':new Cesium$4[(_0x279862(0x153))]({'componentDatatype':Cesium$4[_0x279862(0x207)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x347e30})}),'indices':_0x16e91b});return _0x1807ba;}['createRenderingPrimitives'](_0x4da703,_0x52e75a,_0x502c57,_0x57a772){const _0xfcd390=_0x2d18a1,_0xd01ea8=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x52e75a),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x17146b=_0x3671;return _0x57a772[_0x17146b(0x217)]['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x57a772['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x57a772['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0xd01ea8['textures']['colorTable'];},'aspect':function(){return _0x4da703['drawingBufferWidth']/_0x4da703['drawingBufferHeight'];},'pixelSize':function(){return _0x502c57['pixelSize'];},'lineWidth':function(){const _0x21c29e=_0x3671;return _0x52e75a[_0x21c29e(0x156)];},'particleHeight':function(){return _0x52e75a['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0xfcd390(0x1b5)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0xd01ea8['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x5cca89=_0xfcd390;return _0xd01ea8[_0x5cca89(0x1e3)]['segmentsDepth'];},'currentTrailsColor':function(){return _0xd01ea8['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0xd01ea8['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x52e75a['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0xfcd390(0x1f1))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0xfcd390(0x159)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x5ab53d=_0xfcd390,_0x4a0a33=_0xd01ea8[_0x5ab53d(0x159)]['currentTrails'];_0xd01ea8['framebuffers']['currentTrails']=_0xd01ea8['framebuffers']['nextTrails'],_0xd01ea8['framebuffers']['nextTrails']=_0x4a0a33,_0xd01ea8['primitives'][_0x5ab53d(0x21b)]['commandToExecute']['framebuffer']=_0xd01ea8['framebuffers'][_0x5ab53d(0x155)],_0xd01ea8['primitives']['trails'][_0x5ab53d(0x179)]['framebuffer']=_0xd01ea8[_0x5ab53d(0x159)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0xfcd390(0x1a3),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0xfcd390(0x1aa)](),'primitiveType':Cesium$4[_0xfcd390(0x203)][_0xfcd390(0x1f8)],'uniformMap':{'trailsColorTexture':function(){const _0x200023=_0xfcd390;return _0xd01ea8['framebuffers'][_0x200023(0x155)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x67dcc4=_0xfcd390;return _0xd01ea8['framebuffers'][_0x67dcc4(0x155)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xfcd390(0x154)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x2d18a1(0x165),postProcessingSpeed_frag=_0x2d18a1(0x211);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x53d1d1,_0x39742f,_0x3b0246,_0x2ba302){const _0x1ca227=_0x2d18a1;this['data']=_0x39742f,this['createWindTextures'](_0x53d1d1,_0x39742f),this['createParticlesTextures'](_0x53d1d1,_0x3b0246,_0x2ba302),this[_0x1ca227(0x1d0)](_0x39742f,_0x3b0246,_0x2ba302);}['createWindTextures'](_0x300ddb,_0x4baf09){const _0x45a575=_0x2d18a1,_0x17f54b={'context':_0x300ddb,'width':_0x4baf09['dimensions']['lon'],'height':_0x4baf09[_0x45a575(0x1e9)]['lat']*(_0x4baf09['dimensions']['lev']||0x1),'pixelFormat':Cesium$3[_0x45a575(0x1d3)]['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x45a575(0x1cc)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x45a575(0x1a8)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x17f54b,_0x4baf09['U']['array']),'V':Util['createTexture'](_0x17f54b,_0x4baf09['V']['array'])};}['createParticlesTextures'](_0x871eb8,_0x48fc77,_0x3ed0cd){const _0x26f333=_0x2d18a1,_0x530d35={'context':_0x871eb8,'width':_0x48fc77[_0x26f333(0x14a)],'height':_0x48fc77['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat'][_0x26f333(0x201)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x26f333(0x1a8)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x49ef87=this['randomizeParticles'](_0x48fc77[_0x26f333(0x221)],_0x3ed0cd),_0x57fdc7=new Float32Array(0x4*_0x48fc77['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x530d35),'currentParticlesPosition':Util['createTexture'](_0x530d35,_0x49ef87),'nextParticlesPosition':Util[_0x26f333(0x210)](_0x530d35,_0x49ef87),'currentParticlesSpeed':Util[_0x26f333(0x210)](_0x530d35,_0x57fdc7),'nextParticlesSpeed':Util['createTexture'](_0x530d35,_0x57fdc7),'postProcessingPosition':Util['createTexture'](_0x530d35,_0x49ef87),'postProcessingSpeed':Util['createTexture'](_0x530d35,_0x57fdc7)};}[_0x2d18a1(0x15f)](_0x52e28b,_0x20954f){const _0x1327e4=_0x2d18a1,_0x2aee64=new Float32Array(0x4*_0x52e28b);for(let _0x3b140f=0x0;_0x3b140f<_0x52e28b;_0x3b140f++){_0x2aee64[0x4*_0x3b140f]=Cesium$3['Math']['randomBetween'](_0x20954f['lonRange']['x'],_0x20954f['lonRange']['y']),_0x2aee64[0x4*_0x3b140f+0x1]=Cesium$3[_0x1327e4(0x18a)]['randomBetween'](_0x20954f['latRange']['x'],_0x20954f['latRange']['y']),_0x2aee64[0x4*_0x3b140f+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x1327e4(0x186)]['min'],this['data']['lev']['max']),_0x2aee64[0x4*_0x3b140f+0x3]=0x0;}return _0x2aee64;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x5ecca0=>{const _0x153a45=_0x3671;this['particlesTextures'][_0x5ecca0][_0x153a45(0x20e)]();});}[_0x2d18a1(0x1d0)](_0xecef73,_0x6d8701,_0x4d7047){const _0x3958e6=_0x2d18a1,_0x5a8969=new Cesium$3[(_0x3958e6(0x204))](_0xecef73[_0x3958e6(0x1e9)][_0x3958e6(0x16c)],_0xecef73['dimensions']['lat'],_0xecef73[_0x3958e6(0x1e9)]['lev']),_0x13fc25=new Cesium$3['Cartesian3'](_0xecef73[_0x3958e6(0x16c)]['min'],_0xecef73['lat'][_0x3958e6(0x158)],_0xecef73['lev']['min']),_0x3e2ee4=new Cesium$3[(_0x3958e6(0x204))](_0xecef73[_0x3958e6(0x16c)][_0x3958e6(0x1f9)],_0xecef73[_0x3958e6(0x19f)]['max'],_0xecef73['lev']['max']),_0x137735=new Cesium$3['Cartesian3']((_0x3e2ee4['x']-_0x13fc25['x'])/(_0x5a8969['x']-0x1),(_0x3e2ee4['y']-_0x13fc25['y'])/(_0x5a8969['y']-0x1),_0x5a8969['z']>0x1?(_0x3e2ee4['z']-_0x13fc25['z'])/(_0x5a8969['z']-0x1):0x1),_0x5f5c63=new Cesium$3['Cartesian2'](_0xecef73['U']['min'],_0xecef73['U']['max']),_0x38b9a0=new Cesium$3[(_0x3958e6(0x1c8))](_0xecef73['V'][_0x3958e6(0x158)],_0xecef73['V']['max']),_0x3e8239=this;this[_0x3958e6(0x205)]={'getWind':new CustomPrimitive({'commandType':_0x3958e6(0x15a),'uniformMap':{'U':function(){const _0x395f92=_0x3958e6;return _0x3e8239[_0x395f92(0x20c)]['U'];},'V':function(){const _0x35a3cb=_0x3958e6;return _0x3e8239[_0x35a3cb(0x20c)]['V'];},'currentParticlesPosition':function(){return _0x3e8239['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x5a8969;},'minimum':function(){return _0x13fc25;},'maximum':function(){return _0x3e2ee4;},'interval':function(){return _0x137735;}},'fragmentShaderSource':new Cesium$3[(_0x3958e6(0x1f1))]({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x4f49fe=_0x3958e6;_0x3e8239['primitives']['getWind']['commandToExecute'][_0x4f49fe(0x1d5)]=_0x3e8239['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x3e8239['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x20c63a=_0x3958e6;return _0x3e8239['particlesTextures'][_0x20c63a(0x18d)];},'uSpeedRange':function(){return _0x5f5c63;},'vSpeedRange':function(){return _0x38b9a0;},'pixelSize':function(){return _0x4d7047['pixelSize'];},'speedFactor':function(){const _0x1a7e23=_0x3958e6;return _0x6d8701[_0x1a7e23(0x182)];}},'fragmentShaderSource':new Cesium$3[(_0x3958e6(0x1f1))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x2b8382=_0x3958e6,_0x33fc00=_0x3e8239['particlesTextures']['currentParticlesSpeed'];_0x3e8239['particlesTextures']['currentParticlesSpeed']=_0x3e8239['particlesTextures']['postProcessingSpeed'],_0x3e8239['particlesTextures'][_0x2b8382(0x1db)]=_0x33fc00,_0x3e8239['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x3e8239['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x3958e6(0x15a),'uniformMap':{'currentParticlesPosition':function(){return _0x3e8239['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x3e8239['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x5c9d52=_0x3958e6,_0x3d45e3=_0x3e8239[_0x5c9d52(0x217)]['currentParticlesPosition'];_0x3e8239[_0x5c9d52(0x217)]['currentParticlesPosition']=_0x3e8239['particlesTextures']['postProcessingPosition'],_0x3e8239['particlesTextures']['postProcessingPosition']=_0x3d45e3,_0x3e8239[_0x5c9d52(0x205)]['updatePosition']['commandToExecute'][_0x5c9d52(0x1d5)]=_0x3e8239[_0x5c9d52(0x217)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x4d809e=_0x3958e6;return _0x3e8239['particlesTextures'][_0x4d809e(0x1df)];},'nextParticlesSpeed':function(){return _0x3e8239['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x4d7047['lonRange'];},'latRange':function(){const _0x5a88ff=_0x3958e6;return _0x4d7047[_0x5a88ff(0x20a)];},'randomCoefficient':function(){const _0x46f7aa=_0x3958e6,_0x33305d=Math[_0x46f7aa(0x171)]();return _0x33305d;},'dropRate':function(){return _0x6d8701['dropRate'];},'dropRateBump':function(){return _0x6d8701['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x3958e6(0x1f1))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x11f4dc=_0x3958e6;_0x3e8239['primitives'][_0x11f4dc(0x220)]['commandToExecute']['outputTexture']=_0x3e8239[_0x11f4dc(0x217)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x18edce=_0x3958e6;return _0x3e8239['particlesTextures'][_0x18edce(0x220)];},'nextParticlesSpeed':function(){return _0x3e8239['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x3958e6(0x217)]['postProcessingSpeed'],'preExecute':function(){const _0x4b53b7=_0x3958e6;_0x3e8239['primitives']['postProcessingSpeed'][_0x4b53b7(0x157)]['outputTexture']=_0x3e8239[_0x4b53b7(0x217)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x55c26b,_0x594d78,_0x18f805,_0x323197){const _0x2092c6=_0x2d18a1;this[_0x2092c6(0x1f3)]=_0x55c26b,_0x594d78={..._0x594d78},_0x594d78[_0x2092c6(0x16b)]&&_0x594d78['vdata']&&(_0x594d78[_0x2092c6(0x1e9)]={},_0x594d78[_0x2092c6(0x1e9)][_0x2092c6(0x16c)]=_0x594d78['cols'],_0x594d78[_0x2092c6(0x1e9)]['lat']=_0x594d78['rows'],_0x594d78[_0x2092c6(0x1e9)][_0x2092c6(0x186)]=_0x594d78['lev']||0x1,_0x594d78['lon']={},_0x594d78['lon']['min']=_0x594d78[_0x2092c6(0x1b2)],_0x594d78['lon'][_0x2092c6(0x1f9)]=_0x594d78['xmax'],_0x594d78[_0x2092c6(0x19f)]={},_0x594d78['lat']['min']=_0x594d78['ymin'],_0x594d78['lat']['max']=_0x594d78['ymax'],_0x594d78['lev']={},_0x594d78[_0x2092c6(0x186)]['min']=_0x594d78['levmin']??0x1,_0x594d78[_0x2092c6(0x186)]['max']=_0x594d78['levmax']??0x1,_0x594d78['U']={},_0x594d78['U'][_0x2092c6(0x1a9)]=new Float32Array(_0x594d78['udata']),_0x594d78['U']['min']=_0x594d78[_0x2092c6(0x194)]??Math['min'](..._0x594d78['udata']),_0x594d78['U']['max']=_0x594d78[_0x2092c6(0x1af)]??Math['max'](..._0x594d78['udata']),_0x594d78['V']={},_0x594d78['V'][_0x2092c6(0x1a9)]=new Float32Array(_0x594d78[_0x2092c6(0x18b)]),_0x594d78['V']['min']=_0x594d78[_0x2092c6(0x14b)]??Math['min'](..._0x594d78[_0x2092c6(0x18b)]),_0x594d78['V']['max']=_0x594d78['vmax']??Math['max'](..._0x594d78['vdata'])),this[_0x2092c6(0x197)]=_0x594d78,this[_0x2092c6(0x21e)]=_0x18f805,this['viewerParameters']=_0x323197,this['particlesComputing']=new ParticlesComputing(this[_0x2092c6(0x1f3)],this[_0x2092c6(0x197)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x2092c6(0x21e)],this[_0x2092c6(0x21c)],this['particlesComputing']);}['canvasResize'](_0x3a288b){const _0x12a861=_0x2d18a1;this['particlesComputing'][_0x12a861(0x214)](),Object['keys'](this['particlesComputing'][_0x12a861(0x20c)])['forEach'](_0x4c5b94=>{const _0xdefdcf=_0x12a861;this['particlesComputing']['windTextures'][_0x4c5b94][_0xdefdcf(0x20e)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x12a861(0x212)](this['particlesRendering'][_0x12a861(0x159)])[_0x12a861(0x19d)](_0x2cab0f=>{const _0x34526a=_0x12a861;this['particlesRendering'][_0x34526a(0x159)][_0x2cab0f][_0x34526a(0x20e)]();}),this['context']=_0x3a288b,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x12a861(0x197)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x12a861(0x197)],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x2d18a1(0x18c)](){const _0x6574a9=_0x2d18a1,_0x5d0622=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this['particlesRendering'][_0x6574a9(0x159)])['forEach'](_0x5262a1=>{const _0x3739f2=_0x6574a9;_0x5d0622['framebuffer']=this['particlesRendering']['framebuffers'][_0x5262a1],_0x5d0622['execute'](this[_0x3739f2(0x1f3)]);});}['refreshParticles'](_0x1285e6){const _0x34ef7d=_0x2d18a1;this['clearFramebuffers'](),this['particlesComputing'][_0x34ef7d(0x214)](),this['particlesComputing']['createParticlesTextures'](this['context'],this[_0x34ef7d(0x21e)],this['viewerParameters']);if(_0x1285e6){var _0x1bd4cf;const _0x559b42=this[_0x34ef7d(0x193)]['createSegmentsGeometry'](this['options']);this['particlesRendering'][_0x34ef7d(0x205)]['segments'][_0x34ef7d(0x1b9)]=_0x559b42;const _0x4bf5ed=Cesium$2['VertexArray'][_0x34ef7d(0x223)]({'context':this['context'],'geometry':_0x559b42,'attributeLocations':this['particlesRendering'][_0x34ef7d(0x205)]['segments'][_0x34ef7d(0x1c5)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x1bd4cf=this[_0x34ef7d(0x193)]['primitives'])!==null&&_0x1bd4cf!==void 0x0&&(_0x1bd4cf=_0x1bd4cf['segments'])!==null&&_0x1bd4cf!==void 0x0&&_0x1bd4cf[_0x34ef7d(0x157)]&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x4bf5ed);}}[_0x2d18a1(0x20d)](_0x4e38ec){const _0x1fc383=_0x2d18a1;let _0x208a40=![];this['options']['maxParticles']!==_0x4e38ec[_0x1fc383(0x221)]&&(_0x208a40=!![]),Object['keys'](_0x4e38ec)['forEach'](_0x1e5eb6=>{this['options'][_0x1e5eb6]=_0x4e38ec[_0x1e5eb6];}),this['refreshParticles'](_0x208a40);}['applyViewerParameters'](_0x2af041){const _0x26d709=_0x2d18a1;Object['keys'](_0x2af041)[_0x26d709(0x19d)](_0x471e53=>{this['viewerParameters'][_0x471e53]=_0x2af041[_0x471e53];}),this[_0x26d709(0x1b6)](![]);}['destroy'](){const _0x53d1f0=_0x2d18a1;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x5a7c24=>{this['particlesComputing']['windTextures'][_0x5a7c24]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x53d1f0(0x159)])[_0x53d1f0(0x19d)](_0x425cdf=>{const _0x564986=_0x53d1f0;this[_0x564986(0x193)]['framebuffers'][_0x425cdf][_0x564986(0x20e)]();});for(const _0x31f25c in this){delete this[_0x31f25c];}}}const Cesium$1=mars3d__namespace[_0x2d18a1(0x1a5)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x3156f7={}){const _0x3e78d0=_0x2d18a1;_0x3156f7={...DEF_OPTIONS,..._0x3156f7},super(_0x3156f7),this[_0x3e78d0(0x170)](_0x3156f7);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x4b9d77){this['setData'](_0x4b9d77);}get[_0x2d18a1(0x190)](){const _0x23ba38=_0x2d18a1;return this[_0x23ba38(0x21e)]['colors'];}set['colors'](_0x266f51){const _0x312868=_0x2d18a1;this['options'][_0x312868(0x190)]=_0x266f51,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x266f51}),this['resize']();}[_0x2d18a1(0x1e1)](){}[_0x2d18a1(0x19a)](){const _0x3222f7=_0x2d18a1;this['scene']=this['_map'][_0x3222f7(0x163)],this['camera']=this['_map']['camera'],this[_0x3222f7(0x205)]=new Cesium$1[(_0x3222f7(0x1dd))](),this[_0x3222f7(0x1eb)]['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1[(_0x3222f7(0x1c8))](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x3222f7(0x213))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x3222f7(0x1c0)](),window['addEventListener'](_0x3222f7(0x17b),this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x3222f7(0x21d)]=![],this[_0x3222f7(0x1eb)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x3222f7(0x1ac)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace[_0x3222f7(0x1ac)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x3222f7(0x222)]);}['_removedHook'](){const _0x3d60e7=_0x2d18a1;window['removeEventListener']('resize',this['resize']),this[_0x3d60e7(0x1eb)]['off'](mars3d__namespace['EventType']['preRender'],this[_0x3d60e7(0x22c)],this),this['_map']['off'](mars3d__namespace[_0x3d60e7(0x1ac)]['wheel'],this[_0x3d60e7(0x180)],this),this['_map'][_0x3d60e7(0x227)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x3d60e7(0x227)](mars3d__namespace[_0x3d60e7(0x1ac)]['mouseUp'],this[_0x3d60e7(0x1b1)],this),this['_map'][_0x3d60e7(0x227)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene'][_0x3d60e7(0x205)]['remove'](this['primitives']);}['resize'](){const _0x47ae3=_0x2d18a1;if(!this['show']||!this[_0x47ae3(0x19b)])return;this['primitives']['show']=![],this[_0x47ae3(0x205)]['removeAll'](),this[_0x47ae3(0x1eb)]['once'](mars3d__namespace['EventType']['preRender'],this[_0x47ae3(0x22c)],this);}['_onMap_preRenderEvent'](_0x321024){const _0xfaef16=_0x2d18a1;this[_0xfaef16(0x19b)]['canvasResize'](this[_0xfaef16(0x163)]['context']),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x4948ac){const _0x3a81d8=_0x2d18a1;clearTimeout(this['refreshTimer']);if(!this[_0x3a81d8(0x184)]||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x4aaa82=_0x3a81d8;if(!this['show'])return;this[_0x4aaa82(0x1d9)]();},0xc8);}['_onMouseDownEvent'](_0x43d1d0){const _0x1fdb76=_0x2d18a1;this[_0x1fdb76(0x1a4)]=!![];}[_0x2d18a1(0x1b8)](_0x484d6c){const _0x26606f=_0x2d18a1;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x26606f(0x21d)]=!![]);}['_onMouseUpEvent'](_0x4552af){const _0x29749f=_0x2d18a1;if(!this[_0x29749f(0x184)]||!this[_0x29749f(0x19b)])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x29749f(0x205)]['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x33baef=_0x2d18a1;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x33baef(0x14d)](this['viewerParameters']),this['primitives']['show']=!![];}[_0x2d18a1(0x188)](_0xbb3565){const _0x8ed040=_0x2d18a1;this['_data']=_0xbb3565,this[_0x8ed040(0x19b)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene'][_0x8ed040(0x1f3)],_0xbb3565,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x33c1c9,_0x1e2e91){const _0x28debe=_0x2d18a1;if(_0x33c1c9)for(const _0x1e1320 in _0x33c1c9){this[_0x1e1320]=_0x33c1c9[_0x1e1320];}this['particleSystem']&&this[_0x28debe(0x19b)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x32ddd4=_0x2d18a1,_0x31b385=Math[_0x32ddd4(0x1b3)](Math['sqrt'](this['particlesNumber']));return this[_0x32ddd4(0x1f6)]=_0x31b385*_0x31b385,{'particlesTextureSize':_0x31b385,'maxParticles':this['particlesNumber'],'particleHeight':this[_0x32ddd4(0x218)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x32ddd4(0x190)]};}['addPrimitives'](){const _0x4ed8e9=_0x2d18a1;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x4ed8e9(0x17c)]),this['primitives']['add'](this[_0x4ed8e9(0x19b)]['particlesComputing']['primitives'][_0x4ed8e9(0x152)]),this['primitives'][_0x4ed8e9(0x1ed)](this['particleSystem']['particlesComputing'][_0x4ed8e9(0x205)][_0x4ed8e9(0x189)]),this['primitives']['add'](this['particleSystem'][_0x4ed8e9(0x15c)]['primitives']['postProcessingPosition']),this[_0x4ed8e9(0x205)][_0x4ed8e9(0x1ed)](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives'][_0x4ed8e9(0x1ed)](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives'][_0x4ed8e9(0x1ed)](this['particleSystem']['particlesRendering'][_0x4ed8e9(0x205)]['trails']),this[_0x4ed8e9(0x205)]['add'](this['particleSystem']['particlesRendering']['primitives'][_0x4ed8e9(0x1f5)]);}[_0x2d18a1(0x1c0)](){const _0x5e156a=_0x2d18a1;let _0x5e2d1d=this['camera']['computeViewRectangle'](this['scene']['globe'][_0x5e156a(0x17a)]);if(!_0x5e2d1d){const _0x16e5d6=this[_0x5e156a(0x1eb)]['getExtent']();_0x5e2d1d=Cesium$1['Rectangle']['fromDegrees'](_0x16e5d6[_0x5e156a(0x1b2)],_0x16e5d6['ymin'],_0x16e5d6['xmax'],_0x16e5d6[_0x5e156a(0x1e0)]);}const _0x503625=Util[_0x5e156a(0x1cd)](_0x5e2d1d);this['viewerParameters']['lonRange']['x']=_0x503625['lon'][_0x5e156a(0x158)],this['viewerParameters'][_0x5e156a(0x17d)]['y']=_0x503625['lon']['max'],this['viewerParameters'][_0x5e156a(0x20a)]['x']=_0x503625['lat'][_0x5e156a(0x158)],this[_0x5e156a(0x21c)]['latRange']['y']=_0x503625['lat']['max'];const _0x1b9f3e=this[_0x5e156a(0x14c)][_0x5e156a(0x16a)](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x1b9f3e>0x0&&(this['viewerParameters']['pixelSize']=_0x1b9f3e);}}mars3d__namespace[_0x2d18a1(0x1c4)]['register']('wind',WindLayer),mars3d__namespace[_0x2d18a1(0x200)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x49846b in this){delete this[_0x49846b];}}}class CanvasWindField{constructor(_0x15f51d){this['setOptions'](_0x15f51d);}get['speedRate'](){return this['_speedRate'];}set[_0x2d18a1(0x192)](_0x32559c){this['_speedRate']=(0x64-(_0x32559c>0x63?0x63:_0x32559c))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){const _0x490fbf=_0x2d18a1;return this[_0x490fbf(0x1e2)];}set[_0x2d18a1(0x16e)](_0x204390){const _0x2b4de6=_0x2d18a1;this[_0x2b4de6(0x1e2)]=_0x204390;}['setOptions'](_0x250983){const _0x45b81d=_0x2d18a1;this['options']=_0x250983,this[_0x45b81d(0x16e)]=_0x250983['maxAge']||0x78,this['speedRate']=_0x250983['speedRate']||0x32,this[_0x45b81d(0x1d4)]=[];const _0x1a3db8=_0x250983['particlesNumber']||0x1000;for(let _0x4d4188=0x0;_0x4d4188<_0x1a3db8;_0x4d4188++){const _0x144bb6=this[_0x45b81d(0x22e)](new CanvasParticle());this['particles']['push'](_0x144bb6);}}['setDate'](_0x4249b0){const _0x5301f8=_0x2d18a1;this['rows']=_0x4249b0['rows'],this[_0x5301f8(0x1bd)]=_0x4249b0['cols'],this['xmin']=_0x4249b0['xmin'],this[_0x5301f8(0x16f)]=_0x4249b0[_0x5301f8(0x16f)],this['ymin']=_0x4249b0[_0x5301f8(0x1c9)],this['ymax']=_0x4249b0[_0x5301f8(0x1e0)],this[_0x5301f8(0x1c7)]=[];const _0x1f285b=_0x4249b0['udata'],_0x3d9cd4=_0x4249b0[_0x5301f8(0x18b)];let _0x983280=![];_0x1f285b['length']===this[_0x5301f8(0x1fb)]&&_0x1f285b[0x0]['length']===this['cols']&&(_0x983280=!![]);let _0x3413d2=0x0,_0x12f1c3=null,_0x353e54=null;for(let _0x5e3759=0x0;_0x5e3759<this[_0x5301f8(0x1fb)];_0x5e3759++){_0x12f1c3=[];for(let _0xfa7468=0x0;_0xfa7468<this['cols'];_0xfa7468++,_0x3413d2++){_0x983280?_0x353e54=this[_0x5301f8(0x209)](_0x1f285b[_0x5e3759][_0xfa7468],_0x3d9cd4[_0x5e3759][_0xfa7468]):_0x353e54=this[_0x5301f8(0x209)](_0x1f285b[_0x3413d2],_0x3d9cd4[_0x3413d2]),_0x12f1c3['push'](_0x353e54);}this['grid']['push'](_0x12f1c3);}this[_0x5301f8(0x21e)]['reverseY']&&this['grid'][_0x5301f8(0x224)]();}['clear'](){const _0x597bf8=_0x2d18a1;delete this[_0x597bf8(0x1fb)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x597bf8(0x1c9)],delete this[_0x597bf8(0x1e0)],delete this[_0x597bf8(0x1c7)],delete this['particles'];}['toGridXY'](_0x5b839e,_0x18eb10){const _0x4001e1=_0x2d18a1,_0x51031d=(_0x5b839e-this[_0x4001e1(0x1b2)])/(this[_0x4001e1(0x16f)]-this['xmin'])*(this['cols']-0x1),_0x223ddb=(this['ymax']-_0x18eb10)/(this['ymax']-this['ymin'])*(this[_0x4001e1(0x1fb)]-0x1);return[_0x51031d,_0x223ddb];}['getUVByXY'](_0x180d13,_0x2426a3){const _0x21990d=_0x2d18a1;if(_0x180d13<0x0||_0x180d13>=this[_0x21990d(0x1bd)]||_0x2426a3>=this['rows'])return[0x0,0x0,0x0];const _0x3cb99e=Math[_0x21990d(0x168)](_0x180d13),_0x63673a=Math['floor'](_0x2426a3);if(_0x3cb99e===_0x180d13&&_0x63673a===_0x2426a3)return this['grid'][_0x2426a3][_0x180d13];const _0x54fbfb=_0x3cb99e+0x1,_0x1d3cd7=_0x63673a+0x1,_0x1498bc=this['getUVByXY'](_0x3cb99e,_0x63673a),_0x418b9c=this['getUVByXY'](_0x54fbfb,_0x63673a),_0x184fe1=this['getUVByXY'](_0x3cb99e,_0x1d3cd7),_0x240c32=this['getUVByXY'](_0x54fbfb,_0x1d3cd7);let _0x29deae=null;try{_0x29deae=this['_bilinearInterpolation'](_0x180d13-_0x3cb99e,_0x2426a3-_0x63673a,_0x1498bc,_0x418b9c,_0x184fe1,_0x240c32);}catch(_0x564f60){console['log'](_0x180d13,_0x2426a3);}return _0x29deae;}['_bilinearInterpolation'](_0x5f3cb6,_0x1d70d1,_0x596153,_0xd4328c,_0x51f70d,_0xd5df75){const _0x249219=0x1-_0x5f3cb6,_0x4debdb=0x1-_0x1d70d1,_0x12318b=_0x249219*_0x4debdb,_0x49d382=_0x5f3cb6*_0x4debdb,_0x32f00b=_0x249219*_0x1d70d1,_0x3fdf42=_0x5f3cb6*_0x1d70d1,_0x5070b6=_0x596153[0x0]*_0x12318b+_0xd4328c[0x0]*_0x49d382+_0x51f70d[0x0]*_0x32f00b+_0xd5df75[0x0]*_0x3fdf42,_0x198e70=_0x596153[0x1]*_0x12318b+_0xd4328c[0x1]*_0x49d382+_0x51f70d[0x1]*_0x32f00b+_0xd5df75[0x1]*_0x3fdf42;return this['_calcUV'](_0x5070b6,_0x198e70);}['_calcUV'](_0x6c36bc,_0x3bef83){const _0x5082af=_0x2d18a1;return[+_0x6c36bc,+_0x3bef83,Math[_0x5082af(0x1c6)](_0x6c36bc*_0x6c36bc+_0x3bef83*_0x3bef83)];}[_0x2d18a1(0x1d6)](_0x143e44,_0x101887){if(!this['isInExtent'](_0x143e44,_0x101887))return null;const _0x5a0ff1=this['toGridXY'](_0x143e44,_0x101887),_0x3c482d=this['getUVByXY'](_0x5a0ff1[0x0],_0x5a0ff1[0x1]);return _0x3c482d;}['isInExtent'](_0x27e6e1,_0xd9e2a5){const _0x575aed=_0x2d18a1;return _0x27e6e1>=this['xmin']&&_0x27e6e1<=this[_0x575aed(0x16f)]&&_0xd9e2a5>=this['ymin']&&_0xd9e2a5<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x58df6c=_0x2d18a1,_0x1ef243=fRandomByfloat(this[_0x58df6c(0x1b2)],this['xmax']),_0x4194e1=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x4194e1,'lng':_0x1ef243};}['getParticles'](){const _0x18836d=_0x2d18a1;let _0x3be09b,_0x4fabb9,_0x43b5ee;for(let _0x5f4077=0x0,_0x15dc9a=this[_0x18836d(0x1d4)]['length'];_0x5f4077<_0x15dc9a;_0x5f4077++){let _0x3912af=this['particles'][_0x5f4077];_0x3912af[_0x18836d(0x17e)]<=0x0&&(_0x3912af=this['_randomParticle'](_0x3912af));if(_0x3912af[_0x18836d(0x17e)]>0x0){const _0x455a93=_0x3912af['tlng'],_0x3d6e6f=_0x3912af['tlat'];_0x43b5ee=this[_0x18836d(0x1d6)](_0x455a93,_0x3d6e6f),_0x43b5ee?(_0x3be09b=_0x455a93+this['_calc_speedRate'][0x0]*_0x43b5ee[0x0],_0x4fabb9=_0x3d6e6f+this['_calc_speedRate'][0x1]*_0x43b5ee[0x1],_0x3912af['lng']=_0x455a93,_0x3912af[_0x18836d(0x19f)]=_0x3d6e6f,_0x3912af[_0x18836d(0x1d8)]=_0x3be09b,_0x3912af['tlat']=_0x4fabb9,_0x3912af['speed']=_0x43b5ee[0x2],_0x3912af['age']--):_0x3912af[_0x18836d(0x17e)]=0x0;}}return this[_0x18836d(0x1d4)];}[_0x2d18a1(0x22e)](_0x53cbc2){const _0x175b4d=_0x2d18a1;let _0x5c901d,_0x87d5fa;for(let _0x293ccc=0x0;_0x293ccc<0x1e;_0x293ccc++){_0x5c901d=this[_0x175b4d(0x1d7)](),_0x87d5fa=this[_0x175b4d(0x1d6)](_0x5c901d['lng'],_0x5c901d['lat']);if(_0x87d5fa&&_0x87d5fa[0x2]>0x0)break;}if(!_0x87d5fa)return _0x53cbc2;const _0x52ad2a=_0x5c901d['lng']+this['_calc_speedRate'][0x0]*_0x87d5fa[0x0],_0x58e5c8=_0x5c901d[_0x175b4d(0x19f)]+this[_0x175b4d(0x164)][0x1]*_0x87d5fa[0x1];return _0x53cbc2['lng']=_0x5c901d['lng'],_0x53cbc2['lat']=_0x5c901d['lat'],_0x53cbc2['tlng']=_0x52ad2a,_0x53cbc2['tlat']=_0x58e5c8,_0x53cbc2[_0x175b4d(0x17e)]=Math['round'](Math['random']()*this[_0x175b4d(0x16e)]),_0x53cbc2[_0x175b4d(0x161)]=_0x87d5fa[0x2],_0x53cbc2;}['destroy'](){for(const _0x3f76c4 in this){delete this[_0x3f76c4];}}}function fRandomByfloat(_0x5f3719,_0x1771bf){return _0x5f3719+Math['random']()*(_0x1771bf-_0x5f3719);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x2d18a1(0x16d)];class CanvasWindLayer extends BaseLayer{constructor(_0x2295b6={}){const _0x2ad926=_0x2d18a1;super(_0x2295b6),this['_setOptionsHook'](_0x2295b6),this['canvas']=null,_0x2295b6['colors']&&_0x2295b6['steps']&&(this[_0x2ad926(0x185)]=new mars3d__namespace['ColorRamp'](_0x2295b6));}['_setOptionsHook'](_0x5cf2d5,_0x5d23a9){const _0xe247de=_0x2d18a1;this[_0xe247de(0x1d2)]=0x3e8/(_0x5cf2d5['frameRate']||0xa),this['_pointerEvents']=this[_0xe247de(0x21e)][_0xe247de(0x1ea)]??![],this[_0xe247de(0x216)]=_0x5cf2d5['color']||_0xe247de(0x1b0),this['lineWidth']=_0x5cf2d5['lineWidth']||0x1,this['fixedHeight']=_0x5cf2d5['fixedHeight']??0x0,this['reverseY']=_0x5cf2d5['reverseY']??![],this[_0xe247de(0x1ec)]&&this['windField'][_0xe247de(0x20d)](_0x5cf2d5);}get['layer'](){const _0xe65ea7=_0x2d18a1;return this[_0xe65ea7(0x199)];}get['canvasWidth'](){const _0x1a062b=_0x2d18a1;return this[_0x1a062b(0x1eb)]['scene']['canvas']['clientWidth'];}get[_0x2d18a1(0x21f)](){const _0x3c9ad3=_0x2d18a1;return this['_map'][_0x3c9ad3(0x163)]['canvas']['clientHeight'];}get[_0x2d18a1(0x1ea)](){const _0x1327e6=_0x2d18a1;return this[_0x1327e6(0x162)];}set['pointerEvents'](_0xa729e3){const _0x1a62cd=_0x2d18a1;this['_pointerEvents']=_0xa729e3;if(!this[_0x1a62cd(0x199)])return;_0xa729e3?this['canvas'][_0x1a62cd(0x22b)]['pointer-events']='all':this['canvas'][_0x1a62cd(0x22b)][_0x1a62cd(0x1a7)]='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x3bf4f0){const _0x42ee9c=_0x2d18a1;this[_0x42ee9c(0x21e)][_0x42ee9c(0x1f6)]=_0x3bf4f0,clearTimeout(this[_0x42ee9c(0x149)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get[_0x2d18a1(0x192)](){return this['options']['speedRate'];}set['speedRate'](_0x45b967){this['options']['speedRate']=_0x45b967,this['windField']&&(this['windField']['speedRate']=_0x45b967);}get[_0x2d18a1(0x16e)](){return this['options']['maxAge'];}set[_0x2d18a1(0x16e)](_0x40404d){const _0x506019=_0x2d18a1;this[_0x506019(0x21e)]['maxAge']=_0x40404d,this['windField']&&(this['windField']['maxAge']=_0x40404d);}get['data'](){const _0x15ad5d=_0x2d18a1;return this[_0x15ad5d(0x1e5)];}set['data'](_0x56249a){const _0x50ec96=_0x2d18a1;this[_0x50ec96(0x188)](_0x56249a);}['_showHook'](_0x5d3201){const _0x3a15ad=_0x2d18a1;_0x5d3201?this['_addedHook']():(this['windData']&&(this[_0x3a15ad(0x21e)]['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x2d18a1(0x19a)](){const _0x6a3815=_0x2d18a1;this[_0x6a3815(0x199)]=this[_0x6a3815(0x1f7)](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x6a3815(0x21e)]['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0xd91c38=_0x2d18a1;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map'][_0xd91c38(0x225)]['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x3f1348=_0x2d18a1,_0x51462b=mars3d__namespace['DomUtil'][_0x3f1348(0x15b)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x51462b[_0x3f1348(0x22b)]['position']='absolute',_0x51462b[_0x3f1348(0x22b)]['top']='0px',_0x51462b['style']['left']='0px',_0x51462b['style'][_0x3f1348(0x195)]=this[_0x3f1348(0x1eb)]['scene']['canvas']['clientWidth']+'px',_0x51462b['style']['height']=this[_0x3f1348(0x1eb)]['scene']['canvas']['clientHeight']+'px',_0x51462b['style'][_0x3f1348(0x1ea)]=this[_0x3f1348(0x162)]?'auto':'none',_0x51462b['style']['zIndex']=this['options'][_0x3f1348(0x174)]??0x9,_0x51462b['width']=this['_map'][_0x3f1348(0x163)]['canvas']['clientWidth'],_0x51462b['height']=this['_map'][_0x3f1348(0x163)]['canvas']['clientHeight'],_0x51462b;}['resize'](){const _0x222ee6=_0x2d18a1;this['canvas']&&(this[_0x222ee6(0x199)]['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style'][_0x222ee6(0x183)]=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this[_0x222ee6(0x1eb)][_0x222ee6(0x163)]['canvas']['clientWidth'],this[_0x222ee6(0x199)]['height']=this['_map']['scene']['canvas']['clientHeight']);}[_0x2d18a1(0x18f)](){const _0x5e008a=_0x2d18a1,_0x31d7c7=this;let _0x11ed75=Date['now']();(function _0x23fefb(){const _0x1bc311=_0x3671;_0x31d7c7[_0x1bc311(0x20f)]=window['requestAnimationFrame'](_0x23fefb);if(_0x31d7c7[_0x1bc311(0x184)]&&_0x31d7c7['windField']){const _0x34d0bc=Date['now'](),_0x22d42e=_0x34d0bc-_0x11ed75;_0x22d42e>_0x31d7c7[_0x1bc311(0x1d2)]&&(_0x11ed75=_0x34d0bc-_0x22d42e%_0x31d7c7['frameTime'],_0x31d7c7['update']());}}(),window['addEventListener']('resize',this['resize'][_0x5e008a(0x206)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x5e008a(0x21e)][_0x5e008a(0x1ae)]&&(this['_map']['on'](mars3d__namespace[_0x5e008a(0x1ac)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x5e008a(0x1eb)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}[_0x2d18a1(0x176)](){const _0x39d6c9=_0x2d18a1;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener'](_0x39d6c9(0x17b),this['resize']),this['options']['mouseHidden']&&(this['_map'][_0x39d6c9(0x227)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x39d6c9(0x1eb)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x39d6c9(0x1eb)][_0x39d6c9(0x227)](mars3d__namespace['EventType'][_0x39d6c9(0x228)],this['_onMouseUpEvent'],this),this['_map'][_0x39d6c9(0x227)](mars3d__namespace[_0x39d6c9(0x1ac)]['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x114f22){const _0x4975a8=_0x2d18a1;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x4975a8(0x199)])return;this['canvas']['style']['visibility']='hidden',this[_0x4975a8(0x18e)]=setTimeout(()=>{const _0x3d3bd5=_0x4975a8;if(!this['show'])return;this['redraw'](),this[_0x3d3bd5(0x199)][_0x3d3bd5(0x22b)]['visibility']=_0x3d3bd5(0x1c2);},0xc8);}['_onMouseDownEvent'](_0x574661){const _0x5535fd=_0x2d18a1;this[_0x5535fd(0x1a4)]=!![],this['_map'][_0x5535fd(0x227)](mars3d__namespace['EventType']['mouseMove'],this[_0x5535fd(0x1b8)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x5535fd(0x1bf)],this[_0x5535fd(0x1b8)],this);}['_onMouseMoveEvent'](_0x1ceea9){const _0x548764=_0x2d18a1;if(!this['show']||!this[_0x548764(0x199)])return;this['mouse_down']&&(this['canvas']['style'][_0x548764(0x1c3)]=_0x548764(0x187),this[_0x548764(0x21d)]=!![]);}['_onMouseUpEvent'](_0x213083){const _0x32be10=_0x2d18a1;if(!this['show']||!this[_0x32be10(0x199)])return;this['_map']['off'](mars3d__namespace['EventType'][_0x32be10(0x1bf)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x32be10(0x21d)]&&this['redraw'](),this['canvas'][_0x32be10(0x22b)][_0x32be10(0x1c3)]='visible',this[_0x32be10(0x1a4)]=![],this[_0x32be10(0x21d)]=![];}['setData'](_0x39ee3e){const _0x1f9e39=_0x2d18a1;this[_0x1f9e39(0x1c1)](),this['windData']=_0x39ee3e,this['windField']['setDate'](_0x39ee3e),this[_0x1f9e39(0x1d9)]();}['redraw'](){const _0x39d015=_0x2d18a1;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x39d015(0x19c)]();}['update'](){const _0x51aa38=_0x2d18a1;if(this[_0x51aa38(0x1a1)])return;this['_updateIng']=!![];if(this[_0x51aa38(0x169)])this['windField']['update']();else{const _0x2f9654=this['windField']['getParticles']();this['_drawLines'](_0x2f9654);}this['_updateIng']=![];}['_drawLines'](_0x57a6af){const _0x247f5c=_0x2d18a1;this[_0x247f5c(0x1fd)]['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x247f5c(0x21f)]),this['canvasContext'][_0x247f5c(0x1be)]=_0x247f5c(0x1ce),this['canvasContext']['globalAlpha']=0.9;const _0x764065=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x318cb=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x4efb6a=0x0,_0x6c79ca=_0x57a6af['length'];_0x4efb6a<_0x6c79ca;_0x4efb6a++){const _0x5eed92=_0x57a6af[_0x4efb6a],_0x3dc19a=this['_tomap'](_0x5eed92['lng'],_0x5eed92['lat'],_0x5eed92),_0x24ef51=this[_0x247f5c(0x181)](_0x5eed92['tlng'],_0x5eed92[_0x247f5c(0x14f)],_0x5eed92);if(!_0x3dc19a||!_0x24ef51)continue;if(_0x764065&&Math['abs'](_0x3dc19a[0x0]-_0x24ef51[0x0])>=_0x318cb)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x247f5c(0x1fd)][_0x247f5c(0x1fe)]=this['_colorRamp']['getColor'](_0x5eed92[_0x247f5c(0x161)]),this['canvasContext']['moveTo'](_0x3dc19a[0x0],_0x3dc19a[0x1]),this['canvasContext']['lineTo'](_0x24ef51[0x0],_0x24ef51[0x1]),this['canvasContext'][_0x247f5c(0x1fc)]();}else{this['canvasContext']['beginPath'](),this['canvasContext'][_0x247f5c(0x156)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this['color'];for(let _0x468514=0x0,_0x57a9fe=_0x57a6af['length'];_0x468514<_0x57a9fe;_0x468514++){const _0x824e34=_0x57a6af[_0x468514],_0x57bd2b=this[_0x247f5c(0x181)](_0x824e34[_0x247f5c(0x1e7)],_0x824e34['lat'],_0x824e34),_0x5c0262=this[_0x247f5c(0x181)](_0x824e34['tlng'],_0x824e34['tlat'],_0x824e34);if(!_0x57bd2b||!_0x5c0262)continue;if(_0x764065&&Math[_0x247f5c(0x191)](_0x57bd2b[0x0]-_0x5c0262[0x0])>=_0x318cb)continue;this[_0x247f5c(0x1fd)]['moveTo'](_0x57bd2b[0x0],_0x57bd2b[0x1]),this['canvasContext']['lineTo'](_0x5c0262[0x0],_0x5c0262[0x1]);}this[_0x247f5c(0x1fd)][_0x247f5c(0x1fc)]();}}['_tomap'](_0x2746c6,_0x5afefc,_0x1d1f56){const _0x5dfebe=_0x2d18a1,_0x31ae9a=Cesium['Cartesian3'][_0x5dfebe(0x167)](_0x2746c6,_0x5afefc,this[_0x5dfebe(0x218)]),_0x58dfe3=this[_0x5dfebe(0x1eb)]['scene'];if(_0x58dfe3[_0x5dfebe(0x198)]===Cesium['SceneMode']['SCENE3D']){const _0x54756a=new Cesium['EllipsoidalOccluder'](_0x58dfe3['globe']['ellipsoid'],_0x58dfe3['camera']['positionWC']),_0x1c7ff3=_0x54756a['isPointVisible'](_0x31ae9a);if(!_0x1c7ff3)return _0x1d1f56[_0x5dfebe(0x17e)]=0x0,null;}const _0x1f675f=Cesium[_0x5dfebe(0x21a)]['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x31ae9a);return _0x1f675f?[_0x1f675f['x'],_0x1f675f['y']]:null;}[_0x2d18a1(0x1c1)](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x70748=_0x2d18a1;this[_0x70748(0x169)]=new Worker(this['options'][_0x70748(0x169)]),this['worker'][_0x70748(0x226)]=_0x3794b4=>{const _0x341463=_0x70748;this['_drawLines'](_0x3794b4[_0x341463(0x197)][_0x341463(0x1d4)]),this['_updateIng2']=![];},this['windField']={'init':_0x45ae62=>{const _0x26a1ae=_0x70748;this[_0x26a1ae(0x169)]['postMessage']({'type':'init','options':_0x45ae62});},'setOptions':_0x3bdc30=>{const _0x4f398e=_0x70748;this[_0x4f398e(0x169)]['postMessage']({'type':'setOptions','options':_0x3bdc30});},'setDate':_0x53e55a=>{this['worker']['postMessage']({'type':'setDate','data':_0x53e55a});},'update':()=>{const _0x5841ee=_0x70748;if(this[_0x5841ee(0x177)])return;this[_0x5841ee(0x177)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this[_0x70748(0x1ec)]['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x2d18a1(0x1ab)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x2d18a1(0x150)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x2d18a1(0x1cb),{'value':!![]});
}));
