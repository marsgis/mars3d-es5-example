/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.15
 * 编译日期：2023-12-04 17:35:45
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x572e14=_0x5c9e;(function(_0xa87b9f,_0x2ed21d){const _0x176633=_0x5c9e,_0x109bc8=_0xa87b9f();while(!![]){try{const _0x240fb8=-parseInt(_0x176633(0x20a))/0x1+parseInt(_0x176633(0x18d))/0x2+-parseInt(_0x176633(0x17c))/0x3*(-parseInt(_0x176633(0x1c8))/0x4)+-parseInt(_0x176633(0x137))/0x5+-parseInt(_0x176633(0x15b))/0x6+parseInt(_0x176633(0x1ce))/0x7*(parseInt(_0x176633(0x1cd))/0x8)+parseInt(_0x176633(0x1c4))/0x9;if(_0x240fb8===_0x2ed21d)break;else _0x109bc8['push'](_0x109bc8['shift']());}catch(_0xed9af5){_0x109bc8['push'](_0x109bc8['shift']());}}}(_0x5a9a,0x33501));function _interopNamespace(_0x1e5fc3){if(_0x1e5fc3&&_0x1e5fc3['__esModule'])return _0x1e5fc3;var _0x4106c2=Object['create'](null);return _0x1e5fc3&&Object['keys'](_0x1e5fc3)['forEach'](function(_0x445418){const _0x194ca3=_0x5c9e;if(_0x445418!=='default'){var _0x3900ec=Object[_0x194ca3(0x1e9)](_0x1e5fc3,_0x445418);Object['defineProperty'](_0x4106c2,_0x445418,_0x3900ec['get']?_0x3900ec:{'enumerable':!![],'get':function(){return _0x1e5fc3[_0x445418];}});}}),_0x4106c2['default']=_0x1e5fc3,_0x4106c2;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0xf63b89,_0x3591aa){const _0x3fde2d=_0x5c9e,_0x215844=_0xf63b89*Math[_0x3fde2d(0x1ad)](Cesium$7['Math'][_0x3fde2d(0x208)](_0x3591aa));return _0x215844;}function getV(_0x48fde0,_0x4c69b7){const _0x3a17b5=_0x5c9e,_0x404d02=_0x48fde0*Math[_0x3a17b5(0x1da)](Cesium$7['Math'][_0x3a17b5(0x208)](_0x4c69b7));return _0x404d02;}function getSpeed(_0x38c6aa,_0xc1cc6e){const _0x19cb9f=_0x5c9e,_0x2ca914=Math[_0x19cb9f(0x1d7)](Math['pow'](_0x38c6aa,0x2)+Math[_0x19cb9f(0x1bc)](_0xc1cc6e,0x2));return _0x2ca914;}function getDirection(_0x5c6712,_0x23877f){const _0x3a6fbb=_0x5c9e;let _0x26f3d7=Cesium$7['Math'][_0x3a6fbb(0x1ed)](Math['atan2'](_0x23877f,_0x5c6712));return _0x26f3d7+=_0x26f3d7<0x0?0x168:0x0,_0x26f3d7;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x1434b0){const _0x36d197=_0x5c9e;this['commandType']=_0x1434b0['commandType'],this[_0x36d197(0x18a)]=_0x1434b0['geometry'],this['attributeLocations']=_0x1434b0['attributeLocations'],this['primitiveType']=_0x1434b0['primitiveType'],this['uniformMap']=_0x1434b0[_0x36d197(0x1c9)],this['vertexShaderSource']=_0x1434b0[_0x36d197(0x213)],this['fragmentShaderSource']=_0x1434b0['fragmentShaderSource'],this[_0x36d197(0x160)]=_0x1434b0['rawRenderState'],this['framebuffer']=_0x1434b0['framebuffer'],this['outputTexture']=_0x1434b0[_0x36d197(0x1c6)],this['autoClear']=_0x1434b0['autoClear']??![],this[_0x36d197(0x156)]=_0x1434b0['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x36d197(0x1f6)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x210756){const _0x5cef21=_0x5c9e;switch(this['commandType']){case'Draw':{const _0x58f0ee=Cesium$6['VertexArray'][_0x5cef21(0x1dd)]({'context':_0x210756,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x5cef21(0x1fc)]['STATIC_DRAW']}),_0x522305=Cesium$6['ShaderProgram'][_0x5cef21(0x177)]({'context':_0x210756,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x2780f0=Cesium$6[_0x5cef21(0x205)][_0x5cef21(0x177)](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x522305,'vertexArray':_0x58f0ee,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x2780f0,'uniformMap':this[_0x5cef21(0x1c9)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x5cef21(0x1a3))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0xb04119,_0x3d42e7){const _0x2b3bc2=_0x5c9e;this['geometry']=_0x3d42e7;const _0x44c800=Cesium$6['VertexArray']['fromGeometry']({'context':_0xb04119,'geometry':this['geometry'],'attributeLocations':this[_0x2b3bc2(0x143)],'bufferUsage':Cesium$6[_0x2b3bc2(0x1fc)]['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x44c800;}['update'](_0x5e7115){const _0x57520f=_0x5c9e;if(!this['show'])return;if(_0x5e7115[_0x57520f(0x175)]!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x5e7115['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x5e7115['commandList']['push'](this[_0x57520f(0x1f6)]),_0x5e7115['commandList'][_0x57520f(0x19c)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x42a5f7=_0x5c9e;if(this[_0x42a5f7(0x1f6)]){var _0xf11555,_0x292494;(_0xf11555=this['clearCommand'])!==null&&_0xf11555!==void 0x0&&_0xf11555[_0x42a5f7(0x1b7)]&&this['clearCommand']['vertexArray']['destroy'](),(_0x292494=this['clearCommand'])!==null&&_0x292494!==void 0x0&&_0x292494[_0x42a5f7(0x187)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this[_0x42a5f7(0x1f6)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this[_0x42a5f7(0x14c)]['shaderProgram']&&this['commandToExecute'][_0x42a5f7(0x187)]['destroy'](),delete this[_0x42a5f7(0x14c)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0xd60bff=function(){const _0x3b9807=_0x5c9e,_0x4e746f=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5[(_0x3b9807(0x186))]({'componentDatatype':Cesium$5[_0x3b9807(0x217)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x4e746f;},_0xb80d2=function(_0x481f93,_0x536d5b){const _0x92dc7a=_0x5c9e;if(Cesium$5['defined'](_0x536d5b)){const _0xcd1683={};_0xcd1683['arrayBufferView']=_0x536d5b,_0x481f93['source']=_0xcd1683;}const _0x3598b7=new Cesium$5[(_0x92dc7a(0x16c))](_0x481f93);return _0x3598b7;},_0x33b272=function(_0x26cabd,_0x10b775,_0xe6dc42){const _0x160c4c=new Cesium$5['Framebuffer']({'context':_0x26cabd,'colorTextures':[_0x10b775],'depthTexture':_0xe6dc42});return _0x160c4c;},_0x3243eb=function(_0x2cc68a){const _0x51cbfb=_0x5c9e,_0x315a7c=!![],_0x1b8adf=![],_0x4de01d={'viewport':_0x2cc68a['viewport'],'depthTest':_0x2cc68a['depthTest'],'depthMask':_0x2cc68a['depthMask'],'blending':_0x2cc68a[_0x51cbfb(0x14b)]},_0x2e4668=Cesium$5['Appearance']['getDefaultRenderState'](_0x315a7c,_0x1b8adf,_0x4de01d);return _0x2e4668;},_0x2f4ab9=function(_0x154658){const _0x16136e=_0x5c9e,_0x10e410={},_0x5056ab=Cesium$5['Math'][_0x16136e(0x182)](_0x154658[_0x16136e(0x195)],Cesium$5['Math'][_0x16136e(0x12f)]),_0x1ad1f7=Cesium$5['Math']['mod'](_0x154658[_0x16136e(0x1f2)],Cesium$5['Math']['TWO_PI']),_0x411898=_0x154658[_0x16136e(0x13d)];let _0x17bc39,_0x32b2e7;_0x411898>Cesium$5[_0x16136e(0x13f)]['THREE_PI_OVER_TWO']?(_0x17bc39=0x0,_0x32b2e7=Cesium$5['Math']['TWO_PI']):_0x1ad1f7-_0x5056ab<_0x411898?(_0x17bc39=_0x5056ab,_0x32b2e7=_0x5056ab+_0x411898):(_0x17bc39=_0x5056ab,_0x32b2e7=_0x1ad1f7);_0x10e410['lon']={'min':Cesium$5[_0x16136e(0x13f)]['toDegrees'](_0x17bc39),'max':Cesium$5['Math']['toDegrees'](_0x32b2e7)};const _0x5f2f37=_0x154658[_0x16136e(0x212)],_0x3aba66=_0x154658['north'],_0x439dbc=_0x154658[_0x16136e(0x1ac)],_0x5370aa=_0x439dbc>Cesium$5['Math']['PI']/0xc?_0x439dbc/0x2:0x0;let _0x28af31=Cesium$5[_0x16136e(0x13f)][_0x16136e(0x153)](_0x5f2f37-_0x5370aa),_0x34766e=Cesium$5[_0x16136e(0x13f)][_0x16136e(0x153)](_0x3aba66+_0x5370aa);return _0x28af31<-Cesium$5[_0x16136e(0x13f)]['PI_OVER_THREE']&&(_0x28af31=-Cesium$5['Math'][_0x16136e(0x1b0)]),_0x34766e>Cesium$5['Math'][_0x16136e(0x1f1)]&&(_0x34766e=Cesium$5['Math'][_0x16136e(0x1b0)]),_0x10e410['lat']={'min':Cesium$5['Math'][_0x16136e(0x1ed)](_0x28af31),'max':Cesium$5['Math'][_0x16136e(0x1ed)](_0x34766e)},_0x10e410;};return{'getFullscreenQuad':_0xd60bff,'createTexture':_0xb80d2,'createFramebuffer':_0x33b272,'createRawRenderState':_0x3243eb,'viewRectangleToLonLatRange':_0x2f4ab9};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x572e14(0x1b1),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x572e14(0x1ef),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x49b6c5,_0x3059a9,_0x4202b0,_0x3c4e,_0x20eb93){this['createRenderingTextures'](_0x49b6c5,_0x3059a9,_0x4202b0['colors']),this['createRenderingFramebuffers'](_0x49b6c5),this['createRenderingPrimitives'](_0x49b6c5,_0x4202b0,_0x3c4e,_0x20eb93);}['createRenderingTextures'](_0x59a0d8,_0x87d798,_0x266fb4){const _0x5abe1f=_0x572e14,_0x1d8063={'context':_0x59a0d8,'width':_0x59a0d8['drawingBufferWidth'],'height':_0x59a0d8[_0x5abe1f(0x1ee)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x476d6a={'context':_0x59a0d8,'width':_0x59a0d8[_0x5abe1f(0x1f7)],'height':_0x59a0d8['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x5abe1f(0x1aa)],'pixelDatatype':Cesium$4[_0x5abe1f(0x1df)][_0x5abe1f(0x1f4)]},_0x7158a=_0x266fb4['length'],_0x34b629=new Float32Array(_0x7158a*0x3);for(let _0x5e0b9d=0x0;_0x5e0b9d<_0x7158a;_0x5e0b9d++){const _0xe8c4a0=Cesium$4['Color']['fromCssColorString'](_0x266fb4[_0x5e0b9d]);_0x34b629[0x3*_0x5e0b9d]=_0xe8c4a0['red'],_0x34b629[0x3*_0x5e0b9d+0x1]=_0xe8c4a0['green'],_0x34b629[0x3*_0x5e0b9d+0x2]=_0xe8c4a0['blue'];}const _0x54e037={'context':_0x59a0d8,'width':_0x7158a,'height':0x1,'pixelFormat':Cesium$4[_0x5abe1f(0x1dc)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x5abe1f(0x216)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this[_0x5abe1f(0x1d9)]={'segmentsColor':Util['createTexture'](_0x1d8063),'segmentsDepth':Util[_0x5abe1f(0x1eb)](_0x476d6a),'currentTrailsColor':Util[_0x5abe1f(0x1eb)](_0x1d8063),'currentTrailsDepth':Util[_0x5abe1f(0x1eb)](_0x476d6a),'nextTrailsColor':Util['createTexture'](_0x1d8063),'nextTrailsDepth':Util['createTexture'](_0x476d6a),'colorTable':Util[_0x5abe1f(0x1eb)](_0x54e037,_0x34b629)};}[_0x572e14(0x1ea)](_0x55632c){const _0x2cee1b=_0x572e14;this['framebuffers']={'segments':Util['createFramebuffer'](_0x55632c,this['textures']['segmentsColor'],this[_0x2cee1b(0x1d9)]['segmentsDepth']),'currentTrails':Util[_0x2cee1b(0x203)](_0x55632c,this['textures'][_0x2cee1b(0x181)],this[_0x2cee1b(0x1d9)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x55632c,this['textures']['nextTrailsColor'],this[_0x2cee1b(0x1d9)][_0x2cee1b(0x1e3)])};}[_0x572e14(0x149)](_0x3f2570){const _0xb1cd28=_0x572e14,_0x5464cf=0x4;let _0x42f33a=[];for(let _0x2f33bd=0x0;_0x2f33bd<_0x3f2570['particlesTextureSize'];_0x2f33bd++){for(let _0x732a68=0x0;_0x732a68<_0x3f2570['particlesTextureSize'];_0x732a68++){for(let _0x2c6bb8=0x0;_0x2c6bb8<_0x5464cf;_0x2c6bb8++){_0x42f33a['push'](_0x2f33bd/_0x3f2570['particlesTextureSize']),_0x42f33a['push'](_0x732a68/_0x3f2570['particlesTextureSize']);}}}_0x42f33a=new Float32Array(_0x42f33a);let _0x560dec=[];const _0x49fcb7=[-0x1,0x1],_0x4c20e1=[-0x1,0x1];for(let _0x368418=0x0;_0x368418<_0x3f2570['maxParticles'];_0x368418++){for(let _0x40956c=0x0;_0x40956c<_0x5464cf/0x2;_0x40956c++){for(let _0x5abfec=0x0;_0x5abfec<_0x5464cf/0x2;_0x5abfec++){_0x560dec[_0xb1cd28(0x19c)](_0x49fcb7[_0x40956c]),_0x560dec['push'](_0x4c20e1[_0x5abfec]),_0x560dec['push'](0x0);}}}_0x560dec=new Float32Array(_0x560dec);const _0x5b65f1=0x6*_0x3f2570[_0xb1cd28(0x1cc)],_0x58c1d3=new Uint32Array(_0x5b65f1);for(let _0x161e41=0x0,_0x33e84d=0x0,_0x2da09a=0x0;_0x161e41<_0x3f2570['maxParticles'];_0x161e41++){_0x58c1d3[_0x33e84d++]=_0x2da09a+0x0,_0x58c1d3[_0x33e84d++]=_0x2da09a+0x1,_0x58c1d3[_0x33e84d++]=_0x2da09a+0x2,_0x58c1d3[_0x33e84d++]=_0x2da09a+0x2,_0x58c1d3[_0x33e84d++]=_0x2da09a+0x1,_0x58c1d3[_0x33e84d++]=_0x2da09a+0x3,_0x2da09a+=0x4;}const _0x4b6ea2=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x42f33a}),'normal':new Cesium$4[(_0xb1cd28(0x186))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x560dec})}),'indices':_0x58c1d3});return _0x4b6ea2;}['createRenderingPrimitives'](_0x471877,_0x584dc3,_0x45efc1,_0x5894cd){const _0xc9a3b8=_0x572e14,_0x105c32=this;this[_0xc9a3b8(0x19a)]={'segments':new CustomPrimitive({'commandType':_0xc9a3b8(0x20e),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0xc9a3b8(0x149)](_0x584dc3),'primitiveType':Cesium$4[_0xc9a3b8(0x13b)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x109f29=_0xc9a3b8;return _0x5894cd[_0x109f29(0x1b9)]['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x43b913=_0xc9a3b8;return _0x5894cd['particlesTextures'][_0x43b913(0x170)];},'postProcessingSpeed':function(){const _0x288f8c=_0xc9a3b8;return _0x5894cd[_0x288f8c(0x1b9)]['postProcessingSpeed'];},'colorTable':function(){return _0x105c32['textures']['colorTable'];},'aspect':function(){const _0x2684fc=_0xc9a3b8;return _0x471877[_0x2684fc(0x1f7)]/_0x471877[_0x2684fc(0x1ee)];},'pixelSize':function(){return _0x45efc1['pixelSize'];},'lineWidth':function(){return _0x584dc3['lineWidth'];},'particleHeight':function(){const _0x4807a3=_0xc9a3b8;return _0x584dc3[_0x4807a3(0x1ec)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x5d9fbf=_0xc9a3b8;return _0x105c32['textures'][_0x5d9fbf(0x1f0)];},'segmentsDepthTexture':function(){const _0x257a54=_0xc9a3b8;return _0x105c32[_0x257a54(0x1d9)]['segmentsDepth'];},'currentTrailsColor':function(){return _0x105c32['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x105c32['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x584dc3['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0xc9a3b8(0x14e))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0xc9a3b8(0x194)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x526720=_0xc9a3b8,_0x3cbf23=_0x105c32['framebuffers']['currentTrails'];_0x105c32['framebuffers'][_0x526720(0x189)]=_0x105c32[_0x526720(0x194)]['nextTrails'],_0x105c32['framebuffers']['nextTrails']=_0x3cbf23,_0x105c32['primitives']['trails']['commandToExecute']['framebuffer']=_0x105c32['framebuffers']['nextTrails'],_0x105c32['primitives'][_0x526720(0x1bf)][_0x526720(0x1f6)]['framebuffer']=_0x105c32['framebuffers'][_0x526720(0x200)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x105c32['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x3f9371=_0xc9a3b8;return _0x105c32['framebuffers'][_0x3f9371(0x200)]['depthTexture'];}},'vertexShaderSource':new Cesium$4[(_0xc9a3b8(0x14e))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0xc9a3b8(0x218)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';function _0x5a9a(){const _0x5c1379=['mode','mouseUp','fromCache','SCENE3D','FLOAT','canvasContext','refreshTimer','27132hzqlcv','windData','mouseDown','camera','cols','currentTrailsColor','mod','ymax','RGBA','ClearCommand','GeometryAttribute','shaderProgram','redraw','currentTrails','geometry','removeEventListener','color','38744xiBVcy','pointer-events','array','createParticlesTextures','updateViewerParameters','VertexArray','dimensions','framebuffers','west','particlesRendering','mouse_move','canvasResize','currentParticlesPosition','primitives','particleSystem','push','requestAnimationFrame','pointerEvents','particlesNumber','NEAREST','addEventListener','PrimitiveCollection','ComputeCommand','_map','max','pixelSize','CanvasWindLayer','ymin','worker','DEPTH_COMPONENT','currentParticlesSpeed','height','cos','BaseLayer','keys','PI_OVER_TWO','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','nextParticlesSpeed','dropRateBump','wheel','colors','setDate','vertexArray','visible','particlesTextures','_onMap_preRenderEvent','abs','pow','resize','_maxAge','trails','maxAge','vmax','data','setData','4349862yLmLvV','options','outputTexture','_onMouseMoveEvent','32aUEdUZ','uniformMap','windTextures','ZERO','maxParticles','120DkaIcI','10360VJfyxB','fixedHeight','Rectangle','canvas','clear','preRender','postMessage','_showHook','tlat','sqrt','createWindTextures','textures','sin','show','PixelFormat','fromGeometry','age','PixelDatatype','style','mouseMove','remove','nextTrailsDepth','umax','vdata','lat','_pointerEvents','animateFrame','getOwnPropertyDescriptor','createRenderingFramebuffers','createTexture','particleHeight','toDegrees','drawingBufferHeight','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','segmentsColor','PI_OVER_THREE','east','updateSpeed','UNSIGNED_INT','clientWidth','clearCommand','drawingBufferWidth','speed','particlesComputing','length','_removedHook','BufferUsage','lineWidth','viewRectangleToLonLatRange','segments','nextTrails','hidden','postProcessingSpeed','createFramebuffer','toGridXY','RenderState','viewerParameters','bindEvent','toRadians','clearFramebuffers','46715VxAYdR','udata','_setOptionsHook','getUVByXY','Draw','lev','canvasWidth','_addedHook','south','vertexShaderSource','_onMapWhellEvent','speedRate','TextureMinificationFilter','ComponentDatatype','createRawRenderState','TWO_PI','min','getRandomLatLng','latRange','_updateIng','mouseHidden','destroyParticlesTextures','none','307030vUfAiN','_data','nextParticlesPosition','createComputingPrimitives','PrimitiveType','globeBoundingSphere','width','_colorRamp','Math','destroy','WindLayer','particlesTextureSize','attributeLocations','onmessage','auto','randomBetween','#ffffff','randomizeParticles','createSegmentsGeometry','setOptions','blending','commandToExecute','random','ShaderSource','Cartesian3','reverseY','lng','LayerUtil','clampToLatitudeRange','_canrefresh','xmin','preExecute','mouse_down','windField','canvasHeight','xmax','1673664IcmEuO','rows','_calc_speedRate','DomUtil','_speedRate','rawRenderState','globalCompositeOperation','levmin','layer','add','colorTable','forEach','grid','EventType','zIndex','getUVByPoint','scene','Texture','off','Compute','getParticles','postProcessingPosition','particles','context','Sampler','getPixelSize'];_0x5a9a=function(){return _0x5c1379;};return _0x5a9a();}const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x3e4ea8,_0x23ed8d,_0x50e8d7,_0x3282db){const _0x7cd4a4=_0x572e14;this['data']=_0x23ed8d,this[_0x7cd4a4(0x1d8)](_0x3e4ea8,_0x23ed8d),this[_0x7cd4a4(0x190)](_0x3e4ea8,_0x50e8d7,_0x3282db),this[_0x7cd4a4(0x13a)](_0x23ed8d,_0x50e8d7,_0x3282db);}['createWindTextures'](_0x243b53,_0xf94905){const _0x44ab50=_0x572e14,_0x523533={'context':_0x243b53,'width':_0xf94905['dimensions']['lon'],'height':_0xf94905['dimensions']['lat']*(_0xf94905['dimensions'][_0x44ab50(0x20f)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3[(_0x44ab50(0x173))]({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this[_0x44ab50(0x1ca)]={'U':Util[_0x44ab50(0x1eb)](_0x523533,_0xf94905['U']['array']),'V':Util['createTexture'](_0x523533,_0xf94905['V']['array'])};}['createParticlesTextures'](_0x2ddb78,_0x2007ec,_0x307a7b){const _0x4a1e96=_0x572e14,_0x13dcc3={'context':_0x2ddb78,'width':_0x2007ec['particlesTextureSize'],'height':_0x2007ec[_0x4a1e96(0x142)],'pixelFormat':Cesium$3['PixelFormat'][_0x4a1e96(0x184)],'pixelDatatype':Cesium$3['PixelDatatype'][_0x4a1e96(0x179)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x4a1e96(0x216)][_0x4a1e96(0x1a0)],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x4a1e96(0x1a0)]})},_0x2b6f32=this['randomizeParticles'](_0x2007ec['maxParticles'],_0x307a7b),_0x5a7c35=new Float32Array(0x4*_0x2007ec['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x13dcc3),'currentParticlesPosition':Util['createTexture'](_0x13dcc3,_0x2b6f32),'nextParticlesPosition':Util['createTexture'](_0x13dcc3,_0x2b6f32),'currentParticlesSpeed':Util[_0x4a1e96(0x1eb)](_0x13dcc3,_0x5a7c35),'nextParticlesSpeed':Util['createTexture'](_0x13dcc3,_0x5a7c35),'postProcessingPosition':Util['createTexture'](_0x13dcc3,_0x2b6f32),'postProcessingSpeed':Util['createTexture'](_0x13dcc3,_0x5a7c35)};}[_0x572e14(0x148)](_0x237806,_0x101cdf){const _0x1f90ea=_0x572e14,_0x410f74=new Float32Array(0x4*_0x237806);for(let _0x26710e=0x0;_0x26710e<_0x237806;_0x26710e++){_0x410f74[0x4*_0x26710e]=Cesium$3[_0x1f90ea(0x13f)]['randomBetween'](_0x101cdf['lonRange']['x'],_0x101cdf['lonRange']['y']),_0x410f74[0x4*_0x26710e+0x1]=Cesium$3[_0x1f90ea(0x13f)][_0x1f90ea(0x146)](_0x101cdf['latRange']['x'],_0x101cdf['latRange']['y']),_0x410f74[0x4*_0x26710e+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data']['lev'][_0x1f90ea(0x1a5)]),_0x410f74[0x4*_0x26710e+0x3]=0x0;}return _0x410f74;}[_0x572e14(0x135)](){const _0x73e136=_0x572e14;Object[_0x73e136(0x1af)](this[_0x73e136(0x1b9)])['forEach'](_0x3a5fda=>{this['particlesTextures'][_0x3a5fda]['destroy']();});}['createComputingPrimitives'](_0x4675a8,_0x1cf4b3,_0x260d05){const _0x324c9e=_0x572e14,_0x27d7f1=new Cesium$3[(_0x324c9e(0x14f))](_0x4675a8[_0x324c9e(0x193)]['lon'],_0x4675a8['dimensions']['lat'],_0x4675a8['dimensions'][_0x324c9e(0x20f)]),_0x132c0f=new Cesium$3[(_0x324c9e(0x14f))](_0x4675a8['lon']['min'],_0x4675a8['lat']['min'],_0x4675a8[_0x324c9e(0x20f)][_0x324c9e(0x130)]),_0x3e7940=new Cesium$3['Cartesian3'](_0x4675a8['lon']['max'],_0x4675a8['lat']['max'],_0x4675a8['lev'][_0x324c9e(0x1a5)]),_0x27287f=new Cesium$3[(_0x324c9e(0x14f))]((_0x3e7940['x']-_0x132c0f['x'])/(_0x27d7f1['x']-0x1),(_0x3e7940['y']-_0x132c0f['y'])/(_0x27d7f1['y']-0x1),_0x27d7f1['z']>0x1?(_0x3e7940['z']-_0x132c0f['z'])/(_0x27d7f1['z']-0x1):0x1),_0x53e077=new Cesium$3['Cartesian2'](_0x4675a8['U']['min'],_0x4675a8['U']['max']),_0x4f6e93=new Cesium$3['Cartesian2'](_0x4675a8['V']['min'],_0x4675a8['V']['max']),_0x369b25=this;this[_0x324c9e(0x19a)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x369b25['windTextures']['U'];},'V':function(){const _0x5defd7=_0x324c9e;return _0x369b25[_0x5defd7(0x1ca)]['V'];},'currentParticlesPosition':function(){const _0x38f397=_0x324c9e;return _0x369b25[_0x38f397(0x1b9)][_0x38f397(0x199)];},'dimension':function(){return _0x27d7f1;},'minimum':function(){return _0x132c0f;},'maximum':function(){return _0x3e7940;},'interval':function(){return _0x27287f;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x395c58=_0x324c9e;_0x369b25['primitives']['getWind']['commandToExecute']['outputTexture']=_0x369b25[_0x395c58(0x1b9)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x27408a=_0x324c9e;return _0x369b25['particlesTextures'][_0x27408a(0x1ab)];},'particlesWind':function(){return _0x369b25['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x53e077;},'vSpeedRange':function(){return _0x4f6e93;},'pixelSize':function(){const _0x3851a1=_0x324c9e;return _0x260d05[_0x3851a1(0x1a6)];},'speedFactor':function(){return _0x1cf4b3['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x324c9e(0x14e))]({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x4a78e9=_0x324c9e,_0x5c1e1f=_0x369b25[_0x4a78e9(0x1b9)][_0x4a78e9(0x1ab)];_0x369b25['particlesTextures']['currentParticlesSpeed']=_0x369b25['particlesTextures']['postProcessingSpeed'],_0x369b25['particlesTextures']['postProcessingSpeed']=_0x5c1e1f,_0x369b25['primitives']['updateSpeed']['commandToExecute'][_0x4a78e9(0x1c6)]=_0x369b25['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x324c9e(0x16e),'uniformMap':{'currentParticlesPosition':function(){const _0x3b7fae=_0x324c9e;return _0x369b25[_0x3b7fae(0x1b9)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x1bc857=_0x324c9e;return _0x369b25[_0x1bc857(0x1b9)][_0x1bc857(0x1ab)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x4beeb7=_0x324c9e,_0x21e122=_0x369b25[_0x4beeb7(0x1b9)]['currentParticlesPosition'];_0x369b25['particlesTextures'][_0x4beeb7(0x199)]=_0x369b25['particlesTextures']['postProcessingPosition'],_0x369b25[_0x4beeb7(0x1b9)]['postProcessingPosition']=_0x21e122,_0x369b25['primitives']['updatePosition'][_0x4beeb7(0x14c)]['outputTexture']=_0x369b25['particlesTextures'][_0x4beeb7(0x139)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x324c9e(0x16e),'uniformMap':{'nextParticlesPosition':function(){const _0x5dc5ea=_0x324c9e;return _0x369b25['particlesTextures'][_0x5dc5ea(0x139)];},'nextParticlesSpeed':function(){return _0x369b25['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x260d05['lonRange'];},'latRange':function(){return _0x260d05['latRange'];},'randomCoefficient':function(){const _0x5a93dd=_0x324c9e,_0x4dff05=Math[_0x5a93dd(0x14d)]();return _0x4dff05;},'dropRate':function(){return _0x1cf4b3['dropRate'];},'dropRateBump':function(){return _0x1cf4b3['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x324c9e(0x14e))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x324c9e(0x170)],'preExecute':function(){const _0x4f25b2=_0x324c9e;_0x369b25['primitives']['postProcessingPosition'][_0x4f25b2(0x14c)]['outputTexture']=_0x369b25[_0x4f25b2(0x1b9)][_0x4f25b2(0x170)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x369b25['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x3c2651=_0x324c9e;return _0x369b25[_0x3c2651(0x1b9)][_0x3c2651(0x1b2)];}},'fragmentShaderSource':new Cesium$3[(_0x324c9e(0x14e))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x324c9e(0x202)],'preExecute':function(){_0x369b25['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x369b25['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x36dd9d,_0x8b4d79,_0xe46858,_0x552541){const _0xdc9f53=_0x572e14;this['context']=_0x36dd9d,_0x8b4d79={..._0x8b4d79},_0x8b4d79[_0xdc9f53(0x20b)]&&_0x8b4d79['vdata']&&(_0x8b4d79['dimensions']={},_0x8b4d79[_0xdc9f53(0x193)]['lon']=_0x8b4d79['cols'],_0x8b4d79[_0xdc9f53(0x193)]['lat']=_0x8b4d79[_0xdc9f53(0x15c)],_0x8b4d79['dimensions'][_0xdc9f53(0x20f)]=_0x8b4d79['lev']||0x1,_0x8b4d79['lon']={},_0x8b4d79['lon']['min']=_0x8b4d79['xmin'],_0x8b4d79['lon'][_0xdc9f53(0x1a5)]=_0x8b4d79['xmax'],_0x8b4d79['lat']={},_0x8b4d79['lat']['min']=_0x8b4d79['ymin'],_0x8b4d79['lat']['max']=_0x8b4d79['ymax'],_0x8b4d79['lev']={},_0x8b4d79[_0xdc9f53(0x20f)]['min']=_0x8b4d79[_0xdc9f53(0x162)]??0x1,_0x8b4d79[_0xdc9f53(0x20f)]['max']=_0x8b4d79['levmax']??0x1,_0x8b4d79['U']={},_0x8b4d79['U']['array']=new Float32Array(_0x8b4d79['udata']),_0x8b4d79['U']['min']=_0x8b4d79['umin']??Math['min'](..._0x8b4d79['udata']),_0x8b4d79['U']['max']=_0x8b4d79[_0xdc9f53(0x1e4)]??Math[_0xdc9f53(0x1a5)](..._0x8b4d79['udata']),_0x8b4d79['V']={},_0x8b4d79['V'][_0xdc9f53(0x18f)]=new Float32Array(_0x8b4d79[_0xdc9f53(0x1e5)]),_0x8b4d79['V']['min']=_0x8b4d79['vmin']??Math['min'](..._0x8b4d79[_0xdc9f53(0x1e5)]),_0x8b4d79['V']['max']=_0x8b4d79[_0xdc9f53(0x1c1)]??Math['max'](..._0x8b4d79['vdata'])),this['data']=_0x8b4d79,this['options']=_0xe46858,this[_0xdc9f53(0x206)]=_0x552541,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0xdc9f53(0x1c2)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0xdc9f53(0x172)],this['data'],this[_0xdc9f53(0x1c5)],this[_0xdc9f53(0x206)],this['particlesComputing']);}['canvasResize'](_0x52f686){const _0xecd869=_0x572e14;this[_0xecd869(0x1f9)]['destroyParticlesTextures'](),Object['keys'](this[_0xecd869(0x1f9)]['windTextures'])['forEach'](_0x3e61bb=>{const _0x5713e4=_0xecd869;this['particlesComputing']['windTextures'][_0x3e61bb][_0x5713e4(0x140)]();}),this[_0xecd869(0x196)]['textures'][_0xecd869(0x165)]['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x13e496=>{this['particlesRendering']['framebuffers'][_0x13e496]['destroy']();}),this['context']=_0x52f686,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0xecd869(0x196)]=new ParticlesRendering(this[_0xecd869(0x172)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x572e14(0x209)](){const _0x2412ad=_0x572e14,_0x29d64a=new Cesium$2[(_0x2412ad(0x185))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x2412ad(0x1af)](this['particlesRendering']['framebuffers'])['forEach'](_0x3e3a79=>{_0x29d64a['framebuffer']=this['particlesRendering']['framebuffers'][_0x3e3a79],_0x29d64a['execute'](this['context']);});}['refreshParticles'](_0x274704){const _0x4236df=_0x572e14;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this[_0x4236df(0x172)],this['options'],this[_0x4236df(0x206)]);if(_0x274704){var _0x445fc7;const _0x22c3ab=this[_0x4236df(0x196)]['createSegmentsGeometry'](this[_0x4236df(0x1c5)]);this['particlesRendering']['primitives']['segments']['geometry']=_0x22c3ab;const _0x1498aa=Cesium$2[_0x4236df(0x192)]['fromGeometry']({'context':this[_0x4236df(0x172)],'geometry':_0x22c3ab,'attributeLocations':this[_0x4236df(0x196)][_0x4236df(0x19a)]['segments'][_0x4236df(0x143)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x445fc7=this['particlesRendering']['primitives'])!==null&&_0x445fc7!==void 0x0&&(_0x445fc7=_0x445fc7[_0x4236df(0x1ff)])!==null&&_0x445fc7!==void 0x0&&_0x445fc7['commandToExecute']&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x1498aa);}}['setOptions'](_0x56d37d){const _0x204ad8=_0x572e14;let _0x48af50=![];this['options']['maxParticles']!==_0x56d37d['maxParticles']&&(_0x48af50=!![]),Object['keys'](_0x56d37d)[_0x204ad8(0x166)](_0x23d5d9=>{this['options'][_0x23d5d9]=_0x56d37d[_0x23d5d9];}),this['refreshParticles'](_0x48af50);}['applyViewerParameters'](_0x4f1d15){Object['keys'](_0x4f1d15)['forEach'](_0x85acc8=>{const _0x4ead0a=_0x5c9e;this[_0x4ead0a(0x206)][_0x85acc8]=_0x4f1d15[_0x85acc8];}),this['refreshParticles'](![]);}['destroy'](){const _0x26e143=_0x572e14;clearTimeout(this['canrefresh']),this['particlesComputing'][_0x26e143(0x135)](),Object['keys'](this['particlesComputing']['windTextures'])[_0x26e143(0x166)](_0x562f61=>{const _0x5701ea=_0x26e143;this[_0x5701ea(0x1f9)]['windTextures'][_0x562f61]['destroy']();}),this['particlesRendering']['textures'][_0x26e143(0x165)]['destroy'](),Object['keys'](this['particlesRendering'][_0x26e143(0x194)])['forEach'](_0x31477f=>{const _0x23f2ef=_0x26e143;this['particlesRendering']['framebuffers'][_0x31477f][_0x23f2ef(0x140)]();});for(const _0xa4130d in this){delete this[_0xa4130d];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x572e14(0x163)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x453eed={}){_0x453eed={...DEF_OPTIONS,..._0x453eed},super(_0x453eed),this['_setOptionsHook'](_0x453eed);}get[_0x572e14(0x163)](){const _0x4d33a5=_0x572e14;return this[_0x4d33a5(0x19a)];}get['data'](){const _0x2286d9=_0x572e14;return this[_0x2286d9(0x138)];}set[_0x572e14(0x1c2)](_0x27e940){this['setData'](_0x27e940);}get[_0x572e14(0x1b5)](){const _0xdc9773=_0x572e14;return this['options'][_0xdc9773(0x1b5)];}set[_0x572e14(0x1b5)](_0x27801a){const _0x5dc554=_0x572e14;this['options'][_0x5dc554(0x1b5)]=_0x27801a,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x27801a}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x63e29b=_0x572e14;this[_0x63e29b(0x16b)]=this['_map']['scene'],this['camera']=this['_map'][_0x63e29b(0x17f)],this['primitives']=new Cesium$1[(_0x63e29b(0x1a2))](),this['_map']['scene']['primitives']['add'](this[_0x63e29b(0x19a)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x63e29b(0x13c)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x63e29b(0x1cb)],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x63e29b(0x1a4)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x63e29b(0x176)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}[_0x572e14(0x1fb)](){const _0x4940f9=_0x572e14;window[_0x4940f9(0x18b)]('resize',this[_0x4940f9(0x1bd)]),this[_0x4940f9(0x1a4)]['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this[_0x4940f9(0x1a4)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x4940f9(0x1a4)]['off'](mars3d__namespace['EventType'][_0x4940f9(0x176)],this['_onMouseUpEvent'],this),this[_0x4940f9(0x1a4)]['off'](mars3d__namespace[_0x4940f9(0x168)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x4940f9(0x1a4)]['scene']['primitives'][_0x4940f9(0x1e2)](this[_0x4940f9(0x19a)]);}[_0x572e14(0x1bd)](){const _0x13b72d=_0x572e14;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType'][_0x13b72d(0x1d3)],this['_onMap_preRenderEvent'],this);}[_0x572e14(0x1ba)](_0x525e5a){const _0x222a1a=_0x572e14;this[_0x222a1a(0x19b)][_0x222a1a(0x198)](this[_0x222a1a(0x16b)]['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x572e14(0x214)](_0xa5c999){const _0x54f39d=_0x572e14;clearTimeout(this[_0x54f39d(0x17b)]);if(!this['show']||!this[_0x54f39d(0x19b)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x5a7f6c=_0x54f39d;if(!this['show'])return;this[_0x5a7f6c(0x188)]();},0xc8);}['_onMouseDownEvent'](_0x206e45){this['mouse_down']=!![];}[_0x572e14(0x1c7)](_0xbe6496){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0xeb390c){const _0x599bc9=_0x572e14;if(!this[_0x599bc9(0x1db)]||!this['particleSystem'])return;this[_0x599bc9(0x157)]&&this[_0x599bc9(0x197)]&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}[_0x572e14(0x188)](){if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x5dbed2){this['_data']=_0x5dbed2,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x5dbed2,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x274129,_0x3db2d8){if(_0x274129)for(const _0x3b9725 in _0x274129){this[_0x3b9725]=_0x274129[_0x3b9725];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x140360=_0x572e14,_0x338221=Math['ceil'](Math[_0x140360(0x1d7)](this['particlesNumber']));return this['particlesNumber']=_0x338221*_0x338221,{'particlesTextureSize':_0x338221,'maxParticles':this['particlesNumber'],'particleHeight':this[_0x140360(0x1cf)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this[_0x140360(0x1b3)],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x2ba5ce=_0x572e14;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this[_0x2ba5ce(0x19a)]['add'](this[_0x2ba5ce(0x19b)]['particlesComputing'][_0x2ba5ce(0x19a)][_0x2ba5ce(0x1f3)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x2ba5ce(0x19a)]['updatePosition']),this[_0x2ba5ce(0x19a)]['add'](this[_0x2ba5ce(0x19b)][_0x2ba5ce(0x1f9)]['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x2ba5ce(0x1f9)][_0x2ba5ce(0x19a)][_0x2ba5ce(0x202)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this[_0x2ba5ce(0x19a)]['add'](this['particleSystem']['particlesRendering']['primitives']['trails']),this['primitives'][_0x2ba5ce(0x164)](this[_0x2ba5ce(0x19b)]['particlesRendering']['primitives']['screen']);}[_0x572e14(0x191)](){const _0x1c6590=_0x572e14;let _0x56cab8=this['camera']['computeViewRectangle'](this[_0x1c6590(0x16b)]['globe']['ellipsoid']);if(!_0x56cab8){const _0x19ad04=this[_0x1c6590(0x1a4)]['getExtent']();_0x56cab8=Cesium$1[_0x1c6590(0x1d0)]['fromDegrees'](_0x19ad04[_0x1c6590(0x155)],_0x19ad04[_0x1c6590(0x1a8)],_0x19ad04['xmax'],_0x19ad04['ymax']);}const _0x180d15=Util[_0x1c6590(0x1fe)](_0x56cab8);this['viewerParameters']['lonRange']['x']=_0x180d15['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x180d15['lon']['max'],this[_0x1c6590(0x206)][_0x1c6590(0x132)]['x']=_0x180d15['lat']['min'],this['viewerParameters']['latRange']['y']=_0x180d15['lat']['max'];const _0x4baad9=this['camera'][_0x1c6590(0x174)](this[_0x1c6590(0x13c)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x4baad9>0x0&&(this['viewerParameters']['pixelSize']=_0x4baad9);}}mars3d__namespace[_0x572e14(0x152)]['register']('wind',WindLayer),mars3d__namespace[_0x572e14(0x163)][_0x572e14(0x141)]=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}[_0x572e14(0x140)](){for(const _0x45afee in this){delete this[_0x45afee];}}}class CanvasWindField{constructor(_0x24a4bb){this['setOptions'](_0x24a4bb);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x22f7c4){const _0x472220=_0x572e14;this['_speedRate']=(0x64-(_0x22f7c4>0x63?0x63:_0x22f7c4))*0x64,this[_0x472220(0x15d)]=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x472220(0x1a8)])/this[_0x472220(0x15f)]];}get[_0x572e14(0x1c0)](){return this['_maxAge'];}set['maxAge'](_0xc7e259){const _0x3e243c=_0x572e14;this[_0x3e243c(0x1be)]=_0xc7e259;}['setOptions'](_0x2d62a2){const _0x575208=_0x572e14;this['options']=_0x2d62a2,this[_0x575208(0x1c0)]=_0x2d62a2['maxAge']||0x78,this['speedRate']=_0x2d62a2['speedRate']||0x32,this['particles']=[];const _0x33b8fa=_0x2d62a2['particlesNumber']||0x1000;for(let _0x360c97=0x0;_0x360c97<_0x33b8fa;_0x360c97++){const _0x2368f8=this['_randomParticle'](new CanvasParticle());this[_0x575208(0x171)]['push'](_0x2368f8);}}[_0x572e14(0x1b6)](_0x429e86){const _0x22cb0b=_0x572e14;this['rows']=_0x429e86['rows'],this[_0x22cb0b(0x180)]=_0x429e86['cols'],this['xmin']=_0x429e86['xmin'],this['xmax']=_0x429e86[_0x22cb0b(0x15a)],this['ymin']=_0x429e86['ymin'],this['ymax']=_0x429e86[_0x22cb0b(0x183)],this['grid']=[];const _0x28c7e4=_0x429e86['udata'],_0x2c4c14=_0x429e86['vdata'];let _0x4ba4c8=![];_0x28c7e4['length']===this[_0x22cb0b(0x15c)]&&_0x28c7e4[0x0][_0x22cb0b(0x1fa)]===this['cols']&&(_0x4ba4c8=!![]);let _0x2cbdf9=0x0,_0x51808a=null,_0x51c8af=null;for(let _0xa7242c=0x0;_0xa7242c<this['rows'];_0xa7242c++){_0x51808a=[];for(let _0x1d68b9=0x0;_0x1d68b9<this['cols'];_0x1d68b9++,_0x2cbdf9++){_0x4ba4c8?_0x51c8af=this['_calcUV'](_0x28c7e4[_0xa7242c][_0x1d68b9],_0x2c4c14[_0xa7242c][_0x1d68b9]):_0x51c8af=this['_calcUV'](_0x28c7e4[_0x2cbdf9],_0x2c4c14[_0x2cbdf9]),_0x51808a['push'](_0x51c8af);}this['grid']['push'](_0x51808a);}this['options'][_0x22cb0b(0x150)]&&this['grid']['reverse']();}['clear'](){const _0x1ff536=_0x572e14;delete this[_0x1ff536(0x15c)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0x1ff536(0x183)],delete this[_0x1ff536(0x167)],delete this['particles'];}[_0x572e14(0x204)](_0x5b3f69,_0x42cf31){const _0x457baa=_0x572e14,_0x57082e=(_0x5b3f69-this[_0x457baa(0x155)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x545a02=(this['ymax']-_0x42cf31)/(this[_0x457baa(0x183)]-this[_0x457baa(0x1a8)])*(this['rows']-0x1);return[_0x57082e,_0x545a02];}['getUVByXY'](_0x400ab4,_0x776a73){const _0xffc29f=_0x572e14;if(_0x400ab4<0x0||_0x400ab4>=this[_0xffc29f(0x180)]||_0x776a73>=this['rows'])return[0x0,0x0,0x0];const _0x14adbd=Math['floor'](_0x400ab4),_0x3431e7=Math['floor'](_0x776a73);if(_0x14adbd===_0x400ab4&&_0x3431e7===_0x776a73)return this['grid'][_0x776a73][_0x400ab4];const _0x3ad7ec=_0x14adbd+0x1,_0x4c5ee9=_0x3431e7+0x1,_0x2e1aa7=this['getUVByXY'](_0x14adbd,_0x3431e7),_0x5a15dd=this[_0xffc29f(0x20d)](_0x3ad7ec,_0x3431e7),_0x57cfd4=this['getUVByXY'](_0x14adbd,_0x4c5ee9),_0x3da58b=this['getUVByXY'](_0x3ad7ec,_0x4c5ee9);let _0x104aa5=null;try{_0x104aa5=this['_bilinearInterpolation'](_0x400ab4-_0x14adbd,_0x776a73-_0x3431e7,_0x2e1aa7,_0x5a15dd,_0x57cfd4,_0x3da58b);}catch(_0x4d1105){console['log'](_0x400ab4,_0x776a73);}return _0x104aa5;}['_bilinearInterpolation'](_0x2fbaa0,_0x445b03,_0x353348,_0x1a44b8,_0x45ba22,_0x1d7382){const _0x3f3e43=0x1-_0x2fbaa0,_0x18d6e6=0x1-_0x445b03,_0x2699fa=_0x3f3e43*_0x18d6e6,_0x4f45fc=_0x2fbaa0*_0x18d6e6,_0x4bc4ba=_0x3f3e43*_0x445b03,_0x24e309=_0x2fbaa0*_0x445b03,_0x318f37=_0x353348[0x0]*_0x2699fa+_0x1a44b8[0x0]*_0x4f45fc+_0x45ba22[0x0]*_0x4bc4ba+_0x1d7382[0x0]*_0x24e309,_0x47155b=_0x353348[0x1]*_0x2699fa+_0x1a44b8[0x1]*_0x4f45fc+_0x45ba22[0x1]*_0x4bc4ba+_0x1d7382[0x1]*_0x24e309;return this['_calcUV'](_0x318f37,_0x47155b);}['_calcUV'](_0x2cf8d8,_0x4fd816){return[+_0x2cf8d8,+_0x4fd816,Math['sqrt'](_0x2cf8d8*_0x2cf8d8+_0x4fd816*_0x4fd816)];}[_0x572e14(0x16a)](_0x495808,_0x1d2585){const _0x389a30=_0x572e14;if(!this['isInExtent'](_0x495808,_0x1d2585))return null;const _0x599473=this[_0x389a30(0x204)](_0x495808,_0x1d2585),_0xd4e9e3=this['getUVByXY'](_0x599473[0x0],_0x599473[0x1]);return _0xd4e9e3;}['isInExtent'](_0x108818,_0x30685f){return _0x108818>=this['xmin']&&_0x108818<=this['xmax']&&_0x30685f>=this['ymin']&&_0x30685f<=this['ymax']?!![]:![];}[_0x572e14(0x131)](){const _0x40e17d=_0x572e14,_0x200919=fRandomByfloat(this[_0x40e17d(0x155)],this['xmax']),_0x42122c=fRandomByfloat(this[_0x40e17d(0x1a8)],this['ymax']);return{'lat':_0x42122c,'lng':_0x200919};}['getParticles'](){const _0x2e0fea=_0x572e14;let _0x510b15,_0x5b41b4,_0x3c0f69;for(let _0x42e6a6=0x0,_0x396c0a=this['particles']['length'];_0x42e6a6<_0x396c0a;_0x42e6a6++){let _0x6c30e8=this[_0x2e0fea(0x171)][_0x42e6a6];_0x6c30e8[_0x2e0fea(0x1de)]<=0x0&&(_0x6c30e8=this['_randomParticle'](_0x6c30e8));if(_0x6c30e8['age']>0x0){const _0x5093fb=_0x6c30e8['tlng'],_0x4e23bc=_0x6c30e8['tlat'];_0x3c0f69=this['getUVByPoint'](_0x5093fb,_0x4e23bc),_0x3c0f69?(_0x510b15=_0x5093fb+this['_calc_speedRate'][0x0]*_0x3c0f69[0x0],_0x5b41b4=_0x4e23bc+this['_calc_speedRate'][0x1]*_0x3c0f69[0x1],_0x6c30e8[_0x2e0fea(0x151)]=_0x5093fb,_0x6c30e8['lat']=_0x4e23bc,_0x6c30e8['tlng']=_0x510b15,_0x6c30e8['tlat']=_0x5b41b4,_0x6c30e8[_0x2e0fea(0x1f8)]=_0x3c0f69[0x2],_0x6c30e8[_0x2e0fea(0x1de)]--):_0x6c30e8['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x84d278){const _0x232102=_0x572e14;let _0x49a7b9,_0x334e88;for(let _0x588029=0x0;_0x588029<0x1e;_0x588029++){_0x49a7b9=this['getRandomLatLng'](),_0x334e88=this['getUVByPoint'](_0x49a7b9[_0x232102(0x151)],_0x49a7b9['lat']);if(_0x334e88&&_0x334e88[0x2]>0x0)break;}if(!_0x334e88)return _0x84d278;const _0x66df2d=_0x49a7b9[_0x232102(0x151)]+this['_calc_speedRate'][0x0]*_0x334e88[0x0],_0x403cee=_0x49a7b9['lat']+this['_calc_speedRate'][0x1]*_0x334e88[0x1];return _0x84d278[_0x232102(0x151)]=_0x49a7b9[_0x232102(0x151)],_0x84d278[_0x232102(0x1e6)]=_0x49a7b9[_0x232102(0x1e6)],_0x84d278['tlng']=_0x66df2d,_0x84d278['tlat']=_0x403cee,_0x84d278['age']=Math['round'](Math[_0x232102(0x14d)]()*this['maxAge']),_0x84d278['speed']=_0x334e88[0x2],_0x84d278;}['destroy'](){for(const _0x315b0f in this){delete this[_0x315b0f];}}}function _0x5c9e(_0x3fe363,_0x564e46){const _0x5a9a4c=_0x5a9a();return _0x5c9e=function(_0x5c9e8f,_0x43e482){_0x5c9e8f=_0x5c9e8f-0x12f;let _0x83b046=_0x5a9a4c[_0x5c9e8f];return _0x83b046;},_0x5c9e(_0x3fe363,_0x564e46);}function fRandomByfloat(_0x6974b5,_0x98299f){const _0x3e816e=_0x572e14;return _0x6974b5+Math[_0x3e816e(0x14d)]()*(_0x98299f-_0x6974b5);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x572e14(0x1ae)];class CanvasWindLayer extends BaseLayer{constructor(_0x4ab6c3={}){const _0x5c2430=_0x572e14;super(_0x4ab6c3),this[_0x5c2430(0x20c)](_0x4ab6c3),this['canvas']=null,_0x4ab6c3['colors']&&_0x4ab6c3['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x4ab6c3));}['_setOptionsHook'](_0x3d0c2d,_0x5b2c86){const _0x1d17cd=_0x572e14;this['frameTime']=0x3e8/(_0x3d0c2d['frameRate']||0xa),this[_0x1d17cd(0x1e7)]=this['options'][_0x1d17cd(0x19e)]??![],this[_0x1d17cd(0x18c)]=_0x3d0c2d['color']||_0x1d17cd(0x147),this['lineWidth']=_0x3d0c2d['lineWidth']||0x1,this[_0x1d17cd(0x1cf)]=_0x3d0c2d[_0x1d17cd(0x1cf)]??0x0,this['reverseY']=_0x3d0c2d[_0x1d17cd(0x150)]??![],this['windField']&&this['windField']['setOptions'](_0x3d0c2d);}get[_0x572e14(0x163)](){return this['canvas'];}get[_0x572e14(0x210)](){const _0xeffaa0=_0x572e14;return this['_map']['scene']['canvas'][_0xeffaa0(0x1f5)];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x1360b6){const _0x5e9b09=_0x572e14;this[_0x5e9b09(0x1e7)]=_0x1360b6;if(!this[_0x5e9b09(0x1d1)])return;_0x1360b6?this['canvas'][_0x5e9b09(0x1e0)][_0x5e9b09(0x18e)]='all':this['canvas'][_0x5e9b09(0x1e0)]['pointer-events']=_0x5e9b09(0x136);}get['particlesNumber'](){return this['options']['particlesNumber'];}set[_0x572e14(0x19f)](_0x560f1c){const _0x2efe15=_0x572e14;this['options'][_0x2efe15(0x19f)]=_0x560f1c,clearTimeout(this[_0x2efe15(0x154)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x15b6b4=_0x572e14;return this[_0x15b6b4(0x1c5)][_0x15b6b4(0x215)];}set[_0x572e14(0x215)](_0x9e24ac){this['options']['speedRate']=_0x9e24ac,this['windField']&&(this['windField']['speedRate']=_0x9e24ac);}get[_0x572e14(0x1c0)](){const _0x57fe60=_0x572e14;return this[_0x57fe60(0x1c5)]['maxAge'];}set['maxAge'](_0x1b7423){const _0x592ab6=_0x572e14;this['options'][_0x592ab6(0x1c0)]=_0x1b7423,this['windField']&&(this[_0x592ab6(0x158)]['maxAge']=_0x1b7423);}get[_0x572e14(0x1c2)](){return this['windData'];}set['data'](_0x52c3f7){this['setData'](_0x52c3f7);}[_0x572e14(0x1d5)](_0x400dce){const _0x3a8f9d=_0x572e14;_0x400dce?this['_addedHook']():(this['windData']&&(this[_0x3a8f9d(0x1c5)][_0x3a8f9d(0x1c2)]=this['windData']),this[_0x3a8f9d(0x1fb)]());}['_mountedHook'](){const _0x39b638=_0x572e14;this[_0x39b638(0x1c5)]['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x572e14(0x211)](){const _0x392829=_0x572e14;this[_0x392829(0x1d1)]=this['_createCanvas'](),this['canvasContext']=this[_0x392829(0x1d1)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x392829(0x1c3)](this['options'][_0x392829(0x1c2)]);}[_0x572e14(0x1fb)](){const _0x26c97f=_0x572e14;this[_0x26c97f(0x1d2)](),this['unbindEvent'](),this['canvas']&&(this[_0x26c97f(0x1a4)]['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x5a9bb2=_0x572e14,_0x4cfd4b=mars3d__namespace[_0x5a9bb2(0x15e)]['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x4cfd4b['style']['position']='absolute',_0x4cfd4b[_0x5a9bb2(0x1e0)]['top']='0px',_0x4cfd4b['style']['left']='0px',_0x4cfd4b['style']['width']=this['_map'][_0x5a9bb2(0x16b)]['canvas'][_0x5a9bb2(0x1f5)]+'px',_0x4cfd4b['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x4cfd4b['style']['pointerEvents']=this[_0x5a9bb2(0x1e7)]?_0x5a9bb2(0x145):_0x5a9bb2(0x136),_0x4cfd4b['style'][_0x5a9bb2(0x169)]=this['options']['zIndex']??0x9,_0x4cfd4b[_0x5a9bb2(0x13d)]=this['_map']['scene']['canvas'][_0x5a9bb2(0x1f5)],_0x4cfd4b['height']=this[_0x5a9bb2(0x1a4)]['scene'][_0x5a9bb2(0x1d1)]['clientHeight'],_0x4cfd4b;}[_0x572e14(0x1bd)](){const _0x451573=_0x572e14;this['canvas']&&(this['canvas']['style'][_0x451573(0x13d)]=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this['_map'][_0x451573(0x16b)]['canvas']['clientHeight']+'px',this[_0x451573(0x1d1)]['width']=this['_map'][_0x451573(0x16b)]['canvas']['clientWidth'],this['canvas']['height']=this['_map'][_0x451573(0x16b)]['canvas']['clientHeight']);}[_0x572e14(0x207)](){const _0x244204=_0x572e14,_0x510bcd=this;let _0x41a43b=Date['now']();(function _0x5969f2(){const _0x34ab00=_0x5c9e;_0x510bcd[_0x34ab00(0x1e8)]=window[_0x34ab00(0x19d)](_0x5969f2);if(_0x510bcd['show']&&_0x510bcd[_0x34ab00(0x158)]){const _0x1955d7=Date['now'](),_0x5d0a86=_0x1955d7-_0x41a43b;_0x5d0a86>_0x510bcd['frameTime']&&(_0x41a43b=_0x1955d7-_0x5d0a86%_0x510bcd['frameTime'],_0x510bcd['update']());}}(),window[_0x244204(0x1a1)](_0x244204(0x1bd),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType'][_0x244204(0x1b4)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x244204(0x168)][_0x244204(0x17e)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x244204(0x168)]['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x275daf=_0x572e14;window['cancelAnimationFrame'](this[_0x275daf(0x1e8)]),delete this[_0x275daf(0x1e8)],window['removeEventListener']('resize',this[_0x275daf(0x1bd)]),this['options'][_0x275daf(0x134)]&&(this['_map']['off'](mars3d__namespace['EventType']['wheel'],this[_0x275daf(0x214)],this),this[_0x275daf(0x1a4)][_0x275daf(0x16d)](mars3d__namespace['EventType'][_0x275daf(0x17e)],this['_onMouseDownEvent'],this),this[_0x275daf(0x1a4)]['off'](mars3d__namespace['EventType'][_0x275daf(0x176)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x275daf(0x168)][_0x275daf(0x1e1)],this['_onMouseMoveEvent'],this));}[_0x572e14(0x214)](_0xf550a3){const _0x4b5159=_0x572e14;clearTimeout(this['refreshTimer']);if(!this[_0x4b5159(0x1db)]||!this['canvas'])return;this[_0x4b5159(0x1d1)][_0x4b5159(0x1e0)]['visibility']=_0x4b5159(0x201),this['refreshTimer']=setTimeout(()=>{const _0x45849b=_0x4b5159;if(!this['show'])return;this[_0x45849b(0x188)](),this[_0x45849b(0x1d1)][_0x45849b(0x1e0)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x3ee9e6){const _0x196d38=_0x572e14;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x196d38(0x1e1)],this[_0x196d38(0x1c7)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x196d38(0x1e1)],this['_onMouseMoveEvent'],this);}[_0x572e14(0x1c7)](_0x5c6c2b){const _0x21e08f=_0x572e14;if(!this['show']||!this[_0x21e08f(0x1d1)])return;this[_0x21e08f(0x157)]&&(this[_0x21e08f(0x1d1)][_0x21e08f(0x1e0)]['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x223408){const _0x4b9cfa=_0x572e14;if(!this['show']||!this[_0x4b9cfa(0x1d1)])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x4b9cfa(0x1c7)],this),this['mouse_down']&&this[_0x4b9cfa(0x197)]&&this['redraw'](),this['canvas'][_0x4b9cfa(0x1e0)]['visibility']=_0x4b9cfa(0x1b8),this[_0x4b9cfa(0x157)]=![],this['mouse_move']=![];}[_0x572e14(0x1c3)](_0x4147f4){const _0x360863=_0x572e14;this['clear'](),this[_0x360863(0x17d)]=_0x4147f4,this['windField']['setDate'](_0x4147f4),this['redraw']();}[_0x572e14(0x188)](){const _0x15c268=_0x572e14;if(!this['show'])return;this['windField'][_0x15c268(0x14a)](this['options']),this['update']();}['update'](){const _0x171dae=_0x572e14;if(this[_0x171dae(0x133)])return;this['_updateIng']=!![];if(this[_0x171dae(0x1a9)])this[_0x171dae(0x158)]['update']();else{const _0x40cda2=this[_0x171dae(0x158)][_0x171dae(0x16f)]();this['_drawLines'](_0x40cda2);}this[_0x171dae(0x133)]=![];}['_drawLines'](_0x3228d2){const _0x59fe0e=_0x572e14;this[_0x59fe0e(0x17a)]['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this[_0x59fe0e(0x159)]),this['canvasContext'][_0x59fe0e(0x161)]='lighter',this[_0x59fe0e(0x17a)]['globalAlpha']=0.9;const _0x317f55=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x8c044e=this['canvasWidth']*0.25;if(this[_0x59fe0e(0x13e)])for(let _0x2b3492=0x0,_0x3c71a9=_0x3228d2['length'];_0x2b3492<_0x3c71a9;_0x2b3492++){const _0x270c57=_0x3228d2[_0x2b3492],_0xb74082=this['_tomap'](_0x270c57['lng'],_0x270c57[_0x59fe0e(0x1e6)],_0x270c57),_0x23bb9c=this['_tomap'](_0x270c57['tlng'],_0x270c57[_0x59fe0e(0x1d6)],_0x270c57);if(!_0xb74082||!_0x23bb9c)continue;if(_0x317f55&&Math['abs'](_0xb74082[0x0]-_0x23bb9c[0x0])>=_0x8c044e)continue;this['canvasContext']['beginPath'](),this['canvasContext'][_0x59fe0e(0x1fd)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x270c57['speed']),this['canvasContext']['moveTo'](_0xb74082[0x0],_0xb74082[0x1]),this[_0x59fe0e(0x17a)]['lineTo'](_0x23bb9c[0x0],_0x23bb9c[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext'][_0x59fe0e(0x1fd)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x59fe0e(0x18c)];for(let _0x30c1a7=0x0,_0x47919c=_0x3228d2['length'];_0x30c1a7<_0x47919c;_0x30c1a7++){const _0x303490=_0x3228d2[_0x30c1a7],_0x25d275=this['_tomap'](_0x303490['lng'],_0x303490['lat'],_0x303490),_0x7c0d47=this['_tomap'](_0x303490['tlng'],_0x303490['tlat'],_0x303490);if(!_0x25d275||!_0x7c0d47)continue;if(_0x317f55&&Math[_0x59fe0e(0x1bb)](_0x25d275[0x0]-_0x7c0d47[0x0])>=_0x8c044e)continue;this['canvasContext']['moveTo'](_0x25d275[0x0],_0x25d275[0x1]),this['canvasContext']['lineTo'](_0x7c0d47[0x0],_0x7c0d47[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0xb20258,_0x29b4ba,_0x182ef5){const _0x5b78ea=_0x572e14,_0x3a6ef7=Cesium['Cartesian3']['fromDegrees'](_0xb20258,_0x29b4ba,this['fixedHeight']),_0x22c951=this['_map']['scene'];if(_0x22c951['mode']===Cesium['SceneMode'][_0x5b78ea(0x178)]){const _0x330836=new Cesium['EllipsoidalOccluder'](_0x22c951['globe']['ellipsoid'],_0x22c951['camera']['positionWC']),_0x4633f0=_0x330836['isPointVisible'](_0x3a6ef7);if(!_0x4633f0)return _0x182ef5['age']=0x0,null;}const _0x339fb5=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x3a6ef7);return _0x339fb5?[_0x339fb5['x'],_0x339fb5['y']]:null;}['clear'](){const _0x58d2a8=_0x572e14;this['windField']['clear'](),delete this[_0x58d2a8(0x17d)];}['initWorker'](){const _0x2429d7=_0x572e14;this[_0x2429d7(0x1a9)]=new Worker(this[_0x2429d7(0x1c5)][_0x2429d7(0x1a9)]),this['worker'][_0x2429d7(0x144)]=_0x18d094=>{const _0x541ad3=_0x2429d7;this['_drawLines'](_0x18d094[_0x541ad3(0x1c2)]['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x1fe7b8=>{const _0x5e93b0=_0x2429d7;this[_0x5e93b0(0x1a9)]['postMessage']({'type':'init','options':_0x1fe7b8});},'setOptions':_0x58f6a8=>{const _0x1f798b=_0x2429d7;this['worker']['postMessage']({'type':_0x1f798b(0x14a),'options':_0x58f6a8});},'setDate':_0x12e745=>{const _0x2ec2cf=_0x2429d7;this[_0x2ec2cf(0x1a9)]['postMessage']({'type':_0x2ec2cf(0x1b6),'data':_0x12e745});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x37c33e=_0x2429d7;this[_0x37c33e(0x1a9)][_0x37c33e(0x1d4)]({'type':_0x37c33e(0x1d2)});}},this['windField']['init'](this[_0x2429d7(0x1c5)]);}}mars3d__namespace[_0x572e14(0x152)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x572e14(0x163)][_0x572e14(0x1a7)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x572e14(0x1a7)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
