/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.18
 * 编译日期：2023-12-28 21:28:39
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x1e2a71=_0xa2d9;(function(_0x9737cb,_0xec46a6){const _0x244b0e=_0xa2d9,_0x35a1b6=_0x9737cb();while(!![]){try{const _0xb4b9a3=-parseInt(_0x244b0e(0x251))/0x1*(parseInt(_0x244b0e(0x185))/0x2)+-parseInt(_0x244b0e(0x1d7))/0x3+parseInt(_0x244b0e(0x197))/0x4*(-parseInt(_0x244b0e(0x253))/0x5)+-parseInt(_0x244b0e(0x1de))/0x6+-parseInt(_0x244b0e(0x215))/0x7*(-parseInt(_0x244b0e(0x17b))/0x8)+parseInt(_0x244b0e(0x1a6))/0x9*(parseInt(_0x244b0e(0x1d6))/0xa)+parseInt(_0x244b0e(0x183))/0xb;if(_0xb4b9a3===_0xec46a6)break;else _0x35a1b6['push'](_0x35a1b6['shift']());}catch(_0x2fbb7f){_0x35a1b6['push'](_0x35a1b6['shift']());}}}(_0x2a42,0x5a930));function _interopNamespace(_0x57eb38){const _0x56e7b2=_0xa2d9;if(_0x57eb38&&_0x57eb38['__esModule'])return _0x57eb38;var _0x362d00=Object['create'](null);return _0x57eb38&&Object['keys'](_0x57eb38)[_0x56e7b2(0x178)](function(_0x32b31e){if(_0x32b31e!=='default'){var _0x38e648=Object['getOwnPropertyDescriptor'](_0x57eb38,_0x32b31e);Object['defineProperty'](_0x362d00,_0x32b31e,_0x38e648['get']?_0x38e648:{'enumerable':!![],'get':function(){return _0x57eb38[_0x32b31e];}});}}),_0x362d00['default']=_0x57eb38,_0x362d00;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function _0xa2d9(_0x193679,_0x5a6b73){const _0x2a4217=_0x2a42();return _0xa2d9=function(_0xa2d95b,_0x1bfd08){_0xa2d95b=_0xa2d95b-0x16f;let _0x1943ab=_0x2a4217[_0xa2d95b];return _0x1943ab;},_0xa2d9(_0x193679,_0x5a6b73);}function getU(_0x326062,_0x1da371){const _0x237430=_0xa2d9,_0x192255=_0x326062*Math[_0x237430(0x22e)](Cesium$7['Math']['toRadians'](_0x1da371));return _0x192255;}function getV(_0x3db3bb,_0x30d138){const _0x4d33ad=_0x3db3bb*Math['sin'](Cesium$7['Math']['toRadians'](_0x30d138));return _0x4d33ad;}function getSpeed(_0x3c9b29,_0x5c631c){const _0x295d84=_0xa2d9,_0x4ab213=Math['sqrt'](Math['pow'](_0x3c9b29,0x2)+Math[_0x295d84(0x21b)](_0x5c631c,0x2));return _0x4ab213;}function getDirection(_0x2f7e71,_0xcc6479){const _0x181b3b=_0xa2d9;let _0x19afe0=Cesium$7[_0x181b3b(0x1ff)][_0x181b3b(0x17f)](Math[_0x181b3b(0x204)](_0xcc6479,_0x2f7e71));return _0x19afe0+=_0x19afe0<0x0?0x168:0x0,_0x19afe0;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x3cfea6){const _0x344539=_0xa2d9;this['commandType']=_0x3cfea6['commandType'],this['geometry']=_0x3cfea6['geometry'],this[_0x344539(0x255)]=_0x3cfea6['attributeLocations'],this['primitiveType']=_0x3cfea6['primitiveType'],this['uniformMap']=_0x3cfea6['uniformMap'],this['vertexShaderSource']=_0x3cfea6['vertexShaderSource'],this[_0x344539(0x1ab)]=_0x3cfea6[_0x344539(0x1ab)],this[_0x344539(0x1eb)]=_0x3cfea6['rawRenderState'],this[_0x344539(0x1b8)]=_0x3cfea6['framebuffer'],this['outputTexture']=_0x3cfea6['outputTexture'],this['autoClear']=_0x3cfea6['autoClear']??![],this['preExecute']=_0x3cfea6['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this[_0x344539(0x175)]=undefined,this[_0x344539(0x1c7)]&&(this[_0x344539(0x175)]=new Cesium$6[(_0x344539(0x1fe))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x344539(0x236)]['OPAQUE']}));}['createCommand'](_0x146e9a){const _0xfdb16a=_0xa2d9;switch(this[_0xfdb16a(0x1e1)]){case _0xfdb16a(0x1ee):{const _0x215d2a=Cesium$6[_0xfdb16a(0x1c8)]['fromGeometry']({'context':_0x146e9a,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x8b87a7=Cesium$6['ShaderProgram']['fromCache']({'context':_0x146e9a,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0xfdb16a(0x1c0)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x4ac8df=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x8b87a7,'vertexArray':_0x215d2a,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x4ac8df,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0xfdb16a(0x236)][_0xfdb16a(0x258)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0xfdb16a(0x198))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x22ea0b,_0x3a6e32){const _0x184118=_0xa2d9;this['geometry']=_0x3a6e32;const _0xc21ea4=Cesium$6['VertexArray']['fromGeometry']({'context':_0x22ea0b,'geometry':this[_0x184118(0x1dc)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x184118(0x1b7)]['vertexArray']=_0xc21ea4;}[_0x1e2a71(0x182)](_0x59fa59){const _0xa8487a=_0x1e2a71;if(!this['show'])return;if(_0x59fa59['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0xa8487a(0x1b7)]=this['createCommand'](_0x59fa59['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6[_0xa8487a(0x20a)](this[_0xa8487a(0x175)])&&_0x59fa59[_0xa8487a(0x23e)]['push'](this[_0xa8487a(0x175)]),_0x59fa59[_0xa8487a(0x23e)][_0xa8487a(0x225)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x38f292=_0x1e2a71;if(this[_0x38f292(0x175)]){var _0x24990b,_0x561103;(_0x24990b=this['clearCommand'])!==null&&_0x24990b!==void 0x0&&_0x24990b['vertexArray']&&this['clearCommand'][_0x38f292(0x1f2)][_0x38f292(0x191)](),(_0x561103=this['clearCommand'])!==null&&_0x561103!==void 0x0&&_0x561103['shaderProgram']&&this[_0x38f292(0x175)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0x38f292(0x1b7)]['shaderProgram'][_0x38f292(0x191)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x54237a=function(){const _0x26b089=_0xa2d9,_0x12758d=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x26b089(0x205))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x26b089(0x1ae)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x26b089(0x1ae)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x12758d;},_0x576c5d=function(_0x1860db,_0x487d1a){const _0x32d05c=_0xa2d9;if(Cesium$5[_0x32d05c(0x20a)](_0x487d1a)){const _0x519da1={};_0x519da1['arrayBufferView']=_0x487d1a,_0x1860db[_0x32d05c(0x18b)]=_0x519da1;}const _0x21ac85=new Cesium$5[(_0x32d05c(0x1e8))](_0x1860db);return _0x21ac85;},_0x5ded97=function(_0x7a13c6,_0x707311,_0x3fe3ba){const _0x1f34f7=new Cesium$5['Framebuffer']({'context':_0x7a13c6,'colorTextures':[_0x707311],'depthTexture':_0x3fe3ba});return _0x1f34f7;},_0x524db6=function(_0x38d3a4){const _0x464e85=_0xa2d9,_0x5a52c1=!![],_0x26c43c=![],_0xb68068={'viewport':_0x38d3a4[_0x464e85(0x1f3)],'depthTest':_0x38d3a4['depthTest'],'depthMask':_0x38d3a4[_0x464e85(0x240)],'blending':_0x38d3a4['blending']},_0x3244b7=Cesium$5['Appearance']['getDefaultRenderState'](_0x5a52c1,_0x26c43c,_0xb68068);return _0x3244b7;},_0x4b61c0=function(_0x1ae112){const _0x49dff5=_0xa2d9,_0x114327={},_0x22d76d=Cesium$5['Math']['mod'](_0x1ae112[_0x49dff5(0x1dd)],Cesium$5['Math']['TWO_PI']),_0x1c0e20=Cesium$5['Math']['mod'](_0x1ae112['east'],Cesium$5[_0x49dff5(0x1ff)]['TWO_PI']),_0x184d35=_0x1ae112['width'];let _0x32a637,_0x4c08cf;_0x184d35>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x32a637=0x0,_0x4c08cf=Cesium$5['Math']['TWO_PI']):_0x1c0e20-_0x22d76d<_0x184d35?(_0x32a637=_0x22d76d,_0x4c08cf=_0x22d76d+_0x184d35):(_0x32a637=_0x22d76d,_0x4c08cf=_0x1c0e20);_0x114327['lon']={'min':Cesium$5['Math']['toDegrees'](_0x32a637),'max':Cesium$5[_0x49dff5(0x1ff)]['toDegrees'](_0x4c08cf)};const _0x49fe92=_0x1ae112['south'],_0x31b7db=_0x1ae112['north'],_0x20111b=_0x1ae112['height'],_0x23fce4=_0x20111b>Cesium$5['Math']['PI']/0xc?_0x20111b/0x2:0x0;let _0x35eeef=Cesium$5['Math'][_0x49dff5(0x211)](_0x49fe92-_0x23fce4),_0x2b32dd=Cesium$5['Math']['clampToLatitudeRange'](_0x31b7db+_0x23fce4);return _0x35eeef<-Cesium$5[_0x49dff5(0x1ff)]['PI_OVER_THREE']&&(_0x35eeef=-Cesium$5['Math']['PI_OVER_TWO']),_0x2b32dd>Cesium$5['Math']['PI_OVER_THREE']&&(_0x2b32dd=Cesium$5['Math']['PI_OVER_TWO']),_0x114327['lat']={'min':Cesium$5['Math']['toDegrees'](_0x35eeef),'max':Cesium$5['Math']['toDegrees'](_0x2b32dd)},_0x114327;};return{'getFullscreenQuad':_0x54237a,'createTexture':_0x576c5d,'createFramebuffer':_0x5ded97,'createRawRenderState':_0x524db6,'viewRectangleToLonLatRange':_0x4b61c0};}());var segmentDraw_vert=_0x1e2a71(0x232),segmentDraw_frag=_0x1e2a71(0x1f7),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x1e2a71(0x19c)];class ParticlesRendering{constructor(_0x180f77,_0x5a2d73,_0x560330,_0x3d9873,_0x1735c1){const _0x3b2916=_0x1e2a71;this['createRenderingTextures'](_0x180f77,_0x5a2d73,_0x560330['colors']),this[_0x3b2916(0x19f)](_0x180f77),this['createRenderingPrimitives'](_0x180f77,_0x560330,_0x3d9873,_0x1735c1);}['createRenderingTextures'](_0x4c5f56,_0x3b670b,_0x4941b5){const _0x5c523c=_0x1e2a71,_0x342700={'context':_0x4c5f56,'width':_0x4c5f56[_0x5c523c(0x201)],'height':_0x4c5f56['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x5c523c(0x1e7)]['RGBA'],'pixelDatatype':Cesium$4[_0x5c523c(0x226)]['UNSIGNED_BYTE']},_0x40a60d={'context':_0x4c5f56,'width':_0x4c5f56['drawingBufferWidth'],'height':_0x4c5f56['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x5c523c(0x1e7)][_0x5c523c(0x173)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x26e5f7=_0x4941b5['length'],_0x290b78=new Float32Array(_0x26e5f7*0x3);for(let _0x270885=0x0;_0x270885<_0x26e5f7;_0x270885++){const _0x5c03dd=Cesium$4['Color'][_0x5c523c(0x177)](_0x4941b5[_0x270885]);_0x290b78[0x3*_0x270885]=_0x5c03dd[_0x5c523c(0x1a2)],_0x290b78[0x3*_0x270885+0x1]=_0x5c03dd['green'],_0x290b78[0x3*_0x270885+0x2]=_0x5c03dd['blue'];}const _0x5c2a9e={'context':_0x4c5f56,'width':_0x26e5f7,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x5c523c(0x226)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x5c523c(0x1f6)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x342700),'segmentsDepth':Util['createTexture'](_0x40a60d),'currentTrailsColor':Util['createTexture'](_0x342700),'currentTrailsDepth':Util[_0x5c523c(0x1f5)](_0x40a60d),'nextTrailsColor':Util['createTexture'](_0x342700),'nextTrailsDepth':Util['createTexture'](_0x40a60d),'colorTable':Util['createTexture'](_0x5c2a9e,_0x290b78)};}['createRenderingFramebuffers'](_0x5ab458){const _0x4a4559=_0x1e2a71;this[_0x4a4559(0x1b1)]={'segments':Util[_0x4a4559(0x1cf)](_0x5ab458,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x5ab458,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util[_0x4a4559(0x1cf)](_0x5ab458,this[_0x4a4559(0x1fa)]['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x33a19e){const _0x2a9efd=_0x1e2a71,_0x58f676=0x4;let _0x11b46c=[];for(let _0x3573fd=0x0;_0x3573fd<_0x33a19e['particlesTextureSize'];_0x3573fd++){for(let _0x21d8df=0x0;_0x21d8df<_0x33a19e['particlesTextureSize'];_0x21d8df++){for(let _0x5661e1=0x0;_0x5661e1<_0x58f676;_0x5661e1++){_0x11b46c[_0x2a9efd(0x225)](_0x3573fd/_0x33a19e['particlesTextureSize']),_0x11b46c['push'](_0x21d8df/_0x33a19e[_0x2a9efd(0x1b4)]);}}}_0x11b46c=new Float32Array(_0x11b46c);let _0x2d3f9f=[];const _0x389608=[-0x1,0x1],_0xacfdb8=[-0x1,0x1];for(let _0x369aab=0x0;_0x369aab<_0x33a19e['maxParticles'];_0x369aab++){for(let _0x57798e=0x0;_0x57798e<_0x58f676/0x2;_0x57798e++){for(let _0x5a764f=0x0;_0x5a764f<_0x58f676/0x2;_0x5a764f++){_0x2d3f9f['push'](_0x389608[_0x57798e]),_0x2d3f9f['push'](_0xacfdb8[_0x5a764f]),_0x2d3f9f['push'](0x0);}}}_0x2d3f9f=new Float32Array(_0x2d3f9f);const _0x3b9eaa=0x6*_0x33a19e['maxParticles'],_0x48a210=new Uint32Array(_0x3b9eaa);for(let _0x81a86a=0x0,_0x81463a=0x0,_0x14b68e=0x0;_0x81a86a<_0x33a19e[_0x2a9efd(0x20f)];_0x81a86a++){_0x48a210[_0x81463a++]=_0x14b68e+0x0,_0x48a210[_0x81463a++]=_0x14b68e+0x1,_0x48a210[_0x81463a++]=_0x14b68e+0x2,_0x48a210[_0x81463a++]=_0x14b68e+0x2,_0x48a210[_0x81463a++]=_0x14b68e+0x1,_0x48a210[_0x81463a++]=_0x14b68e+0x3,_0x14b68e+=0x4;}const _0x165a47=new Cesium$4[(_0x2a9efd(0x1bf))]({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x2a9efd(0x1be)]['FLOAT'],'componentsPerAttribute':0x2,'values':_0x11b46c}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x2d3f9f})}),'indices':_0x48a210});return _0x165a47;}['createRenderingPrimitives'](_0x1afbf4,_0x30703b,_0x3e29db,_0x596e0a){const _0xb674a7=_0x1e2a71,_0x3c4a9f=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x30703b),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x3a2989=_0xa2d9;return _0x596e0a[_0x3a2989(0x1c5)][_0x3a2989(0x187)];},'postProcessingPosition':function(){return _0x596e0a['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x43e956=_0xa2d9;return _0x596e0a['particlesTextures'][_0x43e956(0x241)];},'colorTable':function(){const _0x1dcb4f=_0xa2d9;return _0x3c4a9f['textures'][_0x1dcb4f(0x259)];},'aspect':function(){const _0x1b5612=_0xa2d9;return _0x1afbf4['drawingBufferWidth']/_0x1afbf4[_0x1b5612(0x18d)];},'pixelSize':function(){return _0x3e29db['pixelSize'];},'lineWidth':function(){return _0x30703b['lineWidth'];},'particleHeight':function(){return _0x30703b['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0xb674a7(0x247))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0xb674a7(0x1ee),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0xb674a7(0x242)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x3c4a9f['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x3ab059=_0xb674a7;return _0x3c4a9f[_0x3ab059(0x1fa)]['segmentsDepth'];},'currentTrailsColor':function(){const _0x12aeda=_0xb674a7;return _0x3c4a9f[_0x12aeda(0x1b1)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x3c4a9f['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x335c52=_0xb674a7;return _0x30703b[_0x335c52(0x20b)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0xb674a7(0x22c)],'autoClear':!![],'preExecute':function(){const _0x14aee7=_0xb674a7,_0x4e1eef=_0x3c4a9f['framebuffers'][_0x14aee7(0x23f)];_0x3c4a9f['framebuffers'][_0x14aee7(0x23f)]=_0x3c4a9f['framebuffers'][_0x14aee7(0x22c)],_0x3c4a9f['framebuffers'][_0x14aee7(0x22c)]=_0x4e1eef,_0x3c4a9f['primitives'][_0x14aee7(0x23c)]['commandToExecute']['framebuffer']=_0x3c4a9f['framebuffers']['nextTrails'],_0x3c4a9f['primitives']['trails'][_0x14aee7(0x175)][_0x14aee7(0x1b8)]=_0x3c4a9f['framebuffers'][_0x14aee7(0x22c)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0xb674a7(0x24c)],'uniformMap':{'trailsColorTexture':function(){return _0x3c4a9f['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x4e27ac=_0xb674a7;return _0x3c4a9f['framebuffers'][_0x4e27ac(0x22c)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xb674a7(0x237)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0xb674a7(0x247))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0xb674a7(0x17a)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x1e2a71(0x231),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x1e2a71(0x19c)];class ParticlesComputing{constructor(_0x6961b3,_0xf87d2f,_0x25b1fe,_0xfbfae3){const _0x34b89a=_0x1e2a71;this[_0x34b89a(0x1ca)]=_0xf87d2f,this['createWindTextures'](_0x6961b3,_0xf87d2f),this[_0x34b89a(0x239)](_0x6961b3,_0x25b1fe,_0xfbfae3),this['createComputingPrimitives'](_0xf87d2f,_0x25b1fe,_0xfbfae3);}['createWindTextures'](_0x3f2e06,_0x4ef056){const _0x2961cd=_0x1e2a71,_0x31abf7={'context':_0x3f2e06,'width':_0x4ef056['dimensions']['lon'],'height':_0x4ef056['dimensions']['lat']*(_0x4ef056['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x2961cd(0x1ae)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x2961cd(0x23d)][_0x2961cd(0x20c)],'magnificationFilter':Cesium$3[_0x2961cd(0x1e4)][_0x2961cd(0x20c)]})};this['windTextures']={'U':Util[_0x2961cd(0x1f5)](_0x31abf7,_0x4ef056['U'][_0x2961cd(0x1a5)]),'V':Util['createTexture'](_0x31abf7,_0x4ef056['V'][_0x2961cd(0x1a5)])};}['createParticlesTextures'](_0xf86b0,_0xb06217,_0x124432){const _0x545577=_0x1e2a71,_0x3be2a3={'context':_0xf86b0,'width':_0xb06217[_0x545577(0x1b4)],'height':_0xb06217['particlesTextureSize'],'pixelFormat':Cesium$3[_0x545577(0x1e7)]['RGBA'],'pixelDatatype':Cesium$3[_0x545577(0x226)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x545577(0x23d)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x3f7221=this['randomizeParticles'](_0xb06217['maxParticles'],_0x124432),_0x1f7847=new Float32Array(0x4*_0xb06217['maxParticles'])['fill'](0x0);this[_0x545577(0x1c5)]={'particlesWind':Util['createTexture'](_0x3be2a3),'currentParticlesPosition':Util['createTexture'](_0x3be2a3,_0x3f7221),'nextParticlesPosition':Util['createTexture'](_0x3be2a3,_0x3f7221),'currentParticlesSpeed':Util['createTexture'](_0x3be2a3,_0x1f7847),'nextParticlesSpeed':Util['createTexture'](_0x3be2a3,_0x1f7847),'postProcessingPosition':Util['createTexture'](_0x3be2a3,_0x3f7221),'postProcessingSpeed':Util['createTexture'](_0x3be2a3,_0x1f7847)};}['randomizeParticles'](_0x3feee5,_0xd55959){const _0x175c6f=_0x1e2a71,_0x5d7672=new Float32Array(0x4*_0x3feee5);for(let _0x339e2c=0x0;_0x339e2c<_0x3feee5;_0x339e2c++){_0x5d7672[0x4*_0x339e2c]=Cesium$3['Math']['randomBetween'](_0xd55959['lonRange']['x'],_0xd55959['lonRange']['y']),_0x5d7672[0x4*_0x339e2c+0x1]=Cesium$3['Math'][_0x175c6f(0x18c)](_0xd55959[_0x175c6f(0x1fb)]['x'],_0xd55959['latRange']['y']),_0x5d7672[0x4*_0x339e2c+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x175c6f(0x212)]['min'],this['data']['lev'][_0x175c6f(0x1f8)]),_0x5d7672[0x4*_0x339e2c+0x3]=0x0;}return _0x5d7672;}['destroyParticlesTextures'](){const _0x1451a6=_0x1e2a71;Object['keys'](this[_0x1451a6(0x1c5)])['forEach'](_0x47613f=>{const _0x223206=_0x1451a6;this[_0x223206(0x1c5)][_0x47613f]['destroy']();});}[_0x1e2a71(0x1bb)](_0x36ea36,_0x33b23d,_0x6416ec){const _0x977cb0=_0x1e2a71,_0x545d2f=new Cesium$3[(_0x977cb0(0x210))](_0x36ea36[_0x977cb0(0x1a7)]['lon'],_0x36ea36['dimensions']['lat'],_0x36ea36['dimensions']['lev']),_0x18562e=new Cesium$3['Cartesian3'](_0x36ea36['lon']['min'],_0x36ea36[_0x977cb0(0x1b2)]['min'],_0x36ea36['lev']['min']),_0x5551c7=new Cesium$3[(_0x977cb0(0x210))](_0x36ea36[_0x977cb0(0x1aa)]['max'],_0x36ea36[_0x977cb0(0x1b2)]['max'],_0x36ea36['lev']['max']),_0x1cb535=new Cesium$3['Cartesian3']((_0x5551c7['x']-_0x18562e['x'])/(_0x545d2f['x']-0x1),(_0x5551c7['y']-_0x18562e['y'])/(_0x545d2f['y']-0x1),_0x545d2f['z']>0x1?(_0x5551c7['z']-_0x18562e['z'])/(_0x545d2f['z']-0x1):0x1),_0x2fd6a7=new Cesium$3['Cartesian2'](_0x36ea36['U']['min'],_0x36ea36['U']['max']),_0x1fed70=new Cesium$3[(_0x977cb0(0x209))](_0x36ea36['V']['min'],_0x36ea36['V']['max']),_0x2f4dc6=this;this[_0x977cb0(0x1d3)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x38a5b9=_0x977cb0;return _0x2f4dc6[_0x38a5b9(0x1a1)]['U'];},'V':function(){const _0x132f95=_0x977cb0;return _0x2f4dc6[_0x132f95(0x1a1)]['V'];},'currentParticlesPosition':function(){return _0x2f4dc6['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x545d2f;},'minimum':function(){return _0x18562e;},'maximum':function(){return _0x5551c7;},'interval':function(){return _0x1cb535;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x11b0fb=_0x977cb0;_0x2f4dc6['primitives']['getWind'][_0x11b0fb(0x1b7)]['outputTexture']=_0x2f4dc6['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x2f7ee5=_0x977cb0;return _0x2f4dc6[_0x2f7ee5(0x1c5)][_0x2f7ee5(0x193)];},'particlesWind':function(){const _0x503abe=_0x977cb0;return _0x2f4dc6[_0x503abe(0x1c5)]['particlesWind'];},'uSpeedRange':function(){return _0x2fd6a7;},'vSpeedRange':function(){return _0x1fed70;},'pixelSize':function(){return _0x6416ec['pixelSize'];},'speedFactor':function(){return _0x33b23d['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x977cb0(0x1c5)]['nextParticlesSpeed'],'preExecute':function(){const _0x40f54b=_0x2f4dc6['particlesTextures']['currentParticlesSpeed'];_0x2f4dc6['particlesTextures']['currentParticlesSpeed']=_0x2f4dc6['particlesTextures']['postProcessingSpeed'],_0x2f4dc6['particlesTextures']['postProcessingSpeed']=_0x40f54b,_0x2f4dc6['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x2f4dc6['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x370ef1=_0x977cb0;return _0x2f4dc6[_0x370ef1(0x1c5)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x2f4dc6['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x977cb0(0x1c5)]['nextParticlesPosition'],'preExecute':function(){const _0xd23f9e=_0x977cb0,_0x136a8d=_0x2f4dc6['particlesTextures']['currentParticlesPosition'];_0x2f4dc6[_0xd23f9e(0x1c5)]['currentParticlesPosition']=_0x2f4dc6['particlesTextures'][_0xd23f9e(0x1df)],_0x2f4dc6['particlesTextures'][_0xd23f9e(0x1df)]=_0x136a8d,_0x2f4dc6[_0xd23f9e(0x1d3)][_0xd23f9e(0x17c)]['commandToExecute']['outputTexture']=_0x2f4dc6['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x2f4dc6['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x2f4dc6['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x6416ec['lonRange'];},'latRange':function(){return _0x6416ec['latRange'];},'randomCoefficient':function(){const _0x1c2c57=_0x977cb0,_0x4c7824=Math[_0x1c2c57(0x1f9)]();return _0x4c7824;},'dropRate':function(){return _0x33b23d['dropRate'];},'dropRateBump':function(){return _0x33b23d['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x977cb0(0x1c5)]['postProcessingPosition'],'preExecute':function(){_0x2f4dc6['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0x2f4dc6['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x977cb0(0x194),'uniformMap':{'postProcessingPosition':function(){return _0x2f4dc6['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x57ad75=_0x977cb0;return _0x2f4dc6['particlesTextures'][_0x57ad75(0x233)];}},'fragmentShaderSource':new Cesium$3[(_0x977cb0(0x247))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x1777a0=_0x977cb0;_0x2f4dc6['primitives']['postProcessingSpeed'][_0x1777a0(0x1b7)][_0x1777a0(0x171)]=_0x2f4dc6['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];function _0x2a42(){const _0xf36339=['EllipsoidalOccluder','vertexArray','viewport','absolute','createTexture','LINEAR','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','max','random','textures','latRange','destroyParticlesTextures','clientWidth','ClearCommand','Math','getParticles','drawingBufferWidth','getRandomLatLng','particlesRendering','atan2','GeometryAttributes','floor','particleSystem','mouseDown','Cartesian2','defined','fadeOpacity','NEAREST','SceneTransforms','mouse_down','maxParticles','Cartesian3','clampToLatitudeRange','lev','setOptions','canvasResize','3633581xlfNfb','globeBoundingSphere','xmax','_map','_updateIng','particles','pow','EventType','windData','container','_data','canrefresh','_calc_speedRate','setData','mode','particlesComputing','push','PixelDatatype','BaseLayer','SceneMode','age','getUVByXY','reverseY','nextTrails','ymin','cos','keys','_onMouseDownEvent','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','nextParticlesSpeed','style','isInExtent','Pass','DISABLE_GL_POSITION_LOG_DEPTH','lineTo','createParticlesTextures','globe','addPrimitives','trails','TextureMinificationFilter','commandList','currentTrails','depthMask','postProcessingSpeed','getFullscreenQuad','min','none','length','visibility','ShaderSource','globalCompositeOperation','_pointerEvents','__esModule','strokeStyle','TRIANGLES','udata','BoundingSphere','options','canvasContext','103826rDXaWE','ymax','11465DixOoR','getOptions','attributeLocations','applyViewerParameters','stroke','OPAQUE','colorTable','colors','context','outputTexture','canvasWidth','DEPTH_COMPONENT','mouseMove','clearCommand','auto','fromCssColorString','forEach','speed','createRawRenderState','8bUIOCs','updatePosition','_removedHook','levmin','toDegrees','_colorRamp','_drawLines','update','1755347CYxBgL','0px','8pjQMNz','postMessage','currentParticlesPosition','canvas','createSegmentsGeometry','removeEventListener','source','randomBetween','drawingBufferHeight','cols','fixedHeight','layer','destroy','beginPath','currentParticlesSpeed','Compute','clear','xmin','580ctajcS','ComputeCommand','dropRateBump','grid','_onMouseMoveEvent','Cesium','_maxAge','lng','createRenderingFramebuffers','particlesNumber','windTextures','red','SCENE3D','redraw','array','1901007uIoaZn','dimensions','_calcUV','maxAge','lon','fragmentShaderSource','_speedRate','viewerParameters','FLOAT','show','lineWidth','framebuffers','lat','removeAll','particlesTextureSize','_onMapWhellEvent','register','commandToExecute','framebuffer','scene','mouseUp','createComputingPrimitives','isPointVisible','off','ComponentDatatype','Geometry','vertexShaderSource','animateFrame','addEventListener','initWorker','width','particlesTextures','mouse_move','autoClear','VertexArray','now','data','PrimitiveCollection','_tomap','_mountedHook','tlat','createFramebuffer','viewRectangleToLonLatRange','pointer-events','windField','primitives','bind','wgs84ToWindowCoordinates','30QVCScs','427923xKBrOD','rows','_onMouseUpEvent','resize','vdata','geometry','west','305442OALVoX','postProcessingPosition','fillRect','commandType','_updateIng2','wind','TextureMagnificationFilter','tlng','speedRate','PixelFormat','Texture','camera','_setOptionsHook','rawRenderState','execute','add','Draw','init','updateViewerParameters'];_0x2a42=function(){return _0xf36339;};return _0x2a42();}class ParticleSystem{constructor(_0xd90ed5,_0x13690e,_0x3315ad,_0x163301){const _0x1eeba7=_0x1e2a71;this['context']=_0xd90ed5,_0x13690e={..._0x13690e},_0x13690e[_0x1eeba7(0x24d)]&&_0x13690e['vdata']&&(_0x13690e[_0x1eeba7(0x1a7)]={},_0x13690e['dimensions'][_0x1eeba7(0x1aa)]=_0x13690e[_0x1eeba7(0x18e)],_0x13690e['dimensions'][_0x1eeba7(0x1b2)]=_0x13690e[_0x1eeba7(0x1d8)],_0x13690e[_0x1eeba7(0x1a7)][_0x1eeba7(0x212)]=_0x13690e['lev']||0x1,_0x13690e['lon']={},_0x13690e['lon']['min']=_0x13690e['xmin'],_0x13690e['lon']['max']=_0x13690e[_0x1eeba7(0x217)],_0x13690e['lat']={},_0x13690e['lat'][_0x1eeba7(0x243)]=_0x13690e['ymin'],_0x13690e['lat']['max']=_0x13690e['ymax'],_0x13690e['lev']={},_0x13690e['lev']['min']=_0x13690e[_0x1eeba7(0x17e)]??0x1,_0x13690e['lev']['max']=_0x13690e['levmax']??0x1,_0x13690e['U']={},_0x13690e['U']['array']=new Float32Array(_0x13690e[_0x1eeba7(0x24d)]),_0x13690e['U']['min']=_0x13690e['umin']??Math[_0x1eeba7(0x243)](..._0x13690e[_0x1eeba7(0x24d)]),_0x13690e['U'][_0x1eeba7(0x1f8)]=_0x13690e['umax']??Math['max'](..._0x13690e[_0x1eeba7(0x24d)]),_0x13690e['V']={},_0x13690e['V']['array']=new Float32Array(_0x13690e['vdata']),_0x13690e['V'][_0x1eeba7(0x243)]=_0x13690e['vmin']??Math['min'](..._0x13690e[_0x1eeba7(0x1db)]),_0x13690e['V']['max']=_0x13690e['vmax']??Math[_0x1eeba7(0x1f8)](..._0x13690e[_0x1eeba7(0x1db)])),this['data']=_0x13690e,this['options']=_0x3315ad,this[_0x1eeba7(0x1ad)]=_0x163301,this[_0x1eeba7(0x224)]=new ParticlesComputing(this['context'],this[_0x1eeba7(0x1ca)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x1eeba7(0x170)],this[_0x1eeba7(0x1ca)],this[_0x1eeba7(0x24f)],this['viewerParameters'],this['particlesComputing']);}[_0x1e2a71(0x214)](_0x2c357c){const _0x13b523=_0x1e2a71;this['particlesComputing'][_0x13b523(0x1fc)](),Object['keys'](this['particlesComputing'][_0x13b523(0x1a1)])[_0x13b523(0x178)](_0x4c4891=>{this['particlesComputing']['windTextures'][_0x4c4891]['destroy']();}),this[_0x13b523(0x203)][_0x13b523(0x1fa)][_0x13b523(0x259)]['destroy'](),Object[_0x13b523(0x22f)](this['particlesRendering']['framebuffers'])[_0x13b523(0x178)](_0x236fd8=>{const _0x4cedc1=_0x13b523;this['particlesRendering'][_0x4cedc1(0x1b1)][_0x236fd8]['destroy']();}),this['context']=_0x2c357c,this['particlesComputing']=new ParticlesComputing(this[_0x13b523(0x170)],this[_0x13b523(0x1ca)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x13b523(0x24f)],this['viewerParameters'],this[_0x13b523(0x224)]);}['clearFramebuffers'](){const _0x5748d3=_0x1e2a71,_0x1aeeca=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x5748d3(0x236)]['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x1790fb=>{const _0x1ae393=_0x5748d3;_0x1aeeca[_0x1ae393(0x1b8)]=this[_0x1ae393(0x203)]['framebuffers'][_0x1790fb],_0x1aeeca[_0x1ae393(0x1ec)](this[_0x1ae393(0x170)]);});}['refreshParticles'](_0x3a8876){const _0x515b9b=_0x1e2a71;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x515b9b(0x224)]['createParticlesTextures'](this[_0x515b9b(0x170)],this['options'],this['viewerParameters']);if(_0x3a8876){var _0x55da23;const _0x125d65=this['particlesRendering'][_0x515b9b(0x189)](this['options']);this['particlesRendering'][_0x515b9b(0x1d3)]['segments'][_0x515b9b(0x1dc)]=_0x125d65;const _0x1fe71c=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x125d65,'attributeLocations':this['particlesRendering'][_0x515b9b(0x1d3)]['segments'][_0x515b9b(0x255)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x55da23=this['particlesRendering']['primitives'])!==null&&_0x55da23!==void 0x0&&(_0x55da23=_0x55da23['segments'])!==null&&_0x55da23!==void 0x0&&_0x55da23[_0x515b9b(0x1b7)]&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x1fe71c);}}['setOptions'](_0x498701){const _0x2bd6f3=_0x1e2a71;let _0xe0f439=![];this['options'][_0x2bd6f3(0x20f)]!==_0x498701['maxParticles']&&(_0xe0f439=!![]),Object['keys'](_0x498701)['forEach'](_0x34f5e6=>{const _0x20879d=_0x2bd6f3;this[_0x20879d(0x24f)][_0x34f5e6]=_0x498701[_0x34f5e6];}),this['refreshParticles'](_0xe0f439);}['applyViewerParameters'](_0x278b30){const _0x2ea1c9=_0x1e2a71;Object['keys'](_0x278b30)[_0x2ea1c9(0x178)](_0x1b41e4=>{this['viewerParameters'][_0x1b41e4]=_0x278b30[_0x1b41e4];}),this['refreshParticles'](![]);}['destroy'](){const _0x4f9f66=_0x1e2a71;clearTimeout(this[_0x4f9f66(0x220)]),this[_0x4f9f66(0x224)]['destroyParticlesTextures'](),Object[_0x4f9f66(0x22f)](this[_0x4f9f66(0x224)]['windTextures'])[_0x4f9f66(0x178)](_0x46675e=>{this['particlesComputing']['windTextures'][_0x46675e]['destroy']();}),this[_0x4f9f66(0x203)]['textures']['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x48fd41=>{const _0x4546c2=_0x4f9f66;this['particlesRendering'][_0x4546c2(0x1b1)][_0x48fd41]['destroy']();});for(const _0xd39fdb in this){delete this[_0xd39fdb];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x523cae={}){_0x523cae={...DEF_OPTIONS,..._0x523cae},super(_0x523cae),this['_setOptionsHook'](_0x523cae);}get['layer'](){return this['primitives'];}get[_0x1e2a71(0x1ca)](){const _0x6ce8db=_0x1e2a71;return this[_0x6ce8db(0x21f)];}set['data'](_0x697c31){this['setData'](_0x697c31);}get['colors'](){const _0x434051=_0x1e2a71;return this[_0x434051(0x24f)]['colors'];}set[_0x1e2a71(0x16f)](_0x1e9b43){const _0x3dc8ff=_0x1e2a71;this[_0x3dc8ff(0x24f)][_0x3dc8ff(0x16f)]=_0x1e9b43,this[_0x3dc8ff(0x207)]&&this['particleSystem']['setOptions']({'colors':_0x1e9b43}),this['resize']();}[_0x1e2a71(0x1cd)](){}['_addedHook'](){const _0x40bd2f=_0x1e2a71;this[_0x40bd2f(0x1b9)]=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1[(_0x40bd2f(0x1cb))](),this['_map'][_0x40bd2f(0x1b9)]['primitives'][_0x40bd2f(0x1ed)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x40bd2f(0x216)]=new Cesium$1[(_0x40bd2f(0x24e))](Cesium$1[_0x40bd2f(0x210)]['ZERO'],0.99*0x615299),this[_0x40bd2f(0x1f0)](),window[_0x40bd2f(0x1c2)]('resize',this['resize'][_0x40bd2f(0x1d4)](this),![]),this[_0x40bd2f(0x20e)]=![],this['mouse_move']=![],this[_0x40bd2f(0x218)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x40bd2f(0x218)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x40bd2f(0x1ba)],this[_0x40bd2f(0x1d9)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x40bd2f(0x19b)],this),this[_0x40bd2f(0x21f)]&&this['setData'](this['_data']);}[_0x1e2a71(0x17d)](){const _0x593d14=_0x1e2a71;window['removeEventListener'](_0x593d14(0x1da),this['resize']),this['_map'][_0x593d14(0x1bd)](mars3d__namespace[_0x593d14(0x21c)]['preRender'],this['_onMap_preRenderEvent'],this),this[_0x593d14(0x218)]['off'](mars3d__namespace[_0x593d14(0x21c)]['wheel'],this[_0x593d14(0x1b5)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x593d14(0x208)],this[_0x593d14(0x230)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x593d14(0x1ba)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace[_0x593d14(0x21c)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map'][_0x593d14(0x1b9)]['primitives']['remove'](this['primitives']);}['resize'](){const _0x3ee2cd=_0x1e2a71;if(!this[_0x3ee2cd(0x1af)]||!this[_0x3ee2cd(0x207)])return;this['primitives'][_0x3ee2cd(0x1af)]=![],this[_0x3ee2cd(0x1d3)][_0x3ee2cd(0x1b3)](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x4ae0){const _0x3c57c3=_0x1e2a71;this[_0x3c57c3(0x207)]['canvasResize'](this['scene'][_0x3c57c3(0x170)]),this[_0x3c57c3(0x23b)](),this[_0x3c57c3(0x1d3)]['show']=!![];}['_onMapWhellEvent'](_0x195e92){const _0x2bc340=_0x1e2a71;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x2bc340(0x207)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x3ca386=_0x2bc340;if(!this['show'])return;this[_0x3ca386(0x1a4)]();},0xc8);}['_onMouseDownEvent'](_0x1759c0){this['mouse_down']=!![];}[_0x1e2a71(0x19b)](_0x34f5ef){const _0x54db05=_0x1e2a71;if(!this['show']||!this['particleSystem'])return;this[_0x54db05(0x20e)]&&(this[_0x54db05(0x1d3)]['show']=![],this[_0x54db05(0x1c6)]=!![]);}['_onMouseUpEvent'](_0x4deef3){const _0xebb684=_0x1e2a71;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives'][_0xebb684(0x1af)]=!![],this['mouse_down']=![],this[_0xebb684(0x1c6)]=![];}[_0x1e2a71(0x1a4)](){const _0x229172=_0x1e2a71;if(!this['_map']||!this[_0x229172(0x1af)])return;this[_0x229172(0x1f0)](),this['particleSystem'][_0x229172(0x256)](this['viewerParameters']),this[_0x229172(0x1d3)]['show']=!![];}[_0x1e2a71(0x222)](_0x2dcd92){const _0x43eb19=_0x1e2a71;this['_data']=_0x2dcd92,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x2dcd92,this[_0x43eb19(0x254)](),this['viewerParameters']),this['addPrimitives']();}[_0x1e2a71(0x1ea)](_0x1b994a,_0x57ddc5){const _0x4be4a6=_0x1e2a71;if(_0x1b994a)for(const _0x1cc144 in _0x1b994a){this[_0x1cc144]=_0x1b994a[_0x1cc144];}this['particleSystem']&&this[_0x4be4a6(0x207)]['setOptions'](this['getOptions']());}['getOptions'](){const _0x24fae6=_0x1e2a71,_0x23bdb0=Math['ceil'](Math['sqrt'](this[_0x24fae6(0x1a0)]));return this['particlesNumber']=_0x23bdb0*_0x23bdb0,{'particlesTextureSize':_0x23bdb0,'maxParticles':this['particlesNumber'],'particleHeight':this[_0x24fae6(0x18f)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this[_0x24fae6(0x199)],'speedFactor':this['speedFactor'],'lineWidth':this[_0x24fae6(0x1b0)],'colors':this['colors']};}['addPrimitives'](){const _0x46987a=_0x1e2a71;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives']['add'](this['particleSystem'][_0x46987a(0x224)]['primitives']['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0x46987a(0x224)]['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x46987a(0x224)][_0x46987a(0x1d3)]['postProcessingPosition']),this[_0x46987a(0x1d3)]['add'](this['particleSystem'][_0x46987a(0x224)][_0x46987a(0x1d3)][_0x46987a(0x241)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x46987a(0x1d3)][_0x46987a(0x23c)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x336e60=_0x1e2a71;let _0x286e8d=this['camera']['computeViewRectangle'](this[_0x336e60(0x1b9)]['globe']['ellipsoid']);if(!_0x286e8d){const _0x4a9806=this['_map']['getExtent']();_0x286e8d=Cesium$1['Rectangle']['fromDegrees'](_0x4a9806[_0x336e60(0x196)],_0x4a9806[_0x336e60(0x22d)],_0x4a9806[_0x336e60(0x217)],_0x4a9806[_0x336e60(0x252)]);}const _0x4cece7=Util[_0x336e60(0x1d0)](_0x286e8d);this[_0x336e60(0x1ad)]['lonRange']['x']=_0x4cece7['lon']['min'],this[_0x336e60(0x1ad)]['lonRange']['y']=_0x4cece7['lon'][_0x336e60(0x1f8)],this['viewerParameters']['latRange']['x']=_0x4cece7['lat']['min'],this['viewerParameters']['latRange']['y']=_0x4cece7['lat']['max'];const _0x47c00d=this[_0x336e60(0x1e9)]['getPixelSize'](this['globeBoundingSphere'],this['scene'][_0x336e60(0x201)],this['scene']['drawingBufferHeight']);_0x47c00d>0x0&&(this[_0x336e60(0x1ad)]['pixelSize']=_0x47c00d);}}mars3d__namespace['LayerUtil'][_0x1e2a71(0x1b6)](_0x1e2a71(0x1e3),WindLayer),mars3d__namespace[_0x1e2a71(0x190)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x28b34a=_0x1e2a71;this['lng']=null,this[_0x28b34a(0x1b2)]=null,this[_0x28b34a(0x1e5)]=null,this['tlat']=null,this[_0x28b34a(0x229)]=null,this['speed']=null;}['destroy'](){for(const _0x29f361 in this){delete this[_0x29f361];}}}class CanvasWindField{constructor(_0x1cb58e){const _0x18d85a=_0x1e2a71;this[_0x18d85a(0x213)](_0x1cb58e);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x3d42ca){const _0x21dbe7=_0x1e2a71;this[_0x21dbe7(0x1ac)]=(0x64-(_0x3d42ca>0x63?0x63:_0x3d42ca))*0x64,this['_calc_speedRate']=[(this[_0x21dbe7(0x217)]-this['xmin'])/this[_0x21dbe7(0x1ac)],(this['ymax']-this[_0x21dbe7(0x22d)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set[_0x1e2a71(0x1a9)](_0x2639e9){const _0x34fb28=_0x1e2a71;this[_0x34fb28(0x19d)]=_0x2639e9;}[_0x1e2a71(0x213)](_0x51ce69){const _0x325196=_0x1e2a71;this['options']=_0x51ce69,this[_0x325196(0x1a9)]=_0x51ce69['maxAge']||0x78,this[_0x325196(0x1e6)]=_0x51ce69['speedRate']||0x32,this['particles']=[];const _0xa1e071=_0x51ce69['particlesNumber']||0x1000;for(let _0x5a499c=0x0;_0x5a499c<_0xa1e071;_0x5a499c++){const _0x49b2f6=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x49b2f6);}}['setDate'](_0x1308a3){const _0x46adb4=_0x1e2a71;this[_0x46adb4(0x1d8)]=_0x1308a3['rows'],this['cols']=_0x1308a3['cols'],this['xmin']=_0x1308a3['xmin'],this[_0x46adb4(0x217)]=_0x1308a3[_0x46adb4(0x217)],this[_0x46adb4(0x22d)]=_0x1308a3['ymin'],this[_0x46adb4(0x252)]=_0x1308a3['ymax'],this[_0x46adb4(0x19a)]=[];const _0x5cf185=_0x1308a3['udata'],_0xbb170f=_0x1308a3['vdata'];let _0x4b7501=![];_0x5cf185['length']===this['rows']&&_0x5cf185[0x0][_0x46adb4(0x245)]===this['cols']&&(_0x4b7501=!![]);let _0x50daef=0x0,_0x215a43=null,_0x3a4786=null;for(let _0x184df5=0x0;_0x184df5<this['rows'];_0x184df5++){_0x215a43=[];for(let _0xde5c10=0x0;_0xde5c10<this['cols'];_0xde5c10++,_0x50daef++){_0x4b7501?_0x3a4786=this['_calcUV'](_0x5cf185[_0x184df5][_0xde5c10],_0xbb170f[_0x184df5][_0xde5c10]):_0x3a4786=this['_calcUV'](_0x5cf185[_0x50daef],_0xbb170f[_0x50daef]),_0x215a43['push'](_0x3a4786);}this['grid'][_0x46adb4(0x225)](_0x215a43);}this['options'][_0x46adb4(0x22b)]&&this[_0x46adb4(0x19a)]['reverse']();}[_0x1e2a71(0x195)](){const _0x5f48bf=_0x1e2a71;delete this[_0x5f48bf(0x1d8)],delete this['cols'],delete this[_0x5f48bf(0x196)],delete this['xmax'],delete this[_0x5f48bf(0x22d)],delete this[_0x5f48bf(0x252)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x56bb7a,_0x3ac22c){const _0x3b7b9e=_0x1e2a71,_0x41148e=(_0x56bb7a-this['xmin'])/(this[_0x3b7b9e(0x217)]-this['xmin'])*(this['cols']-0x1),_0x1ad5d4=(this[_0x3b7b9e(0x252)]-_0x3ac22c)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x41148e,_0x1ad5d4];}[_0x1e2a71(0x22a)](_0x5a14fd,_0x400e01){const _0x4c2a45=_0x1e2a71;if(_0x5a14fd<0x0||_0x5a14fd>=this['cols']||_0x400e01>=this['rows'])return[0x0,0x0,0x0];const _0x54732c=Math[_0x4c2a45(0x206)](_0x5a14fd),_0x2784b4=Math['floor'](_0x400e01);if(_0x54732c===_0x5a14fd&&_0x2784b4===_0x400e01)return this['grid'][_0x400e01][_0x5a14fd];const _0x267049=_0x54732c+0x1,_0x1e2f91=_0x2784b4+0x1,_0x492186=this[_0x4c2a45(0x22a)](_0x54732c,_0x2784b4),_0x274a45=this['getUVByXY'](_0x267049,_0x2784b4),_0xbbe7b6=this[_0x4c2a45(0x22a)](_0x54732c,_0x1e2f91),_0x47e130=this['getUVByXY'](_0x267049,_0x1e2f91);let _0x1a53f7=null;try{_0x1a53f7=this['_bilinearInterpolation'](_0x5a14fd-_0x54732c,_0x400e01-_0x2784b4,_0x492186,_0x274a45,_0xbbe7b6,_0x47e130);}catch(_0x3c30f1){console['log'](_0x5a14fd,_0x400e01);}return _0x1a53f7;}['_bilinearInterpolation'](_0x212060,_0x385feb,_0x23ecff,_0x15a171,_0x5b95be,_0x38ade0){const _0x384bd9=0x1-_0x212060,_0x42cfea=0x1-_0x385feb,_0xeb3f9f=_0x384bd9*_0x42cfea,_0x554197=_0x212060*_0x42cfea,_0x1eda3a=_0x384bd9*_0x385feb,_0x46c4b6=_0x212060*_0x385feb,_0x3e391f=_0x23ecff[0x0]*_0xeb3f9f+_0x15a171[0x0]*_0x554197+_0x5b95be[0x0]*_0x1eda3a+_0x38ade0[0x0]*_0x46c4b6,_0x24ecb3=_0x23ecff[0x1]*_0xeb3f9f+_0x15a171[0x1]*_0x554197+_0x5b95be[0x1]*_0x1eda3a+_0x38ade0[0x1]*_0x46c4b6;return this['_calcUV'](_0x3e391f,_0x24ecb3);}[_0x1e2a71(0x1a8)](_0x206aad,_0x48c915){return[+_0x206aad,+_0x48c915,Math['sqrt'](_0x206aad*_0x206aad+_0x48c915*_0x48c915)];}['getUVByPoint'](_0xd35452,_0x3fc634){const _0x653209=_0x1e2a71;if(!this['isInExtent'](_0xd35452,_0x3fc634))return null;const _0x682c20=this['toGridXY'](_0xd35452,_0x3fc634),_0x3c677d=this[_0x653209(0x22a)](_0x682c20[0x0],_0x682c20[0x1]);return _0x3c677d;}[_0x1e2a71(0x235)](_0x2cc677,_0x322b0b){return _0x2cc677>=this['xmin']&&_0x2cc677<=this['xmax']&&_0x322b0b>=this['ymin']&&_0x322b0b<=this['ymax']?!![]:![];}[_0x1e2a71(0x202)](){const _0x206b8c=_0x1e2a71,_0x1fa540=fRandomByfloat(this[_0x206b8c(0x196)],this['xmax']),_0x58fcf4=fRandomByfloat(this['ymin'],this[_0x206b8c(0x252)]);return{'lat':_0x58fcf4,'lng':_0x1fa540};}[_0x1e2a71(0x200)](){const _0x3258dd=_0x1e2a71;let _0x5ee63d,_0x10be64,_0xa984ae;for(let _0x210fda=0x0,_0x1f8c6e=this['particles']['length'];_0x210fda<_0x1f8c6e;_0x210fda++){let _0x4cd5f9=this['particles'][_0x210fda];_0x4cd5f9['age']<=0x0&&(_0x4cd5f9=this['_randomParticle'](_0x4cd5f9));if(_0x4cd5f9['age']>0x0){const _0x57d492=_0x4cd5f9['tlng'],_0x3e7965=_0x4cd5f9['tlat'];_0xa984ae=this['getUVByPoint'](_0x57d492,_0x3e7965),_0xa984ae?(_0x5ee63d=_0x57d492+this[_0x3258dd(0x221)][0x0]*_0xa984ae[0x0],_0x10be64=_0x3e7965+this['_calc_speedRate'][0x1]*_0xa984ae[0x1],_0x4cd5f9['lng']=_0x57d492,_0x4cd5f9[_0x3258dd(0x1b2)]=_0x3e7965,_0x4cd5f9[_0x3258dd(0x1e5)]=_0x5ee63d,_0x4cd5f9[_0x3258dd(0x1ce)]=_0x10be64,_0x4cd5f9['speed']=_0xa984ae[0x2],_0x4cd5f9['age']--):_0x4cd5f9['age']=0x0;}}return this[_0x3258dd(0x21a)];}['_randomParticle'](_0x1c576b){const _0xe8039=_0x1e2a71;let _0x38ee8d,_0x598274;for(let _0x2f36f3=0x0;_0x2f36f3<0x1e;_0x2f36f3++){_0x38ee8d=this[_0xe8039(0x202)](),_0x598274=this['getUVByPoint'](_0x38ee8d['lng'],_0x38ee8d['lat']);if(_0x598274&&_0x598274[0x2]>0x0)break;}if(!_0x598274)return _0x1c576b;const _0x186bda=_0x38ee8d['lng']+this['_calc_speedRate'][0x0]*_0x598274[0x0],_0x457a66=_0x38ee8d['lat']+this['_calc_speedRate'][0x1]*_0x598274[0x1];return _0x1c576b['lng']=_0x38ee8d[_0xe8039(0x19e)],_0x1c576b['lat']=_0x38ee8d['lat'],_0x1c576b['tlng']=_0x186bda,_0x1c576b['tlat']=_0x457a66,_0x1c576b['age']=Math['round'](Math['random']()*this['maxAge']),_0x1c576b[_0xe8039(0x179)]=_0x598274[0x2],_0x1c576b;}['destroy'](){for(const _0x1e24b4 in this){delete this[_0x1e24b4];}}}function fRandomByfloat(_0x4a319c,_0x1a9400){return _0x4a319c+Math['random']()*(_0x1a9400-_0x4a319c);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x1e2a71(0x190)][_0x1e2a71(0x227)];class CanvasWindLayer extends BaseLayer{constructor(_0x558879={}){const _0x50bd3f=_0x1e2a71;super(_0x558879),this[_0x50bd3f(0x1ea)](_0x558879),this[_0x50bd3f(0x188)]=null,_0x558879['colors']&&_0x558879['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x558879));}['_setOptionsHook'](_0x28b3ba,_0x257195){const _0x393f3e=_0x1e2a71;this['frameTime']=0x3e8/(_0x28b3ba['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x28b3ba['color']||'#ffffff',this[_0x393f3e(0x1b0)]=_0x28b3ba[_0x393f3e(0x1b0)]||0x1,this[_0x393f3e(0x18f)]=_0x28b3ba[_0x393f3e(0x18f)]??0x0,this['reverseY']=_0x28b3ba['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x28b3ba);}get['layer'](){return this['canvas'];}get[_0x1e2a71(0x172)](){const _0x298d5b=_0x1e2a71;return this['_map'][_0x298d5b(0x1b9)]['canvas']['clientWidth'];}get['canvasHeight'](){const _0x553bab=_0x1e2a71;return this[_0x553bab(0x218)]['scene'][_0x553bab(0x188)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x353b64){const _0x1e9e1d=_0x1e2a71;this[_0x1e9e1d(0x249)]=_0x353b64;if(!this['canvas'])return;_0x353b64?this['canvas']['style'][_0x1e9e1d(0x1d1)]='all':this[_0x1e9e1d(0x188)]['style']['pointer-events']=_0x1e9e1d(0x244);}get['particlesNumber'](){const _0x35e464=_0x1e2a71;return this[_0x35e464(0x24f)]['particlesNumber'];}set['particlesNumber'](_0x471f2c){const _0x443a21=_0x1e2a71;this['options'][_0x443a21(0x1a0)]=_0x471f2c,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{const _0x42ae97=_0x443a21;this[_0x42ae97(0x1a4)]();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x16940f){const _0x4a3d97=_0x1e2a71;this['options']['speedRate']=_0x16940f,this['windField']&&(this['windField'][_0x4a3d97(0x1e6)]=_0x16940f);}get['maxAge'](){const _0x306dec=_0x1e2a71;return this['options'][_0x306dec(0x1a9)];}set['maxAge'](_0x4ec3a2){const _0x1bd7cd=_0x1e2a71;this[_0x1bd7cd(0x24f)]['maxAge']=_0x4ec3a2,this['windField']&&(this['windField']['maxAge']=_0x4ec3a2);}get['data'](){return this['windData'];}set[_0x1e2a71(0x1ca)](_0x35d2b1){this['setData'](_0x35d2b1);}['_showHook'](_0x1a9c0a){const _0x535448=_0x1e2a71;_0x1a9c0a?this['_addedHook']():(this['windData']&&(this['options'][_0x535448(0x1ca)]=this['windData']),this[_0x535448(0x17d)]());}['_mountedHook'](){const _0x2fc596=_0x1e2a71;this['options']['worker']?this[_0x2fc596(0x1c3)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x540b72=_0x1e2a71;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map'][_0x540b72(0x21e)]['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x524122=_0x1e2a71,_0x30d231=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map']['container']);return _0x30d231[_0x524122(0x234)]['position']=_0x524122(0x1f4),_0x30d231['style']['top']=_0x524122(0x184),_0x30d231['style']['left']='0px',_0x30d231['style']['width']=this[_0x524122(0x218)]['scene']['canvas'][_0x524122(0x1fd)]+'px',_0x30d231[_0x524122(0x234)]['height']=this['_map']['scene'][_0x524122(0x188)]['clientHeight']+'px',_0x30d231['style']['pointerEvents']=this['_pointerEvents']?_0x524122(0x176):'none',_0x30d231['style']['zIndex']=this['options']['zIndex']??0x9,_0x30d231[_0x524122(0x1c4)]=this['_map']['scene']['canvas'][_0x524122(0x1fd)],_0x30d231['height']=this['_map'][_0x524122(0x1b9)]['canvas']['clientHeight'],_0x30d231;}[_0x1e2a71(0x1da)](){const _0x13216e=_0x1e2a71;this[_0x13216e(0x188)]&&(this[_0x13216e(0x188)]['style']['width']=this[_0x13216e(0x218)]['scene'][_0x13216e(0x188)]['clientWidth']+'px',this[_0x13216e(0x188)]['style']['height']=this['_map'][_0x13216e(0x1b9)][_0x13216e(0x188)]['clientHeight']+'px',this['canvas'][_0x13216e(0x1c4)]=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this[_0x13216e(0x218)][_0x13216e(0x1b9)]['canvas']['clientHeight']);}['bindEvent'](){const _0x1e25dc=_0x1e2a71,_0x409d72=this;let _0x914246=Date['now']();(function _0x33e6c9(){const _0x161d96=_0xa2d9;_0x409d72['animateFrame']=window['requestAnimationFrame'](_0x33e6c9);if(_0x409d72['show']&&_0x409d72['windField']){const _0x22beef=Date[_0x161d96(0x1c9)](),_0x5f3dd3=_0x22beef-_0x914246;_0x5f3dd3>_0x409d72['frameTime']&&(_0x914246=_0x22beef-_0x5f3dd3%_0x409d72['frameTime'],_0x409d72['update']());}}(),window['addEventListener'](_0x1e25dc(0x1da),this[_0x1e25dc(0x1da)][_0x1e25dc(0x1d4)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x1e25dc(0x24f)]['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x1e25dc(0x218)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x48711f=_0x1e2a71;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x48711f(0x1c1)],window[_0x48711f(0x18a)]('resize',this[_0x48711f(0x1da)]),this[_0x48711f(0x24f)]['mouseHidden']&&(this[_0x48711f(0x218)][_0x48711f(0x1bd)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x48711f(0x21c)][_0x48711f(0x208)],this['_onMouseDownEvent'],this),this['_map'][_0x48711f(0x1bd)](mars3d__namespace['EventType'][_0x48711f(0x1ba)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x11ab83){clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x521a7c=_0xa2d9;if(!this[_0x521a7c(0x1af)])return;this['redraw'](),this['canvas']['style'][_0x521a7c(0x246)]='visible';},0xc8);}[_0x1e2a71(0x230)](_0xe10df2){const _0x18f476=_0x1e2a71;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x18f476(0x174)],this['_onMouseMoveEvent'],this),this[_0x18f476(0x218)]['on'](mars3d__namespace['EventType'][_0x18f476(0x174)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x397800){const _0x1fd099=_0x1e2a71;if(!this['show']||!this['canvas'])return;this[_0x1fd099(0x20e)]&&(this[_0x1fd099(0x188)]['style']['visibility']='hidden',this['mouse_move']=!![]);}[_0x1e2a71(0x1d9)](_0x27287f){const _0x19b516=_0x1e2a71;if(!this['show']||!this[_0x19b516(0x188)])return;this['_map'][_0x19b516(0x1bd)](mars3d__namespace['EventType'][_0x19b516(0x174)],this[_0x19b516(0x19b)],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas'][_0x19b516(0x234)]['visibility']='visible',this[_0x19b516(0x20e)]=![],this['mouse_move']=![];}['setData'](_0x5163a1){const _0x228cb0=_0x1e2a71;this[_0x228cb0(0x195)](),this[_0x228cb0(0x21d)]=_0x5163a1,this[_0x228cb0(0x1d2)]['setDate'](_0x5163a1),this[_0x228cb0(0x1a4)]();}['redraw'](){if(!this['show'])return;this['windField']['setOptions'](this['options']),this['update']();}['update'](){const _0x456851=_0x1e2a71;if(this[_0x456851(0x219)])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x4fc851=this[_0x456851(0x1d2)]['getParticles']();this['_drawLines'](_0x4fc851);}this[_0x456851(0x219)]=![];}[_0x1e2a71(0x181)](_0x4cd395){const _0x4c8dd5=_0x1e2a71;this['canvasContext'][_0x4c8dd5(0x248)]='destination-in',this['canvasContext'][_0x4c8dd5(0x1e0)](0x0,0x0,this[_0x4c8dd5(0x172)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x4c8dd5(0x250)]['globalAlpha']=0.9;const _0x22db0e=this[_0x4c8dd5(0x218)]['scene']['mode']!==Cesium[_0x4c8dd5(0x228)][_0x4c8dd5(0x1a3)],_0x3b6e81=this['canvasWidth']*0.25;if(this[_0x4c8dd5(0x180)])for(let _0x114f4e=0x0,_0x4a2391=_0x4cd395[_0x4c8dd5(0x245)];_0x114f4e<_0x4a2391;_0x114f4e++){const _0x20b4a9=_0x4cd395[_0x114f4e],_0x2201b5=this['_tomap'](_0x20b4a9['lng'],_0x20b4a9[_0x4c8dd5(0x1b2)],_0x20b4a9),_0x1fe274=this['_tomap'](_0x20b4a9[_0x4c8dd5(0x1e5)],_0x20b4a9['tlat'],_0x20b4a9);if(!_0x2201b5||!_0x1fe274)continue;if(_0x22db0e&&Math['abs'](_0x2201b5[0x0]-_0x1fe274[0x0])>=_0x3b6e81)continue;this['canvasContext']['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x4c8dd5(0x180)]['getColor'](_0x20b4a9['speed']),this[_0x4c8dd5(0x250)]['moveTo'](_0x2201b5[0x0],_0x2201b5[0x1]),this['canvasContext']['lineTo'](_0x1fe274[0x0],_0x1fe274[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x4c8dd5(0x192)](),this[_0x4c8dd5(0x250)]['lineWidth']=this['lineWidth'],this['canvasContext'][_0x4c8dd5(0x24b)]=this['color'];for(let _0xef4d27=0x0,_0x3348be=_0x4cd395[_0x4c8dd5(0x245)];_0xef4d27<_0x3348be;_0xef4d27++){const _0xe6f313=_0x4cd395[_0xef4d27],_0x5c0128=this[_0x4c8dd5(0x1cc)](_0xe6f313['lng'],_0xe6f313['lat'],_0xe6f313),_0xc086be=this['_tomap'](_0xe6f313[_0x4c8dd5(0x1e5)],_0xe6f313['tlat'],_0xe6f313);if(!_0x5c0128||!_0xc086be)continue;if(_0x22db0e&&Math['abs'](_0x5c0128[0x0]-_0xc086be[0x0])>=_0x3b6e81)continue;this['canvasContext']['moveTo'](_0x5c0128[0x0],_0x5c0128[0x1]),this[_0x4c8dd5(0x250)][_0x4c8dd5(0x238)](_0xc086be[0x0],_0xc086be[0x1]);}this['canvasContext'][_0x4c8dd5(0x257)]();}}['_tomap'](_0x35272d,_0x4304c6,_0xdb19ae){const _0x30b811=_0x1e2a71,_0x4cabf9=Cesium['Cartesian3']['fromDegrees'](_0x35272d,_0x4304c6,this['fixedHeight']),_0x2968dc=this['_map']['scene'];if(_0x2968dc[_0x30b811(0x223)]===Cesium['SceneMode']['SCENE3D']){const _0x4a024e=new Cesium[(_0x30b811(0x1f1))](_0x2968dc[_0x30b811(0x23a)]['ellipsoid'],_0x2968dc[_0x30b811(0x1e9)]['positionWC']),_0x1faad8=_0x4a024e[_0x30b811(0x1bc)](_0x4cabf9);if(!_0x1faad8)return _0xdb19ae['age']=0x0,null;}const _0x177d21=Cesium[_0x30b811(0x20d)][_0x30b811(0x1d5)](this['_map'][_0x30b811(0x1b9)],_0x4cabf9);return _0x177d21?[_0x177d21['x'],_0x177d21['y']]:null;}['clear'](){const _0x1a55ee=_0x1e2a71;this[_0x1a55ee(0x1d2)]['clear'](),delete this['windData'];}[_0x1e2a71(0x1c3)](){const _0x2eecf2=_0x1e2a71;this['worker']=new Worker(this['options']['worker']),this['worker']['onmessage']=_0x135ae2=>{const _0x4e7155=_0xa2d9;this['_drawLines'](_0x135ae2[_0x4e7155(0x1ca)]['particles']),this[_0x4e7155(0x1e2)]=![];},this[_0x2eecf2(0x1d2)]={'init':_0x1293c8=>{this['worker']['postMessage']({'type':'init','options':_0x1293c8});},'setOptions':_0x4a74c8=>{const _0x4f9616=_0x2eecf2;this['worker'][_0x4f9616(0x186)]({'type':'setOptions','options':_0x4a74c8});},'setDate':_0x24b1eb=>{this['worker']['postMessage']({'type':'setDate','data':_0x24b1eb});},'update':()=>{const _0x2a7f96=_0x2eecf2;if(this[_0x2a7f96(0x1e2)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':_0x2a7f96(0x182)});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this[_0x2eecf2(0x1d2)][_0x2eecf2(0x1ef)](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x1e2a71(0x24a),{'value':!![]});
}));
