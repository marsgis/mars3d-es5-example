/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.9
 * 编译日期：2023-10-15 21:13:54
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x507d02=_0x3b14;(function(_0x15de00,_0x93e014){const _0x26cde3=_0x3b14,_0xee8b46=_0x15de00();while(!![]){try{const _0xbf8219=-parseInt(_0x26cde3(0x157))/0x1+-parseInt(_0x26cde3(0xf8))/0x2*(-parseInt(_0x26cde3(0x1a1))/0x3)+-parseInt(_0x26cde3(0x18d))/0x4+-parseInt(_0x26cde3(0xcf))/0x5+parseInt(_0x26cde3(0x135))/0x6*(parseInt(_0x26cde3(0x181))/0x7)+parseInt(_0x26cde3(0xd6))/0x8+parseInt(_0x26cde3(0xf2))/0x9;if(_0xbf8219===_0x93e014)break;else _0xee8b46['push'](_0xee8b46['shift']());}catch(_0x4c755d){_0xee8b46['push'](_0xee8b46['shift']());}}}(_0x98d2,0x9d3c7));function _0x98d2(){const _0xd068b3=['canvasWidth','OPAQUE','_onMouseDownEvent','show','EllipsoidalOccluder','Cartesian3','commandType','WindUtil','globeBoundingSphere','Rectangle','speedRate','randomizeParticles','UNSIGNED_BYTE','segmentsColor','beginPath','ShaderProgram','segments','default','sqrt','lighter','nextTrailsColor','refreshParticles','3148860mFYXiI','createRawRenderState','createFramebuffer','_maxAge','TextureMinificationFilter','currentParticlesSpeed','dimensions','6714272enNdjd','canvas','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','fromDegrees','EventType','log','blending','udata','NEAREST','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','fragmentShaderSource','GeometryAttributes','particles','removeEventListener','frameTime','textures','framebuffers','outputTexture','fadeOpacity','globalAlpha','TextureMagnificationFilter','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','getColor','particlesTextures','drawingBufferHeight','applyViewerParameters','array','WindLayer','9557919qxTKaI','drawingBufferWidth','Cesium','autoClear','xmax','round','7978YAuggm','createWindTextures','pixelSize','resize','viewerParameters','clearFramebuffers','_drawLines','max','_mountedHook','fromCssColorString','attributeLocations','globe','stroke','maxAge','pointerEvents','none','keys','length','LayerUtil','cols','primitives','visibility','colorTable','_calcUV','fill','setOptions','PixelFormat','moveTo','xmin','pow','commandToExecute','nextTrails','unbindEvent','geometry','getUVByXY','push','worker','_addedHook','_map','vertexArray','maxParticles','ymin','preRender','_data','create','_colorRamp','currentTrails','createParticlesTextures','mode','defineProperty','hidden','tlat','floor','destroy','camera','speed','updateViewerParameters','wheel','Geometry','Framebuffer','destroyParticlesTextures','180GFOMEY','vertexShaderSource','particlesWind','_onMapWhellEvent','_randomParticle','off','rawRenderState','ClearCommand','uniformMap','dropRate','_speedRate','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','colors','currentParticlesPosition','lev','createRenderingFramebuffers','lng','nextParticlesSpeed','data','layer','createTexture','toGridXY','positionWC','scene','_setOptionsHook','destination-in','canvasContext','age','_tomap','min','Compute','Math','refreshTimer','Color','822455jLtzUR','bind','FLOAT','getPixelSize','framebuffer','toDegrees','ymax','mouseUp','update','windField','Cartesian2','_showHook','SceneMode','getDefaultRenderState','screen','getColorTexture','getUVByPoint','lat','PrimitiveType','postMessage','lineWidth','tlng','depthTexture','DISABLE_GL_POSITION_LOG_DEPTH','mouseHidden','defined','color','clear','__esModule','reverseY','particlesComputing','west','postProcessingSpeed','windTextures','Sampler','addEventListener','style','mouse_down','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','add','vdata','mouseMove','4305dSiZOY','VertexArray','_onMouseUpEvent','_calc_speedRate','postProcessingPosition','clientHeight','mouse_move','_bilinearInterpolation','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','particleSystem','umin','_onMouseMoveEvent','3825340TrzZds','clientWidth','_canrefresh','getParticles','pointer-events','forEach','_onMap_preRenderEvent','ShaderSource','options','context','_createCanvas','windData','getContext','STATIC_DRAW','_updateIng','ComponentDatatype','PixelDatatype','particlesNumber','ColorRamp','rows','852nnSZBI','dropRateBump','shaderProgram','getWind','primitiveType','grid','DEPTH_COMPONENT','setData','commandList','clearCommand','preExecute','lon','lineTo','mars3d-canvasWind','particlesRendering','PI_OVER_THREE','GeometryAttribute','BoundingSphere','TRIANGLES'];_0x98d2=function(){return _0xd068b3;};return _0x98d2();}function _interopNamespace(_0x8b1c3c){const _0x168f13=_0x3b14;if(_0x8b1c3c&&_0x8b1c3c['__esModule'])return _0x8b1c3c;var _0x36dd48=Object['create'](null);return _0x8b1c3c&&Object['keys'](_0x8b1c3c)[_0x168f13(0x192)](function(_0x3753f2){const _0x187fca=_0x168f13;if(_0x3753f2!==_0x187fca(0xca)){var _0x258ed2=Object['getOwnPropertyDescriptor'](_0x8b1c3c,_0x3753f2);Object[_0x187fca(0x129)](_0x36dd48,_0x3753f2,_0x258ed2['get']?_0x258ed2:{'enumerable':!![],'get':function(){return _0x8b1c3c[_0x3753f2];}});}}),_0x36dd48['default']=_0x8b1c3c,_0x36dd48;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x2176ad,_0x504dbb){const _0x3def06=_0x2176ad*Math['cos'](Cesium$7['Math']['toRadians'](_0x504dbb));return _0x3def06;}function getV(_0x470b33,_0x263908){const _0x4ac26f=_0x470b33*Math['sin'](Cesium$7['Math']['toRadians'](_0x263908));return _0x4ac26f;}function getSpeed(_0x47faea,_0x18f4ab){const _0x2ff7aa=_0x3b14,_0x28d269=Math['sqrt'](Math['pow'](_0x47faea,0x2)+Math[_0x2ff7aa(0x115)](_0x18f4ab,0x2));return _0x28d269;}function getDirection(_0x54939c,_0x4dbe2c){const _0x4ae6ce=_0x3b14;let _0x1a8cd4=Cesium$7[_0x4ae6ce(0x154)]['toDegrees'](Math['atan2'](_0x4dbe2c,_0x54939c));return _0x1a8cd4+=_0x1a8cd4<0x0?0x168:0x0,_0x1a8cd4;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x507d02(0xf4)];class CustomPrimitive{constructor(_0x21ed28){const _0x15ea12=_0x507d02;this['commandType']=_0x21ed28['commandType'],this['geometry']=_0x21ed28['geometry'],this['attributeLocations']=_0x21ed28['attributeLocations'],this[_0x15ea12(0x1a5)]=_0x21ed28[_0x15ea12(0x1a5)],this['uniformMap']=_0x21ed28['uniformMap'],this['vertexShaderSource']=_0x21ed28[_0x15ea12(0x136)],this['fragmentShaderSource']=_0x21ed28[_0x15ea12(0xe0)],this[_0x15ea12(0x13b)]=_0x21ed28['rawRenderState'],this[_0x15ea12(0x15b)]=_0x21ed28['framebuffer'],this['outputTexture']=_0x21ed28['outputTexture'],this['autoClear']=_0x21ed28['autoClear']??![],this[_0x15ea12(0x1ab)]=_0x21ed28['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this[_0x15ea12(0x1aa)]=undefined,this[_0x15ea12(0xf5)]&&(this[_0x15ea12(0x1aa)]=new Cesium$6[(_0x15ea12(0x13c))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x15ea12(0xba)]}));}['createCommand'](_0x403f91){const _0x8fbed=_0x507d02;switch(this[_0x8fbed(0xbf)]){case'Draw':{const _0x1de810=Cesium$6['VertexArray']['fromGeometry']({'context':_0x403f91,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x8fbed(0x19a)]}),_0x2b37da=Cesium$6[_0x8fbed(0xc8)]['fromCache']({'context':_0x403f91,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x8fbed(0x136)],'fragmentShaderSource':this[_0x8fbed(0xe0)]}),_0x132181=Cesium$6['RenderState']['fromCache'](this[_0x8fbed(0x13b)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x8fbed(0x1a5)],'shaderProgram':_0x2b37da,'vertexArray':_0x1de810,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x132181,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0x8fbed(0x13d)],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x2897ab,_0xa0792e){const _0x473aab=_0x507d02;this[_0x473aab(0x119)]=_0xa0792e;const _0x228a94=Cesium$6[_0x473aab(0x182)]['fromGeometry']({'context':_0x2897ab,'geometry':this[_0x473aab(0x119)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x228a94;}[_0x507d02(0x15f)](_0x40b185){const _0x220c27=_0x507d02;if(!this['show'])return;if(_0x40b185['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6[_0x220c27(0x170)](this[_0x220c27(0x116)])&&(this['commandToExecute']=this['createCommand'](_0x40b185[_0x220c27(0x196)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x40b185[_0x220c27(0x1a9)]['push'](this['clearCommand']),_0x40b185[_0x220c27(0x1a9)][_0x220c27(0x11b)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x4acca3=_0x507d02;if(this[_0x4acca3(0x1aa)]){var _0x28e1ec,_0x57538c;(_0x28e1ec=this[_0x4acca3(0x1aa)])!==null&&_0x28e1ec!==void 0x0&&_0x28e1ec[_0x4acca3(0x11f)]&&this['clearCommand']['vertexArray']['destroy'](),(_0x57538c=this['clearCommand'])!==null&&_0x57538c!==void 0x0&&_0x57538c['shaderProgram']&&this['clearCommand'][_0x4acca3(0x1a3)]['destroy'](),delete this[_0x4acca3(0x1aa)];}return this[_0x4acca3(0x116)]&&(this[_0x4acca3(0x116)]['vertexArray']&&this['commandToExecute']['vertexArray'][_0x4acca3(0x12d)](),this[_0x4acca3(0x116)][_0x4acca3(0x1a3)]&&this['commandToExecute'][_0x4acca3(0x1a3)]['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x4c9675=function(){const _0x142faa=_0x3b14,_0x58b037=new Cesium$5[(_0x142faa(0x132))]({'attributes':new Cesium$5[(_0x142faa(0xe1))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x142faa(0x19c)][_0x142faa(0x159)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x142faa(0x159)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x58b037;},_0x347608=function(_0x1edc1a,_0x251612){const _0x2660c1=_0x3b14;if(Cesium$5[_0x2660c1(0x170)](_0x251612)){const _0x2f561f={};_0x2f561f['arrayBufferView']=_0x251612,_0x1edc1a['source']=_0x2f561f;}const _0x689004=new Cesium$5['Texture'](_0x1edc1a);return _0x689004;},_0x3943c0=function(_0x1aa5ee,_0x48a609,_0x332eee){const _0x22e4d2=_0x3b14,_0x3983f9=new Cesium$5[(_0x22e4d2(0x133))]({'context':_0x1aa5ee,'colorTextures':[_0x48a609],'depthTexture':_0x332eee});return _0x3983f9;},_0x895c63=function(_0x538264){const _0x94f30f=_0x3b14,_0x44dfbb=!![],_0x264e3e=![],_0x46a8b1={'viewport':_0x538264['viewport'],'depthTest':_0x538264['depthTest'],'depthMask':_0x538264['depthMask'],'blending':_0x538264[_0x94f30f(0xdc)]},_0x5e84f3=Cesium$5['Appearance'][_0x94f30f(0x164)](_0x44dfbb,_0x264e3e,_0x46a8b1);return _0x5e84f3;},_0x225e3d=function(_0x361af7){const _0x53077c=_0x3b14,_0x4a9997={},_0x3007bf=Cesium$5['Math']['mod'](_0x361af7[_0x53077c(0x176)],Cesium$5[_0x53077c(0x154)]['TWO_PI']),_0x45ee6e=Cesium$5['Math']['mod'](_0x361af7['east'],Cesium$5[_0x53077c(0x154)]['TWO_PI']),_0x4957b9=_0x361af7['width'];let _0x512c9a,_0x422a9b;_0x4957b9>Cesium$5[_0x53077c(0x154)]['THREE_PI_OVER_TWO']?(_0x512c9a=0x0,_0x422a9b=Cesium$5['Math']['TWO_PI']):_0x45ee6e-_0x3007bf<_0x4957b9?(_0x512c9a=_0x3007bf,_0x422a9b=_0x3007bf+_0x4957b9):(_0x512c9a=_0x3007bf,_0x422a9b=_0x45ee6e);_0x4a9997['lon']={'min':Cesium$5['Math']['toDegrees'](_0x512c9a),'max':Cesium$5[_0x53077c(0x154)]['toDegrees'](_0x422a9b)};const _0x179941=_0x361af7['south'],_0x442584=_0x361af7['north'],_0x548e33=_0x361af7['height'],_0x453223=_0x548e33>Cesium$5['Math']['PI']/0xc?_0x548e33/0x2:0x0;let _0x5c5068=Cesium$5[_0x53077c(0x154)]['clampToLatitudeRange'](_0x179941-_0x453223),_0x4541b3=Cesium$5[_0x53077c(0x154)]['clampToLatitudeRange'](_0x442584+_0x453223);return _0x5c5068<-Cesium$5[_0x53077c(0x154)][_0x53077c(0x1b0)]&&(_0x5c5068=-Cesium$5['Math']['PI_OVER_TWO']),_0x4541b3>Cesium$5['Math'][_0x53077c(0x1b0)]&&(_0x4541b3=Cesium$5[_0x53077c(0x154)]['PI_OVER_TWO']),_0x4a9997[_0x53077c(0x168)]={'min':Cesium$5['Math'][_0x53077c(0x15c)](_0x5c5068),'max':Cesium$5[_0x53077c(0x154)]['toDegrees'](_0x4541b3)},_0x4a9997;};return{'getFullscreenQuad':_0x4c9675,'createTexture':_0x347608,'createFramebuffer':_0x3943c0,'createRawRenderState':_0x895c63,'viewRectangleToLonLatRange':_0x225e3d};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag=_0x507d02(0x17d),fullscreen_vert=_0x507d02(0xeb),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x507d02(0x140);const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0xdde73d,_0x4aa451,_0x2da8c1,_0x5dc013,_0x57e5a0){const _0x3041e3=_0x507d02;this['createRenderingTextures'](_0xdde73d,_0x4aa451,_0x2da8c1[_0x3041e3(0x141)]),this['createRenderingFramebuffers'](_0xdde73d),this['createRenderingPrimitives'](_0xdde73d,_0x2da8c1,_0x5dc013,_0x57e5a0);}['createRenderingTextures'](_0x215853,_0x2786a0,_0x1fab2e){const _0xeb4eda=_0x507d02,_0x4c20e0={'context':_0x215853,'width':_0x215853['drawingBufferWidth'],'height':_0x215853['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0xeb4eda(0x19d)][_0xeb4eda(0xc5)]},_0x582bc3={'context':_0x215853,'width':_0x215853['drawingBufferWidth'],'height':_0x215853[_0xeb4eda(0xee)],'pixelFormat':Cesium$4['PixelFormat'][_0xeb4eda(0x1a7)],'pixelDatatype':Cesium$4[_0xeb4eda(0x19d)]['UNSIGNED_INT']},_0x58f1e4=_0x1fab2e[_0xeb4eda(0x109)],_0x115253=new Float32Array(_0x58f1e4*0x3);for(let _0x410369=0x0;_0x410369<_0x58f1e4;_0x410369++){const _0x257443=Cesium$4[_0xeb4eda(0x156)][_0xeb4eda(0x101)](_0x1fab2e[_0x410369]);_0x115253[0x3*_0x410369]=_0x257443['red'],_0x115253[0x3*_0x410369+0x1]=_0x257443['green'],_0x115253[0x3*_0x410369+0x2]=_0x257443['blue'];}const _0x21f52f={'context':_0x215853,'width':_0x58f1e4,'height':0x1,'pixelFormat':Cesium$4[_0xeb4eda(0x112)]['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0xeb4eda(0xd3)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x4c20e0),'segmentsDepth':Util['createTexture'](_0x582bc3),'currentTrailsColor':Util['createTexture'](_0x4c20e0),'currentTrailsDepth':Util[_0xeb4eda(0x149)](_0x582bc3),'nextTrailsColor':Util[_0xeb4eda(0x149)](_0x4c20e0),'nextTrailsDepth':Util[_0xeb4eda(0x149)](_0x582bc3),'colorTable':Util[_0xeb4eda(0x149)](_0x21f52f,_0x115253)};}[_0x507d02(0x144)](_0x9e2654){const _0x1ea1f4=_0x507d02;this['framebuffers']={'segments':Util[_0x1ea1f4(0xd1)](_0x9e2654,this[_0x1ea1f4(0xe5)][_0x1ea1f4(0xc6)],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x9e2654,this['textures']['currentTrailsColor'],this[_0x1ea1f4(0xe5)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x9e2654,this['textures'][_0x1ea1f4(0xcd)],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x4aa03c){const _0x573130=_0x507d02,_0x593cf5=0x4;let _0xf64148=[];for(let _0x1ca5fa=0x0;_0x1ca5fa<_0x4aa03c['particlesTextureSize'];_0x1ca5fa++){for(let _0x463510=0x0;_0x463510<_0x4aa03c['particlesTextureSize'];_0x463510++){for(let _0x56aae1=0x0;_0x56aae1<_0x593cf5;_0x56aae1++){_0xf64148['push'](_0x1ca5fa/_0x4aa03c['particlesTextureSize']),_0xf64148['push'](_0x463510/_0x4aa03c['particlesTextureSize']);}}}_0xf64148=new Float32Array(_0xf64148);let _0x5c35f0=[];const _0x19e675=[-0x1,0x1],_0x26b241=[-0x1,0x1];for(let _0x25384c=0x0;_0x25384c<_0x4aa03c['maxParticles'];_0x25384c++){for(let _0x357823=0x0;_0x357823<_0x593cf5/0x2;_0x357823++){for(let _0x2bff67=0x0;_0x2bff67<_0x593cf5/0x2;_0x2bff67++){_0x5c35f0['push'](_0x19e675[_0x357823]),_0x5c35f0[_0x573130(0x11b)](_0x26b241[_0x2bff67]),_0x5c35f0[_0x573130(0x11b)](0x0);}}}_0x5c35f0=new Float32Array(_0x5c35f0);const _0x43e9ba=0x6*_0x4aa03c['maxParticles'],_0x4ada2c=new Uint32Array(_0x43e9ba);for(let _0x330848=0x0,_0x8a946c=0x0,_0x354e94=0x0;_0x330848<_0x4aa03c['maxParticles'];_0x330848++){_0x4ada2c[_0x8a946c++]=_0x354e94+0x0,_0x4ada2c[_0x8a946c++]=_0x354e94+0x1,_0x4ada2c[_0x8a946c++]=_0x354e94+0x2,_0x4ada2c[_0x8a946c++]=_0x354e94+0x2,_0x4ada2c[_0x8a946c++]=_0x354e94+0x1,_0x4ada2c[_0x8a946c++]=_0x354e94+0x3,_0x354e94+=0x4;}const _0xf15cd=new Cesium$4['Geometry']({'attributes':new Cesium$4[(_0x573130(0xe1))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0xf64148}),'normal':new Cesium$4[(_0x573130(0x1b1))]({'componentDatatype':Cesium$4[_0x573130(0x19c)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x5c35f0})}),'indices':_0x4ada2c});return _0xf15cd;}['createRenderingPrimitives'](_0x1c52c0,_0x29d19d,_0x37431b,_0x2d79a2){const _0x276aa9=_0x507d02,_0x460958=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x29d19d),'primitiveType':Cesium$4['PrimitiveType'][_0x276aa9(0xb8)],'uniformMap':{'currentParticlesPosition':function(){return _0x2d79a2['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x2d79a2['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x2d79a2['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x460958['textures']['colorTable'];},'aspect':function(){const _0x2d9e07=_0x276aa9;return _0x1c52c0[_0x2d9e07(0xf3)]/_0x1c52c0['drawingBufferHeight'];},'pixelSize':function(){const _0x507513=_0x276aa9;return _0x37431b[_0x507513(0xfa)];},'lineWidth':function(){const _0x4de190=_0x276aa9;return _0x29d19d[_0x4de190(0x16b)];},'particleHeight':function(){return _0x29d19d['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x276aa9(0x194))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x276aa9(0x169)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x363635=_0x276aa9;return _0x460958[_0x363635(0xe5)]['segmentsColor'];},'segmentsDepthTexture':function(){return _0x460958['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x3fb4f2=_0x276aa9;return _0x460958['framebuffers'][_0x3fb4f2(0x126)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x11b5d6=_0x276aa9;return _0x460958[_0x11b5d6(0xe6)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x2b36e3=_0x276aa9;return _0x29d19d[_0x2b36e3(0xe8)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x276aa9(0x16e)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x276aa9(0xd0)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x55f04d=_0x276aa9,_0x41a7cd=_0x460958['framebuffers']['currentTrails'];_0x460958['framebuffers']['currentTrails']=_0x460958['framebuffers']['nextTrails'],_0x460958['framebuffers']['nextTrails']=_0x41a7cd,_0x460958['primitives']['trails']['commandToExecute'][_0x55f04d(0x15b)]=_0x460958['framebuffers'][_0x55f04d(0x117)],_0x460958['primitives']['trails']['clearCommand'][_0x55f04d(0x15b)]=_0x460958['framebuffers'][_0x55f04d(0x117)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x4c454f=_0x276aa9;return _0x460958['framebuffers'][_0x4c454f(0x117)][_0x4c454f(0x166)](0x0);},'trailsDepthTexture':function(){const _0x460f59=_0x276aa9;return _0x460958['framebuffers'][_0x460f59(0x117)][_0x460f59(0x16d)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x276aa9(0xd0)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x507d02(0xd8),updateSpeed_frag=_0x507d02(0xdf),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x507d02(0x189);function _0x3b14(_0x52eebc,_0xa85a9a){const _0x98d2f4=_0x98d2();return _0x3b14=function(_0x3b14f3,_0x40f4f5){_0x3b14f3=_0x3b14f3-0xb8;let _0x1fa200=_0x98d2f4[_0x3b14f3];return _0x1fa200;},_0x3b14(_0x52eebc,_0xa85a9a);}const Cesium$3=mars3d__namespace[_0x507d02(0xf4)];class ParticlesComputing{constructor(_0x2359f2,_0x5edd55,_0x79e239,_0x12da4f){const _0x309170=_0x507d02;this[_0x309170(0x147)]=_0x5edd55,this[_0x309170(0xf9)](_0x2359f2,_0x5edd55),this['createParticlesTextures'](_0x2359f2,_0x79e239,_0x12da4f),this['createComputingPrimitives'](_0x5edd55,_0x79e239,_0x12da4f);}[_0x507d02(0xf9)](_0x2a9799,_0x39aeb0){const _0x33ba12=_0x507d02,_0x5936dd={'context':_0x2a9799,'width':_0x39aeb0[_0x33ba12(0xd5)]['lon'],'height':_0x39aeb0['dimensions'][_0x33ba12(0x168)]*(_0x39aeb0[_0x33ba12(0xd5)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x33ba12(0x19d)][_0x33ba12(0x159)],'flipY':![],'sampler':new Cesium$3[(_0x33ba12(0x179))]({'minificationFilter':Cesium$3[_0x33ba12(0xd3)]['NEAREST'],'magnificationFilter':Cesium$3[_0x33ba12(0xea)][_0x33ba12(0xde)]})};this['windTextures']={'U':Util['createTexture'](_0x5936dd,_0x39aeb0['U'][_0x33ba12(0xf0)]),'V':Util[_0x33ba12(0x149)](_0x5936dd,_0x39aeb0['V']['array'])};}[_0x507d02(0x127)](_0x340f85,_0x55a188,_0x3b2826){const _0x17cce8=_0x507d02,_0x4d995b={'context':_0x340f85,'width':_0x55a188['particlesTextureSize'],'height':_0x55a188['particlesTextureSize'],'pixelFormat':Cesium$3[_0x17cce8(0x112)]['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x17cce8(0xde)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x1032de=this[_0x17cce8(0xc4)](_0x55a188['maxParticles'],_0x3b2826),_0x5ea71c=new Float32Array(0x4*_0x55a188[_0x17cce8(0x120)])[_0x17cce8(0x110)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x4d995b),'currentParticlesPosition':Util['createTexture'](_0x4d995b,_0x1032de),'nextParticlesPosition':Util['createTexture'](_0x4d995b,_0x1032de),'currentParticlesSpeed':Util['createTexture'](_0x4d995b,_0x5ea71c),'nextParticlesSpeed':Util[_0x17cce8(0x149)](_0x4d995b,_0x5ea71c),'postProcessingPosition':Util[_0x17cce8(0x149)](_0x4d995b,_0x1032de),'postProcessingSpeed':Util[_0x17cce8(0x149)](_0x4d995b,_0x5ea71c)};}['randomizeParticles'](_0x369b99,_0x4fcf09){const _0x5ebc7f=_0x507d02,_0x8582e5=new Float32Array(0x4*_0x369b99);for(let _0x4e7636=0x0;_0x4e7636<_0x369b99;_0x4e7636++){_0x8582e5[0x4*_0x4e7636]=Cesium$3[_0x5ebc7f(0x154)]['randomBetween'](_0x4fcf09['lonRange']['x'],_0x4fcf09['lonRange']['y']),_0x8582e5[0x4*_0x4e7636+0x1]=Cesium$3['Math']['randomBetween'](_0x4fcf09['latRange']['x'],_0x4fcf09['latRange']['y']),_0x8582e5[0x4*_0x4e7636+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data']['lev']['max']),_0x8582e5[0x4*_0x4e7636+0x3]=0x0;}return _0x8582e5;}['destroyParticlesTextures'](){const _0x247158=_0x507d02;Object['keys'](this['particlesTextures'])[_0x247158(0x192)](_0x44cd8f=>{const _0x274124=_0x247158;this['particlesTextures'][_0x44cd8f][_0x274124(0x12d)]();});}['createComputingPrimitives'](_0xd5903c,_0x28e1b9,_0x241728){const _0x3a2b99=_0x507d02,_0xb44240=new Cesium$3[(_0x3a2b99(0xbe))](_0xd5903c['dimensions'][_0x3a2b99(0x1ac)],_0xd5903c['dimensions']['lat'],_0xd5903c[_0x3a2b99(0xd5)]['lev']),_0xd71aa4=new Cesium$3['Cartesian3'](_0xd5903c['lon']['min'],_0xd5903c[_0x3a2b99(0x168)]['min'],_0xd5903c['lev'][_0x3a2b99(0x152)]),_0x4238ef=new Cesium$3['Cartesian3'](_0xd5903c['lon']['max'],_0xd5903c[_0x3a2b99(0x168)][_0x3a2b99(0xff)],_0xd5903c['lev'][_0x3a2b99(0xff)]),_0x43e400=new Cesium$3['Cartesian3']((_0x4238ef['x']-_0xd71aa4['x'])/(_0xb44240['x']-0x1),(_0x4238ef['y']-_0xd71aa4['y'])/(_0xb44240['y']-0x1),_0xb44240['z']>0x1?(_0x4238ef['z']-_0xd71aa4['z'])/(_0xb44240['z']-0x1):0x1),_0x45b4a1=new Cesium$3['Cartesian2'](_0xd5903c['U']['min'],_0xd5903c['U']['max']),_0x2ee9b2=new Cesium$3['Cartesian2'](_0xd5903c['V']['min'],_0xd5903c['V']['max']),_0x5e6e38=this;this[_0x3a2b99(0x10c)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x5e6e38['windTextures']['U'];},'V':function(){return _0x5e6e38['windTextures']['V'];},'currentParticlesPosition':function(){const _0x3b1129=_0x3a2b99;return _0x5e6e38[_0x3b1129(0xed)][_0x3b1129(0x142)];},'dimension':function(){return _0xb44240;},'minimum':function(){return _0xd71aa4;},'maximum':function(){return _0x4238ef;},'interval':function(){return _0x43e400;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x2d3c38=_0x3a2b99;_0x5e6e38['primitives'][_0x2d3c38(0x1a4)][_0x2d3c38(0x116)]['outputTexture']=_0x5e6e38[_0x2d3c38(0xed)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x3ff83e=_0x3a2b99;return _0x5e6e38['particlesTextures'][_0x3ff83e(0xd4)];},'particlesWind':function(){const _0x3109a4=_0x3a2b99;return _0x5e6e38['particlesTextures'][_0x3109a4(0x137)];},'uSpeedRange':function(){return _0x45b4a1;},'vSpeedRange':function(){return _0x2ee9b2;},'pixelSize':function(){const _0x1cbbd1=_0x3a2b99;return _0x241728[_0x1cbbd1(0xfa)];},'speedFactor':function(){return _0x28e1b9['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x39355b=_0x3a2b99,_0x291bee=_0x5e6e38[_0x39355b(0xed)]['currentParticlesSpeed'];_0x5e6e38['particlesTextures'][_0x39355b(0xd4)]=_0x5e6e38[_0x39355b(0xed)][_0x39355b(0x177)],_0x5e6e38['particlesTextures'][_0x39355b(0x177)]=_0x291bee,_0x5e6e38[_0x39355b(0x10c)]['updateSpeed']['commandToExecute'][_0x39355b(0xe7)]=_0x5e6e38[_0x39355b(0xed)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x3a2b99(0x153),'uniformMap':{'currentParticlesPosition':function(){return _0x5e6e38['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x5c0c24=_0x3a2b99;return _0x5e6e38['particlesTextures'][_0x5c0c24(0xd4)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x496f94=_0x3a2b99,_0x59bc9a=_0x5e6e38['particlesTextures']['currentParticlesPosition'];_0x5e6e38['particlesTextures'][_0x496f94(0x142)]=_0x5e6e38['particlesTextures']['postProcessingPosition'],_0x5e6e38[_0x496f94(0xed)]['postProcessingPosition']=_0x59bc9a,_0x5e6e38['primitives']['updatePosition'][_0x496f94(0x116)]['outputTexture']=_0x5e6e38[_0x496f94(0xed)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x3981cd=_0x3a2b99;return _0x5e6e38[_0x3981cd(0xed)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x17244f=_0x3a2b99;return _0x5e6e38['particlesTextures'][_0x17244f(0x146)];},'lonRange':function(){return _0x241728['lonRange'];},'latRange':function(){return _0x241728['latRange'];},'randomCoefficient':function(){const _0x3179ba=Math['random']();return _0x3179ba;},'dropRate':function(){const _0x266f88=_0x3a2b99;return _0x28e1b9[_0x266f88(0x13e)];},'dropRateBump':function(){const _0x452bc3=_0x3a2b99;return _0x28e1b9[_0x452bc3(0x1a2)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x3a2b99(0xed)]['postProcessingPosition'],'preExecute':function(){const _0x3c5da8=_0x3a2b99;_0x5e6e38['primitives'][_0x3c5da8(0x185)]['commandToExecute']['outputTexture']=_0x5e6e38['particlesTextures'][_0x3c5da8(0x185)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x3a2b99(0x153),'uniformMap':{'postProcessingPosition':function(){return _0x5e6e38['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x5e6e38['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x3a2b99(0xed)]['postProcessingSpeed'],'preExecute':function(){const _0x2ed819=_0x3a2b99;_0x5e6e38['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x5e6e38[_0x2ed819(0xed)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x253c16,_0x2b7ef7,_0xe8b553,_0x319c74){const _0x459a7b=_0x507d02;this[_0x459a7b(0x196)]=_0x253c16,_0x2b7ef7={..._0x2b7ef7},_0x2b7ef7['udata']&&_0x2b7ef7['vdata']&&(_0x2b7ef7['dimensions']={},_0x2b7ef7['dimensions'][_0x459a7b(0x1ac)]=_0x2b7ef7['cols'],_0x2b7ef7['dimensions']['lat']=_0x2b7ef7[_0x459a7b(0x1a0)],_0x2b7ef7[_0x459a7b(0xd5)]['lev']=_0x2b7ef7[_0x459a7b(0x143)]||0x1,_0x2b7ef7['lon']={},_0x2b7ef7['lon'][_0x459a7b(0x152)]=_0x2b7ef7['xmin'],_0x2b7ef7['lon']['max']=_0x2b7ef7[_0x459a7b(0xf6)],_0x2b7ef7['lat']={},_0x2b7ef7['lat']['min']=_0x2b7ef7['ymin'],_0x2b7ef7['lat']['max']=_0x2b7ef7['ymax'],_0x2b7ef7['lev']={},_0x2b7ef7['lev']['min']=_0x2b7ef7['levmin']??0x1,_0x2b7ef7['lev']['max']=_0x2b7ef7['levmax']??0x1,_0x2b7ef7['U']={},_0x2b7ef7['U']['array']=new Float32Array(_0x2b7ef7[_0x459a7b(0xdd)]),_0x2b7ef7['U']['min']=_0x2b7ef7[_0x459a7b(0x18b)]??Math['min'](..._0x2b7ef7['udata']),_0x2b7ef7['U']['max']=_0x2b7ef7['umax']??Math[_0x459a7b(0xff)](..._0x2b7ef7['udata']),_0x2b7ef7['V']={},_0x2b7ef7['V']['array']=new Float32Array(_0x2b7ef7['vdata']),_0x2b7ef7['V']['min']=_0x2b7ef7['vmin']??Math['min'](..._0x2b7ef7[_0x459a7b(0x17f)]),_0x2b7ef7['V']['max']=_0x2b7ef7['vmax']??Math['max'](..._0x2b7ef7['vdata'])),this['data']=_0x2b7ef7,this['options']=_0xe8b553,this['viewerParameters']=_0x319c74,this[_0x459a7b(0x175)]=new ParticlesComputing(this['context'],this['data'],this[_0x459a7b(0x195)],this['viewerParameters']),this[_0x459a7b(0x1af)]=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x459a7b(0xfc)],this['particlesComputing']);}['canvasResize'](_0x611328){const _0x134b95=_0x507d02;this['particlesComputing'][_0x134b95(0x134)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0xa92879=>{this['particlesComputing']['windTextures'][_0xa92879]['destroy']();}),this[_0x134b95(0x1af)][_0x134b95(0xe5)]['colorTable'][_0x134b95(0x12d)](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x134b95(0x192)](_0x40485e=>{const _0x108048=_0x134b95;this[_0x108048(0x1af)]['framebuffers'][_0x40485e]['destroy']();}),this[_0x134b95(0x196)]=_0x611328,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0x134b95(0x175)]);}[_0x507d02(0xfd)](){const _0x4eabe2=_0x507d02,_0x29e93c=new Cesium$2[(_0x4eabe2(0x13c))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x4eabe2(0xba)]});Object['keys'](this[_0x4eabe2(0x1af)][_0x4eabe2(0xe6)])['forEach'](_0x158b46=>{const _0xfea417=_0x4eabe2;_0x29e93c[_0xfea417(0x15b)]=this['particlesRendering']['framebuffers'][_0x158b46],_0x29e93c['execute'](this[_0xfea417(0x196)]);});}[_0x507d02(0xce)](_0x2c5e28){const _0x1d2bab=_0x507d02;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x1d2bab(0x175)]['createParticlesTextures'](this['context'],this['options'],this['viewerParameters']);if(_0x2c5e28){var _0x4fc9ba,_0x24daa7;const _0x1fb19d=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives'][_0x1d2bab(0xc9)][_0x1d2bab(0x119)]=_0x1fb19d;const _0x5bcd29=Cesium$2['VertexArray']['fromGeometry']({'context':this[_0x1d2bab(0x196)],'geometry':_0x1fb19d,'attributeLocations':this['particlesRendering'][_0x1d2bab(0x10c)]['segments'][_0x1d2bab(0x102)],'bufferUsage':Cesium$2['BufferUsage'][_0x1d2bab(0x19a)]});(_0x4fc9ba=this['particlesRendering']['primitives'])!==null&&_0x4fc9ba!==void 0x0&&(_0x24daa7=_0x4fc9ba['segments'])!==null&&_0x24daa7!==void 0x0&&_0x24daa7['commandToExecute']&&(this['particlesRendering']['primitives'][_0x1d2bab(0xc9)]['commandToExecute']['vertexArray']=_0x5bcd29);}}['setOptions'](_0x309c11){const _0xc0ea11=_0x507d02;let _0x138101=![];this[_0xc0ea11(0x195)]['maxParticles']!==_0x309c11[_0xc0ea11(0x120)]&&(_0x138101=!![]),Object['keys'](_0x309c11)['forEach'](_0x3c30a3=>{this['options'][_0x3c30a3]=_0x309c11[_0x3c30a3];}),this[_0xc0ea11(0xce)](_0x138101);}['applyViewerParameters'](_0x68b862){const _0x19b534=_0x507d02;Object['keys'](_0x68b862)['forEach'](_0x4e632c=>{this['viewerParameters'][_0x4e632c]=_0x68b862[_0x4e632c];}),this[_0x19b534(0xce)](![]);}['destroy'](){const _0x51f85f=_0x507d02;clearTimeout(this['canrefresh']),this[_0x51f85f(0x175)][_0x51f85f(0x134)](),Object['keys'](this['particlesComputing'][_0x51f85f(0x178)])[_0x51f85f(0x192)](_0x23d08b=>{this['particlesComputing']['windTextures'][_0x23d08b]['destroy']();}),this['particlesRendering'][_0x51f85f(0xe5)][_0x51f85f(0x10e)][_0x51f85f(0x12d)](),Object[_0x51f85f(0x108)](this['particlesRendering'][_0x51f85f(0xe6)])['forEach'](_0x5688c4=>{const _0x433737=_0x51f85f;this['particlesRendering'][_0x433737(0xe6)][_0x5688c4]['destroy']();});for(const _0x59d543 in this){delete this[_0x59d543];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x507d02(0x148)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x3142a9={}){_0x3142a9={...DEF_OPTIONS,..._0x3142a9},super(_0x3142a9),this['_setOptionsHook'](_0x3142a9);}get['layer'](){const _0xc8f10b=_0x507d02;return this[_0xc8f10b(0x10c)];}get[_0x507d02(0x147)](){const _0x2b54bd=_0x507d02;return this[_0x2b54bd(0x123)];}set['data'](_0x3fda4c){this['setData'](_0x3fda4c);}get['colors'](){return this['options']['colors'];}set['colors'](_0x125aae){const _0x568441=_0x507d02;this['options'][_0x568441(0x141)]=_0x125aae,this[_0x568441(0x18a)]&&this['particleSystem'][_0x568441(0x111)]({'colors':_0x125aae}),this['resize']();}[_0x507d02(0x100)](){}['_addedHook'](){const _0xebee05=_0x507d02;this['scene']=this[_0xebee05(0x11e)]['scene'],this['camera']=this['_map'][_0xebee05(0x12e)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this[_0xebee05(0x11e)]['scene']['primitives']['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0xebee05(0x161))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0xebee05(0x1b2))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType'][_0xebee05(0x131)],this[_0xebee05(0x138)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0xebee05(0xbb)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace[_0xebee05(0xda)]['mouseMove'],this[_0xebee05(0x18c)],this),this['_data']&&this['setData'](this[_0xebee05(0x123)]);}['_removedHook'](){const _0x495bff=_0x507d02;window['removeEventListener']('resize',this[_0x495bff(0xfb)]),this[_0x495bff(0x11e)]['off'](mars3d__namespace[_0x495bff(0xda)]['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace[_0x495bff(0xda)]['wheel'],this[_0x495bff(0x138)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x495bff(0x15e)],this[_0x495bff(0x183)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x495bff(0x180)],this[_0x495bff(0x18c)],this),this[_0x495bff(0x10c)]['removeAll'](),this['_map'][_0x495bff(0x14c)]['primitives']['remove'](this[_0x495bff(0x10c)]);}['resize'](){const _0x33f19e=_0x507d02;if(!this[_0x33f19e(0xbc)]||!this[_0x33f19e(0x18a)])return;this[_0x33f19e(0x10c)]['show']=![],this['primitives']['removeAll'](),this[_0x33f19e(0x11e)]['once'](mars3d__namespace['EventType'][_0x33f19e(0x122)],this['_onMap_preRenderEvent'],this);}[_0x507d02(0x193)](_0x34faff){const _0x419401=_0x507d02;this['particleSystem']['canvasResize'](this[_0x419401(0x14c)]['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x507d02(0x138)](_0x1f2c90){const _0x525675=_0x507d02;clearTimeout(this[_0x525675(0x155)]);if(!this['show']||!this['particleSystem'])return;this[_0x525675(0x10c)]['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x300779=_0x525675;if(!this[_0x300779(0xbc)])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x3bdb16){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x4b72c6){const _0x306543=_0x507d02;if(!this[_0x306543(0xbc)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}[_0x507d02(0x183)](_0x350650){const _0x5d1788=_0x507d02;if(!this[_0x5d1788(0xbc)]||!this[_0x5d1788(0x18a)])return;this[_0x5d1788(0x17c)]&&this['mouse_move']&&this['redraw'](),this['primitives'][_0x5d1788(0xbc)]=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x1ac478=_0x507d02;if(!this[_0x1ac478(0x11e)]||!this['show'])return;this[_0x1ac478(0x130)](),this['particleSystem'][_0x1ac478(0xef)](this['viewerParameters']),this['primitives']['show']=!![];}[_0x507d02(0x1a8)](_0x277b46){const _0x2805a0=_0x507d02;this['_data']=_0x277b46,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene'][_0x2805a0(0x196)],_0x277b46,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}[_0x507d02(0x14d)](_0x5b9765,_0x1bd365){const _0x457519=_0x507d02;if(_0x5b9765)for(const _0x395bef in _0x5b9765){this[_0x395bef]=_0x5b9765[_0x395bef];}this[_0x457519(0x18a)]&&this[_0x457519(0x18a)]['setOptions'](this['getOptions']());}['getOptions'](){const _0xa03778=_0x507d02,_0x2e7085=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x2e7085*_0x2e7085,{'particlesTextureSize':_0x2e7085,'maxParticles':this[_0xa03778(0x19e)],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0xa03778(0xe8)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x3e6295=_0x507d02;this['primitives'][_0x3e6295(0x17e)](this['particleSystem']['particlesComputing'][_0x3e6295(0x10c)]['getWind']),this['primitives'][_0x3e6295(0x17e)](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this[_0x3e6295(0x10c)]['add'](this['particleSystem'][_0x3e6295(0x175)]['primitives']['updatePosition']),this[_0x3e6295(0x10c)]['add'](this[_0x3e6295(0x18a)][_0x3e6295(0x175)]['primitives'][_0x3e6295(0x185)]),this['primitives']['add'](this[_0x3e6295(0x18a)][_0x3e6295(0x175)][_0x3e6295(0x10c)][_0x3e6295(0x177)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['segments']),this[_0x3e6295(0x10c)]['add'](this['particleSystem'][_0x3e6295(0x1af)]['primitives']['trails']),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x3e6295(0x10c)][_0x3e6295(0x165)]);}['updateViewerParameters'](){const _0x23b13f=_0x507d02;let _0x44ac4a=this[_0x23b13f(0x12e)]['computeViewRectangle'](this[_0x23b13f(0x14c)][_0x23b13f(0x103)]['ellipsoid']);if(!_0x44ac4a){const _0x2da9d5=this[_0x23b13f(0x11e)]['getExtent']();_0x44ac4a=Cesium$1[_0x23b13f(0xc2)][_0x23b13f(0xd9)](_0x2da9d5['xmin'],_0x2da9d5['ymin'],_0x2da9d5['xmax'],_0x2da9d5['ymax']);}const _0x32ec9d=Util['viewRectangleToLonLatRange'](_0x44ac4a);this['viewerParameters']['lonRange']['x']=_0x32ec9d['lon'][_0x23b13f(0x152)],this['viewerParameters']['lonRange']['y']=_0x32ec9d['lon']['max'],this[_0x23b13f(0xfc)]['latRange']['x']=_0x32ec9d['lat']['min'],this['viewerParameters']['latRange']['y']=_0x32ec9d['lat']['max'];const _0x36e3f3=this['camera'][_0x23b13f(0x15a)](this[_0x23b13f(0xc1)],this['scene']['drawingBufferWidth'],this['scene'][_0x23b13f(0xee)]);_0x36e3f3>0x0&&(this['viewerParameters']['pixelSize']=_0x36e3f3);}}mars3d__namespace[_0x507d02(0x10a)]['register']('wind',WindLayer),mars3d__namespace['layer'][_0x507d02(0xf1)]=WindLayer;class CanvasParticle{constructor(){const _0x4b526c=_0x507d02;this['lng']=null,this['lat']=null,this['tlng']=null,this[_0x4b526c(0x12b)]=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x576285 in this){delete this[_0x576285];}}}class CanvasWindField{constructor(_0x5162c1){this['setOptions'](_0x5162c1);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x516d30){const _0x180f3e=_0x507d02;this['_speedRate']=(0x64-(_0x516d30>0x63?0x63:_0x516d30))*0x64,this[_0x180f3e(0x184)]=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x180f3e(0x121)])/this[_0x180f3e(0x13f)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x5c5ed9){const _0x4f5849=_0x507d02;this[_0x4f5849(0xd2)]=_0x5c5ed9;}['setOptions'](_0x2dee7f){const _0x1f2fe6=_0x507d02;this[_0x1f2fe6(0x195)]=_0x2dee7f,this[_0x1f2fe6(0x105)]=_0x2dee7f[_0x1f2fe6(0x105)]||0x78,this[_0x1f2fe6(0xc3)]=_0x2dee7f['speedRate']||0x32,this['particles']=[];const _0x2ae3f9=_0x2dee7f['particlesNumber']||0x1000;for(let _0x17372f=0x0;_0x17372f<_0x2ae3f9;_0x17372f++){const _0x10ca02=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x10ca02);}}['setDate'](_0x20d593){const _0x2c1ed0=_0x507d02;this['rows']=_0x20d593['rows'],this['cols']=_0x20d593['cols'],this['xmin']=_0x20d593[_0x2c1ed0(0x114)],this['xmax']=_0x20d593[_0x2c1ed0(0xf6)],this[_0x2c1ed0(0x121)]=_0x20d593['ymin'],this['ymax']=_0x20d593[_0x2c1ed0(0x15d)],this[_0x2c1ed0(0x1a6)]=[];const _0x22c30e=_0x20d593[_0x2c1ed0(0xdd)],_0x1fa931=_0x20d593['vdata'];let _0x38bc33=![];_0x22c30e[_0x2c1ed0(0x109)]===this['rows']&&_0x22c30e[0x0]['length']===this[_0x2c1ed0(0x10b)]&&(_0x38bc33=!![]);let _0x3243b5=0x0,_0x33ceee=null,_0x5e6c2b=null;for(let _0x5bc2d5=0x0;_0x5bc2d5<this[_0x2c1ed0(0x1a0)];_0x5bc2d5++){_0x33ceee=[];for(let _0x432c61=0x0;_0x432c61<this[_0x2c1ed0(0x10b)];_0x432c61++,_0x3243b5++){_0x38bc33?_0x5e6c2b=this['_calcUV'](_0x22c30e[_0x5bc2d5][_0x432c61],_0x1fa931[_0x5bc2d5][_0x432c61]):_0x5e6c2b=this['_calcUV'](_0x22c30e[_0x3243b5],_0x1fa931[_0x3243b5]),_0x33ceee['push'](_0x5e6c2b);}this['grid'][_0x2c1ed0(0x11b)](_0x33ceee);}this[_0x2c1ed0(0x195)]['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x1d566a=_0x507d02;delete this[_0x1d566a(0x1a0)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0x1d566a(0x15d)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x25d8c2,_0xfe6e5){const _0x536ca3=_0x507d02,_0x51c103=(_0x25d8c2-this['xmin'])/(this['xmax']-this[_0x536ca3(0x114)])*(this['cols']-0x1),_0x1a3dde=(this['ymax']-_0xfe6e5)/(this[_0x536ca3(0x15d)]-this['ymin'])*(this[_0x536ca3(0x1a0)]-0x1);return[_0x51c103,_0x1a3dde];}['getUVByXY'](_0x44ae65,_0x5c8e45){const _0x1b2b12=_0x507d02;if(_0x44ae65<0x0||_0x44ae65>=this[_0x1b2b12(0x10b)]||_0x5c8e45>=this[_0x1b2b12(0x1a0)])return[0x0,0x0,0x0];const _0x4a0cd3=Math['floor'](_0x44ae65),_0x200927=Math[_0x1b2b12(0x12c)](_0x5c8e45);if(_0x4a0cd3===_0x44ae65&&_0x200927===_0x5c8e45)return this[_0x1b2b12(0x1a6)][_0x5c8e45][_0x44ae65];const _0x25405d=_0x4a0cd3+0x1,_0xb682d8=_0x200927+0x1,_0x48ad83=this[_0x1b2b12(0x11a)](_0x4a0cd3,_0x200927),_0x38a23c=this['getUVByXY'](_0x25405d,_0x200927),_0x22a3af=this['getUVByXY'](_0x4a0cd3,_0xb682d8),_0x41a247=this['getUVByXY'](_0x25405d,_0xb682d8);let _0x44bf3d=null;try{_0x44bf3d=this['_bilinearInterpolation'](_0x44ae65-_0x4a0cd3,_0x5c8e45-_0x200927,_0x48ad83,_0x38a23c,_0x22a3af,_0x41a247);}catch(_0x4a1a88){console[_0x1b2b12(0xdb)](_0x44ae65,_0x5c8e45);}return _0x44bf3d;}[_0x507d02(0x188)](_0x139d9a,_0x13f8b4,_0x258f3a,_0x202ad1,_0x3b4c43,_0x4836b7){const _0x48b81f=_0x507d02,_0x454d05=0x1-_0x139d9a,_0x4ee1fe=0x1-_0x13f8b4,_0x26c559=_0x454d05*_0x4ee1fe,_0x3608fa=_0x139d9a*_0x4ee1fe,_0x3819cb=_0x454d05*_0x13f8b4,_0x214852=_0x139d9a*_0x13f8b4,_0x38f450=_0x258f3a[0x0]*_0x26c559+_0x202ad1[0x0]*_0x3608fa+_0x3b4c43[0x0]*_0x3819cb+_0x4836b7[0x0]*_0x214852,_0x1cb964=_0x258f3a[0x1]*_0x26c559+_0x202ad1[0x1]*_0x3608fa+_0x3b4c43[0x1]*_0x3819cb+_0x4836b7[0x1]*_0x214852;return this[_0x48b81f(0x10f)](_0x38f450,_0x1cb964);}[_0x507d02(0x10f)](_0x21e2de,_0x570004){const _0x225730=_0x507d02;return[+_0x21e2de,+_0x570004,Math[_0x225730(0xcb)](_0x21e2de*_0x21e2de+_0x570004*_0x570004)];}['getUVByPoint'](_0x1921ca,_0x432580){const _0xb0b931=_0x507d02;if(!this['isInExtent'](_0x1921ca,_0x432580))return null;const _0x472623=this[_0xb0b931(0x14a)](_0x1921ca,_0x432580),_0x752a8=this['getUVByXY'](_0x472623[0x0],_0x472623[0x1]);return _0x752a8;}['isInExtent'](_0x29df86,_0xd7dea2){const _0x46f1c9=_0x507d02;return _0x29df86>=this[_0x46f1c9(0x114)]&&_0x29df86<=this[_0x46f1c9(0xf6)]&&_0xd7dea2>=this[_0x46f1c9(0x121)]&&_0xd7dea2<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x306f49=_0x507d02,_0xef1401=fRandomByfloat(this['xmin'],this[_0x306f49(0xf6)]),_0x2bbff6=fRandomByfloat(this[_0x306f49(0x121)],this['ymax']);return{'lat':_0x2bbff6,'lng':_0xef1401};}[_0x507d02(0x190)](){const _0x24d1af=_0x507d02;let _0x462348,_0x108e26,_0x1565c8;for(let _0x11bd59=0x0,_0x3c6d57=this['particles']['length'];_0x11bd59<_0x3c6d57;_0x11bd59++){let _0x2b4fd3=this[_0x24d1af(0xe2)][_0x11bd59];_0x2b4fd3['age']<=0x0&&(_0x2b4fd3=this[_0x24d1af(0x139)](_0x2b4fd3));if(_0x2b4fd3['age']>0x0){const _0x13c318=_0x2b4fd3['tlng'],_0x20a6dc=_0x2b4fd3[_0x24d1af(0x12b)];_0x1565c8=this['getUVByPoint'](_0x13c318,_0x20a6dc),_0x1565c8?(_0x462348=_0x13c318+this['_calc_speedRate'][0x0]*_0x1565c8[0x0],_0x108e26=_0x20a6dc+this['_calc_speedRate'][0x1]*_0x1565c8[0x1],_0x2b4fd3['lng']=_0x13c318,_0x2b4fd3['lat']=_0x20a6dc,_0x2b4fd3['tlng']=_0x462348,_0x2b4fd3['tlat']=_0x108e26,_0x2b4fd3['speed']=_0x1565c8[0x2],_0x2b4fd3[_0x24d1af(0x150)]--):_0x2b4fd3[_0x24d1af(0x150)]=0x0;}}return this['particles'];}[_0x507d02(0x139)](_0x170c07){const _0x5d9961=_0x507d02;let _0x5e5345,_0x6f74d;for(let _0xb08180=0x0;_0xb08180<0x1e;_0xb08180++){_0x5e5345=this['getRandomLatLng'](),_0x6f74d=this[_0x5d9961(0x167)](_0x5e5345[_0x5d9961(0x145)],_0x5e5345[_0x5d9961(0x168)]);if(_0x6f74d&&_0x6f74d[0x2]>0x0)break;}if(!_0x6f74d)return _0x170c07;const _0xdd5908=_0x5e5345[_0x5d9961(0x145)]+this['_calc_speedRate'][0x0]*_0x6f74d[0x0],_0x49b723=_0x5e5345['lat']+this['_calc_speedRate'][0x1]*_0x6f74d[0x1];return _0x170c07[_0x5d9961(0x145)]=_0x5e5345['lng'],_0x170c07['lat']=_0x5e5345['lat'],_0x170c07[_0x5d9961(0x16c)]=_0xdd5908,_0x170c07['tlat']=_0x49b723,_0x170c07['age']=Math[_0x5d9961(0xf7)](Math['random']()*this['maxAge']),_0x170c07[_0x5d9961(0x12f)]=_0x6f74d[0x2],_0x170c07;}['destroy'](){for(const _0x3166ee in this){delete this[_0x3166ee];}}}function fRandomByfloat(_0x52c375,_0x21bffb){return _0x52c375+Math['random']()*(_0x21bffb-_0x52c375);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x10401e={}){const _0x14fe18=_0x507d02;super(_0x10401e),this['_setOptionsHook'](_0x10401e),this['canvas']=null,_0x10401e['colors']&&_0x10401e['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x14fe18(0x19f))](_0x10401e));}[_0x507d02(0x14d)](_0x387ed7,_0xae2c87){const _0x52f73c=_0x507d02;this['frameTime']=0x3e8/(_0x387ed7['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x387ed7['color']||'#ffffff',this['lineWidth']=_0x387ed7['lineWidth']||0x1,this['fixedHeight']=_0x387ed7['fixedHeight']??0x0,this[_0x52f73c(0x174)]=_0x387ed7['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x387ed7);}get['layer'](){const _0x669ca3=_0x507d02;return this[_0x669ca3(0xd7)];}get[_0x507d02(0xb9)](){const _0x1c185c=_0x507d02;return this['_map']['scene'][_0x1c185c(0xd7)][_0x1c185c(0x18e)];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x507d02(0x106)](){return this['_pointerEvents'];}set['pointerEvents'](_0x427eb5){const _0x30831f=_0x507d02;this['_pointerEvents']=_0x427eb5;if(!this['canvas'])return;_0x427eb5?this['canvas']['style'][_0x30831f(0x191)]='all':this[_0x30831f(0xd7)]['style']['pointer-events']=_0x30831f(0x107);}get[_0x507d02(0x19e)](){const _0x2fc7e6=_0x507d02;return this[_0x2fc7e6(0x195)]['particlesNumber'];}set['particlesNumber'](_0x22b3f8){const _0x5e5c9f=_0x507d02;this[_0x5e5c9f(0x195)]['particlesNumber']=_0x22b3f8,clearTimeout(this[_0x5e5c9f(0x18f)]),this[_0x5e5c9f(0x18f)]=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x2c9313){const _0x4dec32=_0x507d02;this[_0x4dec32(0x195)][_0x4dec32(0xc3)]=_0x2c9313,this['windField']&&(this['windField']['speedRate']=_0x2c9313);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x40f504){const _0x64f0fa=_0x507d02;this['options']['maxAge']=_0x40f504,this['windField']&&(this['windField'][_0x64f0fa(0x105)]=_0x40f504);}get[_0x507d02(0x147)](){return this['windData'];}set['data'](_0x296b4c){this['setData'](_0x296b4c);}[_0x507d02(0x162)](_0x38cab0){const _0x585a41=_0x507d02;_0x38cab0?this['_addedHook']():(this[_0x585a41(0x198)]&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x5110ac=_0x507d02;this[_0x5110ac(0x195)]['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}[_0x507d02(0x11d)](){const _0x7294d0=_0x507d02;this[_0x7294d0(0xd7)]=this[_0x7294d0(0x197)](),this[_0x7294d0(0x14f)]=this['canvas'][_0x7294d0(0x199)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x7294d0(0x1a8)](this[_0x7294d0(0x195)]['data']);}['_removedHook'](){const _0x273f05=_0x507d02;this['clear'](),this[_0x273f05(0x118)](),this['canvas']&&(this[_0x273f05(0x11e)]['container']['removeChild'](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x488c43=_0x507d02,_0xe2d44b=mars3d__namespace['DomUtil'][_0x488c43(0x124)]('canvas',_0x488c43(0x1ae),this[_0x488c43(0x11e)]['container']);return _0xe2d44b[_0x488c43(0x17b)]['position']='absolute',_0xe2d44b['style']['top']='0px',_0xe2d44b[_0x488c43(0x17b)]['left']='0px',_0xe2d44b['style']['width']=this[_0x488c43(0x11e)]['scene']['canvas']['clientWidth']+'px',_0xe2d44b['style']['height']=this['_map']['scene']['canvas'][_0x488c43(0x186)]+'px',_0xe2d44b['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0xe2d44b['style']['zIndex']=this['options']['zIndex']??0x9,_0xe2d44b['width']=this[_0x488c43(0x11e)][_0x488c43(0x14c)][_0x488c43(0xd7)]['clientWidth'],_0xe2d44b['height']=this['_map'][_0x488c43(0x14c)]['canvas'][_0x488c43(0x186)],_0xe2d44b;}[_0x507d02(0xfb)](){const _0x229774=_0x507d02;this[_0x229774(0xd7)]&&(this['canvas']['style']['width']=this[_0x229774(0x11e)][_0x229774(0x14c)]['canvas']['clientWidth']+'px',this['canvas']['style']['height']=this[_0x229774(0x11e)]['scene']['canvas']['clientHeight']+'px',this[_0x229774(0xd7)]['width']=this[_0x229774(0x11e)]['scene']['canvas'][_0x229774(0x18e)],this['canvas']['height']=this[_0x229774(0x11e)][_0x229774(0x14c)]['canvas']['clientHeight']);}['bindEvent'](){const _0x38c485=_0x507d02,_0x58c341=this;let _0x46fe76=Date['now']();(function _0x17f7ac(){const _0x14a755=_0x3b14;_0x58c341['animateFrame']=window['requestAnimationFrame'](_0x17f7ac);if(_0x58c341['show']&&_0x58c341[_0x14a755(0x160)]){const _0x44967b=Date['now'](),_0x320380=_0x44967b-_0x46fe76;_0x320380>_0x58c341[_0x14a755(0xe4)]&&(_0x46fe76=_0x44967b-_0x320380%_0x58c341[_0x14a755(0xe4)],_0x58c341['update']());}}(),window[_0x38c485(0x17a)]('resize',this[_0x38c485(0xfb)][_0x38c485(0x158)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0x38c485(0x16f)]&&(this['_map']['on'](mars3d__namespace['EventType'][_0x38c485(0x131)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x38c485(0xda)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x38c485(0x15e)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x3cd228=_0x507d02;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window[_0x3cd228(0xe3)](_0x3cd228(0xfb),this['resize']),this[_0x3cd228(0x195)]['mouseHidden']&&(this['_map'][_0x3cd228(0x13a)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x3cd228(0x11e)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x3cd228(0x18c)],this));}[_0x507d02(0x138)](_0xbc3e44){const _0x41c926=_0x507d02;clearTimeout(this[_0x41c926(0x155)]);if(!this['show']||!this[_0x41c926(0xd7)])return;this['canvas']['style'][_0x41c926(0x10d)]=_0x41c926(0x12a),this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0x507d02(0xbb)](_0x12618d){const _0x20cae9=_0x507d02;this['mouse_down']=!![],this['_map'][_0x20cae9(0x13a)](mars3d__namespace[_0x20cae9(0xda)]['mouseMove'],this[_0x20cae9(0x18c)],this),this[_0x20cae9(0x11e)]['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x3874f3){const _0x1cb855=_0x507d02;if(!this[_0x1cb855(0xbc)]||!this['canvas'])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x1ebe83){const _0x46d83a=_0x507d02;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this[_0x46d83a(0x187)]=![];}[_0x507d02(0x1a8)](_0x3a59d8){const _0x3d1463=_0x507d02;this[_0x3d1463(0x172)](),this[_0x3d1463(0x198)]=_0x3a59d8,this[_0x3d1463(0x160)]['setDate'](_0x3a59d8),this['redraw']();}['redraw'](){const _0x3cad89=_0x507d02;if(!this[_0x3cad89(0xbc)])return;this['windField'][_0x3cad89(0x111)](this['options']),this['update']();}['update'](){const _0x1d56eb=_0x507d02;if(this['_updateIng'])return;this[_0x1d56eb(0x19b)]=!![];if(this['worker'])this['windField']['update']();else{const _0x5766cb=this['windField']['getParticles']();this['_drawLines'](_0x5766cb);}this['_updateIng']=![];}[_0x507d02(0xfe)](_0xdce910){const _0x2559d6=_0x507d02;this['canvasContext']['globalCompositeOperation']=_0x2559d6(0x14e),this[_0x2559d6(0x14f)]['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']=_0x2559d6(0xcc),this['canvasContext'][_0x2559d6(0xe9)]=0.9;const _0x49a6f0=this[_0x2559d6(0x11e)]['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x32499f=this['canvasWidth']*0.25;if(this[_0x2559d6(0x125)])for(let _0x14aab4=0x0,_0x20076e=_0xdce910['length'];_0x14aab4<_0x20076e;_0x14aab4++){const _0x4468fd=_0xdce910[_0x14aab4],_0x4b40f3=this[_0x2559d6(0x151)](_0x4468fd['lng'],_0x4468fd['lat'],_0x4468fd),_0x1cb4ef=this['_tomap'](_0x4468fd['tlng'],_0x4468fd['tlat'],_0x4468fd);if(!_0x4b40f3||!_0x1cb4ef)continue;if(_0x49a6f0&&Math['abs'](_0x4b40f3[0x0]-_0x1cb4ef[0x0])>=_0x32499f)continue;this['canvasContext']['beginPath'](),this[_0x2559d6(0x14f)]['lineWidth']=this['lineWidth'],this[_0x2559d6(0x14f)]['strokeStyle']=this[_0x2559d6(0x125)][_0x2559d6(0xec)](_0x4468fd['speed']),this['canvasContext'][_0x2559d6(0x113)](_0x4b40f3[0x0],_0x4b40f3[0x1]),this['canvasContext']['lineTo'](_0x1cb4ef[0x0],_0x1cb4ef[0x1]),this[_0x2559d6(0x14f)][_0x2559d6(0x104)]();}else{this['canvasContext'][_0x2559d6(0xc7)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0x2559d6(0x171)];for(let _0x48354e=0x0,_0xa69b60=_0xdce910[_0x2559d6(0x109)];_0x48354e<_0xa69b60;_0x48354e++){const _0x16c642=_0xdce910[_0x48354e],_0x1385d7=this['_tomap'](_0x16c642[_0x2559d6(0x145)],_0x16c642[_0x2559d6(0x168)],_0x16c642),_0x34501f=this['_tomap'](_0x16c642['tlng'],_0x16c642[_0x2559d6(0x12b)],_0x16c642);if(!_0x1385d7||!_0x34501f)continue;if(_0x49a6f0&&Math['abs'](_0x1385d7[0x0]-_0x34501f[0x0])>=_0x32499f)continue;this[_0x2559d6(0x14f)]['moveTo'](_0x1385d7[0x0],_0x1385d7[0x1]),this['canvasContext'][_0x2559d6(0x1ad)](_0x34501f[0x0],_0x34501f[0x1]);}this['canvasContext']['stroke']();}}[_0x507d02(0x151)](_0x448f32,_0x5d8203,_0x304ca1){const _0x19997b=_0x507d02,_0x591ce7=Cesium['Cartesian3']['fromDegrees'](_0x448f32,_0x5d8203,this['fixedHeight']),_0x48f3b8=this['_map'][_0x19997b(0x14c)];if(_0x48f3b8[_0x19997b(0x128)]===Cesium[_0x19997b(0x163)]['SCENE3D']){const _0x5ef79d=new Cesium[(_0x19997b(0xbd))](_0x48f3b8[_0x19997b(0x103)]['ellipsoid'],_0x48f3b8['camera'][_0x19997b(0x14b)]),_0x52c5c0=_0x5ef79d['isPointVisible'](_0x591ce7);if(!_0x52c5c0)return _0x304ca1[_0x19997b(0x150)]=0x0,null;}const _0x2cae53=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map'][_0x19997b(0x14c)],_0x591ce7);return _0x2cae53?[_0x2cae53['x'],_0x2cae53['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x7c15e8=_0x507d02;this['worker']=new Worker(this['options'][_0x7c15e8(0x11c)]),this['worker']['onmessage']=_0x127bd1=>{this['_drawLines'](_0x127bd1['data']['particles']),this['_updateIng2']=![];},this[_0x7c15e8(0x160)]={'init':_0x231252=>{const _0x3c63fa=_0x7c15e8;this[_0x3c63fa(0x11c)]['postMessage']({'type':'init','options':_0x231252});},'setOptions':_0x5f3c1e=>{const _0x35259b=_0x7c15e8;this['worker'][_0x35259b(0x16a)]({'type':'setOptions','options':_0x5f3c1e});},'setDate':_0x1b7cfb=>{const _0x1fc6eb=_0x7c15e8;this[_0x1fc6eb(0x11c)]['postMessage']({'type':'setDate','data':_0x1b7cfb});},'update':()=>{const _0x253e84=_0x7c15e8;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x253e84(0x11c)]['postMessage']({'type':'update'});},'clear':()=>{const _0x506c3a=_0x7c15e8;this['worker'][_0x506c3a(0x16a)]({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace[_0x507d02(0x10a)]['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x507d02(0xc0)]=WindUtil,Object['defineProperty'](exports,_0x507d02(0x173),{'value':!![]});
}));
