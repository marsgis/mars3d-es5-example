/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.9
 * 编译日期：2024-04-06 21:26:39
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0xddbfa5=_0x19a0;(function(_0x41c873,_0x4d2a88){const _0x4d5330=_0x19a0,_0x417315=_0x41c873();while(!![]){try{const _0x3f7ae6=parseInt(_0x4d5330(0x139))/0x1*(parseInt(_0x4d5330(0x10a))/0x2)+parseInt(_0x4d5330(0x15c))/0x3*(parseInt(_0x4d5330(0x109))/0x4)+parseInt(_0x4d5330(0xe3))/0x5*(parseInt(_0x4d5330(0x16c))/0x6)+parseInt(_0x4d5330(0x140))/0x7*(parseInt(_0x4d5330(0xba))/0x8)+parseInt(_0x4d5330(0x12a))/0x9+parseInt(_0x4d5330(0xec))/0xa+parseInt(_0x4d5330(0x18b))/0xb*(-parseInt(_0x4d5330(0x15d))/0xc);if(_0x3f7ae6===_0x4d2a88)break;else _0x417315['push'](_0x417315['shift']());}catch(_0x4b68f3){_0x417315['push'](_0x417315['shift']());}}}(_0x4c2f,0xbc8d4));function _interopNamespace(_0x70536d){if(_0x70536d&&_0x70536d['__esModule'])return _0x70536d;var _0xae3a9b=Object['create'](null);return _0x70536d&&Object['keys'](_0x70536d)['forEach'](function(_0x4e3862){const _0x261b28=_0x19a0;if(_0x4e3862!==_0x261b28(0x11e)){var _0x303950=Object['getOwnPropertyDescriptor'](_0x70536d,_0x4e3862);Object['defineProperty'](_0xae3a9b,_0x4e3862,_0x303950['get']?_0x303950:{'enumerable':!![],'get':function(){return _0x70536d[_0x4e3862];}});}}),_0xae3a9b['default']=_0x70536d,_0xae3a9b;}var mars3d__namespace=_interopNamespace(mars3d);function _0x4c2f(){const _0x5ae8d0=['createFramebuffer','canvas','CanvasWindField','STATIC_DRAW','createRawRenderState','ymin','show','nextTrails','refreshTimer','Framebuffer','data','dropRateBump','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','particlesNumber','randomBetween','segmentsDepth','_onMouseUpEvent','scene','maxParticles','Math','speedRate','primitiveType','worker','speed','textures','camera','random','getUVByPoint','source','bind','_updateIng','keys','off','windField','RGBA','ShaderSource','isDestroyed','5dUYvmh','fragmentShaderSource','frameRate','dropRate','wgs84ToWindowCoordinates','TextureMinificationFilter','fromGeometry','lineWidth','vdata','9188480hUFxVF','updateViewerParameters','postProcessingSpeed','pixelSize','getWind','lonRange','forEach','Cartesian3','commandList','setOptions','depthTest','layer','shaderProgram','LINEAR','preRender','green','age','particles','particleSystem','SceneMode','toRadians','_onMouseDownEvent','particlesComputing','_randomParticle','mars3d-canvasWind','segments','frameTime','unbindEvent','vmax','4yHRbcQ','1318LlDUCY','viewerParameters','fill','getParticles','_drawLines','vertexShaderSource','Compute','PixelDatatype','reverseY','toGridXY','style','clear','EventType','wind','SCENE3D','randomizeParticles','LUMINANCE','_updateIng2','TWO_PI','north','default','BaseLayer','mouse_move','lon','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','_colorRamp','_map','depthTexture','Cesium','_speedRate','framebuffer','now','693243NJwcRi','mouse_down','sqrt','VertexArray','fixedHeight','viewRectangleToLonLatRange','_setOptionsHook','rows','FLOAT','attributeLocations','latRange','canvasWidth','_calc_speedRate','_onMouseMoveEvent','lng','127yVPyRx','windData','geometry','add','PrimitiveCollection','floor','ComponentDatatype','7VRZygr','udata','nextParticlesSpeed','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','height','vertexArray','postMessage','xmax','ColorRamp','array','canvasContext','resize','push','drawingBufferWidth','visibility','rgb(206,255,255)','currentTrails','execute','width','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','DEPTH_COMPONENT','getDefaultRenderState','visible','mode','removeAll','outputTexture','particlesRendering','PixelFormat','512667hDNosP','29121420RYvMSS','destroy','mouseDown','currentParticlesPosition','toDegrees','_onMap_preRenderEvent','ClearCommand','commandToExecute','Appearance','refreshParticles','OPAQUE','maxAge','tlng','GeometryAttribute','createWindTextures','7128738GZWFXL','setData','setGeometry','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','PI_OVER_THREE','blending','context','particlesWind','destination-in','lineTo','canrefresh','removeEventListener','update','UNSIGNED_INT','xmin','clearFramebuffers','mod','speedFactor','clientHeight','clearCommand','DepthFunction','DISABLE_GL_POSITION_LOG_DEPTH','createTexture','create','getUVByXY','options','fromCssColorString','framebuffers','pointer-events','lat','clientWidth','11LhErTz','max','container','getColorTexture','createParticlesTextures','init','pointerEvents','defineProperty','lev','LayerUtil','colors','lighter','createSegmentsGeometry','_mountedHook','min','rawRenderState','SceneTransforms','defined','Draw','pow','dimensions','postProcessingPosition','primitives','grid','particlesTextures','currentParticlesSpeed','drawingBufferHeight','redraw','hidden','particlesTextureSize','Pass','west','ymax','mouseUp','getRandomLatLng','globe','6084104jkuRSd','BufferUsage','color','isInExtent'];_0x4c2f=function(){return _0x5ae8d0;};return _0x4c2f();}const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x2cea73,_0x109a72){const _0x2cf21a=_0x19a0,_0x20264c=_0x2cea73*Math['cos'](Cesium$7['Math'][_0x2cf21a(0x100)](_0x109a72));return _0x20264c;}function getV(_0x426d4a,_0x56b451){const _0x210abc=_0x19a0,_0x46994f=_0x426d4a*Math['sin'](Cesium$7[_0x210abc(0xd1)]['toRadians'](_0x56b451));return _0x46994f;}function getSpeed(_0x170ac9,_0x404fed){const _0x4c9f25=_0x19a0,_0x1e765d=Math['sqrt'](Math[_0x4c9f25(0xa9)](_0x170ac9,0x2)+Math['pow'](_0x404fed,0x2));return _0x1e765d;}function getDirection(_0x5e9d7c,_0x2e29e7){let _0x4946ee=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x2e29e7,_0x5e9d7c));return _0x4946ee+=_0x4946ee<0x0?0x168:0x0,_0x4946ee;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x9d9f88){const _0x3d3ab9=_0x19a0;this['commandType']=_0x9d9f88['commandType'],this['geometry']=_0x9d9f88[_0x3d3ab9(0x13b)],this['attributeLocations']=_0x9d9f88[_0x3d3ab9(0x133)],this['primitiveType']=_0x9d9f88[_0x3d3ab9(0xd3)],this['uniformMap']=_0x9d9f88['uniformMap'],this[_0x3d3ab9(0x10f)]=_0x9d9f88['vertexShaderSource'],this['fragmentShaderSource']=_0x9d9f88['fragmentShaderSource'],this['rawRenderState']=_0x9d9f88[_0x3d3ab9(0xa5)],this['framebuffer']=_0x9d9f88['framebuffer'],this['outputTexture']=_0x9d9f88[_0x3d3ab9(0x159)],this['autoClear']=_0x9d9f88['autoClear']??![],this['preExecute']=_0x9d9f88['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x3d3ab9(0x167)]}));}['createCommand'](_0x15ab6e){const _0x45cc18=_0x19a0;switch(this['commandType']){case _0x45cc18(0xa8):{const _0x207b70=Cesium$6[_0x45cc18(0x12d)][_0x45cc18(0xe9)]({'context':_0x15ab6e,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x45cc18(0xc1)]}),_0x5db64d=Cesium$6['ShaderProgram']['fromCache']({'context':_0x15ab6e,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x25ffbf=Cesium$6['RenderState']['fromCache'](this[_0x45cc18(0xa5)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x5db64d,'vertexArray':_0x207b70,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x25ffbf,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x45cc18(0xb4)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x45cc18(0xe4)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0xddbfa5(0x16e)](_0x26e3e9,_0x5c2998){const _0x41fc25=_0xddbfa5;this['geometry']=_0x5c2998;const _0x2d1732=Cesium$6['VertexArray'][_0x41fc25(0xe9)]({'context':_0x26e3e9,'geometry':this[_0x41fc25(0x13b)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute'][_0x41fc25(0x145)]=_0x2d1732;}['update'](_0x1dd8f1){const _0x508bc0=_0xddbfa5;if(!this[_0x508bc0(0xc4)])return;if(_0x1dd8f1['mode']!==Cesium$6['SceneMode'][_0x508bc0(0x118)])return;!Cesium$6[_0x508bc0(0xa7)](this['commandToExecute'])&&(this[_0x508bc0(0x164)]=this['createCommand'](_0x1dd8f1[_0x508bc0(0x172)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x1dd8f1[_0x508bc0(0xf4)]['push'](this['clearCommand']),_0x1dd8f1['commandList']['push'](this[_0x508bc0(0x164)]);}[_0xddbfa5(0xe2)](){return![];}['destroy'](){const _0x37b693=_0xddbfa5;if(this['clearCommand']){var _0x52bb69,_0x3f8bf4;(_0x52bb69=this['clearCommand'])!==null&&_0x52bb69!==void 0x0&&_0x52bb69['vertexArray']&&this[_0x37b693(0x17f)][_0x37b693(0x145)][_0x37b693(0x15e)](),(_0x3f8bf4=this[_0x37b693(0x17f)])!==null&&_0x3f8bf4!==void 0x0&&_0x3f8bf4['shaderProgram']&&this['clearCommand'][_0x37b693(0xf8)][_0x37b693(0x15e)](),delete this['clearCommand'];}return this['commandToExecute']&&(this[_0x37b693(0x164)]['vertexArray']&&this['commandToExecute'][_0x37b693(0x145)][_0x37b693(0x15e)](),this[_0x37b693(0x164)]['shaderProgram']&&this['commandToExecute']['shaderProgram'][_0x37b693(0x15e)](),delete this[_0x37b693(0x164)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x121169=function(){const _0x24ee6a=_0x19a0,_0x3b57c1=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x24ee6a(0x13f)]['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0x24ee6a(0x16a))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x3b57c1;},_0x4204b4=function(_0x2e6ca3,_0x4b4f54){const _0x5e010d=_0x19a0;if(Cesium$5['defined'](_0x4b4f54)){const _0x314e61={};_0x314e61['arrayBufferView']=_0x4b4f54,_0x2e6ca3[_0x5e010d(0xda)]=_0x314e61;}const _0x282d51=new Cesium$5['Texture'](_0x2e6ca3);return _0x282d51;},_0x299a7e=function(_0x1646a1,_0x9cf3e1,_0x35325f){const _0x453dca=_0x19a0,_0x62aef8=new Cesium$5[(_0x453dca(0xc7))]({'context':_0x1646a1,'colorTextures':[_0x9cf3e1],'depthTexture':_0x35325f});return _0x62aef8;},_0x4495ae=function(_0x208406){const _0x1f4cc1=_0x19a0,_0x11665e=!![],_0x2dd073=![],_0x1a6d37={'viewport':_0x208406['viewport'],'depthTest':_0x208406[_0x1f4cc1(0xf6)],'depthMask':_0x208406['depthMask'],'blending':_0x208406[_0x1f4cc1(0x171)]},_0x3cb3a5=Cesium$5[_0x1f4cc1(0x165)][_0x1f4cc1(0x155)](_0x11665e,_0x2dd073,_0x1a6d37);return _0x3cb3a5;},_0x2c34a1=function(_0x1bb8b6){const _0x2e817d=_0x19a0,_0x6ff01a={},_0x2bc15a=Cesium$5[_0x2e817d(0xd1)]['mod'](_0x1bb8b6[_0x2e817d(0xb5)],Cesium$5['Math']['TWO_PI']),_0x25ec0b=Cesium$5['Math'][_0x2e817d(0x17c)](_0x1bb8b6['east'],Cesium$5['Math'][_0x2e817d(0x11c)]),_0x2e83ce=_0x1bb8b6[_0x2e817d(0x152)];let _0x5b4d2d,_0xa173cf;_0x2e83ce>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x5b4d2d=0x0,_0xa173cf=Cesium$5['Math']['TWO_PI']):_0x25ec0b-_0x2bc15a<_0x2e83ce?(_0x5b4d2d=_0x2bc15a,_0xa173cf=_0x2bc15a+_0x2e83ce):(_0x5b4d2d=_0x2bc15a,_0xa173cf=_0x25ec0b);_0x6ff01a[_0x2e817d(0x121)]={'min':Cesium$5[_0x2e817d(0xd1)]['toDegrees'](_0x5b4d2d),'max':Cesium$5[_0x2e817d(0xd1)][_0x2e817d(0x161)](_0xa173cf)};const _0x42557d=_0x1bb8b6['south'],_0x10b92d=_0x1bb8b6[_0x2e817d(0x11d)],_0x4700b5=_0x1bb8b6['height'],_0x2f759c=_0x4700b5>Cesium$5[_0x2e817d(0xd1)]['PI']/0xc?_0x4700b5/0x2:0x0;let _0x17103a=Cesium$5['Math']['clampToLatitudeRange'](_0x42557d-_0x2f759c),_0x26c9cc=Cesium$5['Math']['clampToLatitudeRange'](_0x10b92d+_0x2f759c);return _0x17103a<-Cesium$5['Math'][_0x2e817d(0x170)]&&(_0x17103a=-Cesium$5[_0x2e817d(0xd1)]['PI_OVER_TWO']),_0x26c9cc>Cesium$5[_0x2e817d(0xd1)]['PI_OVER_THREE']&&(_0x26c9cc=Cesium$5['Math']['PI_OVER_TWO']),_0x6ff01a['lat']={'min':Cesium$5['Math']['toDegrees'](_0x17103a),'max':Cesium$5['Math']['toDegrees'](_0x26c9cc)},_0x6ff01a;};return{'getFullscreenQuad':_0x121169,'createTexture':_0x4204b4,'createFramebuffer':_0x299a7e,'createRawRenderState':_0x4495ae,'viewRectangleToLonLatRange':_0x2c34a1};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x540895,_0xc21aa2,_0x17320c,_0x5f1052,_0x231599){const _0x473290=_0xddbfa5;this['createRenderingTextures'](_0x540895,_0xc21aa2,_0x17320c[_0x473290(0xa0)]),this['createRenderingFramebuffers'](_0x540895),this['createRenderingPrimitives'](_0x540895,_0x17320c,_0x5f1052,_0x231599);}['createRenderingTextures'](_0x21c602,_0x3a2685,_0x13fbb3){const _0x38f398=_0xddbfa5,_0x69f28a={'context':_0x21c602,'width':_0x21c602[_0x38f398(0x14d)],'height':_0x21c602['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x38f398(0xe0)],'pixelDatatype':Cesium$4[_0x38f398(0x111)]['UNSIGNED_BYTE']},_0x1e1f7e={'context':_0x21c602,'width':_0x21c602[_0x38f398(0x14d)],'height':_0x21c602[_0x38f398(0xb0)],'pixelFormat':Cesium$4[_0x38f398(0x15b)][_0x38f398(0x154)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x38f398(0x179)]},_0x3aedbc=_0x13fbb3['length'],_0x3a3dd6=new Float32Array(_0x3aedbc*0x3);for(let _0x2404c0=0x0;_0x2404c0<_0x3aedbc;_0x2404c0++){const _0x47150e=Cesium$4['Color'][_0x38f398(0x186)](_0x13fbb3[_0x2404c0]);_0x3a3dd6[0x3*_0x2404c0]=_0x47150e['red'],_0x3a3dd6[0x3*_0x2404c0+0x1]=_0x47150e[_0x38f398(0xfb)],_0x3a3dd6[0x3*_0x2404c0+0x2]=_0x47150e['blue'];}const _0x1d683c={'context':_0x21c602,'width':_0x3aedbc,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x38f398(0x111)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x38f398(0xe8)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x38f398(0xf9)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x69f28a),'segmentsDepth':Util[_0x38f398(0x182)](_0x1e1f7e),'currentTrailsColor':Util['createTexture'](_0x69f28a),'currentTrailsDepth':Util[_0x38f398(0x182)](_0x1e1f7e),'nextTrailsColor':Util[_0x38f398(0x182)](_0x69f28a),'nextTrailsDepth':Util['createTexture'](_0x1e1f7e),'colorTable':Util['createTexture'](_0x1d683c,_0x3a3dd6)};}['createRenderingFramebuffers'](_0x59bea8){const _0x242345=_0xddbfa5;this[_0x242345(0x187)]={'segments':Util[_0x242345(0xbe)](_0x59bea8,this['textures']['segmentsColor'],this['textures'][_0x242345(0xcd)]),'currentTrails':Util[_0x242345(0xbe)](_0x59bea8,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x59bea8,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x316aee){const _0x2686aa=_0xddbfa5,_0x44b6dc=0x4;let _0x17c467=[];for(let _0x2463dc=0x0;_0x2463dc<_0x316aee[_0x2686aa(0xb3)];_0x2463dc++){for(let _0x247900=0x0;_0x247900<_0x316aee['particlesTextureSize'];_0x247900++){for(let _0x391733=0x0;_0x391733<_0x44b6dc;_0x391733++){_0x17c467[_0x2686aa(0x14c)](_0x2463dc/_0x316aee['particlesTextureSize']),_0x17c467['push'](_0x247900/_0x316aee['particlesTextureSize']);}}}_0x17c467=new Float32Array(_0x17c467);let _0x4fcfac=[];const _0x169adb=[-0x1,0x1],_0xcfba26=[-0x1,0x1];for(let _0x16ce83=0x0;_0x16ce83<_0x316aee['maxParticles'];_0x16ce83++){for(let _0x5b75e5=0x0;_0x5b75e5<_0x44b6dc/0x2;_0x5b75e5++){for(let _0x1c6fd9=0x0;_0x1c6fd9<_0x44b6dc/0x2;_0x1c6fd9++){_0x4fcfac['push'](_0x169adb[_0x5b75e5]),_0x4fcfac[_0x2686aa(0x14c)](_0xcfba26[_0x1c6fd9]),_0x4fcfac['push'](0x0);}}}_0x4fcfac=new Float32Array(_0x4fcfac);const _0xc4dc03=0x6*_0x316aee[_0x2686aa(0xd0)],_0x648a20=new Uint32Array(_0xc4dc03);for(let _0x596cef=0x0,_0x3e6011=0x0,_0x248c4b=0x0;_0x596cef<_0x316aee['maxParticles'];_0x596cef++){_0x648a20[_0x3e6011++]=_0x248c4b+0x0,_0x648a20[_0x3e6011++]=_0x248c4b+0x1,_0x648a20[_0x3e6011++]=_0x248c4b+0x2,_0x648a20[_0x3e6011++]=_0x248c4b+0x2,_0x648a20[_0x3e6011++]=_0x248c4b+0x1,_0x648a20[_0x3e6011++]=_0x248c4b+0x3,_0x248c4b+=0x4;}const _0x20ba94=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x17c467}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x4fcfac})}),'indices':_0x648a20});return _0x20ba94;}['createRenderingPrimitives'](_0x19aa18,_0x1d34c2,_0x4ac466,_0x4e0edb){const _0x2cf678=_0xddbfa5,_0x2ef35f=this;this[_0x2cf678(0xac)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x1d34c2),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x6a8d54=_0x2cf678;return _0x4e0edb[_0x6a8d54(0xae)][_0x6a8d54(0x160)];},'postProcessingPosition':function(){return _0x4e0edb['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x4e0edb['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x2ef35f['textures']['colorTable'];},'aspect':function(){return _0x19aa18['drawingBufferWidth']/_0x19aa18['drawingBufferHeight'];},'pixelSize':function(){const _0x29413a=_0x2cf678;return _0x4ac466[_0x29413a(0xef)];},'lineWidth':function(){const _0x5be1c5=_0x2cf678;return _0x1d34c2[_0x5be1c5(0xea)];},'particleHeight':function(){return _0x1d34c2['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x2cf678(0xc2)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x437bd8=_0x2cf678;return _0x2ef35f[_0x437bd8(0xd6)]['segmentsColor'];},'segmentsDepthTexture':function(){return _0x2ef35f['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x362513=_0x2cf678;return _0x2ef35f[_0x362513(0x187)][_0x362513(0x150)][_0x362513(0x18e)](0x0);},'trailsDepthTexture':function(){const _0x35bb12=_0x2cf678;return _0x2ef35f['framebuffers']['currentTrails'][_0x35bb12(0x125)];},'fadeOpacity':function(){return _0x1d34c2['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x2cf678(0x181)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x2cf678(0xe1))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x2cf678(0x180)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x3b83f9=_0x2cf678,_0x1c09b2=_0x2ef35f['framebuffers']['currentTrails'];_0x2ef35f['framebuffers']['currentTrails']=_0x2ef35f['framebuffers']['nextTrails'],_0x2ef35f[_0x3b83f9(0x187)]['nextTrails']=_0x1c09b2,_0x2ef35f[_0x3b83f9(0xac)]['trails'][_0x3b83f9(0x164)][_0x3b83f9(0x128)]=_0x2ef35f[_0x3b83f9(0x187)]['nextTrails'],_0x2ef35f[_0x3b83f9(0xac)]['trails']['clearCommand']['framebuffer']=_0x2ef35f['framebuffers'][_0x3b83f9(0xc5)];}}),'screen':new CustomPrimitive({'commandType':_0x2cf678(0xa8),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x43bd6b=_0x2cf678;return _0x2ef35f['framebuffers']['nextTrails'][_0x43bd6b(0x18e)](0x0);},'trailsDepthTexture':function(){const _0x5235d0=_0x2cf678;return _0x2ef35f['framebuffers'][_0x5235d0(0xc5)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x2cf678(0x181)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x2cf678(0xe1))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x2cf678(0xc2)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0xddbfa5(0x153),updateSpeed_frag=_0xddbfa5(0x16f),updatePosition_frag=_0xddbfa5(0xca),postProcessingPosition_frag=_0xddbfa5(0x143),postProcessingSpeed_frag=_0xddbfa5(0x122);const Cesium$3=mars3d__namespace[_0xddbfa5(0x126)];class ParticlesComputing{constructor(_0x53106b,_0x20fd33,_0x3fb558,_0x1af099){const _0x289e26=_0xddbfa5;this[_0x289e26(0xc8)]=_0x20fd33,this[_0x289e26(0x16b)](_0x53106b,_0x20fd33),this[_0x289e26(0x18f)](_0x53106b,_0x3fb558,_0x1af099),this['createComputingPrimitives'](_0x20fd33,_0x3fb558,_0x1af099);}['createWindTextures'](_0x4a00cf,_0x5c6246){const _0x14aa16=_0xddbfa5,_0x27b18d={'context':_0x4a00cf,'width':_0x5c6246[_0x14aa16(0xaa)][_0x14aa16(0x121)],'height':_0x5c6246[_0x14aa16(0xaa)][_0x14aa16(0x189)]*(_0x5c6246['dimensions']['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x14aa16(0x11a)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x27b18d,_0x5c6246['U']['array']),'V':Util['createTexture'](_0x27b18d,_0x5c6246['V'][_0x14aa16(0x149)])};}['createParticlesTextures'](_0x99c255,_0x1e428a,_0x23e80d){const _0x375fdf=_0xddbfa5,_0x52210d={'context':_0x99c255,'width':_0x1e428a['particlesTextureSize'],'height':_0x1e428a[_0x375fdf(0xb3)],'pixelFormat':Cesium$3[_0x375fdf(0x15b)][_0x375fdf(0xe0)],'pixelDatatype':Cesium$3[_0x375fdf(0x111)][_0x375fdf(0x132)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x375fdf(0xe8)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x27127f=this['randomizeParticles'](_0x1e428a[_0x375fdf(0xd0)],_0x23e80d),_0x2cf5f1=new Float32Array(0x4*_0x1e428a['maxParticles'])[_0x375fdf(0x10c)](0x0);this[_0x375fdf(0xae)]={'particlesWind':Util['createTexture'](_0x52210d),'currentParticlesPosition':Util[_0x375fdf(0x182)](_0x52210d,_0x27127f),'nextParticlesPosition':Util['createTexture'](_0x52210d,_0x27127f),'currentParticlesSpeed':Util['createTexture'](_0x52210d,_0x2cf5f1),'nextParticlesSpeed':Util['createTexture'](_0x52210d,_0x2cf5f1),'postProcessingPosition':Util[_0x375fdf(0x182)](_0x52210d,_0x27127f),'postProcessingSpeed':Util[_0x375fdf(0x182)](_0x52210d,_0x2cf5f1)};}[_0xddbfa5(0x119)](_0x3afcec,_0x2fee1d){const _0x3a0c84=_0xddbfa5,_0x7fdda4=new Float32Array(0x4*_0x3afcec);for(let _0x2b7908=0x0;_0x2b7908<_0x3afcec;_0x2b7908++){_0x7fdda4[0x4*_0x2b7908]=Cesium$3['Math']['randomBetween'](_0x2fee1d[_0x3a0c84(0xf1)]['x'],_0x2fee1d['lonRange']['y']),_0x7fdda4[0x4*_0x2b7908+0x1]=Cesium$3[_0x3a0c84(0xd1)]['randomBetween'](_0x2fee1d['latRange']['x'],_0x2fee1d['latRange']['y']),_0x7fdda4[0x4*_0x2b7908+0x2]=Cesium$3['Math'][_0x3a0c84(0xcc)](this['data']['lev']['min'],this['data']['lev']['max']),_0x7fdda4[0x4*_0x2b7908+0x3]=0x0;}return _0x7fdda4;}['destroyParticlesTextures'](){Object['keys'](this['particlesTextures'])['forEach'](_0x334609=>{const _0x12f1cb=_0x19a0;this['particlesTextures'][_0x334609][_0x12f1cb(0x15e)]();});}['createComputingPrimitives'](_0x21e9b3,_0x26198e,_0xb5e2da){const _0x4221f3=_0xddbfa5,_0xa23748=new Cesium$3['Cartesian3'](_0x21e9b3['dimensions']['lon'],_0x21e9b3[_0x4221f3(0xaa)][_0x4221f3(0x189)],_0x21e9b3['dimensions']['lev']),_0xedbb40=new Cesium$3['Cartesian3'](_0x21e9b3[_0x4221f3(0x121)]['min'],_0x21e9b3['lat'][_0x4221f3(0xa4)],_0x21e9b3[_0x4221f3(0x9e)]['min']),_0x1a4f6c=new Cesium$3[(_0x4221f3(0xf3))](_0x21e9b3['lon']['max'],_0x21e9b3['lat']['max'],_0x21e9b3['lev'][_0x4221f3(0x18c)]),_0x226759=new Cesium$3['Cartesian3']((_0x1a4f6c['x']-_0xedbb40['x'])/(_0xa23748['x']-0x1),(_0x1a4f6c['y']-_0xedbb40['y'])/(_0xa23748['y']-0x1),_0xa23748['z']>0x1?(_0x1a4f6c['z']-_0xedbb40['z'])/(_0xa23748['z']-0x1):0x1),_0x2bfac1=new Cesium$3['Cartesian2'](_0x21e9b3['U']['min'],_0x21e9b3['U']['max']),_0x437ab1=new Cesium$3['Cartesian2'](_0x21e9b3['V']['min'],_0x21e9b3['V']['max']),_0x50c04d=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x50c04d['windTextures']['U'];},'V':function(){return _0x50c04d['windTextures']['V'];},'currentParticlesPosition':function(){const _0x21c0f4=_0x4221f3;return _0x50c04d[_0x21c0f4(0xae)]['currentParticlesPosition'];},'dimension':function(){return _0xa23748;},'minimum':function(){return _0xedbb40;},'maximum':function(){return _0x1a4f6c;},'interval':function(){return _0x226759;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x4221f3(0x173)],'preExecute':function(){const _0x5d2fd7=_0x4221f3;_0x50c04d[_0x5d2fd7(0xac)]['getWind']['commandToExecute'][_0x5d2fd7(0x159)]=_0x50c04d[_0x5d2fd7(0xae)][_0x5d2fd7(0x173)];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x4221f3(0x110),'uniformMap':{'currentParticlesSpeed':function(){const _0x5f4de1=_0x4221f3;return _0x50c04d[_0x5f4de1(0xae)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x50c04d['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x2bfac1;},'vSpeedRange':function(){return _0x437ab1;},'pixelSize':function(){const _0x12b8e0=_0x4221f3;return _0xb5e2da[_0x12b8e0(0xef)];},'speedFactor':function(){const _0x541cf6=_0x4221f3;return _0x26198e[_0x541cf6(0x17d)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x4221f3(0xae)][_0x4221f3(0x142)],'preExecute':function(){const _0x312dd6=_0x4221f3,_0x2c79f4=_0x50c04d[_0x312dd6(0xae)][_0x312dd6(0xaf)];_0x50c04d['particlesTextures']['currentParticlesSpeed']=_0x50c04d['particlesTextures']['postProcessingSpeed'],_0x50c04d['particlesTextures']['postProcessingSpeed']=_0x2c79f4,_0x50c04d[_0x312dd6(0xac)]['updateSpeed']['commandToExecute']['outputTexture']=_0x50c04d[_0x312dd6(0xae)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x46008e=_0x4221f3;return _0x50c04d[_0x46008e(0xae)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x15a739=_0x4221f3;return _0x50c04d['particlesTextures'][_0x15a739(0xaf)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x4221f3(0xae)]['nextParticlesPosition'],'preExecute':function(){const _0x19c4af=_0x4221f3,_0x48be28=_0x50c04d[_0x19c4af(0xae)]['currentParticlesPosition'];_0x50c04d['particlesTextures'][_0x19c4af(0x160)]=_0x50c04d['particlesTextures']['postProcessingPosition'],_0x50c04d[_0x19c4af(0xae)]['postProcessingPosition']=_0x48be28,_0x50c04d['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x50c04d['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x50c04d['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x29239f=_0x4221f3;return _0x50c04d[_0x29239f(0xae)][_0x29239f(0x142)];},'lonRange':function(){return _0xb5e2da['lonRange'];},'latRange':function(){const _0x285b70=_0x4221f3;return _0xb5e2da[_0x285b70(0x134)];},'randomCoefficient':function(){const _0x631a2b=_0x4221f3,_0x7b7003=Math[_0x631a2b(0xd8)]();return _0x7b7003;},'dropRate':function(){return _0x26198e['dropRate'];},'dropRateBump':function(){const _0x1e6c65=_0x4221f3;return _0x26198e[_0x1e6c65(0xc9)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x106bbd=_0x4221f3;_0x50c04d['primitives']['postProcessingPosition'][_0x106bbd(0x164)]['outputTexture']=_0x50c04d['particlesTextures'][_0x106bbd(0xab)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x4221f3(0x110),'uniformMap':{'postProcessingPosition':function(){return _0x50c04d['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x4f487c=_0x4221f3;return _0x50c04d[_0x4f487c(0xae)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x39e39d=_0x4221f3;_0x50c04d['primitives'][_0x39e39d(0xee)]['commandToExecute']['outputTexture']=_0x50c04d['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0xddbfa5(0x126)];class ParticleSystem{constructor(_0x1df5fd,_0x3c22c7,_0x4a8658,_0x200cf7){const _0x2af215=_0xddbfa5;this['context']=_0x1df5fd,_0x3c22c7={..._0x3c22c7},_0x3c22c7['udata']&&_0x3c22c7['vdata']&&(_0x3c22c7['dimensions']={},_0x3c22c7['dimensions'][_0x2af215(0x121)]=_0x3c22c7['cols'],_0x3c22c7[_0x2af215(0xaa)]['lat']=_0x3c22c7['rows'],_0x3c22c7['dimensions']['lev']=_0x3c22c7['lev']||0x1,_0x3c22c7['lon']={},_0x3c22c7[_0x2af215(0x121)]['min']=_0x3c22c7[_0x2af215(0x17a)],_0x3c22c7[_0x2af215(0x121)]['max']=_0x3c22c7['xmax'],_0x3c22c7[_0x2af215(0x189)]={},_0x3c22c7['lat']['min']=_0x3c22c7['ymin'],_0x3c22c7['lat']['max']=_0x3c22c7[_0x2af215(0xb6)],_0x3c22c7['lev']={},_0x3c22c7[_0x2af215(0x9e)]['min']=_0x3c22c7['levmin']??0x1,_0x3c22c7['lev'][_0x2af215(0x18c)]=_0x3c22c7['levmax']??0x1,_0x3c22c7['U']={},_0x3c22c7['U']['array']=new Float32Array(_0x3c22c7[_0x2af215(0x141)]),_0x3c22c7['U'][_0x2af215(0xa4)]=_0x3c22c7['umin']??Math['min'](..._0x3c22c7[_0x2af215(0x141)]),_0x3c22c7['U']['max']=_0x3c22c7['umax']??Math['max'](..._0x3c22c7['udata']),_0x3c22c7['V']={},_0x3c22c7['V']['array']=new Float32Array(_0x3c22c7['vdata']),_0x3c22c7['V']['min']=_0x3c22c7['vmin']??Math['min'](..._0x3c22c7['vdata']),_0x3c22c7['V']['max']=_0x3c22c7[_0x2af215(0x108)]??Math[_0x2af215(0x18c)](..._0x3c22c7[_0x2af215(0xeb)])),this[_0x2af215(0xc8)]=_0x3c22c7,this['options']=_0x4a8658,this['viewerParameters']=_0x200cf7,this[_0x2af215(0x102)]=new ParticlesComputing(this['context'],this['data'],this[_0x2af215(0x185)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x2af215(0xc8)],this['options'],this[_0x2af215(0x10b)],this['particlesComputing']);}['canvasResize'](_0x4964ed){const _0x1a1639=_0xddbfa5;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2f0895=>{this['particlesComputing']['windTextures'][_0x2f0895]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x1a1639(0xdd)](this['particlesRendering'][_0x1a1639(0x187)])['forEach'](_0x274ac7=>{const _0x202788=_0x1a1639;this[_0x202788(0x15a)]['framebuffers'][_0x274ac7][_0x202788(0x15e)]();}),this[_0x1a1639(0x172)]=_0x4964ed,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x1a1639(0xc8)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x1a1639(0x172)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0xddbfa5(0x17b)](){const _0x1f0d88=_0xddbfa5,_0x48c72d=new Cesium$2[(_0x1f0d88(0x163))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0x1f0d88(0xb4)]['OPAQUE']});Object[_0x1f0d88(0xdd)](this['particlesRendering']['framebuffers'])[_0x1f0d88(0xf2)](_0x49dd1d=>{const _0x1dc185=_0x1f0d88;_0x48c72d[_0x1dc185(0x128)]=this['particlesRendering']['framebuffers'][_0x49dd1d],_0x48c72d[_0x1dc185(0x151)](this['context']);});}['refreshParticles'](_0xd2cf55){const _0x5a7a20=_0xddbfa5;this[_0x5a7a20(0x17b)](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing'][_0x5a7a20(0x18f)](this['context'],this['options'],this['viewerParameters']);if(_0xd2cf55){var _0x560531;const _0x4124bc=this[_0x5a7a20(0x15a)][_0x5a7a20(0xa2)](this['options']);this[_0x5a7a20(0x15a)]['primitives']['segments']['geometry']=_0x4124bc;const _0x2b63ea=Cesium$2['VertexArray'][_0x5a7a20(0xe9)]({'context':this['context'],'geometry':_0x4124bc,'attributeLocations':this['particlesRendering']['primitives']['segments'][_0x5a7a20(0x133)],'bufferUsage':Cesium$2[_0x5a7a20(0xbb)]['STATIC_DRAW']});(_0x560531=this['particlesRendering']['primitives'])!==null&&_0x560531!==void 0x0&&(_0x560531=_0x560531['segments'])!==null&&_0x560531!==void 0x0&&_0x560531['commandToExecute']&&(this[_0x5a7a20(0x15a)][_0x5a7a20(0xac)][_0x5a7a20(0x105)]['commandToExecute']['vertexArray']=_0x2b63ea);}}[_0xddbfa5(0xf5)](_0xf1ef95){const _0x2c9cc9=_0xddbfa5;let _0x510a2e=![];this['options']['maxParticles']!==_0xf1ef95['maxParticles']&&(_0x510a2e=!![]),Object['keys'](_0xf1ef95)['forEach'](_0xc539cc=>{this['options'][_0xc539cc]=_0xf1ef95[_0xc539cc];}),this[_0x2c9cc9(0x166)](_0x510a2e);}['applyViewerParameters'](_0x143743){Object['keys'](_0x143743)['forEach'](_0x3d8a4d=>{this['viewerParameters'][_0x3d8a4d]=_0x143743[_0x3d8a4d];}),this['refreshParticles'](![]);}['destroy'](){const _0x3c30e7=_0xddbfa5;clearTimeout(this[_0x3c30e7(0x176)]),this['particlesComputing']['destroyParticlesTextures'](),Object[_0x3c30e7(0xdd)](this['particlesComputing']['windTextures'])['forEach'](_0xe45e57=>{const _0xddda71=_0x3c30e7;this[_0xddda71(0x102)]['windTextures'][_0xe45e57]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x3c30e7(0x15e)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x13a0d2=>{this['particlesRendering']['framebuffers'][_0x13a0d2]['destroy']();});for(const _0x59d081 in this){delete this[_0x59d081];}}}const Cesium$1=mars3d__namespace[_0xddbfa5(0x126)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0xddbfa5(0x14f)]};class WindLayer extends BaseLayer$1{constructor(_0x2bb37c={}){_0x2bb37c={...DEF_OPTIONS,..._0x2bb37c},super(_0x2bb37c),this['_setOptionsHook'](_0x2bb37c);}get[_0xddbfa5(0xf7)](){const _0x3345f0=_0xddbfa5;return this[_0x3345f0(0xac)];}get['data'](){return this['_data'];}set['data'](_0x5544e1){this['setData'](_0x5544e1);}get['colors'](){return this['options']['colors'];}set[_0xddbfa5(0xa0)](_0x1795d1){this['options']['colors']=_0x1795d1,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x1795d1}),this['resize']();}[_0xddbfa5(0xa3)](){}['_addedHook'](){const _0xc84f59=_0xddbfa5;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1[(_0xc84f59(0x13d))](),this[_0xc84f59(0x124)]['scene'][_0xc84f59(0xac)][_0xc84f59(0x13c)](this[_0xc84f59(0xac)]),this[_0xc84f59(0x10b)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0xc84f59(0xed)](),window['addEventListener'](_0xc84f59(0x14b),this['resize'][_0xc84f59(0xdb)](this),![]),this[_0xc84f59(0x12b)]=![],this['mouse_move']=![],this[_0xc84f59(0x124)]['on'](mars3d__namespace[_0xc84f59(0x116)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0xc84f59(0x15f)],this['_onMouseDownEvent'],this),this[_0xc84f59(0x124)]['on'](mars3d__namespace[_0xc84f59(0x116)][_0xc84f59(0xb7)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x9cadba=_0xddbfa5;window[_0x9cadba(0x177)]('resize',this[_0x9cadba(0x14b)]),this['_map'][_0x9cadba(0xde)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this[_0x9cadba(0x124)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x9cadba(0x101)],this),this['_map'][_0x9cadba(0xde)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x9cadba(0x124)][_0x9cadba(0xde)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x9cadba(0xac)][_0x9cadba(0x158)](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x151bd4=_0xddbfa5;if(!this['show']||!this['particleSystem'])return;this[_0x151bd4(0xac)][_0x151bd4(0xc4)]=![],this['primitives']['removeAll'](),this[_0x151bd4(0x124)]['once'](mars3d__namespace['EventType'][_0x151bd4(0xfa)],this['_onMap_preRenderEvent'],this);}[_0xddbfa5(0x162)](_0x598be2){const _0x5a92e2=_0xddbfa5;this[_0x5a92e2(0xfe)]['canvasResize'](this[_0x5a92e2(0xcf)][_0x5a92e2(0x172)]),this['addPrimitives'](),this['primitives'][_0x5a92e2(0xc4)]=!![];}['_onMapWhellEvent'](_0x526f58){const _0x2d74fe=_0xddbfa5;clearTimeout(this[_0x2d74fe(0xc6)]);if(!this[_0x2d74fe(0xc4)]||!this[_0x2d74fe(0xfe)])return;this[_0x2d74fe(0xac)]['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x6a04ff=_0x2d74fe;if(!this[_0x6a04ff(0xc4)])return;this['redraw']();},0xc8);}[_0xddbfa5(0x101)](_0x2560d3){const _0x2d3e42=_0xddbfa5;this[_0x2d3e42(0x12b)]=!![];}['_onMouseMoveEvent'](_0x4c2f5e){const _0x2c3e9e=_0xddbfa5;if(!this['show']||!this[_0x2c3e9e(0xfe)])return;this[_0x2c3e9e(0x12b)]&&(this['primitives']['show']=![],this['mouse_move']=!![]);}[_0xddbfa5(0xce)](_0xb6885a){const _0xc95606=_0xddbfa5;if(!this[_0xc95606(0xc4)]||!this['particleSystem'])return;this['mouse_down']&&this[_0xc95606(0x120)]&&this['redraw'](),this['primitives'][_0xc95606(0xc4)]=!![],this['mouse_down']=![],this['mouse_move']=![];}['redraw'](){const _0x125eb6=_0xddbfa5;if(!this[_0x125eb6(0x124)]||!this[_0x125eb6(0xc4)])return;this['updateViewerParameters'](),this[_0x125eb6(0xfe)]['applyViewerParameters'](this[_0x125eb6(0x10b)]),this[_0x125eb6(0xac)]['show']=!![];}['setData'](_0x723e07){const _0x1675f4=_0xddbfa5;this['_data']=_0x723e07,this['particleSystem']&&this['particleSystem']['destroy'](),this[_0x1675f4(0xfe)]=new ParticleSystem(this['scene']['context'],_0x723e07,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}[_0xddbfa5(0x130)](_0x2ee323,_0xa950f9){const _0x5967d8=_0xddbfa5;if(_0x2ee323)for(const _0x44677b in _0x2ee323){this[_0x44677b]=_0x2ee323[_0x44677b];}this[_0x5967d8(0xfe)]&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x35c154=_0xddbfa5,_0x127be3=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x127be3*_0x127be3,{'particlesTextureSize':_0x127be3,'maxParticles':this[_0x35c154(0xcb)],'particleHeight':this[_0x35c154(0x12e)],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x35c154(0xe6)],'dropRateBump':this[_0x35c154(0xc9)],'speedFactor':this[_0x35c154(0x17d)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x33e744=_0xddbfa5;this['primitives']['add'](this['particleSystem'][_0x33e744(0x102)]['primitives'][_0x33e744(0xf0)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x33e744(0xac)]['updateSpeed']),this['primitives'][_0x33e744(0x13c)](this['particleSystem'][_0x33e744(0x102)]['primitives']['updatePosition']),this['primitives'][_0x33e744(0x13c)](this['particleSystem']['particlesComputing'][_0x33e744(0xac)]['postProcessingPosition']),this['primitives']['add'](this['particleSystem'][_0x33e744(0x102)][_0x33e744(0xac)][_0x33e744(0xee)]),this[_0x33e744(0xac)][_0x33e744(0x13c)](this['particleSystem']['particlesRendering']['primitives']['segments']),this[_0x33e744(0xac)][_0x33e744(0x13c)](this['particleSystem']['particlesRendering'][_0x33e744(0xac)]['trails']),this['primitives'][_0x33e744(0x13c)](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x1d6fdc=_0xddbfa5;let _0x5237fc=this[_0x1d6fdc(0xd7)]['computeViewRectangle'](this['scene'][_0x1d6fdc(0xb9)]['ellipsoid']);if(!_0x5237fc){const _0xd564e9=this[_0x1d6fdc(0x124)]['getExtent']();_0x5237fc=Cesium$1['Rectangle']['fromDegrees'](_0xd564e9[_0x1d6fdc(0x17a)],_0xd564e9['ymin'],_0xd564e9['xmax'],_0xd564e9[_0x1d6fdc(0xb6)]);}const _0x4a97b6=Util[_0x1d6fdc(0x12f)](_0x5237fc);this['viewerParameters']['lonRange']['x']=_0x4a97b6['lon']['min'],this['viewerParameters'][_0x1d6fdc(0xf1)]['y']=_0x4a97b6['lon']['max'],this[_0x1d6fdc(0x10b)]['latRange']['x']=_0x4a97b6['lat']['min'],this['viewerParameters']['latRange']['y']=_0x4a97b6['lat']['max'];const _0x278b4a=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this[_0x1d6fdc(0xcf)]['drawingBufferHeight']);_0x278b4a>0x0&&(this['viewerParameters']['pixelSize']=_0x278b4a);}}mars3d__namespace[_0xddbfa5(0x9f)]['register'](_0xddbfa5(0x117),WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x1f3d07=_0xddbfa5;this[_0x1f3d07(0x138)]=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0x1f3d07(0xfc)]=null,this['speed']=null;}['destroy'](){for(const _0x2ad763 in this){delete this[_0x2ad763];}}}class CanvasWindField{constructor(_0x227eec){this['setOptions'](_0x227eec);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x24c508){const _0x472633=_0xddbfa5;this['_speedRate']=(0x64-(_0x24c508>0x63?0x63:_0x24c508))*0x64,this['_calc_speedRate']=[(this[_0x472633(0x147)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this[_0x472633(0x127)]];}get[_0xddbfa5(0x168)](){return this['_maxAge'];}set['maxAge'](_0x1298c9){this['_maxAge']=_0x1298c9;}['setOptions'](_0x4ff500){const _0x54e712=_0xddbfa5;this['options']=_0x4ff500,this[_0x54e712(0x168)]=_0x4ff500['maxAge']||0x78,this['speedRate']=_0x4ff500['speedRate']||0x32,this[_0x54e712(0xfd)]=[];const _0x10adc6=_0x4ff500['particlesNumber']||0x1000;for(let _0x29d5ce=0x0;_0x29d5ce<_0x10adc6;_0x29d5ce++){const _0x1c3ddc=this[_0x54e712(0x103)](new CanvasParticle());this['particles']['push'](_0x1c3ddc);}}['setDate'](_0xdf8102){const _0x509ccb=_0xddbfa5;this['rows']=_0xdf8102['rows'],this['cols']=_0xdf8102['cols'],this['xmin']=_0xdf8102['xmin'],this['xmax']=_0xdf8102['xmax'],this[_0x509ccb(0xc3)]=_0xdf8102['ymin'],this['ymax']=_0xdf8102[_0x509ccb(0xb6)],this[_0x509ccb(0xad)]=[];const _0x32f3f3=_0xdf8102['udata'],_0xd9cc7b=_0xdf8102[_0x509ccb(0xeb)];let _0x2e0f80=![];_0x32f3f3['length']===this['rows']&&_0x32f3f3[0x0]['length']===this['cols']&&(_0x2e0f80=!![]);let _0x24afcb=0x0,_0x26485b=null,_0x5d5de6=null;for(let _0xe37b0=0x0;_0xe37b0<this[_0x509ccb(0x131)];_0xe37b0++){_0x26485b=[];for(let _0x4e91c3=0x0;_0x4e91c3<this['cols'];_0x4e91c3++,_0x24afcb++){_0x2e0f80?_0x5d5de6=this['_calcUV'](_0x32f3f3[_0xe37b0][_0x4e91c3],_0xd9cc7b[_0xe37b0][_0x4e91c3]):_0x5d5de6=this['_calcUV'](_0x32f3f3[_0x24afcb],_0xd9cc7b[_0x24afcb]),_0x26485b[_0x509ccb(0x14c)](_0x5d5de6);}this[_0x509ccb(0xad)][_0x509ccb(0x14c)](_0x26485b);}this[_0x509ccb(0x185)]['reverseY']&&this['grid']['reverse']();}[_0xddbfa5(0x115)](){const _0x1d0d06=_0xddbfa5;delete this[_0x1d0d06(0x131)],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x1d0d06(0xc3)],delete this['ymax'],delete this['grid'],delete this['particles'];}[_0xddbfa5(0x113)](_0x4f0667,_0x23a766){const _0x338de5=(_0x4f0667-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x5ae649=(this['ymax']-_0x23a766)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x338de5,_0x5ae649];}['getUVByXY'](_0xfd9d9b,_0x2ca880){const _0x106b26=_0xddbfa5;if(_0xfd9d9b<0x0||_0xfd9d9b>=this['cols']||_0x2ca880>=this['rows'])return[0x0,0x0,0x0];const _0x520fb3=Math[_0x106b26(0x13e)](_0xfd9d9b),_0x2bb001=Math['floor'](_0x2ca880);if(_0x520fb3===_0xfd9d9b&&_0x2bb001===_0x2ca880)return this['grid'][_0x2ca880][_0xfd9d9b];const _0x4c4f1e=_0x520fb3+0x1,_0x2d9c91=_0x2bb001+0x1,_0x4595e4=this['getUVByXY'](_0x520fb3,_0x2bb001),_0x146edf=this['getUVByXY'](_0x4c4f1e,_0x2bb001),_0x61a1d8=this['getUVByXY'](_0x520fb3,_0x2d9c91),_0x29b9eb=this['getUVByXY'](_0x4c4f1e,_0x2d9c91);let _0x48c0ba=null;try{_0x48c0ba=this['_bilinearInterpolation'](_0xfd9d9b-_0x520fb3,_0x2ca880-_0x2bb001,_0x4595e4,_0x146edf,_0x61a1d8,_0x29b9eb);}catch(_0xc6bdbc){console['log'](_0xfd9d9b,_0x2ca880);}return _0x48c0ba;}['_bilinearInterpolation'](_0x46ad87,_0x3557b6,_0x124aa1,_0x494e80,_0x58697d,_0x218b56){const _0x428c33=0x1-_0x46ad87,_0xe74c15=0x1-_0x3557b6,_0x5cb24a=_0x428c33*_0xe74c15,_0x1f7f9b=_0x46ad87*_0xe74c15,_0x440308=_0x428c33*_0x3557b6,_0x3a8730=_0x46ad87*_0x3557b6,_0x2de17a=_0x124aa1[0x0]*_0x5cb24a+_0x494e80[0x0]*_0x1f7f9b+_0x58697d[0x0]*_0x440308+_0x218b56[0x0]*_0x3a8730,_0x23177b=_0x124aa1[0x1]*_0x5cb24a+_0x494e80[0x1]*_0x1f7f9b+_0x58697d[0x1]*_0x440308+_0x218b56[0x1]*_0x3a8730;return this['_calcUV'](_0x2de17a,_0x23177b);}['_calcUV'](_0xafd495,_0x164f22){const _0x17c4f6=_0xddbfa5;return[+_0xafd495,+_0x164f22,Math[_0x17c4f6(0x12c)](_0xafd495*_0xafd495+_0x164f22*_0x164f22)];}[_0xddbfa5(0xd9)](_0x598fc0,_0x47dc13){const _0x3f4cb5=_0xddbfa5;if(!this['isInExtent'](_0x598fc0,_0x47dc13))return null;const _0x204572=this[_0x3f4cb5(0x113)](_0x598fc0,_0x47dc13),_0x422de0=this[_0x3f4cb5(0x184)](_0x204572[0x0],_0x204572[0x1]);return _0x422de0;}[_0xddbfa5(0xbd)](_0x2632b8,_0x5d4f2f){const _0x2f9dda=_0xddbfa5;return _0x2632b8>=this['xmin']&&_0x2632b8<=this[_0x2f9dda(0x147)]&&_0x5d4f2f>=this[_0x2f9dda(0xc3)]&&_0x5d4f2f<=this['ymax']?!![]:![];}[_0xddbfa5(0xb8)](){const _0x2b42d9=_0xddbfa5,_0xc5fee1=fRandomByfloat(this['xmin'],this['xmax']),_0x4ad0eb=fRandomByfloat(this[_0x2b42d9(0xc3)],this[_0x2b42d9(0xb6)]);return{'lat':_0x4ad0eb,'lng':_0xc5fee1};}['getParticles'](){const _0x2c39d7=_0xddbfa5;let _0x53404c,_0x5f3689,_0x4022ff;for(let _0x2e3b0c=0x0,_0x2d2b55=this['particles']['length'];_0x2e3b0c<_0x2d2b55;_0x2e3b0c++){let _0x4ba949=this['particles'][_0x2e3b0c];_0x4ba949['age']<=0x0&&(_0x4ba949=this['_randomParticle'](_0x4ba949));if(_0x4ba949['age']>0x0){const _0x5b260c=_0x4ba949['tlng'],_0x358f6f=_0x4ba949['tlat'];_0x4022ff=this[_0x2c39d7(0xd9)](_0x5b260c,_0x358f6f),_0x4022ff?(_0x53404c=_0x5b260c+this['_calc_speedRate'][0x0]*_0x4022ff[0x0],_0x5f3689=_0x358f6f+this['_calc_speedRate'][0x1]*_0x4022ff[0x1],_0x4ba949['lng']=_0x5b260c,_0x4ba949['lat']=_0x358f6f,_0x4ba949['tlng']=_0x53404c,_0x4ba949['tlat']=_0x5f3689,_0x4ba949['speed']=_0x4022ff[0x2],_0x4ba949['age']--):_0x4ba949['age']=0x0;}}return this[_0x2c39d7(0xfd)];}['_randomParticle'](_0x1c6205){const _0x25331a=_0xddbfa5;let _0x2f7387,_0x23e47c;for(let _0x272334=0x0;_0x272334<0x1e;_0x272334++){_0x2f7387=this['getRandomLatLng'](),_0x23e47c=this['getUVByPoint'](_0x2f7387['lng'],_0x2f7387['lat']);if(_0x23e47c&&_0x23e47c[0x2]>0x0)break;}if(!_0x23e47c)return _0x1c6205;const _0x22a346=_0x2f7387['lng']+this[_0x25331a(0x136)][0x0]*_0x23e47c[0x0],_0x3a751a=_0x2f7387[_0x25331a(0x189)]+this['_calc_speedRate'][0x1]*_0x23e47c[0x1];return _0x1c6205['lng']=_0x2f7387['lng'],_0x1c6205[_0x25331a(0x189)]=_0x2f7387[_0x25331a(0x189)],_0x1c6205['tlng']=_0x22a346,_0x1c6205['tlat']=_0x3a751a,_0x1c6205['age']=Math['round'](Math[_0x25331a(0xd8)]()*this['maxAge']),_0x1c6205['speed']=_0x23e47c[0x2],_0x1c6205;}[_0xddbfa5(0x15e)](){for(const _0x57f035 in this){delete this[_0x57f035];}}}function _0x19a0(_0x2a19aa,_0x471ca2){const _0x4c2f2b=_0x4c2f();return _0x19a0=function(_0x19a0be,_0x2d84a3){_0x19a0be=_0x19a0be-0x9b;let _0x34fec3=_0x4c2f2b[_0x19a0be];return _0x34fec3;},_0x19a0(_0x2a19aa,_0x471ca2);}function fRandomByfloat(_0x13110d,_0x2fc6e4){const _0xbed33f=_0xddbfa5;return _0x13110d+Math[_0xbed33f(0xd8)]()*(_0x2fc6e4-_0x13110d);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0xddbfa5(0x11f)];class CanvasWindLayer extends BaseLayer{constructor(_0x446c4f={}){const _0x59ee3d=_0xddbfa5;super(_0x446c4f),this['_setOptionsHook'](_0x446c4f),this['canvas']=null,_0x446c4f['colors']&&_0x446c4f['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x59ee3d(0x148))](_0x446c4f));}['_setOptionsHook'](_0x2b3231,_0xabc8d1){const _0x2adf5b=_0xddbfa5;this['frameTime']=0x3e8/(_0x2b3231[_0x2adf5b(0xe5)]||0xa),this['_pointerEvents']=this['options'][_0x2adf5b(0x9c)]??![],this['color']=_0x2b3231[_0x2adf5b(0xbc)]||'#ffffff',this['lineWidth']=_0x2b3231['lineWidth']||0x1,this['fixedHeight']=_0x2b3231['fixedHeight']??0x0,this['reverseY']=_0x2b3231[_0x2adf5b(0x112)]??![],this['windField']&&this['windField']['setOptions'](_0x2b3231);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x452dc8=_0xddbfa5;return this[_0x452dc8(0x124)]['scene']['canvas']['clientWidth'];}get['canvasHeight'](){const _0xf7764d=_0xddbfa5;return this['_map'][_0xf7764d(0xcf)][_0xf7764d(0xbf)][_0xf7764d(0x17e)];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x1d0405){const _0x324d15=_0xddbfa5;this['_pointerEvents']=_0x1d0405;if(!this['canvas'])return;_0x1d0405?this['canvas'][_0x324d15(0x114)][_0x324d15(0x188)]='all':this['canvas'][_0x324d15(0x114)]['pointer-events']='none';}get[_0xddbfa5(0xcb)](){const _0x4dfd4c=_0xddbfa5;return this['options'][_0x4dfd4c(0xcb)];}set['particlesNumber'](_0x134a96){const _0x3ab082=_0xddbfa5;this['options'][_0x3ab082(0xcb)]=_0x134a96,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x4d9f9d=_0xddbfa5;return this['options'][_0x4d9f9d(0xd2)];}set['speedRate'](_0x13e19d){const _0x12593c=_0xddbfa5;this['options']['speedRate']=_0x13e19d,this[_0x12593c(0xdf)]&&(this[_0x12593c(0xdf)][_0x12593c(0xd2)]=_0x13e19d);}get[_0xddbfa5(0x168)](){const _0x30fff0=_0xddbfa5;return this[_0x30fff0(0x185)][_0x30fff0(0x168)];}set['maxAge'](_0x310d03){const _0x55a2a1=_0xddbfa5;this['options'][_0x55a2a1(0x168)]=_0x310d03,this['windField']&&(this[_0x55a2a1(0xdf)]['maxAge']=_0x310d03);}get['data'](){const _0x6c7c62=_0xddbfa5;return this[_0x6c7c62(0x13a)];}set[_0xddbfa5(0xc8)](_0x495a90){this['setData'](_0x495a90);}['_showHook'](_0x30ad9e){_0x30ad9e?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x201069=_0xddbfa5;this['options'][_0x201069(0xd4)]?this['initWorker']():this[_0x201069(0xdf)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x271088=_0xddbfa5;this[_0x271088(0xbf)]=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this[_0x271088(0x185)][_0x271088(0xc8)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x5638c8=_0xddbfa5;this['clear'](),this['unbindEvent'](),this[_0x5638c8(0xbf)]&&(this[_0x5638c8(0x124)]['container']['removeChild'](this[_0x5638c8(0xbf)]),delete this[_0x5638c8(0xbf)]);}['_createCanvas'](){const _0x561710=_0xddbfa5,_0x2f7edf=mars3d__namespace['DomUtil'][_0x561710(0x183)]('canvas',_0x561710(0x104),this[_0x561710(0x124)][_0x561710(0x18d)]);return _0x2f7edf['style']['position']='absolute',_0x2f7edf['style']['top']='0px',_0x2f7edf[_0x561710(0x114)]['left']='0px',_0x2f7edf['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',_0x2f7edf['style']['height']=this[_0x561710(0x124)][_0x561710(0xcf)][_0x561710(0xbf)]['clientHeight']+'px',_0x2f7edf['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x2f7edf['style']['zIndex']=this['options']['zIndex']??0x9,_0x2f7edf[_0x561710(0x152)]=this['_map']['scene']['canvas']['clientWidth'],_0x2f7edf[_0x561710(0x144)]=this['_map']['scene']['canvas']['clientHeight'],_0x2f7edf;}['resize'](){const _0x41fccc=_0xddbfa5;this['canvas']&&(this['canvas'][_0x41fccc(0x114)]['width']=this['_map']['scene']['canvas'][_0x41fccc(0x18a)]+'px',this['canvas']['style']['height']=this['_map']['scene'][_0x41fccc(0xbf)]['clientHeight']+'px',this[_0x41fccc(0xbf)]['width']=this['_map'][_0x41fccc(0xcf)]['canvas']['clientWidth'],this['canvas'][_0x41fccc(0x144)]=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x386e9b=_0xddbfa5,_0x90fe7a=this;let _0x26af78=Date[_0x386e9b(0x129)]();(function _0x1adaa0(){const _0x4473a2=_0x386e9b;_0x90fe7a['animateFrame']=window['requestAnimationFrame'](_0x1adaa0);if(_0x90fe7a['show']&&_0x90fe7a[_0x4473a2(0xdf)]){const _0x23a93a=Date['now'](),_0x3a6ffd=_0x23a93a-_0x26af78;_0x3a6ffd>_0x90fe7a['frameTime']&&(_0x26af78=_0x23a93a-_0x3a6ffd%_0x90fe7a[_0x4473a2(0x106)],_0x90fe7a['update']());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x386e9b(0x120)]=![],this['options']['mouseHidden']&&(this[_0x386e9b(0x124)]['on'](mars3d__namespace[_0x386e9b(0x116)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x386e9b(0x116)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x386e9b(0x116)][_0x386e9b(0xb7)],this['_onMouseUpEvent'],this)));}[_0xddbfa5(0x107)](){const _0x5183c1=_0xddbfa5;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener'](_0x5183c1(0x14b),this['resize']),this['options']['mouseHidden']&&(this[_0x5183c1(0x124)][_0x5183c1(0xde)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x5183c1(0x116)]['mouseDown'],this['_onMouseDownEvent'],this),this[_0x5183c1(0x124)][_0x5183c1(0xde)](mars3d__namespace['EventType'][_0x5183c1(0xb7)],this['_onMouseUpEvent'],this),this[_0x5183c1(0x124)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x4a430d){const _0x291f67=_0xddbfa5;clearTimeout(this[_0x291f67(0xc6)]);if(!this[_0x291f67(0xc4)]||!this['canvas'])return;this['canvas']['style']['visibility']=_0x291f67(0xb2),this['refreshTimer']=setTimeout(()=>{const _0x15689d=_0x291f67;if(!this['show'])return;this[_0x15689d(0xb1)](),this['canvas']['style']['visibility']='visible';},0xc8);}[_0xddbfa5(0x101)](_0xa4b5f5){const _0x138111=_0xddbfa5;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x138111(0x137)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x1f4da7){const _0x46bec5=_0xddbfa5;if(!this[_0x46bec5(0xc4)]||!this[_0x46bec5(0xbf)])return;this['mouse_down']&&(this[_0x46bec5(0xbf)][_0x46bec5(0x114)][_0x46bec5(0x14e)]='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x3d2464){const _0x23bfed=_0xddbfa5;if(!this['show']||!this[_0x23bfed(0xbf)])return;this['_map']['off'](mars3d__namespace[_0x23bfed(0x116)]['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this[_0x23bfed(0x120)]&&this['redraw'](),this['canvas'][_0x23bfed(0x114)]['visibility']=_0x23bfed(0x156),this['mouse_down']=![],this['mouse_move']=![];}[_0xddbfa5(0x16d)](_0x40b22e){const _0x4b55b9=_0xddbfa5;this['clear'](),this[_0x4b55b9(0x13a)]=_0x40b22e,this[_0x4b55b9(0xdf)]['setDate'](_0x40b22e),this['redraw']();}['redraw'](){const _0x4cd81b=_0xddbfa5;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x4cd81b(0x178)]();}[_0xddbfa5(0x178)](){const _0x1a3554=_0xddbfa5;if(this[_0x1a3554(0xdc)])return;this['_updateIng']=!![];if(this['worker'])this['windField'][_0x1a3554(0x178)]();else{const _0x181613=this[_0x1a3554(0xdf)][_0x1a3554(0x10d)]();this['_drawLines'](_0x181613);}this[_0x1a3554(0xdc)]=![];}[_0xddbfa5(0x10e)](_0x9d8084){const _0x35b35d=_0xddbfa5;this['canvasContext']['globalCompositeOperation']=_0x35b35d(0x174),this['canvasContext']['fillRect'](0x0,0x0,this[_0x35b35d(0x135)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']=_0x35b35d(0xa1),this['canvasContext']['globalAlpha']=0.9;const _0x4474af=this['_map'][_0x35b35d(0xcf)][_0x35b35d(0x157)]!==Cesium[_0x35b35d(0xff)]['SCENE3D'],_0x2af17c=this['canvasWidth']*0.25;if(this[_0x35b35d(0x123)])for(let _0x38eeea=0x0,_0x6a610d=_0x9d8084['length'];_0x38eeea<_0x6a610d;_0x38eeea++){const _0x32414b=_0x9d8084[_0x38eeea],_0x24ccdf=this['_tomap'](_0x32414b['lng'],_0x32414b[_0x35b35d(0x189)],_0x32414b),_0xb54a54=this['_tomap'](_0x32414b[_0x35b35d(0x169)],_0x32414b['tlat'],_0x32414b);if(!_0x24ccdf||!_0xb54a54)continue;if(_0x4474af&&Math['abs'](_0x24ccdf[0x0]-_0xb54a54[0x0])>=_0x2af17c)continue;this[_0x35b35d(0x14a)]['beginPath'](),this[_0x35b35d(0x14a)]['lineWidth']=this['lineWidth'],this[_0x35b35d(0x14a)]['strokeStyle']=this['_colorRamp']['getColor'](_0x32414b[_0x35b35d(0xd5)]),this['canvasContext']['moveTo'](_0x24ccdf[0x0],_0x24ccdf[0x1]),this['canvasContext'][_0x35b35d(0x175)](_0xb54a54[0x0],_0xb54a54[0x1]),this[_0x35b35d(0x14a)]['stroke']();}else{this['canvasContext']['beginPath'](),this['canvasContext'][_0x35b35d(0xea)]=this[_0x35b35d(0xea)],this['canvasContext']['strokeStyle']=this['color'];for(let _0x32a85c=0x0,_0x1fe95b=_0x9d8084['length'];_0x32a85c<_0x1fe95b;_0x32a85c++){const _0xc2797d=_0x9d8084[_0x32a85c],_0x8e8be=this['_tomap'](_0xc2797d['lng'],_0xc2797d['lat'],_0xc2797d),_0x3ceca1=this['_tomap'](_0xc2797d[_0x35b35d(0x169)],_0xc2797d['tlat'],_0xc2797d);if(!_0x8e8be||!_0x3ceca1)continue;if(_0x4474af&&Math['abs'](_0x8e8be[0x0]-_0x3ceca1[0x0])>=_0x2af17c)continue;this['canvasContext']['moveTo'](_0x8e8be[0x0],_0x8e8be[0x1]),this['canvasContext']['lineTo'](_0x3ceca1[0x0],_0x3ceca1[0x1]);}this[_0x35b35d(0x14a)]['stroke']();}}['_tomap'](_0x1e24b6,_0x327f65,_0x449a30){const _0x113418=_0xddbfa5,_0x19ebfa=Cesium['Cartesian3']['fromDegrees'](_0x1e24b6,_0x327f65,this['fixedHeight']),_0x49efd0=this['_map']['scene'];if(_0x49efd0['mode']===Cesium['SceneMode'][_0x113418(0x118)]){const _0x175e0c=new Cesium['EllipsoidalOccluder'](_0x49efd0['globe']['ellipsoid'],_0x49efd0['camera']['positionWC']),_0x10d6d3=_0x175e0c['isPointVisible'](_0x19ebfa);if(!_0x10d6d3)return _0x449a30[_0x113418(0xfc)]=0x0,null;}const _0x568e79=Cesium[_0x113418(0xa6)][_0x113418(0xe7)](this['_map']['scene'],_0x19ebfa);return _0x568e79?[_0x568e79['x'],_0x568e79['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0xb677ec=_0xddbfa5;this['worker']=new Worker(this[_0xb677ec(0x185)]['worker']),this['worker']['onmessage']=_0x52da6b=>{const _0x22d91e=_0xb677ec;this[_0x22d91e(0x10e)](_0x52da6b['data'][_0x22d91e(0xfd)]),this['_updateIng2']=![];},this['windField']={'init':_0x47e922=>{const _0x13b8a8=_0xb677ec;this['worker']['postMessage']({'type':_0x13b8a8(0x9b),'options':_0x47e922});},'setOptions':_0x3c8457=>{const _0x4b6e2e=_0xb677ec;this['worker']['postMessage']({'type':_0x4b6e2e(0xf5),'options':_0x3c8457});},'setDate':_0x51d517=>{const _0x272ed9=_0xb677ec;this['worker'][_0x272ed9(0x146)]({'type':'setDate','data':_0x51d517});},'update':()=>{const _0x4fae68=_0xb677ec;if(this['_updateIng2'])return;this[_0x4fae68(0x11b)]=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x40d968=_0xb677ec;this['worker'][_0x40d968(0x146)]({'type':'clear'});}},this['windField'][_0xb677ec(0x9b)](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0xddbfa5(0xf7)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0xddbfa5(0xc0)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object[_0xddbfa5(0x9d)](exports,'__esModule',{'value':!![]});
}));
