/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.7
 * 编译日期：2024-03-19 15:39:35
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x4e7015=_0xf357;(function(_0x22f0ec,_0x191608){const _0x34035f=_0xf357,_0x485eec=_0x22f0ec();while(!![]){try{const _0x3d50c8=-parseInt(_0x34035f(0x1b9))/0x1+-parseInt(_0x34035f(0x184))/0x2*(parseInt(_0x34035f(0x111))/0x3)+-parseInt(_0x34035f(0x1b6))/0x4+parseInt(_0x34035f(0x122))/0x5+-parseInt(_0x34035f(0x136))/0x6*(parseInt(_0x34035f(0x1cf))/0x7)+parseInt(_0x34035f(0x1ca))/0x8+-parseInt(_0x34035f(0x10a))/0x9*(-parseInt(_0x34035f(0x126))/0xa);if(_0x3d50c8===_0x191608)break;else _0x485eec['push'](_0x485eec['shift']());}catch(_0x117a61){_0x485eec['push'](_0x485eec['shift']());}}}(_0x2a84,0xec9fb));function _interopNamespace(_0x49a21f){const _0x3c39b1=_0xf357;if(_0x49a21f&&_0x49a21f[_0x3c39b1(0x181)])return _0x49a21f;var _0x21688f=Object[_0x3c39b1(0x1df)](null);return _0x49a21f&&Object[_0x3c39b1(0x1a9)](_0x49a21f)['forEach'](function(_0x2af416){const _0x5639d7=_0x3c39b1;if(_0x2af416!=='default'){var _0x27aae3=Object[_0x5639d7(0x1da)](_0x49a21f,_0x2af416);Object[_0x5639d7(0x1fc)](_0x21688f,_0x2af416,_0x27aae3[_0x5639d7(0x176)]?_0x27aae3:{'enumerable':!![],'get':function(){return _0x49a21f[_0x2af416];}});}}),_0x21688f['default']=_0x49a21f,_0x21688f;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x4e7015(0x1c5)];function getU(_0x27cb54,_0x4bfdd1){const _0x21de66=_0x4e7015,_0x424be7=_0x27cb54*Math['cos'](Cesium$7['Math'][_0x21de66(0x1c9)](_0x4bfdd1));return _0x424be7;}function getV(_0x541577,_0x1cf273){const _0x2ebf91=_0x4e7015,_0x304968=_0x541577*Math[_0x2ebf91(0x169)](Cesium$7['Math']['toRadians'](_0x1cf273));return _0x304968;}function getSpeed(_0x1c8579,_0x29ab77){const _0x120e90=Math['sqrt'](Math['pow'](_0x1c8579,0x2)+Math['pow'](_0x29ab77,0x2));return _0x120e90;}function getDirection(_0x4caabe,_0x2527fd){let _0x9c485f=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x2527fd,_0x4caabe));return _0x9c485f+=_0x9c485f<0x0?0x168:0x0,_0x9c485f;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x3e4c63){const _0x346cda=_0x4e7015;this[_0x346cda(0x1ad)]=_0x3e4c63['commandType'],this[_0x346cda(0x17a)]=_0x3e4c63[_0x346cda(0x17a)],this['attributeLocations']=_0x3e4c63[_0x346cda(0x152)],this['primitiveType']=_0x3e4c63['primitiveType'],this[_0x346cda(0x170)]=_0x3e4c63[_0x346cda(0x170)],this['vertexShaderSource']=_0x3e4c63[_0x346cda(0x198)],this['fragmentShaderSource']=_0x3e4c63['fragmentShaderSource'],this['rawRenderState']=_0x3e4c63['rawRenderState'],this[_0x346cda(0x1ef)]=_0x3e4c63[_0x346cda(0x1ef)],this[_0x346cda(0x1e3)]=_0x3e4c63['outputTexture'],this['autoClear']=_0x3e4c63['autoClear']??![],this['preExecute']=_0x3e4c63[_0x346cda(0x108)],this['show']=!![],this[_0x346cda(0x1ac)]=undefined,this['clearCommand']=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x346cda(0x1ef)],'pass':Cesium$6[_0x346cda(0x1f1)][_0x346cda(0x1a1)]}));}['createCommand'](_0x18418c){const _0xc14bc=_0x4e7015;switch(this[_0xc14bc(0x1ad)]){case'Draw':{const _0x35a1b7=Cesium$6['VertexArray']['fromGeometry']({'context':_0x18418c,'geometry':this['geometry'],'attributeLocations':this[_0xc14bc(0x152)],'bufferUsage':Cesium$6[_0xc14bc(0x132)]['STATIC_DRAW']}),_0x3580fd=Cesium$6['ShaderProgram']['fromCache']({'context':_0x18418c,'attributeLocations':this[_0xc14bc(0x152)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x5827e9=Cesium$6[_0xc14bc(0x1a4)][_0xc14bc(0x180)](this[_0xc14bc(0x16a)]);return new Cesium$6[(_0xc14bc(0x13b))]({'primitiveType':this['primitiveType'],'shaderProgram':_0x3580fd,'vertexArray':_0x35a1b7,'modelMatrix':Cesium$6[_0xc14bc(0x1bb)][_0xc14bc(0x115)],'renderState':_0x5827e9,'uniformMap':this[_0xc14bc(0x170)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0xc14bc(0x1a1)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0xc14bc(0x1d0))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x50f8b5,_0x3db6c2){const _0x29856e=_0x4e7015;this['geometry']=_0x3db6c2;const _0x31ccfd=Cesium$6['VertexArray'][_0x29856e(0x113)]({'context':_0x50f8b5,'geometry':this[_0x29856e(0x17a)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0x31ccfd;}['update'](_0xf00173){const _0x5c27ea=_0x4e7015;if(!this['show'])return;if(_0xf00173['mode']!==Cesium$6['SceneMode'][_0x5c27ea(0x19f)])return;!Cesium$6[_0x5c27ea(0x146)](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0xf00173['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this[_0x5c27ea(0x1e4)])&&_0xf00173['commandList']['push'](this['clearCommand']),_0xf00173[_0x5c27ea(0x10b)]['push'](this['commandToExecute']);}[_0x4e7015(0x1b1)](){return![];}['destroy'](){const _0x4bc2c0=_0x4e7015;if(this['clearCommand']){var _0x375932,_0x31fe68;(_0x375932=this[_0x4bc2c0(0x1e4)])!==null&&_0x375932!==void 0x0&&_0x375932['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x31fe68=this['clearCommand'])!==null&&_0x31fe68!==void 0x0&&_0x31fe68['shaderProgram']&&this[_0x4bc2c0(0x1e4)][_0x4bc2c0(0x114)]['destroy'](),delete this['clearCommand'];}return this[_0x4bc2c0(0x1ac)]&&(this[_0x4bc2c0(0x1ac)]['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute']['shaderProgram']&&this[_0x4bc2c0(0x1ac)]['shaderProgram'][_0x4bc2c0(0x15f)](),delete this[_0x4bc2c0(0x1ac)]),Cesium$6[_0x4bc2c0(0x1a5)](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x653a1c=function(){const _0x25d08e=_0xf357,_0x372ce5=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x25d08e(0x199)][_0x25d08e(0x14a)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x372ce5;},_0xd9a511=function(_0x504d64,_0xaf44ef){const _0x192e65=_0xf357;if(Cesium$5['defined'](_0xaf44ef)){const _0xd82bcd={};_0xd82bcd['arrayBufferView']=_0xaf44ef,_0x504d64[_0x192e65(0x141)]=_0xd82bcd;}const _0x4934c5=new Cesium$5['Texture'](_0x504d64);return _0x4934c5;},_0xe2df32=function(_0x5da934,_0x21145d,_0x5b42bd){const _0xdaf68c=new Cesium$5['Framebuffer']({'context':_0x5da934,'colorTextures':[_0x21145d],'depthTexture':_0x5b42bd});return _0xdaf68c;},_0x1613f0=function(_0x153ff0){const _0x457176=_0xf357,_0x48105c=!![],_0x5e925b=![],_0x43afe5={'viewport':_0x153ff0[_0x457176(0x1c1)],'depthTest':_0x153ff0['depthTest'],'depthMask':_0x153ff0['depthMask'],'blending':_0x153ff0['blending']},_0x5dcc37=Cesium$5['Appearance']['getDefaultRenderState'](_0x48105c,_0x5e925b,_0x43afe5);return _0x5dcc37;},_0x4f76d2=function(_0x325f50){const _0x1594d6=_0xf357,_0x28ad5e={},_0x3f0b78=Cesium$5['Math'][_0x1594d6(0x11f)](_0x325f50['west'],Cesium$5['Math']['TWO_PI']),_0x5b68c2=Cesium$5['Math'][_0x1594d6(0x11f)](_0x325f50['east'],Cesium$5[_0x1594d6(0x158)][_0x1594d6(0x1af)]),_0x41a45b=_0x325f50[_0x1594d6(0x187)];let _0x4b42d8,_0x489ea2;_0x41a45b>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x4b42d8=0x0,_0x489ea2=Cesium$5['Math']['TWO_PI']):_0x5b68c2-_0x3f0b78<_0x41a45b?(_0x4b42d8=_0x3f0b78,_0x489ea2=_0x3f0b78+_0x41a45b):(_0x4b42d8=_0x3f0b78,_0x489ea2=_0x5b68c2);_0x28ad5e['lon']={'min':Cesium$5[_0x1594d6(0x158)]['toDegrees'](_0x4b42d8),'max':Cesium$5[_0x1594d6(0x158)]['toDegrees'](_0x489ea2)};const _0x41faea=_0x325f50[_0x1594d6(0x12b)],_0x52e93d=_0x325f50['north'],_0x5f1a7f=_0x325f50['height'],_0x24239e=_0x5f1a7f>Cesium$5['Math']['PI']/0xc?_0x5f1a7f/0x2:0x0;let _0x34f424=Cesium$5['Math'][_0x1594d6(0x10e)](_0x41faea-_0x24239e),_0x2cf40a=Cesium$5[_0x1594d6(0x158)][_0x1594d6(0x10e)](_0x52e93d+_0x24239e);return _0x34f424<-Cesium$5[_0x1594d6(0x158)][_0x1594d6(0x161)]&&(_0x34f424=-Cesium$5['Math'][_0x1594d6(0x11a)]),_0x2cf40a>Cesium$5[_0x1594d6(0x158)][_0x1594d6(0x161)]&&(_0x2cf40a=Cesium$5['Math'][_0x1594d6(0x11a)]),_0x28ad5e[_0x1594d6(0x1ab)]={'min':Cesium$5['Math'][_0x1594d6(0x15b)](_0x34f424),'max':Cesium$5['Math']['toDegrees'](_0x2cf40a)},_0x28ad5e;};return{'getFullscreenQuad':_0x653a1c,'createTexture':_0xd9a511,'createFramebuffer':_0xe2df32,'createRawRenderState':_0x1613f0,'viewRectangleToLonLatRange':_0x4f76d2};}());function _0xf357(_0x4314f7,_0x5dda34){const _0x2a8426=_0x2a84();return _0xf357=function(_0xf357d1,_0x3c7287){_0xf357d1=_0xf357d1-0x100;let _0x36f8cd=_0x2a8426[_0xf357d1];return _0x36f8cd;},_0xf357(_0x4314f7,_0x5dda34);}function _0x2a84(){const _0x11fad4=['viewRectangleToLonLatRange','RGB','defined','0px','particlesTextures','blue','FLOAT','Cartesian2','createRawRenderState','max','bindEvent','createTexture','wheel','min','attributeLocations','Rectangle','canvas','particlesWind','colors','clientHeight','Math','colorTable','viewerParameters','toDegrees','windField','xmax','primitives','destroy','fadeOpacity','PI_OVER_THREE','vdata','ShaderSource','dimensions','segmentsColor','nextParticlesSpeed','strokeStyle','currentParticlesSpeed','sin','rawRenderState','maxParticles','segments','setData','_mountedHook','framebuffers','uniformMap','worker','_setOptionsHook','postProcessingPosition','animateFrame','canvasWind','get','nextTrailsDepth','_onMouseUpEvent','scene','geometry','hidden','top','windTextures','sqrt','particlesTextureSize','fromCache','__esModule','TextureMinificationFilter','particlesRendering','2kbikrc','setOptions','destroyParticlesTextures','width','postProcessingSpeed','_onMouseDownEvent','preRender','wind','computeViewRectangle','data','updateSpeed','_calcUV','UNSIGNED_INT','style','pixelSize','abs','LayerUtil','red','age','Compute','vertexShaderSource','ComponentDatatype','unbindEvent','camera','segmentsDepth','position','register','SCENE3D','getOptions','OPAQUE','floor','postMessage','RenderState','destroyObject','getColorTexture','length','particlesComputing','keys','mouse_down','lat','commandToExecute','commandType','rows','TWO_PI','color','isDestroyed','WindLayer','DEPTH_COMPONENT','mars3d-canvasWind','EventType','3493388qCDviT','_calc_speedRate','ColorRamp','1769633tXhkps','updateViewerParameters','Matrix4','_speedRate','WindUtil','clear','clearFramebuffers','BaseLayer','viewport','canvasWidth','context','levmax','Cesium','forEach','randomizeParticles','_addedHook','toRadians','880872iuclbu','mode','nextParticlesPosition','CanvasWindLayer','lineWidth','2023cyIEwI','ComputeCommand','_bilinearInterpolation','show','cols','CanvasWindField','TRIANGLES','latRange','tlat','particleSystem','off','getOwnPropertyDescriptor','_canrefresh','_updateIng2','trails','_randomParticle','create','canrefresh','resize','canvasContext','outputTexture','clearCommand','_pointerEvents','RGBA','SceneMode','NEAREST','positionWC','currentParticlesPosition','xmin','speedRate','getUVByXY','_map','framebuffer','mouse_move','Pass','lineTo','_onMapWhellEvent','speedFactor','speed','options','createParticlesTextures','GeometryAttributes','lng','nextTrails','createRenderingPrimitives','defineProperty','height','particles','mouseMove','isInExtent','_data','_createCanvas','particlesNumber','update','PixelFormat','beginPath','preExecute','lev','3429KgmkLB','commandList','ellipsoid','_showHook','clampToLatitudeRange','getFullscreenQuad','ymin','2653116BzWcRT','clientWidth','fromGeometry','shaderProgram','IDENTITY','refreshTimer','log','maxAge','fromCssColorString','PI_OVER_TWO','pointerEvents','ClearCommand','lon','_updateIng','mod','_onMouseMoveEvent','udata','4823160ssTqho','mouseUp','PrimitiveType','updatePosition','123460MstAgj','depthTexture','grid','drawingBufferHeight','tlng','south','reverseY','lonRange','push','LUMINANCE','frameTime','visibility','BufferUsage','redraw','globeBoundingSphere','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','26616tKywVE','textures','ymax','fill','moveTo','DrawCommand','fromDegrees','removeAll','Cartesian3','setDate','layer','source','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','init'];_0x2a84=function(){return _0x11fad4;};return _0x2a84();}var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x4e7015(0x1c5)];class ParticlesRendering{constructor(_0x49b679,_0xd0d673,_0x4ed69c,_0x3f8a1b,_0x1e878c){const _0x5090a8=_0x4e7015;this['createRenderingTextures'](_0x49b679,_0xd0d673,_0x4ed69c[_0x5090a8(0x156)]),this['createRenderingFramebuffers'](_0x49b679),this[_0x5090a8(0x1fb)](_0x49b679,_0x4ed69c,_0x3f8a1b,_0x1e878c);}['createRenderingTextures'](_0x40992e,_0x1f8abd,_0x5b8b6d){const _0x3fb8e8=_0x4e7015,_0x32c279={'context':_0x40992e,'width':_0x40992e['drawingBufferWidth'],'height':_0x40992e['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat'][_0x3fb8e8(0x1e6)],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x5dde89={'context':_0x40992e,'width':_0x40992e['drawingBufferWidth'],'height':_0x40992e['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x3fb8e8(0x106)][_0x3fb8e8(0x1b3)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x3fb8e8(0x190)]},_0x32c87f=_0x5b8b6d['length'],_0x4f0842=new Float32Array(_0x32c87f*0x3);for(let _0x25d0ea=0x0;_0x25d0ea<_0x32c87f;_0x25d0ea++){const _0x5664ca=Cesium$4['Color'][_0x3fb8e8(0x119)](_0x5b8b6d[_0x25d0ea]);_0x4f0842[0x3*_0x25d0ea]=_0x5664ca[_0x3fb8e8(0x195)],_0x4f0842[0x3*_0x25d0ea+0x1]=_0x5664ca['green'],_0x4f0842[0x3*_0x25d0ea+0x2]=_0x5664ca[_0x3fb8e8(0x149)];}const _0x3c376a={'context':_0x40992e,'width':_0x32c87f,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x3fb8e8(0x145)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util[_0x3fb8e8(0x14f)](_0x32c279),'segmentsDepth':Util[_0x3fb8e8(0x14f)](_0x5dde89),'currentTrailsColor':Util[_0x3fb8e8(0x14f)](_0x32c279),'currentTrailsDepth':Util['createTexture'](_0x5dde89),'nextTrailsColor':Util['createTexture'](_0x32c279),'nextTrailsDepth':Util['createTexture'](_0x5dde89),'colorTable':Util['createTexture'](_0x3c376a,_0x4f0842)};}['createRenderingFramebuffers'](_0x300a6d){const _0x8282e0=_0x4e7015;this['framebuffers']={'segments':Util['createFramebuffer'](_0x300a6d,this['textures'][_0x8282e0(0x165)],this[_0x8282e0(0x137)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x300a6d,this['textures']['currentTrailsColor'],this[_0x8282e0(0x137)]['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x300a6d,this['textures']['nextTrailsColor'],this[_0x8282e0(0x137)][_0x8282e0(0x177)])};}['createSegmentsGeometry'](_0x24104b){const _0x5911ff=_0x4e7015,_0x4ba18d=0x4;let _0x4962d9=[];for(let _0xbc29fa=0x0;_0xbc29fa<_0x24104b['particlesTextureSize'];_0xbc29fa++){for(let _0x3cccb3=0x0;_0x3cccb3<_0x24104b[_0x5911ff(0x17f)];_0x3cccb3++){for(let _0x4c30dc=0x0;_0x4c30dc<_0x4ba18d;_0x4c30dc++){_0x4962d9[_0x5911ff(0x12e)](_0xbc29fa/_0x24104b['particlesTextureSize']),_0x4962d9[_0x5911ff(0x12e)](_0x3cccb3/_0x24104b['particlesTextureSize']);}}}_0x4962d9=new Float32Array(_0x4962d9);let _0x37660a=[];const _0xfd3cbd=[-0x1,0x1],_0x5c5a88=[-0x1,0x1];for(let _0x5c998b=0x0;_0x5c998b<_0x24104b['maxParticles'];_0x5c998b++){for(let _0x3ec6e8=0x0;_0x3ec6e8<_0x4ba18d/0x2;_0x3ec6e8++){for(let _0x5c8b9e=0x0;_0x5c8b9e<_0x4ba18d/0x2;_0x5c8b9e++){_0x37660a[_0x5911ff(0x12e)](_0xfd3cbd[_0x3ec6e8]),_0x37660a['push'](_0x5c5a88[_0x5c8b9e]),_0x37660a['push'](0x0);}}}_0x37660a=new Float32Array(_0x37660a);const _0x4186e3=0x6*_0x24104b['maxParticles'],_0x22da98=new Uint32Array(_0x4186e3);for(let _0x13e885=0x0,_0x35a290=0x0,_0x2aee75=0x0;_0x13e885<_0x24104b[_0x5911ff(0x16b)];_0x13e885++){_0x22da98[_0x35a290++]=_0x2aee75+0x0,_0x22da98[_0x35a290++]=_0x2aee75+0x1,_0x22da98[_0x35a290++]=_0x2aee75+0x2,_0x22da98[_0x35a290++]=_0x2aee75+0x2,_0x22da98[_0x35a290++]=_0x2aee75+0x1,_0x22da98[_0x35a290++]=_0x2aee75+0x3,_0x2aee75+=0x4;}const _0x595095=new Cesium$4['Geometry']({'attributes':new Cesium$4[(_0x5911ff(0x1f8))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x4962d9}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x37660a})}),'indices':_0x22da98});return _0x595095;}['createRenderingPrimitives'](_0x269639,_0x53f41b,_0x5aa58d,_0x288c82){const _0x3a5483=_0x4e7015,_0xaf8e28=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x53f41b),'primitiveType':Cesium$4[_0x3a5483(0x124)][_0x3a5483(0x1d5)],'uniformMap':{'currentParticlesPosition':function(){return _0x288c82['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x288c82['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x3baf80=_0x3a5483;return _0x288c82[_0x3baf80(0x148)]['postProcessingSpeed'];},'colorTable':function(){const _0x4ba634=_0x3a5483;return _0xaf8e28['textures'][_0x4ba634(0x159)];},'aspect':function(){return _0x269639['drawingBufferWidth']/_0x269639['drawingBufferHeight'];},'pixelSize':function(){const _0xfece3=_0x3a5483;return _0x5aa58d[_0xfece3(0x192)];},'lineWidth':function(){return _0x53f41b['lineWidth'];},'particleHeight':function(){return _0x53f41b['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x3a5483(0x14c)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x234ebd=_0x3a5483;return _0xaf8e28['textures'][_0x234ebd(0x165)];},'segmentsDepthTexture':function(){const _0x4a20a6=_0x3a5483;return _0xaf8e28['textures'][_0x4a20a6(0x19c)];},'currentTrailsColor':function(){const _0x556a73=_0x3a5483;return _0xaf8e28[_0x556a73(0x16f)]['currentTrails'][_0x556a73(0x1a6)](0x0);},'trailsDepthTexture':function(){const _0x40f55e=_0x3a5483;return _0xaf8e28['framebuffers']['currentTrails'][_0x40f55e(0x127)];},'fadeOpacity':function(){return _0x53f41b['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x3a5483(0x163))]({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x3a5483(0x142)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x4504bc=_0x3a5483,_0x356798=_0xaf8e28['framebuffers']['currentTrails'];_0xaf8e28['framebuffers']['currentTrails']=_0xaf8e28[_0x4504bc(0x16f)][_0x4504bc(0x1fa)],_0xaf8e28['framebuffers'][_0x4504bc(0x1fa)]=_0x356798,_0xaf8e28['primitives']['trails']['commandToExecute'][_0x4504bc(0x1ef)]=_0xaf8e28[_0x4504bc(0x16f)][_0x4504bc(0x1fa)],_0xaf8e28['primitives']['trails']['clearCommand']['framebuffer']=_0xaf8e28['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x3a5483(0x10f)](),'primitiveType':Cesium$4['PrimitiveType'][_0x3a5483(0x1d5)],'uniformMap':{'trailsColorTexture':function(){const _0x55559e=_0x3a5483;return _0xaf8e28['framebuffers'][_0x55559e(0x1fa)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0xaf8e28['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag=_0x4e7015(0x135),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x48227f,_0x1b8915,_0x543043,_0xbdfa46){this['data']=_0x1b8915,this['createWindTextures'](_0x48227f,_0x1b8915),this['createParticlesTextures'](_0x48227f,_0x543043,_0xbdfa46),this['createComputingPrimitives'](_0x1b8915,_0x543043,_0xbdfa46);}['createWindTextures'](_0x195c04,_0x3b620b){const _0x4975e4=_0x4e7015,_0x4fdff1={'context':_0x195c04,'width':_0x3b620b['dimensions']['lon'],'height':_0x3b620b[_0x4975e4(0x164)][_0x4975e4(0x1ab)]*(_0x3b620b['dimensions'][_0x4975e4(0x109)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x4975e4(0x12f)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x4fdff1,_0x3b620b['U']['array']),'V':Util['createTexture'](_0x4fdff1,_0x3b620b['V']['array'])};}[_0x4e7015(0x1f7)](_0x4534e7,_0x407f5a,_0x3b9ee1){const _0x2ff877=_0x4e7015,_0x4bc01e={'context':_0x4534e7,'width':_0x407f5a[_0x2ff877(0x17f)],'height':_0x407f5a[_0x2ff877(0x17f)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x2ff877(0x182)][_0x2ff877(0x1e8)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x2b942a=this['randomizeParticles'](_0x407f5a[_0x2ff877(0x16b)],_0x3b9ee1),_0x2e20fb=new Float32Array(0x4*_0x407f5a[_0x2ff877(0x16b)])[_0x2ff877(0x139)](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x4bc01e),'currentParticlesPosition':Util[_0x2ff877(0x14f)](_0x4bc01e,_0x2b942a),'nextParticlesPosition':Util['createTexture'](_0x4bc01e,_0x2b942a),'currentParticlesSpeed':Util['createTexture'](_0x4bc01e,_0x2e20fb),'nextParticlesSpeed':Util['createTexture'](_0x4bc01e,_0x2e20fb),'postProcessingPosition':Util['createTexture'](_0x4bc01e,_0x2b942a),'postProcessingSpeed':Util['createTexture'](_0x4bc01e,_0x2e20fb)};}[_0x4e7015(0x1c7)](_0xc92fe1,_0xa37a6){const _0x32131a=_0x4e7015,_0x49aa85=new Float32Array(0x4*_0xc92fe1);for(let _0x4b61fd=0x0;_0x4b61fd<_0xc92fe1;_0x4b61fd++){_0x49aa85[0x4*_0x4b61fd]=Cesium$3['Math']['randomBetween'](_0xa37a6[_0x32131a(0x12d)]['x'],_0xa37a6['lonRange']['y']),_0x49aa85[0x4*_0x4b61fd+0x1]=Cesium$3[_0x32131a(0x158)]['randomBetween'](_0xa37a6[_0x32131a(0x1d6)]['x'],_0xa37a6[_0x32131a(0x1d6)]['y']),_0x49aa85[0x4*_0x4b61fd+0x2]=Cesium$3['Math']['randomBetween'](this['data'][_0x32131a(0x109)]['min'],this['data']['lev'][_0x32131a(0x14d)]),_0x49aa85[0x4*_0x4b61fd+0x3]=0x0;}return _0x49aa85;}[_0x4e7015(0x186)](){const _0x3eef04=_0x4e7015;Object[_0x3eef04(0x1a9)](this['particlesTextures'])[_0x3eef04(0x1c6)](_0x510db7=>{this['particlesTextures'][_0x510db7]['destroy']();});}['createComputingPrimitives'](_0x124855,_0xb81c6a,_0x310231){const _0x1f21d7=_0x4e7015,_0x219dd8=new Cesium$3['Cartesian3'](_0x124855['dimensions'][_0x1f21d7(0x11d)],_0x124855[_0x1f21d7(0x164)]['lat'],_0x124855[_0x1f21d7(0x164)]['lev']),_0x546cb9=new Cesium$3['Cartesian3'](_0x124855['lon'][_0x1f21d7(0x151)],_0x124855['lat']['min'],_0x124855[_0x1f21d7(0x109)]['min']),_0x29563b=new Cesium$3[(_0x1f21d7(0x13e))](_0x124855['lon']['max'],_0x124855['lat'][_0x1f21d7(0x14d)],_0x124855['lev']['max']),_0x24ff8d=new Cesium$3['Cartesian3']((_0x29563b['x']-_0x546cb9['x'])/(_0x219dd8['x']-0x1),(_0x29563b['y']-_0x546cb9['y'])/(_0x219dd8['y']-0x1),_0x219dd8['z']>0x1?(_0x29563b['z']-_0x546cb9['z'])/(_0x219dd8['z']-0x1):0x1),_0x3f9be8=new Cesium$3['Cartesian2'](_0x124855['U']['min'],_0x124855['U']['max']),_0x11f64b=new Cesium$3[(_0x1f21d7(0x14b))](_0x124855['V']['min'],_0x124855['V'][_0x1f21d7(0x14d)]),_0xb96c48=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x1f21d7(0x197),'uniformMap':{'U':function(){return _0xb96c48['windTextures']['U'];},'V':function(){return _0xb96c48['windTextures']['V'];},'currentParticlesPosition':function(){const _0x4a7edc=_0x1f21d7;return _0xb96c48[_0x4a7edc(0x148)]['currentParticlesPosition'];},'dimension':function(){return _0x219dd8;},'minimum':function(){return _0x546cb9;},'maximum':function(){return _0x29563b;},'interval':function(){return _0x24ff8d;}},'fragmentShaderSource':new Cesium$3[(_0x1f21d7(0x163))]({'sources':[getWind_frag]}),'outputTexture':this[_0x1f21d7(0x148)][_0x1f21d7(0x155)],'preExecute':function(){const _0x49409d=_0x1f21d7;_0xb96c48['primitives']['getWind']['commandToExecute'][_0x49409d(0x1e3)]=_0xb96c48[_0x49409d(0x148)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0xb96c48['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x6bbf94=_0x1f21d7;return _0xb96c48['particlesTextures'][_0x6bbf94(0x155)];},'uSpeedRange':function(){return _0x3f9be8;},'vSpeedRange':function(){return _0x11f64b;},'pixelSize':function(){const _0x5aad36=_0x1f21d7;return _0x310231[_0x5aad36(0x192)];},'speedFactor':function(){return _0xb81c6a['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x1f21d7(0x166)],'preExecute':function(){const _0x45e2ed=_0x1f21d7,_0x212bdc=_0xb96c48['particlesTextures']['currentParticlesSpeed'];_0xb96c48['particlesTextures']['currentParticlesSpeed']=_0xb96c48['particlesTextures']['postProcessingSpeed'],_0xb96c48['particlesTextures'][_0x45e2ed(0x188)]=_0x212bdc,_0xb96c48[_0x45e2ed(0x15e)]['updateSpeed']['commandToExecute'][_0x45e2ed(0x1e3)]=_0xb96c48[_0x45e2ed(0x148)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x1f21d7(0x197),'uniformMap':{'currentParticlesPosition':function(){return _0xb96c48['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x50fb34=_0x1f21d7;return _0xb96c48['particlesTextures'][_0x50fb34(0x168)];}},'fragmentShaderSource':new Cesium$3[(_0x1f21d7(0x163))]({'sources':[updatePosition_frag]}),'outputTexture':this[_0x1f21d7(0x148)]['nextParticlesPosition'],'preExecute':function(){const _0x57a690=_0x1f21d7,_0x3ccbb5=_0xb96c48['particlesTextures']['currentParticlesPosition'];_0xb96c48['particlesTextures'][_0x57a690(0x1ea)]=_0xb96c48[_0x57a690(0x148)]['postProcessingPosition'],_0xb96c48[_0x57a690(0x148)][_0x57a690(0x173)]=_0x3ccbb5,_0xb96c48[_0x57a690(0x15e)][_0x57a690(0x125)]['commandToExecute'][_0x57a690(0x1e3)]=_0xb96c48['particlesTextures'][_0x57a690(0x1cc)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x1f21d7(0x197),'uniformMap':{'nextParticlesPosition':function(){return _0xb96c48['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x40d75a=_0x1f21d7;return _0xb96c48[_0x40d75a(0x148)]['nextParticlesSpeed'];},'lonRange':function(){return _0x310231['lonRange'];},'latRange':function(){return _0x310231['latRange'];},'randomCoefficient':function(){const _0xb5f5d5=Math['random']();return _0xb5f5d5;},'dropRate':function(){return _0xb81c6a['dropRate'];},'dropRateBump':function(){return _0xb81c6a['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x1f21d7(0x163))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1f21d7(0x148)]['postProcessingPosition'],'preExecute':function(){_0xb96c48['primitives']['postProcessingPosition']['commandToExecute']['outputTexture']=_0xb96c48['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x339e2e=_0x1f21d7;return _0xb96c48['particlesTextures'][_0x339e2e(0x173)];},'nextParticlesSpeed':function(){const _0xb7f239=_0x1f21d7;return _0xb96c48[_0xb7f239(0x148)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x12a4f6=_0x1f21d7;_0xb96c48[_0x12a4f6(0x15e)]['postProcessingSpeed']['commandToExecute']['outputTexture']=_0xb96c48['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x46c2f4,_0x5a06c7,_0x424547,_0x1c2094){const _0x286c38=_0x4e7015;this['context']=_0x46c2f4,_0x5a06c7={..._0x5a06c7},_0x5a06c7['udata']&&_0x5a06c7[_0x286c38(0x162)]&&(_0x5a06c7['dimensions']={},_0x5a06c7['dimensions']['lon']=_0x5a06c7[_0x286c38(0x1d3)],_0x5a06c7['dimensions']['lat']=_0x5a06c7['rows'],_0x5a06c7['dimensions']['lev']=_0x5a06c7['lev']||0x1,_0x5a06c7['lon']={},_0x5a06c7[_0x286c38(0x11d)]['min']=_0x5a06c7['xmin'],_0x5a06c7[_0x286c38(0x11d)][_0x286c38(0x14d)]=_0x5a06c7['xmax'],_0x5a06c7['lat']={},_0x5a06c7[_0x286c38(0x1ab)][_0x286c38(0x151)]=_0x5a06c7['ymin'],_0x5a06c7['lat']['max']=_0x5a06c7['ymax'],_0x5a06c7['lev']={},_0x5a06c7['lev']['min']=_0x5a06c7['levmin']??0x1,_0x5a06c7[_0x286c38(0x109)]['max']=_0x5a06c7[_0x286c38(0x1c4)]??0x1,_0x5a06c7['U']={},_0x5a06c7['U']['array']=new Float32Array(_0x5a06c7['udata']),_0x5a06c7['U']['min']=_0x5a06c7['umin']??Math['min'](..._0x5a06c7['udata']),_0x5a06c7['U']['max']=_0x5a06c7['umax']??Math[_0x286c38(0x14d)](..._0x5a06c7[_0x286c38(0x121)]),_0x5a06c7['V']={},_0x5a06c7['V']['array']=new Float32Array(_0x5a06c7['vdata']),_0x5a06c7['V']['min']=_0x5a06c7['vmin']??Math['min'](..._0x5a06c7['vdata']),_0x5a06c7['V']['max']=_0x5a06c7['vmax']??Math[_0x286c38(0x14d)](..._0x5a06c7['vdata'])),this['data']=_0x5a06c7,this['options']=_0x424547,this['viewerParameters']=_0x1c2094,this['particlesComputing']=new ParticlesComputing(this['context'],this[_0x286c38(0x18d)],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0x286c38(0x1a8)]);}['canvasResize'](_0x141ce8){const _0x27c423=_0x4e7015;this['particlesComputing']['destroyParticlesTextures'](),Object[_0x27c423(0x1a9)](this[_0x27c423(0x1a8)]['windTextures'])['forEach'](_0x461722=>{const _0x53074e=_0x27c423;this['particlesComputing']['windTextures'][_0x461722][_0x53074e(0x15f)]();}),this[_0x27c423(0x183)][_0x27c423(0x137)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x27c423(0x1c6)](_0x2fb203=>{const _0x1212a5=_0x27c423;this[_0x1212a5(0x183)]['framebuffers'][_0x2fb203]['destroy']();}),this['context']=_0x141ce8,this[_0x27c423(0x1a8)]=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x27c423(0x15a)]),this['particlesRendering']=new ParticlesRendering(this[_0x27c423(0x1c3)],this[_0x27c423(0x18d)],this['options'],this['viewerParameters'],this[_0x27c423(0x1a8)]);}[_0x4e7015(0x1bf)](){const _0x3f6bf6=_0x4e7015,_0x1acaa5=new Cesium$2[(_0x3f6bf6(0x11c))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x3f6bf6(0x1a1)]});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x4ed0ac=>{const _0x219511=_0x3f6bf6;_0x1acaa5[_0x219511(0x1ef)]=this['particlesRendering'][_0x219511(0x16f)][_0x4ed0ac],_0x1acaa5['execute'](this['context']);});}['refreshParticles'](_0xda849b){const _0xa153d4=_0x4e7015;this['clearFramebuffers'](),this[_0xa153d4(0x1a8)][_0xa153d4(0x186)](),this['particlesComputing'][_0xa153d4(0x1f7)](this[_0xa153d4(0x1c3)],this[_0xa153d4(0x1f6)],this[_0xa153d4(0x15a)]);if(_0xda849b){var _0x11baa5;const _0x3f6956=this['particlesRendering']['createSegmentsGeometry'](this[_0xa153d4(0x1f6)]);this[_0xa153d4(0x183)]['primitives']['segments']['geometry']=_0x3f6956;const _0x525cf9=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x3f6956,'attributeLocations':this[_0xa153d4(0x183)]['primitives']['segments'][_0xa153d4(0x152)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x11baa5=this['particlesRendering']['primitives'])!==null&&_0x11baa5!==void 0x0&&(_0x11baa5=_0x11baa5[_0xa153d4(0x16c)])!==null&&_0x11baa5!==void 0x0&&_0x11baa5['commandToExecute']&&(this[_0xa153d4(0x183)]['primitives']['segments'][_0xa153d4(0x1ac)]['vertexArray']=_0x525cf9);}}['setOptions'](_0x18a164){const _0x41d13a=_0x4e7015;let _0x469936=![];this['options']['maxParticles']!==_0x18a164[_0x41d13a(0x16b)]&&(_0x469936=!![]),Object[_0x41d13a(0x1a9)](_0x18a164)['forEach'](_0x24ede7=>{const _0x4178c2=_0x41d13a;this[_0x4178c2(0x1f6)][_0x24ede7]=_0x18a164[_0x24ede7];}),this['refreshParticles'](_0x469936);}['applyViewerParameters'](_0x4a46fb){const _0xe96862=_0x4e7015;Object[_0xe96862(0x1a9)](_0x4a46fb)['forEach'](_0x2c717e=>{const _0x46dfbe=_0xe96862;this[_0x46dfbe(0x15a)][_0x2c717e]=_0x4a46fb[_0x2c717e];}),this['refreshParticles'](![]);}['destroy'](){const _0x5c8571=_0x4e7015;clearTimeout(this[_0x5c8571(0x1e0)]),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x5c8571(0x1a8)]['windTextures'])['forEach'](_0x1b1517=>{const _0x169ea4=_0x5c8571;this[_0x169ea4(0x1a8)][_0x169ea4(0x17d)][_0x1b1517]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x5c8571(0x1a9)](this[_0x5c8571(0x183)]['framebuffers'])[_0x5c8571(0x1c6)](_0x386ea0=>{const _0x553b61=_0x5c8571;this['particlesRendering']['framebuffers'][_0x386ea0][_0x553b61(0x15f)]();});for(const _0x4627cb in this){delete this[_0x4627cb];}}}const Cesium$1=mars3d__namespace[_0x4e7015(0x1c5)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x2b6bf4={}){_0x2b6bf4={...DEF_OPTIONS,..._0x2b6bf4},super(_0x2b6bf4),this['_setOptionsHook'](_0x2b6bf4);}get['layer'](){const _0x344f34=_0x4e7015;return this[_0x344f34(0x15e)];}get[_0x4e7015(0x18d)](){return this['_data'];}set['data'](_0x38b749){this['setData'](_0x38b749);}get['colors'](){const _0x3f5d08=_0x4e7015;return this['options'][_0x3f5d08(0x156)];}set[_0x4e7015(0x156)](_0x1f23aa){this['options']['colors']=_0x1f23aa,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x1f23aa}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x16df73=_0x4e7015;this['scene']=this['_map']['scene'],this[_0x16df73(0x19b)]=this['_map'][_0x16df73(0x19b)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this[_0x16df73(0x1ee)]['scene'][_0x16df73(0x15e)]['add'](this[_0x16df73(0x15e)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this[_0x16df73(0x134)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener']('resize',this[_0x16df73(0x1e1)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x16df73(0x1f3)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x16df73(0x178)],this),this['_map']['on'](mars3d__namespace[_0x16df73(0x1b5)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x1dc039=_0x4e7015;window['removeEventListener']('resize',this['resize']),this['_map']['off'](mars3d__namespace['EventType'][_0x1dc039(0x18a)],this['_onMap_preRenderEvent'],this),this[_0x1dc039(0x1ee)][_0x1dc039(0x1d9)](mars3d__namespace[_0x1dc039(0x1b5)][_0x1dc039(0x150)],this[_0x1dc039(0x1f3)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x1dc039(0x189)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x1dc039(0x178)],this),this['_map']['off'](mars3d__namespace[_0x1dc039(0x1b5)][_0x1dc039(0x100)],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x1dc039(0x1ee)]['scene']['primitives']['remove'](this[_0x1dc039(0x15e)]);}['resize'](){const _0x3ecb8b=_0x4e7015;if(!this[_0x3ecb8b(0x1d2)]||!this['particleSystem'])return;this[_0x3ecb8b(0x15e)][_0x3ecb8b(0x1d2)]=![],this['primitives'][_0x3ecb8b(0x13d)](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x46983b){const _0x50dfae=_0x4e7015;this[_0x50dfae(0x1d8)]['canvasResize'](this['scene']['context']),this['addPrimitives'](),this[_0x50dfae(0x15e)]['show']=!![];}['_onMapWhellEvent'](_0x3f3545){const _0x1640b6=_0x4e7015;clearTimeout(this[_0x1640b6(0x116)]);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x5c82fc=_0x1640b6;if(!this[_0x5c82fc(0x1d2)])return;this[_0x5c82fc(0x133)]();},0xc8);}['_onMouseDownEvent'](_0x20d0d8){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x26df3f){const _0x2d036d=_0x4e7015;if(!this['show']||!this['particleSystem'])return;this[_0x2d036d(0x1aa)]&&(this['primitives'][_0x2d036d(0x1d2)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x4c197d){const _0x3c74aa=_0x4e7015;if(!this['show']||!this['particleSystem'])return;this[_0x3c74aa(0x1aa)]&&this[_0x3c74aa(0x1f0)]&&this[_0x3c74aa(0x133)](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}[_0x4e7015(0x133)](){const _0x34d47e=_0x4e7015;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives'][_0x34d47e(0x1d2)]=!![];}['setData'](_0x17e43e){const _0x1d66d3=_0x4e7015;this[_0x1d66d3(0x102)]=_0x17e43e,this['particleSystem']&&this[_0x1d66d3(0x1d8)][_0x1d66d3(0x15f)](),this['particleSystem']=new ParticleSystem(this[_0x1d66d3(0x179)][_0x1d66d3(0x1c3)],_0x17e43e,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x39fbf9,_0x47a525){const _0x55dad2=_0x4e7015;if(_0x39fbf9)for(const _0x24683d in _0x39fbf9){this[_0x24683d]=_0x39fbf9[_0x24683d];}this['particleSystem']&&this['particleSystem'][_0x55dad2(0x185)](this[_0x55dad2(0x1a0)]());}['getOptions'](){const _0x54f06e=_0x4e7015,_0x1f166d=Math['ceil'](Math[_0x54f06e(0x17e)](this['particlesNumber']));return this['particlesNumber']=_0x1f166d*_0x1f166d,{'particlesTextureSize':_0x1f166d,'maxParticles':this[_0x54f06e(0x104)],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x54f06e(0x160)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x54f06e(0x1f4)],'lineWidth':this['lineWidth'],'colors':this[_0x54f06e(0x156)]};}['addPrimitives'](){const _0x548557=_0x4e7015;this['primitives']['add'](this[_0x548557(0x1d8)]['particlesComputing']['primitives']['getWind']),this[_0x548557(0x15e)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x548557(0x18e)]),this[_0x548557(0x15e)]['add'](this['particleSystem']['particlesComputing'][_0x548557(0x15e)]['updatePosition']),this[_0x548557(0x15e)]['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this[_0x548557(0x15e)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x548557(0x188)]),this['primitives']['add'](this['particleSystem'][_0x548557(0x183)][_0x548557(0x15e)][_0x548557(0x16c)]),this[_0x548557(0x15e)]['add'](this['particleSystem']['particlesRendering'][_0x548557(0x15e)][_0x548557(0x1dd)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}[_0x4e7015(0x1ba)](){const _0x47be33=_0x4e7015;let _0x27a645=this[_0x47be33(0x19b)][_0x47be33(0x18c)](this[_0x47be33(0x179)]['globe'][_0x47be33(0x10c)]);if(!_0x27a645){const _0x32d87f=this['_map']['getExtent']();_0x27a645=Cesium$1[_0x47be33(0x153)]['fromDegrees'](_0x32d87f['xmin'],_0x32d87f['ymin'],_0x32d87f['xmax'],_0x32d87f[_0x47be33(0x138)]);}const _0x4b23a2=Util[_0x47be33(0x144)](_0x27a645);this['viewerParameters'][_0x47be33(0x12d)]['x']=_0x4b23a2['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x4b23a2['lon']['max'],this[_0x47be33(0x15a)][_0x47be33(0x1d6)]['x']=_0x4b23a2['lat'][_0x47be33(0x151)],this['viewerParameters']['latRange']['y']=_0x4b23a2[_0x47be33(0x1ab)]['max'];const _0x24d7b6=this[_0x47be33(0x19b)]['getPixelSize'](this[_0x47be33(0x134)],this[_0x47be33(0x179)]['drawingBufferWidth'],this['scene'][_0x47be33(0x129)]);_0x24d7b6>0x0&&(this['viewerParameters']['pixelSize']=_0x24d7b6);}}mars3d__namespace['LayerUtil']['register'](_0x4e7015(0x18b),WindLayer),mars3d__namespace[_0x4e7015(0x140)]['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x57dad7=_0x4e7015;this['lng']=null,this[_0x57dad7(0x1ab)]=null,this['tlng']=null,this['tlat']=null,this[_0x57dad7(0x196)]=null,this['speed']=null;}[_0x4e7015(0x15f)](){for(const _0x52d779 in this){delete this[_0x52d779];}}}class CanvasWindField{constructor(_0x277727){this['setOptions'](_0x277727);}get['speedRate'](){const _0x5384fd=_0x4e7015;return this[_0x5384fd(0x1bc)];}set['speedRate'](_0x168913){const _0x205fb4=_0x4e7015;this['_speedRate']=(0x64-(_0x168913>0x63?0x63:_0x168913))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this[_0x205fb4(0x1bc)],(this['ymax']-this['ymin'])/this[_0x205fb4(0x1bc)]];}get[_0x4e7015(0x118)](){return this['_maxAge'];}set['maxAge'](_0x4fc8fc){this['_maxAge']=_0x4fc8fc;}['setOptions'](_0x1e2fb0){const _0x4a088e=_0x4e7015;this['options']=_0x1e2fb0,this['maxAge']=_0x1e2fb0['maxAge']||0x78,this[_0x4a088e(0x1ec)]=_0x1e2fb0[_0x4a088e(0x1ec)]||0x32,this['particles']=[];const _0x547cd6=_0x1e2fb0['particlesNumber']||0x1000;for(let _0xc88f1d=0x0;_0xc88f1d<_0x547cd6;_0xc88f1d++){const _0x23b0e2=this['_randomParticle'](new CanvasParticle());this[_0x4a088e(0x1fe)]['push'](_0x23b0e2);}}[_0x4e7015(0x13f)](_0x484599){const _0x2d9f72=_0x4e7015;this['rows']=_0x484599['rows'],this[_0x2d9f72(0x1d3)]=_0x484599['cols'],this['xmin']=_0x484599['xmin'],this['xmax']=_0x484599[_0x2d9f72(0x15d)],this['ymin']=_0x484599[_0x2d9f72(0x110)],this['ymax']=_0x484599['ymax'],this[_0x2d9f72(0x128)]=[];const _0x24fb7f=_0x484599['udata'],_0x9803fd=_0x484599['vdata'];let _0x21bc28=![];_0x24fb7f['length']===this[_0x2d9f72(0x1ae)]&&_0x24fb7f[0x0]['length']===this[_0x2d9f72(0x1d3)]&&(_0x21bc28=!![]);let _0xffd5eb=0x0,_0x14390f=null,_0x337b7c=null;for(let _0x37b20e=0x0;_0x37b20e<this[_0x2d9f72(0x1ae)];_0x37b20e++){_0x14390f=[];for(let _0x42d2e0=0x0;_0x42d2e0<this['cols'];_0x42d2e0++,_0xffd5eb++){_0x21bc28?_0x337b7c=this[_0x2d9f72(0x18f)](_0x24fb7f[_0x37b20e][_0x42d2e0],_0x9803fd[_0x37b20e][_0x42d2e0]):_0x337b7c=this[_0x2d9f72(0x18f)](_0x24fb7f[_0xffd5eb],_0x9803fd[_0xffd5eb]),_0x14390f[_0x2d9f72(0x12e)](_0x337b7c);}this['grid']['push'](_0x14390f);}this[_0x2d9f72(0x1f6)]['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x2a61ed=_0x4e7015;delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this[_0x2a61ed(0x110)],delete this[_0x2a61ed(0x138)],delete this[_0x2a61ed(0x128)],delete this[_0x2a61ed(0x1fe)];}['toGridXY'](_0x1323d3,_0x114a31){const _0x249c84=_0x4e7015,_0xd02a2d=(_0x1323d3-this[_0x249c84(0x1eb)])/(this[_0x249c84(0x15d)]-this['xmin'])*(this[_0x249c84(0x1d3)]-0x1),_0x123a05=(this[_0x249c84(0x138)]-_0x114a31)/(this['ymax']-this[_0x249c84(0x110)])*(this['rows']-0x1);return[_0xd02a2d,_0x123a05];}['getUVByXY'](_0x966236,_0x1f2cc1){const _0x307b70=_0x4e7015;if(_0x966236<0x0||_0x966236>=this[_0x307b70(0x1d3)]||_0x1f2cc1>=this[_0x307b70(0x1ae)])return[0x0,0x0,0x0];const _0x19f3bd=Math[_0x307b70(0x1a2)](_0x966236),_0x402b36=Math['floor'](_0x1f2cc1);if(_0x19f3bd===_0x966236&&_0x402b36===_0x1f2cc1)return this['grid'][_0x1f2cc1][_0x966236];const _0x403952=_0x19f3bd+0x1,_0x4034e3=_0x402b36+0x1,_0x311f3c=this['getUVByXY'](_0x19f3bd,_0x402b36),_0x3aeb5a=this['getUVByXY'](_0x403952,_0x402b36),_0x1536bf=this[_0x307b70(0x1ed)](_0x19f3bd,_0x4034e3),_0xbbfd59=this['getUVByXY'](_0x403952,_0x4034e3);let _0x49a1cf=null;try{_0x49a1cf=this[_0x307b70(0x1d1)](_0x966236-_0x19f3bd,_0x1f2cc1-_0x402b36,_0x311f3c,_0x3aeb5a,_0x1536bf,_0xbbfd59);}catch(_0xa3f07a){console[_0x307b70(0x117)](_0x966236,_0x1f2cc1);}return _0x49a1cf;}['_bilinearInterpolation'](_0x263358,_0x594d1b,_0x2e17b5,_0x349d7b,_0x45073a,_0x14d6cf){const _0x58546b=_0x4e7015,_0x3fc9a6=0x1-_0x263358,_0x3500fb=0x1-_0x594d1b,_0x2e1883=_0x3fc9a6*_0x3500fb,_0xa30b17=_0x263358*_0x3500fb,_0x8b4171=_0x3fc9a6*_0x594d1b,_0x134f8b=_0x263358*_0x594d1b,_0x323667=_0x2e17b5[0x0]*_0x2e1883+_0x349d7b[0x0]*_0xa30b17+_0x45073a[0x0]*_0x8b4171+_0x14d6cf[0x0]*_0x134f8b,_0x356b7a=_0x2e17b5[0x1]*_0x2e1883+_0x349d7b[0x1]*_0xa30b17+_0x45073a[0x1]*_0x8b4171+_0x14d6cf[0x1]*_0x134f8b;return this[_0x58546b(0x18f)](_0x323667,_0x356b7a);}['_calcUV'](_0x248718,_0x53569d){return[+_0x248718,+_0x53569d,Math['sqrt'](_0x248718*_0x248718+_0x53569d*_0x53569d)];}['getUVByPoint'](_0x4b0c83,_0x466ddc){const _0x57833f=_0x4e7015;if(!this['isInExtent'](_0x4b0c83,_0x466ddc))return null;const _0x967d48=this['toGridXY'](_0x4b0c83,_0x466ddc),_0x52b031=this[_0x57833f(0x1ed)](_0x967d48[0x0],_0x967d48[0x1]);return _0x52b031;}[_0x4e7015(0x101)](_0x13f3b1,_0x31f678){const _0x4a5a5c=_0x4e7015;return _0x13f3b1>=this[_0x4a5a5c(0x1eb)]&&_0x13f3b1<=this['xmax']&&_0x31f678>=this['ymin']&&_0x31f678<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x407098=_0x4e7015,_0x58c222=fRandomByfloat(this[_0x407098(0x1eb)],this[_0x407098(0x15d)]),_0x52fe7a=fRandomByfloat(this[_0x407098(0x110)],this[_0x407098(0x138)]);return{'lat':_0x52fe7a,'lng':_0x58c222};}['getParticles'](){const _0x539f6b=_0x4e7015;let _0x4817cd,_0x42d619,_0x2a2499;for(let _0x1d443b=0x0,_0x10c9d3=this['particles']['length'];_0x1d443b<_0x10c9d3;_0x1d443b++){let _0x572e1b=this['particles'][_0x1d443b];_0x572e1b['age']<=0x0&&(_0x572e1b=this['_randomParticle'](_0x572e1b));if(_0x572e1b['age']>0x0){const _0x32f7e2=_0x572e1b['tlng'],_0x5505f8=_0x572e1b[_0x539f6b(0x1d7)];_0x2a2499=this['getUVByPoint'](_0x32f7e2,_0x5505f8),_0x2a2499?(_0x4817cd=_0x32f7e2+this[_0x539f6b(0x1b7)][0x0]*_0x2a2499[0x0],_0x42d619=_0x5505f8+this[_0x539f6b(0x1b7)][0x1]*_0x2a2499[0x1],_0x572e1b['lng']=_0x32f7e2,_0x572e1b[_0x539f6b(0x1ab)]=_0x5505f8,_0x572e1b['tlng']=_0x4817cd,_0x572e1b[_0x539f6b(0x1d7)]=_0x42d619,_0x572e1b[_0x539f6b(0x1f5)]=_0x2a2499[0x2],_0x572e1b[_0x539f6b(0x196)]--):_0x572e1b['age']=0x0;}}return this[_0x539f6b(0x1fe)];}[_0x4e7015(0x1de)](_0x7bae){const _0x48d949=_0x4e7015;let _0xc90e4b,_0x35c789;for(let _0xdc2fc4=0x0;_0xdc2fc4<0x1e;_0xdc2fc4++){_0xc90e4b=this['getRandomLatLng'](),_0x35c789=this['getUVByPoint'](_0xc90e4b['lng'],_0xc90e4b[_0x48d949(0x1ab)]);if(_0x35c789&&_0x35c789[0x2]>0x0)break;}if(!_0x35c789)return _0x7bae;const _0xf9e168=_0xc90e4b['lng']+this['_calc_speedRate'][0x0]*_0x35c789[0x0],_0x557a4d=_0xc90e4b['lat']+this['_calc_speedRate'][0x1]*_0x35c789[0x1];return _0x7bae[_0x48d949(0x1f9)]=_0xc90e4b['lng'],_0x7bae['lat']=_0xc90e4b[_0x48d949(0x1ab)],_0x7bae[_0x48d949(0x12a)]=_0xf9e168,_0x7bae['tlat']=_0x557a4d,_0x7bae['age']=Math['round'](Math['random']()*this['maxAge']),_0x7bae[_0x48d949(0x1f5)]=_0x35c789[0x2],_0x7bae;}['destroy'](){for(const _0x424918 in this){delete this[_0x424918];}}}function fRandomByfloat(_0x23a245,_0x15fd99){return _0x23a245+Math['random']()*(_0x15fd99-_0x23a245);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer'][_0x4e7015(0x1c0)];class CanvasWindLayer extends BaseLayer{constructor(_0x5f2529={}){const _0x16a37b=_0x4e7015;super(_0x5f2529),this['_setOptionsHook'](_0x5f2529),this[_0x16a37b(0x154)]=null,_0x5f2529['colors']&&_0x5f2529['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x16a37b(0x1b8))](_0x5f2529));}[_0x4e7015(0x172)](_0x4c124c,_0x3ab56f){const _0x2ff93b=_0x4e7015;this[_0x2ff93b(0x130)]=0x3e8/(_0x4c124c['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x4c124c[_0x2ff93b(0x1b0)]||'#ffffff',this[_0x2ff93b(0x1ce)]=_0x4c124c['lineWidth']||0x1,this['fixedHeight']=_0x4c124c['fixedHeight']??0x0,this[_0x2ff93b(0x12c)]=_0x4c124c[_0x2ff93b(0x12c)]??![],this['windField']&&this[_0x2ff93b(0x15c)][_0x2ff93b(0x185)](_0x4c124c);}get[_0x4e7015(0x140)](){return this['canvas'];}get['canvasWidth'](){const _0x57d738=_0x4e7015;return this['_map']['scene']['canvas'][_0x57d738(0x112)];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x4e7015(0x11b)](){return this['_pointerEvents'];}set['pointerEvents'](_0x3b4796){const _0x1196f4=_0x4e7015;this[_0x1196f4(0x1e5)]=_0x3b4796;if(!this['canvas'])return;_0x3b4796?this[_0x1196f4(0x154)][_0x1196f4(0x191)]['pointer-events']='all':this['canvas'][_0x1196f4(0x191)]['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x4d9bdb){const _0x276cde=_0x4e7015;this[_0x276cde(0x1f6)]['particlesNumber']=_0x4d9bdb,clearTimeout(this[_0x276cde(0x1db)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x338eb6=_0x4e7015;return this['options'][_0x338eb6(0x1ec)];}set['speedRate'](_0x1c2557){const _0x476ee5=_0x4e7015;this['options']['speedRate']=_0x1c2557,this['windField']&&(this[_0x476ee5(0x15c)]['speedRate']=_0x1c2557);}get['maxAge'](){const _0x4498da=_0x4e7015;return this[_0x4498da(0x1f6)]['maxAge'];}set[_0x4e7015(0x118)](_0x5ef1ad){const _0x307580=_0x4e7015;this[_0x307580(0x1f6)]['maxAge']=_0x5ef1ad,this['windField']&&(this['windField']['maxAge']=_0x5ef1ad);}get['data'](){return this['windData'];}set['data'](_0x38b5b6){this['setData'](_0x38b5b6);}[_0x4e7015(0x10d)](_0x2689b4){const _0x1a4552=_0x4e7015;_0x2689b4?this[_0x1a4552(0x1c8)]():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}[_0x4e7015(0x16e)](){const _0x45d9b3=_0x4e7015;this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this[_0x45d9b3(0x1f6)]);}['_addedHook'](){const _0x3fab19=_0x4e7015;this['canvas']=this['_createCanvas'](),this[_0x3fab19(0x1e2)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x3fab19(0x14e)](),this['options']['data']&&this[_0x3fab19(0x16d)](this['options']['data']);}['_removedHook'](){const _0x4b5802=_0x4e7015;this[_0x4b5802(0x1be)](),this[_0x4b5802(0x19a)](),this[_0x4b5802(0x154)]&&(this[_0x4b5802(0x1ee)]['container']['removeChild'](this['canvas']),delete this['canvas']);}[_0x4e7015(0x103)](){const _0x3c5108=_0x4e7015,_0x4f6725=mars3d__namespace['DomUtil']['create'](_0x3c5108(0x154),_0x3c5108(0x1b4),this[_0x3c5108(0x1ee)]['container']);return _0x4f6725['style'][_0x3c5108(0x19d)]='absolute',_0x4f6725['style'][_0x3c5108(0x17c)]='0px',_0x4f6725[_0x3c5108(0x191)]['left']=_0x3c5108(0x147),_0x4f6725['style']['width']=this['_map']['scene']['canvas'][_0x3c5108(0x112)]+'px',_0x4f6725[_0x3c5108(0x191)]['height']=this['_map'][_0x3c5108(0x179)]['canvas']['clientHeight']+'px',_0x4f6725[_0x3c5108(0x191)]['pointerEvents']=this[_0x3c5108(0x1e5)]?'auto':'none',_0x4f6725['style']['zIndex']=this[_0x3c5108(0x1f6)]['zIndex']??0x9,_0x4f6725['width']=this['_map']['scene']['canvas']['clientWidth'],_0x4f6725['height']=this['_map']['scene']['canvas']['clientHeight'],_0x4f6725;}['resize'](){const _0x1a0a84=_0x4e7015;this['canvas']&&(this['canvas']['style']['width']=this[_0x1a0a84(0x1ee)][_0x1a0a84(0x179)][_0x1a0a84(0x154)]['clientWidth']+'px',this[_0x1a0a84(0x154)]['style'][_0x1a0a84(0x1fd)]=this[_0x1a0a84(0x1ee)]['scene'][_0x1a0a84(0x154)]['clientHeight']+'px',this[_0x1a0a84(0x154)][_0x1a0a84(0x187)]=this['_map']['scene'][_0x1a0a84(0x154)]['clientWidth'],this[_0x1a0a84(0x154)][_0x1a0a84(0x1fd)]=this['_map']['scene']['canvas'][_0x1a0a84(0x157)]);}['bindEvent'](){const _0x593329=_0x4e7015,_0x5e21f9=this;let _0xa967d8=Date['now']();(function _0x1ce199(){const _0x172bad=_0xf357;_0x5e21f9['animateFrame']=window['requestAnimationFrame'](_0x1ce199);if(_0x5e21f9['show']&&_0x5e21f9[_0x172bad(0x15c)]){const _0x3b6254=Date['now'](),_0x1c0880=_0x3b6254-_0xa967d8;_0x1c0880>_0x5e21f9['frameTime']&&(_0xa967d8=_0x3b6254-_0x1c0880%_0x5e21f9['frameTime'],_0x5e21f9['update']());}}(),window['addEventListener']('resize',this[_0x593329(0x1e1)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this[_0x593329(0x1ee)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x593329(0x1b5)]['mouseDown'],this['_onMouseDownEvent'],this),this[_0x593329(0x1ee)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x3fa687=_0x4e7015;window['cancelAnimationFrame'](this['animateFrame']),delete this[_0x3fa687(0x174)],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace['EventType'][_0x3fa687(0x150)],this['_onMapWhellEvent'],this),this['_map'][_0x3fa687(0x1d9)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x3fa687(0x1ee)]['off'](mars3d__namespace[_0x3fa687(0x1b5)][_0x3fa687(0x123)],this[_0x3fa687(0x178)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x3fa687(0x120)],this));}['_onMapWhellEvent'](_0x21e8fd){const _0x39fd17=_0x4e7015;clearTimeout(this[_0x39fd17(0x116)]);if(!this[_0x39fd17(0x1d2)]||!this['canvas'])return;this['canvas']['style']['visibility']=_0x39fd17(0x17b),this['refreshTimer']=setTimeout(()=>{const _0x30dff2=_0x39fd17;if(!this['show'])return;this['redraw'](),this['canvas']['style'][_0x30dff2(0x131)]='visible';},0xc8);}['_onMouseDownEvent'](_0x55cae0){const _0x2351d0=_0x4e7015;this[_0x2351d0(0x1aa)]=!![],this['_map'][_0x2351d0(0x1d9)](mars3d__namespace[_0x2351d0(0x1b5)][_0x2351d0(0x100)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x2351d0(0x1b5)]['mouseMove'],this['_onMouseMoveEvent'],this);}[_0x4e7015(0x120)](_0x2d2e54){const _0x3dff33=_0x4e7015;if(!this['show']||!this[_0x3dff33(0x154)])return;this['mouse_down']&&(this['canvas']['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x35ca7e){const _0x306dd0=_0x4e7015;if(!this['show']||!this['canvas'])return;this['_map'][_0x306dd0(0x1d9)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x306dd0(0x1aa)]&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x306dd0(0x131)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x866c19){const _0xb41bd4=_0x4e7015;this[_0xb41bd4(0x1be)](),this['windData']=_0x866c19,this['windField'][_0xb41bd4(0x13f)](_0x866c19),this['redraw']();}[_0x4e7015(0x133)](){const _0x3f0421=_0x4e7015;if(!this[_0x3f0421(0x1d2)])return;this[_0x3f0421(0x15c)][_0x3f0421(0x185)](this[_0x3f0421(0x1f6)]),this['update']();}[_0x4e7015(0x105)](){const _0x334d9e=_0x4e7015;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this[_0x334d9e(0x15c)][_0x334d9e(0x105)]();else{const _0x4ffb09=this[_0x334d9e(0x15c)]['getParticles']();this['_drawLines'](_0x4ffb09);}this[_0x334d9e(0x11e)]=![];}['_drawLines'](_0x4ae917){const _0x1c2502=_0x4e7015;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x515884=this['_map']['scene'][_0x1c2502(0x1cb)]!==Cesium[_0x1c2502(0x1e7)]['SCENE3D'],_0x481e71=this[_0x1c2502(0x1c2)]*0.25;if(this['_colorRamp'])for(let _0x1f86fd=0x0,_0x3374db=_0x4ae917['length'];_0x1f86fd<_0x3374db;_0x1f86fd++){const _0x5703a5=_0x4ae917[_0x1f86fd],_0x4eef4b=this['_tomap'](_0x5703a5['lng'],_0x5703a5[_0x1c2502(0x1ab)],_0x5703a5),_0x16af96=this['_tomap'](_0x5703a5[_0x1c2502(0x12a)],_0x5703a5[_0x1c2502(0x1d7)],_0x5703a5);if(!_0x4eef4b||!_0x16af96)continue;if(_0x515884&&Math[_0x1c2502(0x193)](_0x4eef4b[0x0]-_0x16af96[0x0])>=_0x481e71)continue;this[_0x1c2502(0x1e2)]['beginPath'](),this['canvasContext'][_0x1c2502(0x1ce)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x5703a5['speed']),this['canvasContext']['moveTo'](_0x4eef4b[0x0],_0x4eef4b[0x1]),this['canvasContext'][_0x1c2502(0x1f2)](_0x16af96[0x0],_0x16af96[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x1c2502(0x107)](),this['canvasContext'][_0x1c2502(0x1ce)]=this['lineWidth'],this['canvasContext'][_0x1c2502(0x167)]=this[_0x1c2502(0x1b0)];for(let _0xac7449=0x0,_0x16ffe2=_0x4ae917[_0x1c2502(0x1a7)];_0xac7449<_0x16ffe2;_0xac7449++){const _0x3bb926=_0x4ae917[_0xac7449],_0x1f3da9=this['_tomap'](_0x3bb926['lng'],_0x3bb926[_0x1c2502(0x1ab)],_0x3bb926),_0x4c530c=this['_tomap'](_0x3bb926['tlng'],_0x3bb926[_0x1c2502(0x1d7)],_0x3bb926);if(!_0x1f3da9||!_0x4c530c)continue;if(_0x515884&&Math['abs'](_0x1f3da9[0x0]-_0x4c530c[0x0])>=_0x481e71)continue;this['canvasContext'][_0x1c2502(0x13a)](_0x1f3da9[0x0],_0x1f3da9[0x1]),this[_0x1c2502(0x1e2)][_0x1c2502(0x1f2)](_0x4c530c[0x0],_0x4c530c[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0xacb498,_0x2bb8ac,_0x1b029b){const _0x505cb2=_0x4e7015,_0x2b85e0=Cesium[_0x505cb2(0x13e)][_0x505cb2(0x13c)](_0xacb498,_0x2bb8ac,this['fixedHeight']),_0x16c93a=this['_map']['scene'];if(_0x16c93a['mode']===Cesium['SceneMode']['SCENE3D']){const _0x3fa442=new Cesium['EllipsoidalOccluder'](_0x16c93a['globe']['ellipsoid'],_0x16c93a[_0x505cb2(0x19b)][_0x505cb2(0x1e9)]),_0x2168ad=_0x3fa442['isPointVisible'](_0x2b85e0);if(!_0x2168ad)return _0x1b029b['age']=0x0,null;}const _0xa94170=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map'][_0x505cb2(0x179)],_0x2b85e0);return _0xa94170?[_0xa94170['x'],_0xa94170['y']]:null;}[_0x4e7015(0x1be)](){const _0x5dd326=_0x4e7015;this[_0x5dd326(0x15c)]['clear'](),delete this['windData'];}['initWorker'](){const _0x1fc0c7=_0x4e7015;this['worker']=new Worker(this[_0x1fc0c7(0x1f6)]['worker']),this[_0x1fc0c7(0x171)]['onmessage']=_0x4bbe57=>{const _0x33422c=_0x1fc0c7;this['_drawLines'](_0x4bbe57['data']['particles']),this[_0x33422c(0x1dc)]=![];},this['windField']={'init':_0x13b3c2=>{this['worker']['postMessage']({'type':'init','options':_0x13b3c2});},'setOptions':_0x4bc673=>{const _0x3e2fff=_0x1fc0c7;this['worker'][_0x3e2fff(0x1a3)]({'type':'setOptions','options':_0x4bc673});},'setDate':_0x307220=>{this['worker']['postMessage']({'type':'setDate','data':_0x307220});},'update':()=>{const _0x4a22ea=_0x1fc0c7;if(this[_0x4a22ea(0x1dc)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':_0x4a22ea(0x105)});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField'][_0x1fc0c7(0x143)](this['options']);}}mars3d__namespace[_0x4e7015(0x194)][_0x4e7015(0x19e)](_0x4e7015(0x175),CanvasWindLayer),mars3d__namespace['layer'][_0x4e7015(0x1cd)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x4e7015(0x1d4)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports[_0x4e7015(0x1b2)]=WindLayer,exports[_0x4e7015(0x1bd)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
