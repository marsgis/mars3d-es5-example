/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.13
 * 编译日期：2023-11-20 21:13:33
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';function _0x180a(_0xa2b1c7,_0x2ea375){const _0x598cc2=_0x598c();return _0x180a=function(_0x180add,_0x4cac6c){_0x180add=_0x180add-0x134;let _0x342726=_0x598cc2[_0x180add];return _0x342726;},_0x180a(_0xa2b1c7,_0x2ea375);}const _0x3c1cfe=_0x180a;(function(_0x19f68d,_0x124b2a){const _0x49e7b9=_0x180a,_0x292e9b=_0x19f68d();while(!![]){try{const _0x160bd1=-parseInt(_0x49e7b9(0x151))/0x1+-parseInt(_0x49e7b9(0x1cd))/0x2+parseInt(_0x49e7b9(0x219))/0x3+parseInt(_0x49e7b9(0x136))/0x4*(parseInt(_0x49e7b9(0x1bd))/0x5)+parseInt(_0x49e7b9(0x145))/0x6+-parseInt(_0x49e7b9(0x1e9))/0x7+-parseInt(_0x49e7b9(0x1c1))/0x8;if(_0x160bd1===_0x124b2a)break;else _0x292e9b['push'](_0x292e9b['shift']());}catch(_0x12e85a){_0x292e9b['push'](_0x292e9b['shift']());}}}(_0x598c,0xb0506));function _0x598c(){const _0x1a8bb2=['resize','ellipsoid','TextureMinificationFilter','pixelSize','mouse_down','getColorTexture','lineWidth','mouseDown','updateViewerParameters','red','lon','_colorRamp','nextTrails','primitiveType','_data','RenderState','canvasContext','preRender','south','ymax','off','_calcUV','bind','currentParticlesSpeed','_canrefresh','PixelFormat','Sampler','UNSIGNED_BYTE','_onMapWhellEvent','particlesComputing','umax','mod','particlesWind','unbindEvent','segments','colors','_removedHook','vmax','TRIANGLES','default','shaderProgram','THREE_PI_OVER_TWO','textures','stroke','clear','hidden','_calc_speedRate','particlesTextures','all','viewerParameters','primitives','vertexArray','position','mouse_move','mouseUp','Cartesian3','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','PixelDatatype','once','_onMouseDownEvent','randomizeParticles','Color','canvas','depthTest','length','mouseHidden','vdata','getFullscreenQuad','vertexShaderSource','createWindTextures','wgs84ToWindowCoordinates','_updateIng2','fromDegrees','drawingBufferHeight','ClearCommand','createComputingPrimitives','130NLimdV','EventType','pointer-events','mouseMove','5661752hKdMNR','add','Cartesian2','particleSystem','fromGeometry','OPAQUE','addPrimitives','setOptions','SCENE3D','screen','postMessage','worker','1025430NHwqtV','Compute','maxParticles','_onMap_preRenderEvent','geometry','log','globalCompositeOperation','_speedRate','fixedHeight','rows','container','lev','clientHeight','update','uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','createParticlesTextures','pointerEvents','cos','getRandomLatLng','getUVByPoint','min','bindEvent','levmax','framebuffer','createSegmentsGeometry','forEach','scene','refreshTimer','2076445RxpWeu','_mountedHook','commandType','none','keys','lng','createRenderingPrimitives','ShaderSource','beginPath','max','getExtent','cols','drawingBufferWidth','camera','toDegrees','canvasHeight','_pointerEvents','tlng','computeViewRectangle','windTextures','getOptions','getWind','rawRenderState','postProcessingPosition','dropRateBump','windData','random','style','createRawRenderState','STATIC_DRAW','Geometry','CanvasWindLayer','canvasWind','now','ComponentDatatype','outputTexture','sqrt','Math','xmax','latRange','setData','xmin','Cesium','width','BoundingSphere','data','arrayBufferView','show','4200642uYLxQb','updateSpeed','grid','_onMouseMoveEvent','autoClear','options','destroy','Pass','initWorker','create','atan2','framebuffers','left','NEAREST','RGBA','Matrix4','105396ZATbsF','ymin','udata','lat','PrimitiveType','commandToExecute','frameTime','uniformMap','VertexArray','canvasWidth','_map','age','clearCommand','_maxAge','_tomap','1602228YGeCuO','dropRate','defineProperty','createTexture','_onMouseUpEvent','trails','context','currentTrailsDepth','removeEventListener','TWO_PI','getUVByXY','LUMINANCE','113075bwaLEK','currentParticlesPosition','maxAge','speedRate','particlesRendering','FLOAT','BufferUsage','_setOptionsHook','attributeLocations','depthMask','_createCanvas','TextureMagnificationFilter','windField','dimensions','GeometryAttributes','layer','particles','getColor','addEventListener','_updateIng','pow','clearFramebuffers','push','postProcessingSpeed','redraw','speed','zIndex','ColorRamp','fadeOpacity','reverseY','particlesNumber'];_0x598c=function(){return _0x1a8bb2;};return _0x598c();}function _interopNamespace(_0x33f22a){const _0x4c5d7e=_0x180a;if(_0x33f22a&&_0x33f22a['__esModule'])return _0x33f22a;var _0x498859=Object[_0x4c5d7e(0x222)](null);return _0x33f22a&&Object['keys'](_0x33f22a)['forEach'](function(_0xdd189){const _0x8d2d84=_0x4c5d7e;if(_0xdd189!=='default'){var _0x533204=Object['getOwnPropertyDescriptor'](_0x33f22a,_0xdd189);Object[_0x8d2d84(0x147)](_0x498859,_0xdd189,_0x533204['get']?_0x533204:{'enumerable':!![],'get':function(){return _0x33f22a[_0xdd189];}});}}),_0x498859[_0x4c5d7e(0x197)]=_0x33f22a,_0x498859;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x4bc3a1,_0x5e1823){const _0x2ae47c=_0x180a,_0x3daf09=_0x4bc3a1*Math[_0x2ae47c(0x1de)](Cesium$7['Math']['toRadians'](_0x5e1823));return _0x3daf09;}function getV(_0x5262e1,_0x4ed194){const _0x3d0227=_0x5262e1*Math['sin'](Cesium$7['Math']['toRadians'](_0x4ed194));return _0x3d0227;}function getSpeed(_0x6c9be5,_0x405362){const _0x1656b0=_0x180a,_0x1b6c1f=Math['sqrt'](Math[_0x1656b0(0x165)](_0x6c9be5,0x2)+Math['pow'](_0x405362,0x2));return _0x1b6c1f;}function getDirection(_0x3dbbae,_0x17d887){const _0x2ea916=_0x180a;let _0x4fb3b5=Cesium$7[_0x2ea916(0x20e)][_0x2ea916(0x1f7)](Math[_0x2ea916(0x223)](_0x17d887,_0x3dbbae));return _0x4fb3b5+=_0x4fb3b5<0x0?0x168:0x0,_0x4fb3b5;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x5e9d7d){const _0x23a08b=_0x180a;this['commandType']=_0x5e9d7d[_0x23a08b(0x1eb)],this['geometry']=_0x5e9d7d['geometry'],this['attributeLocations']=_0x5e9d7d['attributeLocations'],this[_0x23a08b(0x17d)]=_0x5e9d7d['primitiveType'],this['uniformMap']=_0x5e9d7d['uniformMap'],this[_0x23a08b(0x1b5)]=_0x5e9d7d['vertexShaderSource'],this['fragmentShaderSource']=_0x5e9d7d['fragmentShaderSource'],this['rawRenderState']=_0x5e9d7d[_0x23a08b(0x1ff)],this['framebuffer']=_0x5e9d7d['framebuffer'],this[_0x23a08b(0x20c)]=_0x5e9d7d[_0x23a08b(0x20c)],this[_0x23a08b(0x21d)]=_0x5e9d7d[_0x23a08b(0x21d)]??![],this['preExecute']=_0x5e9d7d['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this[_0x23a08b(0x142)]=undefined,this[_0x23a08b(0x21d)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x23a08b(0x1e4)],'pass':Cesium$6[_0x23a08b(0x220)][_0x23a08b(0x1c6)]}));}['createCommand'](_0x2f6c04){const _0x17275f=_0x180a;switch(this[_0x17275f(0x1eb)]){case'Draw':{const _0x112c8a=Cesium$6['VertexArray']['fromGeometry']({'context':_0x2f6c04,'geometry':this[_0x17275f(0x1d1)],'attributeLocations':this[_0x17275f(0x159)],'bufferUsage':Cesium$6[_0x17275f(0x157)]['STATIC_DRAW']}),_0x5b10b4=Cesium$6['ShaderProgram']['fromCache']({'context':_0x2f6c04,'attributeLocations':this[_0x17275f(0x159)],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x36e967=Cesium$6[_0x17275f(0x17f)]['fromCache'](this[_0x17275f(0x1ff)]);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x5b10b4,'vertexArray':_0x112c8a,'modelMatrix':Cesium$6[_0x17275f(0x135)]['IDENTITY'],'renderState':_0x36e967,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x17275f(0x220)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this[_0x17275f(0x13d)],'outputTexture':this[_0x17275f(0x20c)],'persists':!![]});}}}['setGeometry'](_0x4649ef,_0x2f19d1){const _0x2062fc=_0x180a;this['geometry']=_0x2f19d1;const _0x5329c3=Cesium$6['VertexArray'][_0x2062fc(0x1c5)]({'context':_0x4649ef,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x2062fc(0x157)]['STATIC_DRAW']});this['commandToExecute'][_0x2062fc(0x1a3)]=_0x5329c3;}['update'](_0x421af6){const _0x171a33=_0x180a;if(!this[_0x171a33(0x218)])return;if(_0x421af6['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x421af6['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x421af6['commandList'][_0x171a33(0x167)](this['clearCommand']),_0x421af6['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x3d4767=_0x180a;if(this['clearCommand']){var _0x59d41f,_0x51633c;(_0x59d41f=this['clearCommand'])!==null&&_0x59d41f!==void 0x0&&_0x59d41f[_0x3d4767(0x1a3)]&&this['clearCommand'][_0x3d4767(0x1a3)]['destroy'](),(_0x51633c=this['clearCommand'])!==null&&_0x51633c!==void 0x0&&_0x51633c['shaderProgram']&&this[_0x3d4767(0x142)]['shaderProgram']['destroy'](),delete this[_0x3d4767(0x142)];}return this['commandToExecute']&&(this[_0x3d4767(0x13b)][_0x3d4767(0x1a3)]&&this['commandToExecute'][_0x3d4767(0x1a3)]['destroy'](),this['commandToExecute']['shaderProgram']&&this['commandToExecute'][_0x3d4767(0x198)][_0x3d4767(0x21f)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace[_0x3c1cfe(0x213)],Util=(function(){const _0x34faf7=function(){const _0x50386b=_0x180a,_0x2c3c46=new Cesium$5[(_0x50386b(0x207))]({'attributes':new Cesium$5[(_0x50386b(0x15f))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x50386b(0x20b)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x2c3c46;},_0x49db8b=function(_0x4eeac0,_0x213577){const _0xe94990=_0x180a;if(Cesium$5['defined'](_0x213577)){const _0x3638f1={};_0x3638f1[_0xe94990(0x217)]=_0x213577,_0x4eeac0['source']=_0x3638f1;}const _0xed137e=new Cesium$5['Texture'](_0x4eeac0);return _0xed137e;},_0x46b7ea=function(_0x440e29,_0x52f5e6,_0x40515a){const _0xc325f=new Cesium$5['Framebuffer']({'context':_0x440e29,'colorTextures':[_0x52f5e6],'depthTexture':_0x40515a});return _0xc325f;},_0x26f457=function(_0x2ee96e){const _0xe303b5=_0x180a,_0x1bcd12=!![],_0x13a6d2=![],_0x295d37={'viewport':_0x2ee96e['viewport'],'depthTest':_0x2ee96e[_0xe303b5(0x1b0)],'depthMask':_0x2ee96e[_0xe303b5(0x15a)],'blending':_0x2ee96e['blending']},_0x5ce6ee=Cesium$5['Appearance']['getDefaultRenderState'](_0x1bcd12,_0x13a6d2,_0x295d37);return _0x5ce6ee;},_0x4cab6a=function(_0x4ee3d1){const _0x53aa0c=_0x180a,_0x5667c7={},_0xd656bf=Cesium$5[_0x53aa0c(0x20e)][_0x53aa0c(0x18f)](_0x4ee3d1['west'],Cesium$5['Math'][_0x53aa0c(0x14e)]),_0x2ee5c4=Cesium$5['Math'][_0x53aa0c(0x18f)](_0x4ee3d1['east'],Cesium$5['Math']['TWO_PI']),_0x45487f=_0x4ee3d1['width'];let _0x48070f,_0x3b260d;_0x45487f>Cesium$5['Math'][_0x53aa0c(0x199)]?(_0x48070f=0x0,_0x3b260d=Cesium$5['Math']['TWO_PI']):_0x2ee5c4-_0xd656bf<_0x45487f?(_0x48070f=_0xd656bf,_0x3b260d=_0xd656bf+_0x45487f):(_0x48070f=_0xd656bf,_0x3b260d=_0x2ee5c4);_0x5667c7['lon']={'min':Cesium$5[_0x53aa0c(0x20e)][_0x53aa0c(0x1f7)](_0x48070f),'max':Cesium$5['Math']['toDegrees'](_0x3b260d)};const _0x5d7bf4=_0x4ee3d1[_0x53aa0c(0x182)],_0x3037d3=_0x4ee3d1['north'],_0x468e65=_0x4ee3d1['height'],_0x1d6df2=_0x468e65>Cesium$5['Math']['PI']/0xc?_0x468e65/0x2:0x0;let _0xefccb1=Cesium$5['Math']['clampToLatitudeRange'](_0x5d7bf4-_0x1d6df2),_0x2028f7=Cesium$5['Math']['clampToLatitudeRange'](_0x3037d3+_0x1d6df2);return _0xefccb1<-Cesium$5[_0x53aa0c(0x20e)]['PI_OVER_THREE']&&(_0xefccb1=-Cesium$5[_0x53aa0c(0x20e)]['PI_OVER_TWO']),_0x2028f7>Cesium$5['Math']['PI_OVER_THREE']&&(_0x2028f7=Cesium$5['Math']['PI_OVER_TWO']),_0x5667c7[_0x53aa0c(0x139)]={'min':Cesium$5[_0x53aa0c(0x20e)]['toDegrees'](_0xefccb1),'max':Cesium$5['Math']['toDegrees'](_0x2028f7)},_0x5667c7;};return{'getFullscreenQuad':_0x34faf7,'createTexture':_0x49db8b,'createFramebuffer':_0x46b7ea,'createRawRenderState':_0x26f457,'viewRectangleToLonLatRange':_0x4cab6a};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag=_0x3c1cfe(0x1a9);const Cesium$4=mars3d__namespace[_0x3c1cfe(0x213)];class ParticlesRendering{constructor(_0x5a3264,_0x4fda36,_0x2af8cc,_0x196245,_0x1be8a9){const _0x3a4270=_0x3c1cfe;this['createRenderingTextures'](_0x5a3264,_0x4fda36,_0x2af8cc['colors']),this['createRenderingFramebuffers'](_0x5a3264),this[_0x3a4270(0x1ef)](_0x5a3264,_0x2af8cc,_0x196245,_0x1be8a9);}['createRenderingTextures'](_0x19d769,_0x4f1db0,_0x52a668){const _0x4af5dc=_0x3c1cfe,_0x437779={'context':_0x19d769,'width':_0x19d769[_0x4af5dc(0x1f5)],'height':_0x19d769[_0x4af5dc(0x1ba)],'pixelFormat':Cesium$4[_0x4af5dc(0x189)][_0x4af5dc(0x134)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x4af5dc(0x18b)]},_0x4d80e0={'context':_0x19d769,'width':_0x19d769['drawingBufferWidth'],'height':_0x19d769[_0x4af5dc(0x1ba)],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x5ac728=_0x52a668['length'],_0x57e9ce=new Float32Array(_0x5ac728*0x3);for(let _0x3629a9=0x0;_0x3629a9<_0x5ac728;_0x3629a9++){const _0x56f8ad=Cesium$4['Color']['fromCssColorString'](_0x52a668[_0x3629a9]);_0x57e9ce[0x3*_0x3629a9]=_0x56f8ad[_0x4af5dc(0x179)],_0x57e9ce[0x3*_0x3629a9+0x1]=_0x56f8ad['green'],_0x57e9ce[0x3*_0x3629a9+0x2]=_0x56f8ad['blue'];}const _0x525c6e={'context':_0x19d769,'width':_0x5ac728,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x4af5dc(0x18a))]({'minificationFilter':Cesium$4[_0x4af5dc(0x172)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util[_0x4af5dc(0x148)](_0x437779),'segmentsDepth':Util['createTexture'](_0x4d80e0),'currentTrailsColor':Util[_0x4af5dc(0x148)](_0x437779),'currentTrailsDepth':Util[_0x4af5dc(0x148)](_0x4d80e0),'nextTrailsColor':Util[_0x4af5dc(0x148)](_0x437779),'nextTrailsDepth':Util[_0x4af5dc(0x148)](_0x4d80e0),'colorTable':Util['createTexture'](_0x525c6e,_0x57e9ce)};}['createRenderingFramebuffers'](_0x200fae){const _0x15770f=_0x3c1cfe;this['framebuffers']={'segments':Util['createFramebuffer'](_0x200fae,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x200fae,this[_0x15770f(0x19a)]['currentTrailsColor'],this['textures'][_0x15770f(0x14c)]),'nextTrails':Util['createFramebuffer'](_0x200fae,this['textures']['nextTrailsColor'],this[_0x15770f(0x19a)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x1aed8e){const _0x5b9af3=_0x3c1cfe,_0x3c9a43=0x4;let _0x81f395=[];for(let _0x56fb11=0x0;_0x56fb11<_0x1aed8e['particlesTextureSize'];_0x56fb11++){for(let _0x2487bb=0x0;_0x2487bb<_0x1aed8e['particlesTextureSize'];_0x2487bb++){for(let _0x5b5187=0x0;_0x5b5187<_0x3c9a43;_0x5b5187++){_0x81f395['push'](_0x56fb11/_0x1aed8e['particlesTextureSize']),_0x81f395['push'](_0x2487bb/_0x1aed8e['particlesTextureSize']);}}}_0x81f395=new Float32Array(_0x81f395);let _0x533381=[];const _0x227f05=[-0x1,0x1],_0x2e907a=[-0x1,0x1];for(let _0x362bc2=0x0;_0x362bc2<_0x1aed8e[_0x5b9af3(0x1cf)];_0x362bc2++){for(let _0x6c03f1=0x0;_0x6c03f1<_0x3c9a43/0x2;_0x6c03f1++){for(let _0x33830b=0x0;_0x33830b<_0x3c9a43/0x2;_0x33830b++){_0x533381[_0x5b9af3(0x167)](_0x227f05[_0x6c03f1]),_0x533381['push'](_0x2e907a[_0x33830b]),_0x533381['push'](0x0);}}}_0x533381=new Float32Array(_0x533381);const _0x384dd6=0x6*_0x1aed8e['maxParticles'],_0x38fdf8=new Uint32Array(_0x384dd6);for(let _0x5058b8=0x0,_0xef8cbc=0x0,_0x557880=0x0;_0x5058b8<_0x1aed8e['maxParticles'];_0x5058b8++){_0x38fdf8[_0xef8cbc++]=_0x557880+0x0,_0x38fdf8[_0xef8cbc++]=_0x557880+0x1,_0x38fdf8[_0xef8cbc++]=_0x557880+0x2,_0x38fdf8[_0xef8cbc++]=_0x557880+0x2,_0x38fdf8[_0xef8cbc++]=_0x557880+0x1,_0x38fdf8[_0xef8cbc++]=_0x557880+0x3,_0x557880+=0x4;}const _0x1e37c7=new Cesium$4['Geometry']({'attributes':new Cesium$4[(_0x5b9af3(0x15f))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x81f395}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4[_0x5b9af3(0x20b)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x533381})}),'indices':_0x38fdf8});return _0x1e37c7;}['createRenderingPrimitives'](_0x5e71ef,_0x489fd4,_0x133eba,_0x5759aa){const _0x1aeb2e=_0x3c1cfe,_0x113f88=this;this[_0x1aeb2e(0x1a2)]={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x489fd4),'primitiveType':Cesium$4['PrimitiveType'][_0x1aeb2e(0x196)],'uniformMap':{'currentParticlesPosition':function(){return _0x5759aa['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x3585ef=_0x1aeb2e;return _0x5759aa[_0x3585ef(0x19f)]['postProcessingPosition'];},'postProcessingSpeed':function(){return _0x5759aa['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){return _0x113f88['textures']['colorTable'];},'aspect':function(){return _0x5e71ef['drawingBufferWidth']/_0x5e71ef['drawingBufferHeight'];},'pixelSize':function(){const _0x33697d=_0x1aeb2e;return _0x133eba[_0x33697d(0x173)];},'lineWidth':function(){return _0x489fd4['lineWidth'];},'particleHeight':function(){return _0x489fd4['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x1aeb2e(0x1f0))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x1aeb2e(0x205)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x1aeb2e(0x1b4)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x113f88['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x113f88['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x59043b=_0x1aeb2e;return _0x113f88['framebuffers']['currentTrails'][_0x59043b(0x175)](0x0);},'trailsDepthTexture':function(){return _0x113f88['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){const _0x3dbe96=_0x1aeb2e;return _0x489fd4[_0x3dbe96(0x16d)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x1aeb2e(0x224)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x12bb27=_0x1aeb2e,_0x1134a8=_0x113f88[_0x12bb27(0x224)]['currentTrails'];_0x113f88['framebuffers']['currentTrails']=_0x113f88['framebuffers']['nextTrails'],_0x113f88['framebuffers']['nextTrails']=_0x1134a8,_0x113f88['primitives']['trails']['commandToExecute']['framebuffer']=_0x113f88['framebuffers'][_0x12bb27(0x17c)],_0x113f88['primitives'][_0x12bb27(0x14a)]['clearCommand']['framebuffer']=_0x113f88[_0x12bb27(0x224)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x1aeb2e(0x1b4)](),'primitiveType':Cesium$4[_0x1aeb2e(0x13a)][_0x1aeb2e(0x196)],'uniformMap':{'trailsColorTexture':function(){const _0x30b58=_0x1aeb2e;return _0x113f88[_0x30b58(0x224)]['nextTrails'][_0x30b58(0x175)](0x0);},'trailsDepthTexture':function(){return _0x113f88['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag=_0x3c1cfe(0x1db),postProcessingSpeed_frag=_0x3c1cfe(0x1a8);const Cesium$3=mars3d__namespace[_0x3c1cfe(0x213)];class ParticlesComputing{constructor(_0x3f53db,_0x41392c,_0x4debee,_0x26f289){const _0x514527=_0x3c1cfe;this[_0x514527(0x216)]=_0x41392c,this[_0x514527(0x1b6)](_0x3f53db,_0x41392c),this[_0x514527(0x1dc)](_0x3f53db,_0x4debee,_0x26f289),this['createComputingPrimitives'](_0x41392c,_0x4debee,_0x26f289);}['createWindTextures'](_0x218ccf,_0x7a503a){const _0x12fdb2=_0x3c1cfe,_0x3fa327={'context':_0x218ccf,'width':_0x7a503a['dimensions']['lon'],'height':_0x7a503a[_0x12fdb2(0x15e)][_0x12fdb2(0x139)]*(_0x7a503a[_0x12fdb2(0x15e)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x12fdb2(0x150)],'pixelDatatype':Cesium$3['PixelDatatype'][_0x12fdb2(0x156)],'flipY':![],'sampler':new Cesium$3[(_0x12fdb2(0x18a))]({'minificationFilter':Cesium$3[_0x12fdb2(0x172)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x12fdb2(0x226)]})};this['windTextures']={'U':Util['createTexture'](_0x3fa327,_0x7a503a['U']['array']),'V':Util[_0x12fdb2(0x148)](_0x3fa327,_0x7a503a['V']['array'])};}['createParticlesTextures'](_0x45cfb7,_0xe7c58,_0x136af9){const _0x771d9b=_0x3c1cfe,_0x4d0be9={'context':_0x45cfb7,'width':_0xe7c58['particlesTextureSize'],'height':_0xe7c58['particlesTextureSize'],'pixelFormat':Cesium$3[_0x771d9b(0x189)]['RGBA'],'pixelDatatype':Cesium$3[_0x771d9b(0x1aa)][_0x771d9b(0x156)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x771d9b(0x226)],'magnificationFilter':Cesium$3[_0x771d9b(0x15c)]['NEAREST']})},_0x453841=this['randomizeParticles'](_0xe7c58['maxParticles'],_0x136af9),_0x203f7b=new Float32Array(0x4*_0xe7c58['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x4d0be9),'currentParticlesPosition':Util['createTexture'](_0x4d0be9,_0x453841),'nextParticlesPosition':Util['createTexture'](_0x4d0be9,_0x453841),'currentParticlesSpeed':Util['createTexture'](_0x4d0be9,_0x203f7b),'nextParticlesSpeed':Util[_0x771d9b(0x148)](_0x4d0be9,_0x203f7b),'postProcessingPosition':Util['createTexture'](_0x4d0be9,_0x453841),'postProcessingSpeed':Util[_0x771d9b(0x148)](_0x4d0be9,_0x203f7b)};}[_0x3c1cfe(0x1ad)](_0x1315de,_0x13471b){const _0x4d4de9=_0x3c1cfe,_0x595e62=new Float32Array(0x4*_0x1315de);for(let _0x1377df=0x0;_0x1377df<_0x1315de;_0x1377df++){_0x595e62[0x4*_0x1377df]=Cesium$3[_0x4d4de9(0x20e)]['randomBetween'](_0x13471b['lonRange']['x'],_0x13471b['lonRange']['y']),_0x595e62[0x4*_0x1377df+0x1]=Cesium$3['Math']['randomBetween'](_0x13471b['latRange']['x'],_0x13471b['latRange']['y']),_0x595e62[0x4*_0x1377df+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data'][_0x4d4de9(0x1d8)][_0x4d4de9(0x1f2)]),_0x595e62[0x4*_0x1377df+0x3]=0x0;}return _0x595e62;}['destroyParticlesTextures'](){const _0x3b81af=_0x3c1cfe;Object[_0x3b81af(0x1ed)](this[_0x3b81af(0x19f)])['forEach'](_0x4ab6f3=>{const _0x1844ee=_0x3b81af;this['particlesTextures'][_0x4ab6f3][_0x1844ee(0x21f)]();});}[_0x3c1cfe(0x1bc)](_0x34f85a,_0x48fbe5,_0xfb1691){const _0x3f2845=_0x3c1cfe,_0x3ebf6d=new Cesium$3[(_0x3f2845(0x1a7))](_0x34f85a['dimensions']['lon'],_0x34f85a['dimensions']['lat'],_0x34f85a['dimensions']['lev']),_0x565312=new Cesium$3['Cartesian3'](_0x34f85a['lon']['min'],_0x34f85a['lat'][_0x3f2845(0x1e1)],_0x34f85a[_0x3f2845(0x1d8)]['min']),_0x2f5c17=new Cesium$3['Cartesian3'](_0x34f85a['lon'][_0x3f2845(0x1f2)],_0x34f85a[_0x3f2845(0x139)]['max'],_0x34f85a['lev']['max']),_0x1ded4d=new Cesium$3['Cartesian3']((_0x2f5c17['x']-_0x565312['x'])/(_0x3ebf6d['x']-0x1),(_0x2f5c17['y']-_0x565312['y'])/(_0x3ebf6d['y']-0x1),_0x3ebf6d['z']>0x1?(_0x2f5c17['z']-_0x565312['z'])/(_0x3ebf6d['z']-0x1):0x1),_0x5097a3=new Cesium$3['Cartesian2'](_0x34f85a['U']['min'],_0x34f85a['U']['max']),_0x273ea3=new Cesium$3['Cartesian2'](_0x34f85a['V']['min'],_0x34f85a['V']['max']),_0x1f5ae9=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x1f5ae9['windTextures']['U'];},'V':function(){return _0x1f5ae9['windTextures']['V'];},'currentParticlesPosition':function(){const _0xef5669=_0x3f2845;return _0x1f5ae9['particlesTextures'][_0xef5669(0x152)];},'dimension':function(){return _0x3ebf6d;},'minimum':function(){return _0x565312;},'maximum':function(){return _0x2f5c17;},'interval':function(){return _0x1ded4d;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures'][_0x3f2845(0x190)],'preExecute':function(){const _0x26ad11=_0x3f2845;_0x1f5ae9[_0x26ad11(0x1a2)]['getWind']['commandToExecute']['outputTexture']=_0x1f5ae9['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x2fc449=_0x3f2845;return _0x1f5ae9['particlesTextures'][_0x2fc449(0x187)];},'particlesWind':function(){const _0x53ef7d=_0x3f2845;return _0x1f5ae9['particlesTextures'][_0x53ef7d(0x190)];},'uSpeedRange':function(){return _0x5097a3;},'vSpeedRange':function(){return _0x273ea3;},'pixelSize':function(){const _0x237bdb=_0x3f2845;return _0xfb1691[_0x237bdb(0x173)];},'speedFactor':function(){return _0x48fbe5['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x3f2845(0x19f)]['nextParticlesSpeed'],'preExecute':function(){const _0x3f71e5=_0x3f2845,_0x1cdef3=_0x1f5ae9[_0x3f71e5(0x19f)][_0x3f71e5(0x187)];_0x1f5ae9['particlesTextures'][_0x3f71e5(0x187)]=_0x1f5ae9[_0x3f71e5(0x19f)]['postProcessingSpeed'],_0x1f5ae9['particlesTextures']['postProcessingSpeed']=_0x1cdef3,_0x1f5ae9[_0x3f71e5(0x1a2)][_0x3f71e5(0x21a)]['commandToExecute']['outputTexture']=_0x1f5ae9['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x1f5ae9['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x1f5ae9['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x3f2845(0x1f0))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x4cf467=_0x3f2845,_0x5e4c01=_0x1f5ae9['particlesTextures']['currentParticlesPosition'];_0x1f5ae9['particlesTextures']['currentParticlesPosition']=_0x1f5ae9['particlesTextures']['postProcessingPosition'],_0x1f5ae9['particlesTextures']['postProcessingPosition']=_0x5e4c01,_0x1f5ae9[_0x4cf467(0x1a2)]['updatePosition']['commandToExecute']['outputTexture']=_0x1f5ae9['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x3f2845(0x1ce),'uniformMap':{'nextParticlesPosition':function(){return _0x1f5ae9['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x3b8f0e=_0x3f2845;return _0x1f5ae9[_0x3b8f0e(0x19f)]['nextParticlesSpeed'];},'lonRange':function(){return _0xfb1691['lonRange'];},'latRange':function(){const _0x553a41=_0x3f2845;return _0xfb1691[_0x553a41(0x210)];},'randomCoefficient':function(){const _0x41be4c=Math['random']();return _0x41be4c;},'dropRate':function(){return _0x48fbe5['dropRate'];},'dropRateBump':function(){const _0x30d49e=_0x3f2845;return _0x48fbe5[_0x30d49e(0x201)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x3f2845(0x200)],'preExecute':function(){const _0x4de31a=_0x3f2845;_0x1f5ae9[_0x4de31a(0x1a2)]['postProcessingPosition'][_0x4de31a(0x13b)]['outputTexture']=_0x1f5ae9['particlesTextures'][_0x4de31a(0x200)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x1f5ae9['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x309ca9=_0x3f2845;return _0x1f5ae9[_0x309ca9(0x19f)]['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x3f2845(0x1f0))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x121c23=_0x3f2845;_0x1f5ae9['primitives'][_0x121c23(0x168)]['commandToExecute']['outputTexture']=_0x1f5ae9['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x49d917,_0x2cef28,_0xd89584,_0x709b89){const _0x50e524=_0x3c1cfe;this['context']=_0x49d917,_0x2cef28={..._0x2cef28},_0x2cef28[_0x50e524(0x138)]&&_0x2cef28[_0x50e524(0x1b3)]&&(_0x2cef28['dimensions']={},_0x2cef28['dimensions']['lon']=_0x2cef28[_0x50e524(0x1f4)],_0x2cef28['dimensions'][_0x50e524(0x139)]=_0x2cef28['rows'],_0x2cef28['dimensions']['lev']=_0x2cef28['lev']||0x1,_0x2cef28['lon']={},_0x2cef28[_0x50e524(0x17a)]['min']=_0x2cef28['xmin'],_0x2cef28[_0x50e524(0x17a)]['max']=_0x2cef28[_0x50e524(0x20f)],_0x2cef28['lat']={},_0x2cef28['lat'][_0x50e524(0x1e1)]=_0x2cef28['ymin'],_0x2cef28[_0x50e524(0x139)][_0x50e524(0x1f2)]=_0x2cef28[_0x50e524(0x183)],_0x2cef28[_0x50e524(0x1d8)]={},_0x2cef28[_0x50e524(0x1d8)]['min']=_0x2cef28['levmin']??0x1,_0x2cef28['lev'][_0x50e524(0x1f2)]=_0x2cef28[_0x50e524(0x1e3)]??0x1,_0x2cef28['U']={},_0x2cef28['U']['array']=new Float32Array(_0x2cef28['udata']),_0x2cef28['U']['min']=_0x2cef28['umin']??Math[_0x50e524(0x1e1)](..._0x2cef28['udata']),_0x2cef28['U']['max']=_0x2cef28[_0x50e524(0x18e)]??Math['max'](..._0x2cef28['udata']),_0x2cef28['V']={},_0x2cef28['V']['array']=new Float32Array(_0x2cef28['vdata']),_0x2cef28['V']['min']=_0x2cef28['vmin']??Math['min'](..._0x2cef28[_0x50e524(0x1b3)]),_0x2cef28['V']['max']=_0x2cef28[_0x50e524(0x195)]??Math['max'](..._0x2cef28['vdata'])),this['data']=_0x2cef28,this['options']=_0xd89584,this['viewerParameters']=_0x709b89,this[_0x50e524(0x18d)]=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x50e524(0x1a1)]),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x50e524(0x1a1)],this[_0x50e524(0x18d)]);}['canvasResize'](_0x2a10ef){const _0x1a31ac=_0x3c1cfe;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x1a31ac(0x1fc)])['forEach'](_0x56b023=>{this['particlesComputing']['windTextures'][_0x56b023]['destroy']();}),this[_0x1a31ac(0x155)]['textures']['colorTable'][_0x1a31ac(0x21f)](),Object[_0x1a31ac(0x1ed)](this[_0x1a31ac(0x155)]['framebuffers'])[_0x1a31ac(0x1e6)](_0x4ebdc4=>{const _0x1969f4=_0x1a31ac;this['particlesRendering']['framebuffers'][_0x4ebdc4][_0x1969f4(0x21f)]();}),this['context']=_0x2a10ef,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this[_0x1a31ac(0x21e)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0x1a31ac(0x1a1)],this[_0x1a31ac(0x18d)]);}[_0x3c1cfe(0x166)](){const _0x44915f=_0x3c1cfe,_0x16ed2b=new Cesium$2[(_0x44915f(0x1bb))]({'color':new Cesium$2[(_0x44915f(0x1ae))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x44915f(0x1c6)]});Object[_0x44915f(0x1ed)](this['particlesRendering'][_0x44915f(0x224)])[_0x44915f(0x1e6)](_0x23e7a8=>{const _0x506051=_0x44915f;_0x16ed2b[_0x506051(0x1e4)]=this[_0x506051(0x155)]['framebuffers'][_0x23e7a8],_0x16ed2b['execute'](this[_0x506051(0x14b)]);});}['refreshParticles'](_0x3e473f){const _0x36abc8=_0x3c1cfe;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this[_0x36abc8(0x21e)],this['viewerParameters']);if(_0x3e473f){var _0x4ed026;const _0x187d5f=this[_0x36abc8(0x155)][_0x36abc8(0x1e5)](this['options']);this['particlesRendering'][_0x36abc8(0x1a2)]['segments'][_0x36abc8(0x1d1)]=_0x187d5f;const _0x2cc4c3=Cesium$2[_0x36abc8(0x13e)]['fromGeometry']({'context':this[_0x36abc8(0x14b)],'geometry':_0x187d5f,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x36abc8(0x206)]});(_0x4ed026=this[_0x36abc8(0x155)]['primitives'])!==null&&_0x4ed026!==void 0x0&&(_0x4ed026=_0x4ed026[_0x36abc8(0x192)])!==null&&_0x4ed026!==void 0x0&&_0x4ed026[_0x36abc8(0x13b)]&&(this['particlesRendering']['primitives']['segments'][_0x36abc8(0x13b)]['vertexArray']=_0x2cc4c3);}}['setOptions'](_0xbc650b){const _0x2f9ed7=_0x3c1cfe;let _0x22e64b=![];this['options']['maxParticles']!==_0xbc650b['maxParticles']&&(_0x22e64b=!![]),Object[_0x2f9ed7(0x1ed)](_0xbc650b)['forEach'](_0x298936=>{const _0x32092b=_0x2f9ed7;this[_0x32092b(0x21e)][_0x298936]=_0xbc650b[_0x298936];}),this['refreshParticles'](_0x22e64b);}['applyViewerParameters'](_0x535d31){Object['keys'](_0x535d31)['forEach'](_0x5db103=>{this['viewerParameters'][_0x5db103]=_0x535d31[_0x5db103];}),this['refreshParticles'](![]);}['destroy'](){const _0x1661fa=_0x3c1cfe;clearTimeout(this['canrefresh']),this[_0x1661fa(0x18d)]['destroyParticlesTextures'](),Object['keys'](this[_0x1661fa(0x18d)]['windTextures'])[_0x1661fa(0x1e6)](_0x4a65aa=>{const _0x39ca1d=_0x1661fa;this[_0x39ca1d(0x18d)][_0x39ca1d(0x1fc)][_0x4a65aa]['destroy']();}),this[_0x1661fa(0x155)][_0x1661fa(0x19a)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x1661fa(0x224)])['forEach'](_0x3853c5=>{const _0x5ba452=_0x1661fa;this['particlesRendering'][_0x5ba452(0x224)][_0x3853c5][_0x5ba452(0x21f)]();});for(const _0x453a58 in this){delete this[_0x453a58];}}}const Cesium$1=mars3d__namespace[_0x3c1cfe(0x213)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x465cd9={}){_0x465cd9={...DEF_OPTIONS,..._0x465cd9},super(_0x465cd9),this['_setOptionsHook'](_0x465cd9);}get[_0x3c1cfe(0x160)](){const _0x5bcb02=_0x3c1cfe;return this[_0x5bcb02(0x1a2)];}get['data'](){const _0x1f95c3=_0x3c1cfe;return this[_0x1f95c3(0x17e)];}set[_0x3c1cfe(0x216)](_0x5b2941){const _0x31fdb1=_0x3c1cfe;this[_0x31fdb1(0x211)](_0x5b2941);}get[_0x3c1cfe(0x193)](){const _0x477aba=_0x3c1cfe;return this['options'][_0x477aba(0x193)];}set[_0x3c1cfe(0x193)](_0x1d3c22){const _0x1ce969=_0x3c1cfe;this[_0x1ce969(0x21e)]['colors']=_0x1d3c22,this[_0x1ce969(0x1c4)]&&this['particleSystem'][_0x1ce969(0x1c8)]({'colors':_0x1d3c22}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x4ec678=_0x3c1cfe;this[_0x4ec678(0x1e7)]=this['_map'][_0x4ec678(0x1e7)],this[_0x4ec678(0x1f6)]=this['_map']['camera'],this[_0x4ec678(0x1a2)]=new Cesium$1['PrimitiveCollection'](),this[_0x4ec678(0x140)]['scene']['primitives']['add'](this[_0x4ec678(0x1a2)]),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x4ec678(0x1c3))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1[(_0x4ec678(0x215))](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this[_0x4ec678(0x178)](),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x4ec678(0x18c)],this),this['_map']['on'](mars3d__namespace[_0x4ec678(0x1be)][_0x4ec678(0x177)],this['_onMouseDownEvent'],this),this[_0x4ec678(0x140)]['on'](mars3d__namespace['EventType'][_0x4ec678(0x1a6)],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x4ec678(0x17e)]&&this['setData'](this['_data']);}['_removedHook'](){const _0x337cc0=_0x3c1cfe;window[_0x337cc0(0x14d)]('resize',this['resize']),this[_0x337cc0(0x140)]['off'](mars3d__namespace['EventType'][_0x337cc0(0x181)],this['_onMap_preRenderEvent'],this),this[_0x337cc0(0x140)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseDown'],this[_0x337cc0(0x1ac)],this),this[_0x337cc0(0x140)][_0x337cc0(0x184)](mars3d__namespace[_0x337cc0(0x1be)][_0x337cc0(0x1a6)],this['_onMouseUpEvent'],this),this[_0x337cc0(0x140)][_0x337cc0(0x184)](mars3d__namespace[_0x337cc0(0x1be)][_0x337cc0(0x1c0)],this['_onMouseMoveEvent'],this),this[_0x337cc0(0x1a2)]['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}[_0x3c1cfe(0x170)](){const _0x15c851=_0x3c1cfe;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map'][_0x15c851(0x1ab)](mars3d__namespace['EventType'][_0x15c851(0x181)],this['_onMap_preRenderEvent'],this);}[_0x3c1cfe(0x1d0)](_0x53350f){const _0x4442d7=_0x3c1cfe;this['particleSystem']['canvasResize'](this['scene']['context']),this[_0x4442d7(0x1c7)](),this[_0x4442d7(0x1a2)][_0x4442d7(0x218)]=!![];}['_onMapWhellEvent'](_0x48154d){const _0x5b1a09=_0x3c1cfe;clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x5b1a09(0x218)]=![],this[_0x5b1a09(0x1e8)]=setTimeout(()=>{const _0x4bb1bd=_0x5b1a09;if(!this['show'])return;this[_0x4bb1bd(0x169)]();},0xc8);}[_0x3c1cfe(0x1ac)](_0x3d3ca3){this['mouse_down']=!![];}[_0x3c1cfe(0x21c)](_0x122084){if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x42f489){const _0x2d6a95=_0x3c1cfe;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x2d6a95(0x1a2)]['show']=!![],this['mouse_down']=![],this[_0x2d6a95(0x1a5)]=![];}['redraw'](){const _0x324711=_0x3c1cfe;if(!this[_0x324711(0x140)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x324711(0x1a2)]['show']=!![];}['setData'](_0x2a3694){const _0x516e3f=_0x3c1cfe;this['_data']=_0x2a3694,this[_0x516e3f(0x1c4)]&&this['particleSystem'][_0x516e3f(0x21f)](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x2a3694,this['getOptions'](),this[_0x516e3f(0x1a1)]),this['addPrimitives']();}[_0x3c1cfe(0x158)](_0x3adb2e,_0x58aeb5){if(_0x3adb2e)for(const _0xe7ef82 in _0x3adb2e){this[_0xe7ef82]=_0x3adb2e[_0xe7ef82];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x3c1cfe(0x1fd)](){const _0x32d221=_0x3c1cfe,_0x17d078=Math['ceil'](Math[_0x32d221(0x20d)](this[_0x32d221(0x16f)]));return this['particlesNumber']=_0x17d078*_0x17d078,{'particlesTextureSize':_0x17d078,'maxParticles':this['particlesNumber'],'particleHeight':this[_0x32d221(0x1d5)],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x32d221(0x146)],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x48bc19=_0x3c1cfe;this['primitives']['add'](this['particleSystem'][_0x48bc19(0x18d)][_0x48bc19(0x1a2)][_0x48bc19(0x1fe)]),this['primitives']['add'](this['particleSystem'][_0x48bc19(0x18d)]['primitives'][_0x48bc19(0x21a)]),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x48bc19(0x1a2)]['postProcessingPosition']),this[_0x48bc19(0x1a2)]['add'](this['particleSystem'][_0x48bc19(0x18d)]['primitives']['postProcessingSpeed']),this[_0x48bc19(0x1a2)][_0x48bc19(0x1c2)](this[_0x48bc19(0x1c4)]['particlesRendering']['primitives']['segments']),this[_0x48bc19(0x1a2)]['add'](this['particleSystem']['particlesRendering']['primitives'][_0x48bc19(0x14a)]),this['primitives']['add'](this['particleSystem'][_0x48bc19(0x155)][_0x48bc19(0x1a2)][_0x48bc19(0x1ca)]);}[_0x3c1cfe(0x178)](){const _0x3f02f9=_0x3c1cfe;let _0xe57318=this[_0x3f02f9(0x1f6)][_0x3f02f9(0x1fb)](this['scene']['globe'][_0x3f02f9(0x171)]);if(!_0xe57318){const _0x440ab6=this['_map'][_0x3f02f9(0x1f3)]();_0xe57318=Cesium$1['Rectangle']['fromDegrees'](_0x440ab6['xmin'],_0x440ab6['ymin'],_0x440ab6['xmax'],_0x440ab6['ymax']);}const _0x430fd2=Util['viewRectangleToLonLatRange'](_0xe57318);this['viewerParameters']['lonRange']['x']=_0x430fd2['lon']['min'],this['viewerParameters']['lonRange']['y']=_0x430fd2['lon']['max'],this['viewerParameters']['latRange']['x']=_0x430fd2['lat'][_0x3f02f9(0x1e1)],this[_0x3f02f9(0x1a1)][_0x3f02f9(0x210)]['y']=_0x430fd2[_0x3f02f9(0x139)]['max'];const _0x4262a4=this[_0x3f02f9(0x1f6)]['getPixelSize'](this['globeBoundingSphere'],this['scene'][_0x3f02f9(0x1f5)],this['scene'][_0x3f02f9(0x1ba)]);_0x4262a4>0x0&&(this['viewerParameters']['pixelSize']=_0x4262a4);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0xf0e170=_0x3c1cfe;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this[_0xf0e170(0x141)]=null,this[_0xf0e170(0x16a)]=null;}['destroy'](){for(const _0x13536b in this){delete this[_0x13536b];}}}class CanvasWindField{constructor(_0x35f27d){this['setOptions'](_0x35f27d);}get[_0x3c1cfe(0x154)](){return this['_speedRate'];}set['speedRate'](_0x1d49c8){const _0x1b9b9d=_0x3c1cfe;this['_speedRate']=(0x64-(_0x1d49c8>0x63?0x63:_0x1d49c8))*0x64,this[_0x1b9b9d(0x19e)]=[(this['xmax']-this['xmin'])/this[_0x1b9b9d(0x1d4)],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set[_0x3c1cfe(0x153)](_0x485f6f){const _0x4ce7a7=_0x3c1cfe;this[_0x4ce7a7(0x143)]=_0x485f6f;}['setOptions'](_0x38a6fd){const _0x5d648d=_0x3c1cfe;this['options']=_0x38a6fd,this['maxAge']=_0x38a6fd['maxAge']||0x78,this[_0x5d648d(0x154)]=_0x38a6fd['speedRate']||0x32,this['particles']=[];const _0x980805=_0x38a6fd['particlesNumber']||0x1000;for(let _0x47de8b=0x0;_0x47de8b<_0x980805;_0x47de8b++){const _0xf3b3de=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0xf3b3de);}}['setDate'](_0x417ae7){const _0x644827=_0x3c1cfe;this['rows']=_0x417ae7[_0x644827(0x1d6)],this['cols']=_0x417ae7[_0x644827(0x1f4)],this['xmin']=_0x417ae7[_0x644827(0x212)],this['xmax']=_0x417ae7['xmax'],this[_0x644827(0x137)]=_0x417ae7[_0x644827(0x137)],this['ymax']=_0x417ae7['ymax'],this[_0x644827(0x21b)]=[];const _0x401199=_0x417ae7['udata'],_0x5e5b7b=_0x417ae7['vdata'];let _0xb9c6f8=![];_0x401199['length']===this['rows']&&_0x401199[0x0][_0x644827(0x1b1)]===this['cols']&&(_0xb9c6f8=!![]);let _0x1a21af=0x0,_0x47cab0=null,_0x4b2bf8=null;for(let _0x488c21=0x0;_0x488c21<this['rows'];_0x488c21++){_0x47cab0=[];for(let _0x770f70=0x0;_0x770f70<this[_0x644827(0x1f4)];_0x770f70++,_0x1a21af++){_0xb9c6f8?_0x4b2bf8=this[_0x644827(0x185)](_0x401199[_0x488c21][_0x770f70],_0x5e5b7b[_0x488c21][_0x770f70]):_0x4b2bf8=this['_calcUV'](_0x401199[_0x1a21af],_0x5e5b7b[_0x1a21af]),_0x47cab0['push'](_0x4b2bf8);}this['grid'][_0x644827(0x167)](_0x47cab0);}this['options'][_0x644827(0x16e)]&&this['grid']['reverse']();}['clear'](){const _0x1ea8db=_0x3c1cfe;delete this[_0x1ea8db(0x1d6)],delete this['cols'],delete this['xmin'],delete this[_0x1ea8db(0x20f)],delete this[_0x1ea8db(0x137)],delete this['ymax'],delete this[_0x1ea8db(0x21b)],delete this[_0x1ea8db(0x161)];}['toGridXY'](_0x4aa2a6,_0x3f73a4){const _0x4cd3d9=_0x3c1cfe,_0x1f4ecb=(_0x4aa2a6-this['xmin'])/(this[_0x4cd3d9(0x20f)]-this['xmin'])*(this[_0x4cd3d9(0x1f4)]-0x1),_0x3eb2af=(this['ymax']-_0x3f73a4)/(this[_0x4cd3d9(0x183)]-this[_0x4cd3d9(0x137)])*(this[_0x4cd3d9(0x1d6)]-0x1);return[_0x1f4ecb,_0x3eb2af];}['getUVByXY'](_0x45aab4,_0x86ecd5){const _0x5c9641=_0x3c1cfe;if(_0x45aab4<0x0||_0x45aab4>=this['cols']||_0x86ecd5>=this[_0x5c9641(0x1d6)])return[0x0,0x0,0x0];const _0xb558e2=Math['floor'](_0x45aab4),_0x308da5=Math['floor'](_0x86ecd5);if(_0xb558e2===_0x45aab4&&_0x308da5===_0x86ecd5)return this[_0x5c9641(0x21b)][_0x86ecd5][_0x45aab4];const _0x3b9001=_0xb558e2+0x1,_0x34e07e=_0x308da5+0x1,_0x28eff0=this[_0x5c9641(0x14f)](_0xb558e2,_0x308da5),_0x276df7=this['getUVByXY'](_0x3b9001,_0x308da5),_0x4c69cb=this['getUVByXY'](_0xb558e2,_0x34e07e),_0x526536=this[_0x5c9641(0x14f)](_0x3b9001,_0x34e07e);let _0x3dd447=null;try{_0x3dd447=this['_bilinearInterpolation'](_0x45aab4-_0xb558e2,_0x86ecd5-_0x308da5,_0x28eff0,_0x276df7,_0x4c69cb,_0x526536);}catch(_0xe9b7f3){console[_0x5c9641(0x1d2)](_0x45aab4,_0x86ecd5);}return _0x3dd447;}['_bilinearInterpolation'](_0x2a33a4,_0x327ddc,_0x3b2f5d,_0x600544,_0x33ebf8,_0x347709){const _0x3fabcd=0x1-_0x2a33a4,_0x1af542=0x1-_0x327ddc,_0x2b0dc3=_0x3fabcd*_0x1af542,_0x5e23e4=_0x2a33a4*_0x1af542,_0x322a3e=_0x3fabcd*_0x327ddc,_0x4cda75=_0x2a33a4*_0x327ddc,_0x48c610=_0x3b2f5d[0x0]*_0x2b0dc3+_0x600544[0x0]*_0x5e23e4+_0x33ebf8[0x0]*_0x322a3e+_0x347709[0x0]*_0x4cda75,_0xe0591c=_0x3b2f5d[0x1]*_0x2b0dc3+_0x600544[0x1]*_0x5e23e4+_0x33ebf8[0x1]*_0x322a3e+_0x347709[0x1]*_0x4cda75;return this['_calcUV'](_0x48c610,_0xe0591c);}['_calcUV'](_0x585926,_0x2ee72c){return[+_0x585926,+_0x2ee72c,Math['sqrt'](_0x585926*_0x585926+_0x2ee72c*_0x2ee72c)];}[_0x3c1cfe(0x1e0)](_0x545154,_0x3168ce){if(!this['isInExtent'](_0x545154,_0x3168ce))return null;const _0x3c5efe=this['toGridXY'](_0x545154,_0x3168ce),_0x541321=this['getUVByXY'](_0x3c5efe[0x0],_0x3c5efe[0x1]);return _0x541321;}['isInExtent'](_0x2c9584,_0x2b841b){const _0x42e325=_0x3c1cfe;return _0x2c9584>=this['xmin']&&_0x2c9584<=this['xmax']&&_0x2b841b>=this['ymin']&&_0x2b841b<=this[_0x42e325(0x183)]?!![]:![];}['getRandomLatLng'](){const _0x3a6e10=_0x3c1cfe,_0x488663=fRandomByfloat(this[_0x3a6e10(0x212)],this['xmax']),_0x2d2a2d=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x2d2a2d,'lng':_0x488663};}['getParticles'](){const _0x2cff8c=_0x3c1cfe;let _0x43b5d1,_0x413406,_0x1fed4a;for(let _0x2b221b=0x0,_0x44f915=this['particles'][_0x2cff8c(0x1b1)];_0x2b221b<_0x44f915;_0x2b221b++){let _0x1e348a=this['particles'][_0x2b221b];_0x1e348a['age']<=0x0&&(_0x1e348a=this['_randomParticle'](_0x1e348a));if(_0x1e348a[_0x2cff8c(0x141)]>0x0){const _0x381fb3=_0x1e348a[_0x2cff8c(0x1fa)],_0x29a46c=_0x1e348a['tlat'];_0x1fed4a=this['getUVByPoint'](_0x381fb3,_0x29a46c),_0x1fed4a?(_0x43b5d1=_0x381fb3+this['_calc_speedRate'][0x0]*_0x1fed4a[0x0],_0x413406=_0x29a46c+this[_0x2cff8c(0x19e)][0x1]*_0x1fed4a[0x1],_0x1e348a['lng']=_0x381fb3,_0x1e348a['lat']=_0x29a46c,_0x1e348a['tlng']=_0x43b5d1,_0x1e348a['tlat']=_0x413406,_0x1e348a['speed']=_0x1fed4a[0x2],_0x1e348a['age']--):_0x1e348a['age']=0x0;}}return this[_0x2cff8c(0x161)];}['_randomParticle'](_0x21a98a){const _0x49395a=_0x3c1cfe;let _0x22e860,_0x145ba7;for(let _0x114a8b=0x0;_0x114a8b<0x1e;_0x114a8b++){_0x22e860=this[_0x49395a(0x1df)](),_0x145ba7=this[_0x49395a(0x1e0)](_0x22e860['lng'],_0x22e860['lat']);if(_0x145ba7&&_0x145ba7[0x2]>0x0)break;}if(!_0x145ba7)return _0x21a98a;const _0x1e97ab=_0x22e860['lng']+this['_calc_speedRate'][0x0]*_0x145ba7[0x0],_0x7c528c=_0x22e860[_0x49395a(0x139)]+this[_0x49395a(0x19e)][0x1]*_0x145ba7[0x1];return _0x21a98a['lng']=_0x22e860[_0x49395a(0x1ee)],_0x21a98a[_0x49395a(0x139)]=_0x22e860['lat'],_0x21a98a['tlng']=_0x1e97ab,_0x21a98a['tlat']=_0x7c528c,_0x21a98a['age']=Math['round'](Math['random']()*this['maxAge']),_0x21a98a['speed']=_0x145ba7[0x2],_0x21a98a;}['destroy'](){for(const _0x3b39e8 in this){delete this[_0x3b39e8];}}}function fRandomByfloat(_0x41a324,_0x271d73){const _0x1e26b1=_0x3c1cfe;return _0x41a324+Math[_0x1e26b1(0x203)]()*(_0x271d73-_0x41a324);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x2cbc0f={}){const _0x393858=_0x3c1cfe;super(_0x2cbc0f),this['_setOptionsHook'](_0x2cbc0f),this['canvas']=null,_0x2cbc0f['colors']&&_0x2cbc0f['steps']&&(this['_colorRamp']=new mars3d__namespace[(_0x393858(0x16c))](_0x2cbc0f));}[_0x3c1cfe(0x158)](_0x1cc3c1,_0x1ed73d){const _0x55adcf=_0x3c1cfe;this['frameTime']=0x3e8/(_0x1cc3c1['frameRate']||0xa),this['_pointerEvents']=this['options'][_0x55adcf(0x1dd)]??![],this['color']=_0x1cc3c1['color']||'#ffffff',this['lineWidth']=_0x1cc3c1['lineWidth']||0x1,this['fixedHeight']=_0x1cc3c1['fixedHeight']??0x0,this['reverseY']=_0x1cc3c1['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x1cc3c1);}get[_0x3c1cfe(0x160)](){return this['canvas'];}get['canvasWidth'](){const _0x2d79cf=_0x3c1cfe;return this[_0x2d79cf(0x140)]['scene']['canvas']['clientWidth'];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){const _0x5a647d=_0x3c1cfe;return this[_0x5a647d(0x1f9)];}set[_0x3c1cfe(0x1dd)](_0x326d8e){const _0x302792=_0x3c1cfe;this['_pointerEvents']=_0x326d8e;if(!this['canvas'])return;_0x326d8e?this[_0x302792(0x1af)]['style']['pointer-events']=_0x302792(0x1a0):this['canvas'][_0x302792(0x204)][_0x302792(0x1bf)]=_0x302792(0x1ec);}get['particlesNumber'](){const _0x4d206b=_0x3c1cfe;return this['options'][_0x4d206b(0x16f)];}set['particlesNumber'](_0x2aa2e5){const _0x456eed=_0x3c1cfe;this['options']['particlesNumber']=_0x2aa2e5,clearTimeout(this[_0x456eed(0x188)]),this['_canrefresh']=setTimeout(()=>{const _0x53d4a5=_0x456eed;this[_0x53d4a5(0x169)]();},0x1f4);}get['speedRate'](){const _0x128780=_0x3c1cfe;return this[_0x128780(0x21e)]['speedRate'];}set['speedRate'](_0x10090a){const _0x114369=_0x3c1cfe;this[_0x114369(0x21e)]['speedRate']=_0x10090a,this['windField']&&(this['windField']['speedRate']=_0x10090a);}get['maxAge'](){return this['options']['maxAge'];}set['maxAge'](_0x2dd191){this['options']['maxAge']=_0x2dd191,this['windField']&&(this['windField']['maxAge']=_0x2dd191);}get[_0x3c1cfe(0x216)](){return this['windData'];}set['data'](_0x567a5b){const _0x17cc05=_0x3c1cfe;this[_0x17cc05(0x211)](_0x567a5b);}['_showHook'](_0x29a6e4){const _0x13c236=_0x3c1cfe;_0x29a6e4?this['_addedHook']():(this[_0x13c236(0x202)]&&(this[_0x13c236(0x21e)][_0x13c236(0x216)]=this['windData']),this['_removedHook']());}[_0x3c1cfe(0x1ea)](){const _0x5b4a87=_0x3c1cfe;this[_0x5b4a87(0x21e)][_0x5b4a87(0x1cc)]?this[_0x5b4a87(0x221)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x25c671=_0x3c1cfe;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x25c671(0x1e2)](),this['options']['data']&&this['setData'](this[_0x25c671(0x21e)]['data']);}[_0x3c1cfe(0x194)](){const _0x2d6b9e=_0x3c1cfe;this['clear'](),this['unbindEvent'](),this[_0x2d6b9e(0x1af)]&&(this['_map'][_0x2d6b9e(0x1d7)]['removeChild'](this[_0x2d6b9e(0x1af)]),delete this['canvas']);}[_0x3c1cfe(0x15b)](){const _0x2c2149=_0x3c1cfe,_0x28870a=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this['_map'][_0x2c2149(0x1d7)]);return _0x28870a['style'][_0x2c2149(0x1a4)]='absolute',_0x28870a['style']['top']='0px',_0x28870a['style'][_0x2c2149(0x225)]='0px',_0x28870a['style'][_0x2c2149(0x214)]=this[_0x2c2149(0x140)]['scene']['canvas']['clientWidth']+'px',_0x28870a['style']['height']=this[_0x2c2149(0x140)]['scene'][_0x2c2149(0x1af)][_0x2c2149(0x1d9)]+'px',_0x28870a[_0x2c2149(0x204)][_0x2c2149(0x1dd)]=this['_pointerEvents']?'auto':_0x2c2149(0x1ec),_0x28870a['style']['zIndex']=this['options'][_0x2c2149(0x16b)]??0x9,_0x28870a['width']=this['_map']['scene']['canvas']['clientWidth'],_0x28870a['height']=this[_0x2c2149(0x140)][_0x2c2149(0x1e7)]['canvas'][_0x2c2149(0x1d9)],_0x28870a;}['resize'](){const _0x375a88=_0x3c1cfe;this['canvas']&&(this['canvas'][_0x375a88(0x204)][_0x375a88(0x214)]=this[_0x375a88(0x140)][_0x375a88(0x1e7)]['canvas']['clientWidth']+'px',this['canvas'][_0x375a88(0x204)]['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map'][_0x375a88(0x1e7)]['canvas']['clientWidth'],this[_0x375a88(0x1af)]['height']=this['_map']['scene'][_0x375a88(0x1af)][_0x375a88(0x1d9)]);}['bindEvent'](){const _0x45cfc3=_0x3c1cfe,_0x2e2c0b=this;let _0x5d5e0d=Date['now']();(function _0x3f703e(){const _0x14a64c=_0x180a;_0x2e2c0b['animateFrame']=window['requestAnimationFrame'](_0x3f703e);if(_0x2e2c0b['show']&&_0x2e2c0b['windField']){const _0x53a853=Date[_0x14a64c(0x20a)](),_0x493038=_0x53a853-_0x5d5e0d;_0x493038>_0x2e2c0b[_0x14a64c(0x13c)]&&(_0x5d5e0d=_0x53a853-_0x493038%_0x2e2c0b['frameTime'],_0x2e2c0b['update']());}}(),window[_0x45cfc3(0x163)](_0x45cfc3(0x170),this['resize'][_0x45cfc3(0x186)](this),![]),this[_0x45cfc3(0x174)]=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this[_0x45cfc3(0x140)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x45cfc3(0x1ac)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}[_0x3c1cfe(0x191)](){const _0x29816f=_0x3c1cfe;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options'][_0x29816f(0x1b2)]&&(this[_0x29816f(0x140)]['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x29816f(0x140)][_0x29816f(0x184)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x29816f(0x1a6)],this[_0x29816f(0x149)],this),this[_0x29816f(0x140)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x1db3cb){const _0x377f67=_0x3c1cfe;clearTimeout(this['refreshTimer']);if(!this[_0x377f67(0x218)]||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x5922d4){const _0x14e8c2=_0x3c1cfe;this['mouse_down']=!![],this['_map'][_0x14e8c2(0x184)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x14e8c2(0x1be)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x2bcd31){const _0x32af9f=_0x3c1cfe;if(!this['show']||!this['canvas'])return;this[_0x32af9f(0x174)]&&(this['canvas'][_0x32af9f(0x204)]['visibility']=_0x32af9f(0x19d),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x3c9fdd){const _0x3cbae9=_0x3c1cfe;if(!this[_0x3cbae9(0x218)]||!this['canvas'])return;this['_map'][_0x3cbae9(0x184)](mars3d__namespace['EventType']['mouseMove'],this[_0x3cbae9(0x21c)],this),this[_0x3cbae9(0x174)]&&this[_0x3cbae9(0x1a5)]&&this['redraw'](),this[_0x3cbae9(0x1af)]['style']['visibility']='visible',this['mouse_down']=![],this[_0x3cbae9(0x1a5)]=![];}[_0x3c1cfe(0x211)](_0x33efa2){const _0x316662=_0x3c1cfe;this['clear'](),this['windData']=_0x33efa2,this[_0x316662(0x15d)]['setDate'](_0x33efa2),this[_0x316662(0x169)]();}['redraw'](){const _0x4a606b=_0x3c1cfe;if(!this[_0x4a606b(0x218)])return;this['windField']['setOptions'](this[_0x4a606b(0x21e)]),this[_0x4a606b(0x1da)]();}['update'](){const _0x32c1db=_0x3c1cfe;if(this[_0x32c1db(0x164)])return;this[_0x32c1db(0x164)]=!![];if(this['worker'])this['windField']['update']();else{const _0x19ff00=this['windField']['getParticles']();this['_drawLines'](_0x19ff00);}this['_updateIng']=![];}['_drawLines'](_0x348aa8){const _0x20ffff=_0x3c1cfe;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this[_0x20ffff(0x13f)],this[_0x20ffff(0x1f8)]),this[_0x20ffff(0x180)][_0x20ffff(0x1d3)]='lighter',this[_0x20ffff(0x180)]['globalAlpha']=0.9;const _0x1214b5=this['_map']['scene']['mode']!==Cesium['SceneMode'][_0x20ffff(0x1c9)],_0x5bbaa7=this[_0x20ffff(0x13f)]*0.25;if(this[_0x20ffff(0x17b)])for(let _0x29e6d5=0x0,_0x2df18b=_0x348aa8['length'];_0x29e6d5<_0x2df18b;_0x29e6d5++){const _0x22dc3c=_0x348aa8[_0x29e6d5],_0x1a58cf=this['_tomap'](_0x22dc3c['lng'],_0x22dc3c['lat'],_0x22dc3c),_0x379047=this['_tomap'](_0x22dc3c['tlng'],_0x22dc3c['tlat'],_0x22dc3c);if(!_0x1a58cf||!_0x379047)continue;if(_0x1214b5&&Math['abs'](_0x1a58cf[0x0]-_0x379047[0x0])>=_0x5bbaa7)continue;this['canvasContext']['beginPath'](),this[_0x20ffff(0x180)]['lineWidth']=this['lineWidth'],this[_0x20ffff(0x180)]['strokeStyle']=this[_0x20ffff(0x17b)][_0x20ffff(0x162)](_0x22dc3c[_0x20ffff(0x16a)]),this['canvasContext']['moveTo'](_0x1a58cf[0x0],_0x1a58cf[0x1]),this[_0x20ffff(0x180)]['lineTo'](_0x379047[0x0],_0x379047[0x1]),this[_0x20ffff(0x180)]['stroke']();}else{this[_0x20ffff(0x180)][_0x20ffff(0x1f1)](),this[_0x20ffff(0x180)][_0x20ffff(0x176)]=this[_0x20ffff(0x176)],this['canvasContext']['strokeStyle']=this['color'];for(let _0x2a4da1=0x0,_0x50c4cf=_0x348aa8['length'];_0x2a4da1<_0x50c4cf;_0x2a4da1++){const _0x2fe5f1=_0x348aa8[_0x2a4da1],_0x7b7345=this['_tomap'](_0x2fe5f1['lng'],_0x2fe5f1['lat'],_0x2fe5f1),_0x18cd27=this['_tomap'](_0x2fe5f1['tlng'],_0x2fe5f1['tlat'],_0x2fe5f1);if(!_0x7b7345||!_0x18cd27)continue;if(_0x1214b5&&Math['abs'](_0x7b7345[0x0]-_0x18cd27[0x0])>=_0x5bbaa7)continue;this['canvasContext']['moveTo'](_0x7b7345[0x0],_0x7b7345[0x1]),this['canvasContext']['lineTo'](_0x18cd27[0x0],_0x18cd27[0x1]);}this['canvasContext'][_0x20ffff(0x19b)]();}}[_0x3c1cfe(0x144)](_0x11eb8a,_0x59ac1b,_0x132c2f){const _0x59324b=_0x3c1cfe,_0xf38eef=Cesium['Cartesian3'][_0x59324b(0x1b9)](_0x11eb8a,_0x59ac1b,this[_0x59324b(0x1d5)]),_0x4d6b7a=this['_map']['scene'];if(_0x4d6b7a['mode']===Cesium['SceneMode']['SCENE3D']){const _0x19a70d=new Cesium['EllipsoidalOccluder'](_0x4d6b7a['globe']['ellipsoid'],_0x4d6b7a['camera']['positionWC']),_0x5a30bf=_0x19a70d['isPointVisible'](_0xf38eef);if(!_0x5a30bf)return _0x132c2f['age']=0x0,null;}const _0x43b4f9=Cesium['SceneTransforms'][_0x59324b(0x1b7)](this['_map']['scene'],_0xf38eef);return _0x43b4f9?[_0x43b4f9['x'],_0x43b4f9['y']]:null;}['clear'](){const _0xfada09=_0x3c1cfe;this['windField'][_0xfada09(0x19c)](),delete this['windData'];}['initWorker'](){const _0x38a5e3=_0x3c1cfe;this['worker']=new Worker(this['options'][_0x38a5e3(0x1cc)]),this['worker']['onmessage']=_0x3bf860=>{const _0x15d92d=_0x38a5e3;this['_drawLines'](_0x3bf860['data']['particles']),this[_0x15d92d(0x1b8)]=![];},this['windField']={'init':_0x5e33fb=>{this['worker']['postMessage']({'type':'init','options':_0x5e33fb});},'setOptions':_0x264964=>{const _0x47a6ad=_0x38a5e3;this[_0x47a6ad(0x1cc)][_0x47a6ad(0x1cb)]({'type':'setOptions','options':_0x264964});},'setDate':_0x506048=>{const _0x293c40=_0x38a5e3;this[_0x293c40(0x1cc)]['postMessage']({'type':'setDate','data':_0x506048});},'update':()=>{const _0x391147=_0x38a5e3;if(this[_0x391147(0x1b8)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':_0x391147(0x1da)});},'clear':()=>{const _0x26eb54=_0x38a5e3;this['worker'][_0x26eb54(0x1cb)]({'type':'clear'});}},this[_0x38a5e3(0x15d)]['init'](this['options']);}}mars3d__namespace['LayerUtil']['register'](_0x3c1cfe(0x209),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports[_0x3c1cfe(0x208)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
