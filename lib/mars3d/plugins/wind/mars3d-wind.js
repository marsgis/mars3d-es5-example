/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.12
 * 编译日期：2024-05-06 21:30:39
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x394f56=_0x319f;(function(_0x190792,_0x5b5805){const _0x2705be=_0x319f,_0x2c1503=_0x190792();while(!![]){try{const _0x42095e=parseInt(_0x2705be(0x297))/0x1*(parseInt(_0x2705be(0x268))/0x2)+parseInt(_0x2705be(0x291))/0x3+parseInt(_0x2705be(0x2aa))/0x4*(-parseInt(_0x2705be(0x278))/0x5)+-parseInt(_0x2705be(0x22a))/0x6*(-parseInt(_0x2705be(0x2ce))/0x7)+-parseInt(_0x2705be(0x24c))/0x8+-parseInt(_0x2705be(0x2db))/0x9*(-parseInt(_0x2705be(0x253))/0xa)+parseInt(_0x2705be(0x287))/0xb*(-parseInt(_0x2705be(0x2cf))/0xc);if(_0x42095e===_0x5b5805)break;else _0x2c1503['push'](_0x2c1503['shift']());}catch(_0x2af78){_0x2c1503['push'](_0x2c1503['shift']());}}}(_0x1631,0xb8deb));function _interopNamespace(_0xcd327a){const _0x529c1b=_0x319f;if(_0xcd327a&&_0xcd327a[_0x529c1b(0x2bf)])return _0xcd327a;var _0x3aed93=Object[_0x529c1b(0x27f)](null);return _0xcd327a&&Object['keys'](_0xcd327a)[_0x529c1b(0x27d)](function(_0x283182){const _0x496012=_0x529c1b;if(_0x283182!=='default'){var _0x4d8cbd=Object['getOwnPropertyDescriptor'](_0xcd327a,_0x283182);Object[_0x496012(0x286)](_0x3aed93,_0x283182,_0x4d8cbd[_0x496012(0x1f7)]?_0x4d8cbd:{'enumerable':!![],'get':function(){return _0xcd327a[_0x283182];}});}}),_0x3aed93[_0x529c1b(0x23f)]=_0xcd327a,_0x3aed93;}var mars3d__namespace=_interopNamespace(mars3d);function _0x319f(_0x1e5774,_0x53cfc7){const _0x1631c2=_0x1631();return _0x319f=function(_0x319f23,_0x94071d){_0x319f23=_0x319f23-0x1f3;let _0x42a0b9=_0x1631c2[_0x319f23];return _0x42a0b9;},_0x319f(_0x1e5774,_0x53cfc7);}const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x564ccc,_0x565ae2){const _0x56c1a5=_0x319f,_0x299d85=_0x564ccc*Math['cos'](Cesium$7[_0x56c1a5(0x209)]['toRadians'](_0x565ae2));return _0x299d85;}function getV(_0x135ce3,_0x203473){const _0x42cca7=_0x135ce3*Math['sin'](Cesium$7['Math']['toRadians'](_0x203473));return _0x42cca7;}function getSpeed(_0x4c7043,_0x4f7a8c){const _0x3e89d4=_0x319f,_0x55f1e7=Math['sqrt'](Math['pow'](_0x4c7043,0x2)+Math[_0x3e89d4(0x26f)](_0x4f7a8c,0x2));return _0x55f1e7;}function getDirection(_0xf649fb,_0x1b5b54){const _0x294bfd=_0x319f;let _0x2aedc1=Cesium$7['Math']['toDegrees'](Math[_0x294bfd(0x231)](_0x1b5b54,_0xf649fb));return _0x2aedc1+=_0x2aedc1<0x0?0x168:0x0,_0x2aedc1;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x4cae7b){const _0x4d0665=_0x319f;this['commandType']=_0x4cae7b['commandType'],this['geometry']=_0x4cae7b['geometry'],this[_0x4d0665(0x242)]=_0x4cae7b[_0x4d0665(0x242)],this[_0x4d0665(0x244)]=_0x4cae7b['primitiveType'],this['uniformMap']=_0x4cae7b['uniformMap'],this[_0x4d0665(0x269)]=_0x4cae7b['vertexShaderSource'],this['fragmentShaderSource']=_0x4cae7b['fragmentShaderSource'],this['rawRenderState']=_0x4cae7b['rawRenderState'],this['framebuffer']=_0x4cae7b['framebuffer'],this['outputTexture']=_0x4cae7b[_0x4d0665(0x2b7)],this['autoClear']=_0x4cae7b[_0x4d0665(0x2cd)]??![],this['preExecute']=_0x4cae7b['preExecute'],this['show']=!![],this[_0x4d0665(0x2cc)]=undefined,this['clearCommand']=undefined,this[_0x4d0665(0x2cd)]&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x4d0665(0x2b6))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0x47070a){const _0x439644=_0x319f;switch(this['commandType']){case'Draw':{const _0x129fdc=Cesium$6[_0x439644(0x26c)]['fromGeometry']({'context':_0x47070a,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x439644(0x292)]}),_0x2e4043=Cesium$6[_0x439644(0x258)]['fromCache']({'context':_0x47070a,'attributeLocations':this[_0x439644(0x242)],'vertexShaderSource':this[_0x439644(0x269)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x491ba1=Cesium$6['RenderState'][_0x439644(0x2ca)](this[_0x439644(0x23d)]);return new Cesium$6['DrawCommand']({'primitiveType':this[_0x439644(0x244)],'shaderProgram':_0x2e4043,'vertexArray':_0x129fdc,'modelMatrix':Cesium$6[_0x439644(0x20d)]['IDENTITY'],'renderState':_0x491ba1,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this[_0x439644(0x247)],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x439644(0x25b)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x44fc0f,_0x45ecfb){this['geometry']=_0x45ecfb;const _0xfed5b7=Cesium$6['VertexArray']['fromGeometry']({'context':_0x44fc0f,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this['commandToExecute']['vertexArray']=_0xfed5b7;}[_0x394f56(0x2da)](_0x126064){const _0x420e2c=_0x394f56;if(!this['show'])return;if(_0x126064['mode']!==Cesium$6['SceneMode'][_0x420e2c(0x214)])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this[_0x420e2c(0x202)](_0x126064['context'])),Cesium$6[_0x420e2c(0x203)](this[_0x420e2c(0x238)])&&this['preExecute'](),Cesium$6[_0x420e2c(0x203)](this['clearCommand'])&&_0x126064['commandList']['push'](this['clearCommand']),_0x126064[_0x420e2c(0x285)]['push'](this[_0x420e2c(0x2cc)]);}['isDestroyed'](){return![];}['destroy'](){const _0x47895f=_0x394f56;if(this['clearCommand']){var _0xb5e2fb,_0x587531;(_0xb5e2fb=this[_0x47895f(0x2b8)])!==null&&_0xb5e2fb!==void 0x0&&_0xb5e2fb['vertexArray']&&this['clearCommand']['vertexArray'][_0x47895f(0x21e)](),(_0x587531=this[_0x47895f(0x2b8)])!==null&&_0x587531!==void 0x0&&_0x587531[_0x47895f(0x207)]&&this['clearCommand']['shaderProgram']['destroy'](),delete this[_0x47895f(0x2b8)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x47895f(0x21e)](),this[_0x47895f(0x2cc)]['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x47895f(0x2cc)]),Cesium$6['destroyObject'](this);}}function _0x1631(){const _0x5187e1=['max','destroy','colors','strokeStyle','particleSystem','mouse_move','DISABLE_GL_POSITION_LOG_DEPTH','vertexArray','_updateIng','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','BaseLayer','grid','PI_OVER_TWO','460470VCUOKa','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','postMessage','windTextures','OPAQUE','currentParticlesSpeed','keys','atan2','colorTable','cols','viewerParameters','array','postProcessingSpeed','_onMouseMoveEvent','preExecute','currentTrailsDepth','_drawLines','blue','particlesTextures','rawRenderState','color','default','context','lat','attributeLocations','_speedRate','primitiveType','green','Cesium','framebuffer','add','Compute','segmentsColor','createFramebuffer','2002632vjjJxI','_calcUV','particlesComputing','_updateIng2','particlesTextureSize','register','ymax','160ljbJTQ','blending','_removedHook','_pointerEvents','getRandomLatLng','ShaderProgram','container','udata','fragmentShaderSource','tlat','clientWidth','globeBoundingSphere','nextParticlesPosition','ALWAYS','show','off','currentTrails','execute','getDefaultRenderState','ymin','style','6788PuCUWR','vertexShaderSource','position','NEAREST','VertexArray','canvas','_data','pow','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','lineWidth','worker','depthMask','TextureMagnificationFilter','xmax','createParticlesTextures','randomBetween','5juJVfo','auto','lon','redraw','min','forEach','TextureMinificationFilter','create','particlesNumber','currentTrailsColor','segmentsDepth','_bilinearInterpolation','left','commandList','defineProperty','4037awbCVd','camera','animateFrame','south','length','lineTo','removeEventListener','_onMap_preRenderEvent','framebuffers','mouseHidden','817227GqKkHG','STATIC_DRAW','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','layer','0px','push','19lcSQpU','canvasHeight','mode','nextParticlesSpeed','segments','east','ellipsoid','red','setOptions','pointerEvents','_maxAge','particles','lng','latRange','beginPath','maxParticles','data','positionWC','LUMINANCE','2116028wbwAkL','pixelSize','mouseUp','steps','windField','ColorRamp','random','Rectangle','getColor','umax','rows','getUVByXY','Color','outputTexture','clearCommand','Cartesian2','destroyParticlesTextures','_randomParticle','clear','addEventListener','cancelAnimationFrame','__esModule','all','stroke','onmessage','EventType','textures','tlng','height','arrayBufferView','postProcessingPosition','speed','fromCache','toDegrees','commandToExecute','autoClear','133VtwkDB','21420UVaqPb','_onMouseDownEvent','fillRect','options','now','Cartesian3','addPrimitives','levmin','primitives','clientHeight','sqrt','update','223092QIdHkz','wheel','zIndex','PixelFormat','Draw','_tomap','init','width','get','speedRate','xmin','canvasContext','windData','mouseMove','resize','ShaderSource','getWind','scene','dimensions','createCommand','defined','GeometryAttribute','#ffffff','setData','shaderProgram','ClearCommand','Math','currentParticlesPosition','canvasWidth','removeChild','Matrix4','removeAll','getUVByPoint','createTexture','maxAge','mouse_down','PixelDatatype','SCENE3D','_map','nextTrails','fromGeometry','createWindTextures','lev','lonRange','unbindEvent','age'];_0x1631=function(){return _0x5187e1;};return _0x1631();}const Cesium$5=mars3d__namespace[_0x394f56(0x246)],Util=(function(){const _0x31f1ad=function(){const _0xed0b75=_0x319f,_0x870a43=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5[(_0xed0b75(0x204))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x870a43;},_0x11a454=function(_0x2c5bc1,_0x29b854){const _0xfd392f=_0x319f;if(Cesium$5['defined'](_0x29b854)){const _0x4cbed1={};_0x4cbed1[_0xfd392f(0x2c7)]=_0x29b854,_0x2c5bc1['source']=_0x4cbed1;}const _0x3dcc20=new Cesium$5['Texture'](_0x2c5bc1);return _0x3dcc20;},_0x1f6c30=function(_0x30d2e9,_0x34a936,_0x2cb68c){const _0x4a8851=new Cesium$5['Framebuffer']({'context':_0x30d2e9,'colorTextures':[_0x34a936],'depthTexture':_0x2cb68c});return _0x4a8851;},_0x27e3fa=function(_0x462348){const _0x5169bf=_0x319f,_0x3a4989=!![],_0x5909ee=![],_0x456830={'viewport':_0x462348['viewport'],'depthTest':_0x462348['depthTest'],'depthMask':_0x462348[_0x5169bf(0x273)],'blending':_0x462348[_0x5169bf(0x254)]},_0x1a21e4=Cesium$5['Appearance'][_0x5169bf(0x265)](_0x3a4989,_0x5909ee,_0x456830);return _0x1a21e4;},_0x2aa643=function(_0x34e03c){const _0x5f4fad=_0x319f,_0x15e4b7={},_0x4957d8=Cesium$5[_0x5f4fad(0x209)]['mod'](_0x34e03c['west'],Cesium$5['Math']['TWO_PI']),_0x2cd2ef=Cesium$5['Math']['mod'](_0x34e03c[_0x5f4fad(0x29c)],Cesium$5['Math']['TWO_PI']),_0x1191e7=_0x34e03c['width'];let _0x42e6ca,_0x2bfb9a;_0x1191e7>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x42e6ca=0x0,_0x2bfb9a=Cesium$5[_0x5f4fad(0x209)]['TWO_PI']):_0x2cd2ef-_0x4957d8<_0x1191e7?(_0x42e6ca=_0x4957d8,_0x2bfb9a=_0x4957d8+_0x1191e7):(_0x42e6ca=_0x4957d8,_0x2bfb9a=_0x2cd2ef);_0x15e4b7['lon']={'min':Cesium$5[_0x5f4fad(0x209)][_0x5f4fad(0x2cb)](_0x42e6ca),'max':Cesium$5['Math']['toDegrees'](_0x2bfb9a)};const _0x27453f=_0x34e03c[_0x5f4fad(0x28a)],_0x220b87=_0x34e03c['north'],_0x2cebe2=_0x34e03c[_0x5f4fad(0x2c6)],_0x3e5f6c=_0x2cebe2>Cesium$5['Math']['PI']/0xc?_0x2cebe2/0x2:0x0;let _0x5dbcc1=Cesium$5['Math']['clampToLatitudeRange'](_0x27453f-_0x3e5f6c),_0x1a0207=Cesium$5[_0x5f4fad(0x209)]['clampToLatitudeRange'](_0x220b87+_0x3e5f6c);return _0x5dbcc1<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x5dbcc1=-Cesium$5['Math'][_0x5f4fad(0x229)]),_0x1a0207>Cesium$5[_0x5f4fad(0x209)]['PI_OVER_THREE']&&(_0x1a0207=Cesium$5['Math']['PI_OVER_TWO']),_0x15e4b7['lat']={'min':Cesium$5['Math']['toDegrees'](_0x5dbcc1),'max':Cesium$5['Math'][_0x5f4fad(0x2cb)](_0x1a0207)},_0x15e4b7;};return{'getFullscreenQuad':_0x31f1ad,'createTexture':_0x11a454,'createFramebuffer':_0x1f6c30,'createRawRenderState':_0x27e3fa,'viewRectangleToLonLatRange':_0x2aa643};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x394f56(0x226),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x26b7b9,_0x34b211,_0x575398,_0x5c2b89,_0x508f33){this['createRenderingTextures'](_0x26b7b9,_0x34b211,_0x575398['colors']),this['createRenderingFramebuffers'](_0x26b7b9),this['createRenderingPrimitives'](_0x26b7b9,_0x575398,_0x5c2b89,_0x508f33);}['createRenderingTextures'](_0x341818,_0x1d63c1,_0x4c8fff){const _0x3e5b8b=_0x394f56,_0xf527f5={'context':_0x341818,'width':_0x341818['drawingBufferWidth'],'height':_0x341818['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x14aefc={'context':_0x341818,'width':_0x341818['drawingBufferWidth'],'height':_0x341818['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x3e5b8b(0x2de)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x3e5b8b(0x213)]['UNSIGNED_INT']},_0x3ef0fe=_0x4c8fff['length'],_0x346c42=new Float32Array(_0x3ef0fe*0x3);for(let _0x1b8fec=0x0;_0x1b8fec<_0x3ef0fe;_0x1b8fec++){const _0x3f886d=Cesium$4['Color']['fromCssColorString'](_0x4c8fff[_0x1b8fec]);_0x346c42[0x3*_0x1b8fec]=_0x3f886d[_0x3e5b8b(0x29e)],_0x346c42[0x3*_0x1b8fec+0x1]=_0x3f886d[_0x3e5b8b(0x245)],_0x346c42[0x3*_0x1b8fec+0x2]=_0x3f886d[_0x3e5b8b(0x23b)];}const _0xc9a529={'context':_0x341818,'width':_0x3ef0fe,'height':0x1,'pixelFormat':Cesium$4[_0x3e5b8b(0x2de)]['RGB'],'pixelDatatype':Cesium$4[_0x3e5b8b(0x213)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x3e5b8b(0x27e)]['LINEAR'],'magnificationFilter':Cesium$4[_0x3e5b8b(0x274)]['LINEAR']})};this['textures']={'segmentsColor':Util[_0x3e5b8b(0x210)](_0xf527f5),'segmentsDepth':Util['createTexture'](_0x14aefc),'currentTrailsColor':Util['createTexture'](_0xf527f5),'currentTrailsDepth':Util['createTexture'](_0x14aefc),'nextTrailsColor':Util['createTexture'](_0xf527f5),'nextTrailsDepth':Util['createTexture'](_0x14aefc),'colorTable':Util['createTexture'](_0xc9a529,_0x346c42)};}['createRenderingFramebuffers'](_0x2ae703){const _0x2dd462=_0x394f56;this[_0x2dd462(0x28f)]={'segments':Util[_0x2dd462(0x24b)](_0x2ae703,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x2ae703,this[_0x2dd462(0x2c4)][_0x2dd462(0x281)],this['textures'][_0x2dd462(0x239)]),'nextTrails':Util['createFramebuffer'](_0x2ae703,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x464bc3){const _0x50afcc=_0x394f56,_0x4bb58e=0x4;let _0x387684=[];for(let _0x2f8074=0x0;_0x2f8074<_0x464bc3['particlesTextureSize'];_0x2f8074++){for(let _0x532a8b=0x0;_0x532a8b<_0x464bc3['particlesTextureSize'];_0x532a8b++){for(let _0x21c8e3=0x0;_0x21c8e3<_0x4bb58e;_0x21c8e3++){_0x387684['push'](_0x2f8074/_0x464bc3['particlesTextureSize']),_0x387684['push'](_0x532a8b/_0x464bc3[_0x50afcc(0x250)]);}}}_0x387684=new Float32Array(_0x387684);let _0xf01428=[];const _0x130e15=[-0x1,0x1],_0x3d9727=[-0x1,0x1];for(let _0x55ca9f=0x0;_0x55ca9f<_0x464bc3['maxParticles'];_0x55ca9f++){for(let _0x434859=0x0;_0x434859<_0x4bb58e/0x2;_0x434859++){for(let _0x686424=0x0;_0x686424<_0x4bb58e/0x2;_0x686424++){_0xf01428['push'](_0x130e15[_0x434859]),_0xf01428['push'](_0x3d9727[_0x686424]),_0xf01428['push'](0x0);}}}_0xf01428=new Float32Array(_0xf01428);const _0x3b7a59=0x6*_0x464bc3['maxParticles'],_0x116727=new Uint32Array(_0x3b7a59);for(let _0x531be3=0x0,_0x2c15df=0x0,_0x4899eb=0x0;_0x531be3<_0x464bc3['maxParticles'];_0x531be3++){_0x116727[_0x2c15df++]=_0x4899eb+0x0,_0x116727[_0x2c15df++]=_0x4899eb+0x1,_0x116727[_0x2c15df++]=_0x4899eb+0x2,_0x116727[_0x2c15df++]=_0x4899eb+0x2,_0x116727[_0x2c15df++]=_0x4899eb+0x1,_0x116727[_0x2c15df++]=_0x4899eb+0x3,_0x4899eb+=0x4;}const _0x20a02e=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x387684}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0xf01428})}),'indices':_0x116727});return _0x20a02e;}['createRenderingPrimitives'](_0x13aff4,_0x2fd67e,_0x1e8557,_0x3bfb01){const _0x23c4ab=_0x394f56,_0x3eaa58=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x23c4ab(0x1f3),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x2fd67e),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x3bfb01['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x3bfb01['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x28ecd5=_0x23c4ab;return _0x3bfb01['particlesTextures'][_0x28ecd5(0x236)];},'colorTable':function(){const _0x1ef2fa=_0x23c4ab;return _0x3eaa58['textures'][_0x1ef2fa(0x232)];},'aspect':function(){return _0x13aff4['drawingBufferWidth']/_0x13aff4['drawingBufferHeight'];},'pixelSize':function(){return _0x1e8557['pixelSize'];},'lineWidth':function(){return _0x2fd67e['lineWidth'];},'particleHeight':function(){return _0x2fd67e['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x23c4ab(0x28f)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0xc14306=_0x23c4ab;return _0x3eaa58[_0xc14306(0x2c4)][_0xc14306(0x24a)];},'segmentsDepthTexture':function(){const _0x119e87=_0x23c4ab;return _0x3eaa58[_0x119e87(0x2c4)][_0x119e87(0x282)];},'currentTrailsColor':function(){const _0x20b2e2=_0x23c4ab;return _0x3eaa58['framebuffers'][_0x20b2e2(0x263)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x10e1bf=_0x23c4ab;return _0x3eaa58[_0x10e1bf(0x28f)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x2fd67e['fadeOpacity'];}},'vertexShaderSource':new Cesium$4[(_0x23c4ab(0x1fe))]({'defines':[_0x23c4ab(0x223)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x23c4ab(0x260)]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x23c4ab(0x216)],'autoClear':!![],'preExecute':function(){const _0x5b8b31=_0x23c4ab,_0x721c6f=_0x3eaa58['framebuffers']['currentTrails'];_0x3eaa58['framebuffers']['currentTrails']=_0x3eaa58[_0x5b8b31(0x28f)]['nextTrails'],_0x3eaa58[_0x5b8b31(0x28f)][_0x5b8b31(0x216)]=_0x721c6f,_0x3eaa58['primitives']['trails']['commandToExecute'][_0x5b8b31(0x247)]=_0x3eaa58['framebuffers']['nextTrails'],_0x3eaa58['primitives']['trails'][_0x5b8b31(0x2b8)]['framebuffer']=_0x3eaa58['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':_0x23c4ab(0x1f3),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x697bf2=_0x23c4ab;return _0x3eaa58[_0x697bf2(0x28f)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x3eaa58['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x23c4ab(0x22b)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x394f56(0x270),updateSpeed_frag=_0x394f56(0x293),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace[_0x394f56(0x246)];class ParticlesComputing{constructor(_0x2636c4,_0x7671aa,_0x747d79,_0x501347){this['data']=_0x7671aa,this['createWindTextures'](_0x2636c4,_0x7671aa),this['createParticlesTextures'](_0x2636c4,_0x747d79,_0x501347),this['createComputingPrimitives'](_0x7671aa,_0x747d79,_0x501347);}[_0x394f56(0x218)](_0xe17641,_0x2e7a52){const _0x654a8e=_0x394f56,_0x2bca8d={'context':_0xe17641,'width':_0x2e7a52['dimensions']['lon'],'height':_0x2e7a52['dimensions']['lat']*(_0x2e7a52[_0x654a8e(0x201)][_0x654a8e(0x219)]||0x1),'pixelFormat':Cesium$3[_0x654a8e(0x2de)][_0x654a8e(0x2a9)],'pixelDatatype':Cesium$3[_0x654a8e(0x213)]['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x654a8e(0x26b)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x2bca8d,_0x2e7a52['U']['array']),'V':Util['createTexture'](_0x2bca8d,_0x2e7a52['V']['array'])};}[_0x394f56(0x276)](_0x28cf8e,_0x217134,_0x31d623){const _0x5d3592=_0x394f56,_0x5dd8b5={'context':_0x28cf8e,'width':_0x217134[_0x5d3592(0x250)],'height':_0x217134['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x5d3592(0x26b)],'magnificationFilter':Cesium$3[_0x5d3592(0x274)]['NEAREST']})},_0x5d083f=this['randomizeParticles'](_0x217134['maxParticles'],_0x31d623),_0x52537b=new Float32Array(0x4*_0x217134[_0x5d3592(0x2a6)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x5dd8b5),'currentParticlesPosition':Util['createTexture'](_0x5dd8b5,_0x5d083f),'nextParticlesPosition':Util['createTexture'](_0x5dd8b5,_0x5d083f),'currentParticlesSpeed':Util[_0x5d3592(0x210)](_0x5dd8b5,_0x52537b),'nextParticlesSpeed':Util[_0x5d3592(0x210)](_0x5dd8b5,_0x52537b),'postProcessingPosition':Util['createTexture'](_0x5dd8b5,_0x5d083f),'postProcessingSpeed':Util['createTexture'](_0x5dd8b5,_0x52537b)};}['randomizeParticles'](_0x37e1ab,_0x375a9d){const _0x464651=_0x394f56,_0x4d6670=new Float32Array(0x4*_0x37e1ab);for(let _0xd5c2a9=0x0;_0xd5c2a9<_0x37e1ab;_0xd5c2a9++){_0x4d6670[0x4*_0xd5c2a9]=Cesium$3['Math']['randomBetween'](_0x375a9d['lonRange']['x'],_0x375a9d['lonRange']['y']),_0x4d6670[0x4*_0xd5c2a9+0x1]=Cesium$3['Math'][_0x464651(0x277)](_0x375a9d['latRange']['x'],_0x375a9d['latRange']['y']),_0x4d6670[0x4*_0xd5c2a9+0x2]=Cesium$3[_0x464651(0x209)][_0x464651(0x277)](this['data']['lev']['min'],this['data']['lev'][_0x464651(0x21d)]),_0x4d6670[0x4*_0xd5c2a9+0x3]=0x0;}return _0x4d6670;}[_0x394f56(0x2ba)](){const _0x452d41=_0x394f56;Object['keys'](this[_0x452d41(0x23c)])['forEach'](_0x128104=>{this['particlesTextures'][_0x128104]['destroy']();});}['createComputingPrimitives'](_0xa13d17,_0x199abf,_0x1fe7f5){const _0x211696=_0x394f56,_0x2e0fba=new Cesium$3['Cartesian3'](_0xa13d17['dimensions'][_0x211696(0x27a)],_0xa13d17['dimensions']['lat'],_0xa13d17[_0x211696(0x201)]['lev']),_0x5573e9=new Cesium$3['Cartesian3'](_0xa13d17['lon']['min'],_0xa13d17[_0x211696(0x241)]['min'],_0xa13d17['lev'][_0x211696(0x27c)]),_0x159f18=new Cesium$3[(_0x211696(0x2d4))](_0xa13d17['lon']['max'],_0xa13d17[_0x211696(0x241)]['max'],_0xa13d17['lev']['max']),_0x247a04=new Cesium$3['Cartesian3']((_0x159f18['x']-_0x5573e9['x'])/(_0x2e0fba['x']-0x1),(_0x159f18['y']-_0x5573e9['y'])/(_0x2e0fba['y']-0x1),_0x2e0fba['z']>0x1?(_0x159f18['z']-_0x5573e9['z'])/(_0x2e0fba['z']-0x1):0x1),_0x4fbe65=new Cesium$3[(_0x211696(0x2b9))](_0xa13d17['U'][_0x211696(0x27c)],_0xa13d17['U']['max']),_0x47b9d2=new Cesium$3['Cartesian2'](_0xa13d17['V']['min'],_0xa13d17['V'][_0x211696(0x21d)]),_0x258393=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x211696(0x249),'uniformMap':{'U':function(){const _0x2da06b=_0x211696;return _0x258393[_0x2da06b(0x22d)]['U'];},'V':function(){return _0x258393['windTextures']['V'];},'currentParticlesPosition':function(){return _0x258393['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x2e0fba;},'minimum':function(){return _0x5573e9;},'maximum':function(){return _0x159f18;},'interval':function(){return _0x247a04;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x211696(0x23c)]['particlesWind'],'preExecute':function(){const _0x34452d=_0x211696;_0x258393[_0x34452d(0x2d7)]['getWind']['commandToExecute'][_0x34452d(0x2b7)]=_0x258393[_0x34452d(0x23c)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x211696(0x249),'uniformMap':{'currentParticlesSpeed':function(){const _0x4a664e=_0x211696;return _0x258393[_0x4a664e(0x23c)]['currentParticlesSpeed'];},'particlesWind':function(){const _0x31bf0c=_0x211696;return _0x258393[_0x31bf0c(0x23c)]['particlesWind'];},'uSpeedRange':function(){return _0x4fbe65;},'vSpeedRange':function(){return _0x47b9d2;},'pixelSize':function(){const _0x54c96d=_0x211696;return _0x1fe7f5[_0x54c96d(0x2ab)];},'speedFactor':function(){return _0x199abf['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x211696(0x23c)][_0x211696(0x29a)],'preExecute':function(){const _0x183872=_0x211696,_0x1f9b69=_0x258393['particlesTextures'][_0x183872(0x22f)];_0x258393['particlesTextures']['currentParticlesSpeed']=_0x258393['particlesTextures'][_0x183872(0x236)],_0x258393['particlesTextures'][_0x183872(0x236)]=_0x1f9b69,_0x258393[_0x183872(0x2d7)]['updateSpeed']['commandToExecute'][_0x183872(0x2b7)]=_0x258393['particlesTextures'][_0x183872(0x29a)];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x1e59fa=_0x211696;return _0x258393[_0x1e59fa(0x23c)][_0x1e59fa(0x20a)];},'currentParticlesSpeed':function(){return _0x258393['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures']['nextParticlesPosition'],'preExecute':function(){const _0x5368c8=_0x211696,_0x13c27c=_0x258393['particlesTextures'][_0x5368c8(0x20a)];_0x258393['particlesTextures']['currentParticlesPosition']=_0x258393['particlesTextures']['postProcessingPosition'],_0x258393[_0x5368c8(0x23c)][_0x5368c8(0x2c8)]=_0x13c27c,_0x258393['primitives']['updatePosition']['commandToExecute']['outputTexture']=_0x258393['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x3e23ae=_0x211696;return _0x258393['particlesTextures'][_0x3e23ae(0x25f)];},'nextParticlesSpeed':function(){const _0x23472a=_0x211696;return _0x258393[_0x23472a(0x23c)]['nextParticlesSpeed'];},'lonRange':function(){return _0x1fe7f5['lonRange'];},'latRange':function(){const _0x4acedc=_0x211696;return _0x1fe7f5[_0x4acedc(0x2a4)];},'randomCoefficient':function(){const _0xcb86e0=Math['random']();return _0xcb86e0;},'dropRate':function(){return _0x199abf['dropRate'];},'dropRateBump':function(){return _0x199abf['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x211696(0x23c)][_0x211696(0x2c8)],'preExecute':function(){const _0x58eb94=_0x211696;_0x258393['primitives'][_0x58eb94(0x2c8)]['commandToExecute']['outputTexture']=_0x258393['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x258393['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x258393['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0xa3e085=_0x211696;_0x258393['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x258393[_0xa3e085(0x23c)]['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x394f56(0x246)];class ParticleSystem{constructor(_0x4da6dd,_0x4495c1,_0x4133dc,_0x1933ca){const _0xff31da=_0x394f56;this['context']=_0x4da6dd,_0x4495c1={..._0x4495c1},_0x4495c1['udata']&&_0x4495c1['vdata']&&(_0x4495c1['dimensions']={},_0x4495c1[_0xff31da(0x201)][_0xff31da(0x27a)]=_0x4495c1[_0xff31da(0x233)],_0x4495c1['dimensions'][_0xff31da(0x241)]=_0x4495c1['rows'],_0x4495c1['dimensions']['lev']=_0x4495c1[_0xff31da(0x219)]||0x1,_0x4495c1[_0xff31da(0x27a)]={},_0x4495c1['lon']['min']=_0x4495c1['xmin'],_0x4495c1['lon']['max']=_0x4495c1[_0xff31da(0x275)],_0x4495c1[_0xff31da(0x241)]={},_0x4495c1[_0xff31da(0x241)]['min']=_0x4495c1[_0xff31da(0x266)],_0x4495c1['lat']['max']=_0x4495c1[_0xff31da(0x252)],_0x4495c1['lev']={},_0x4495c1[_0xff31da(0x219)]['min']=_0x4495c1[_0xff31da(0x2d6)]??0x1,_0x4495c1['lev']['max']=_0x4495c1['levmax']??0x1,_0x4495c1['U']={},_0x4495c1['U'][_0xff31da(0x235)]=new Float32Array(_0x4495c1[_0xff31da(0x25a)]),_0x4495c1['U']['min']=_0x4495c1['umin']??Math[_0xff31da(0x27c)](..._0x4495c1['udata']),_0x4495c1['U']['max']=_0x4495c1[_0xff31da(0x2b3)]??Math[_0xff31da(0x21d)](..._0x4495c1['udata']),_0x4495c1['V']={},_0x4495c1['V'][_0xff31da(0x235)]=new Float32Array(_0x4495c1['vdata']),_0x4495c1['V']['min']=_0x4495c1['vmin']??Math['min'](..._0x4495c1['vdata']),_0x4495c1['V']['max']=_0x4495c1['vmax']??Math['max'](..._0x4495c1['vdata'])),this[_0xff31da(0x2a7)]=_0x4495c1,this['options']=_0x4133dc,this['viewerParameters']=_0x1933ca,this['particlesComputing']=new ParticlesComputing(this[_0xff31da(0x240)],this['data'],this['options'],this[_0xff31da(0x234)]),this['particlesRendering']=new ParticlesRendering(this[_0xff31da(0x240)],this[_0xff31da(0x2a7)],this['options'],this['viewerParameters'],this['particlesComputing']);}['canvasResize'](_0x4f1087){const _0x288b4f=_0x394f56;this[_0x288b4f(0x24e)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x2c2bc8=>{const _0x57947f=_0x288b4f;this[_0x57947f(0x24e)]['windTextures'][_0x2c2bc8][_0x57947f(0x21e)]();}),this['particlesRendering'][_0x288b4f(0x2c4)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering']['framebuffers'])[_0x288b4f(0x27d)](_0x4595d3=>{const _0x574001=_0x288b4f;this['particlesRendering'][_0x574001(0x28f)][_0x4595d3][_0x574001(0x21e)]();}),this[_0x288b4f(0x240)]=_0x4f1087,this[_0x288b4f(0x24e)]=new ParticlesComputing(this['context'],this['data'],this['options'],this[_0x288b4f(0x234)]),this['particlesRendering']=new ParticlesRendering(this[_0x288b4f(0x240)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0xdd0f60=_0x394f56,_0x2f3c2a=new Cesium$2[(_0xdd0f60(0x208))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0xdd0f60(0x22e)]});Object[_0xdd0f60(0x230)](this['particlesRendering']['framebuffers'])['forEach'](_0x14255b=>{const _0x1366fd=_0xdd0f60;_0x2f3c2a[_0x1366fd(0x247)]=this['particlesRendering']['framebuffers'][_0x14255b],_0x2f3c2a[_0x1366fd(0x264)](this['context']);});}['refreshParticles'](_0x31429e){const _0x2410e3=_0x394f56;this['clearFramebuffers'](),this['particlesComputing'][_0x2410e3(0x2ba)](),this['particlesComputing'][_0x2410e3(0x276)](this['context'],this['options'],this['viewerParameters']);if(_0x31429e){var _0x445a40;const _0x2eebc2=this['particlesRendering']['createSegmentsGeometry'](this[_0x2410e3(0x2d2)]);this['particlesRendering']['primitives'][_0x2410e3(0x29b)]['geometry']=_0x2eebc2;const _0x302d7e=Cesium$2[_0x2410e3(0x26c)][_0x2410e3(0x217)]({'context':this['context'],'geometry':_0x2eebc2,'attributeLocations':this['particlesRendering']['primitives']['segments']['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x2410e3(0x292)]});(_0x445a40=this['particlesRendering'][_0x2410e3(0x2d7)])!==null&&_0x445a40!==void 0x0&&(_0x445a40=_0x445a40['segments'])!==null&&_0x445a40!==void 0x0&&_0x445a40['commandToExecute']&&(this['particlesRendering'][_0x2410e3(0x2d7)][_0x2410e3(0x29b)][_0x2410e3(0x2cc)][_0x2410e3(0x224)]=_0x302d7e);}}[_0x394f56(0x29f)](_0x216beb){const _0x24cee3=_0x394f56;let _0x3c0a05=![];this[_0x24cee3(0x2d2)]['maxParticles']!==_0x216beb['maxParticles']&&(_0x3c0a05=!![]),Object['keys'](_0x216beb)[_0x24cee3(0x27d)](_0x3445b5=>{this['options'][_0x3445b5]=_0x216beb[_0x3445b5];}),this['refreshParticles'](_0x3c0a05);}['applyViewerParameters'](_0x4e55a5){Object['keys'](_0x4e55a5)['forEach'](_0x298369=>{const _0x10c5d3=_0x319f;this[_0x10c5d3(0x234)][_0x298369]=_0x4e55a5[_0x298369];}),this['refreshParticles'](![]);}['destroy'](){const _0x15b361=_0x394f56;clearTimeout(this['canrefresh']),this[_0x15b361(0x24e)][_0x15b361(0x2ba)](),Object[_0x15b361(0x230)](this['particlesComputing'][_0x15b361(0x22d)])['forEach'](_0x2f3c3a=>{const _0x59473=_0x15b361;this['particlesComputing'][_0x59473(0x22d)][_0x2f3c3a]['destroy']();}),this['particlesRendering'][_0x15b361(0x2c4)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x15b361(0x28f)])['forEach'](_0x33f185=>{this['particlesRendering']['framebuffers'][_0x33f185]['destroy']();});for(const _0x8292f5 in this){delete this[_0x8292f5];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer'][_0x394f56(0x227)],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x20eefd={}){_0x20eefd={...DEF_OPTIONS,..._0x20eefd},super(_0x20eefd),this['_setOptionsHook'](_0x20eefd);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x2840c9){this['setData'](_0x2840c9);}get['colors'](){const _0x374cd7=_0x394f56;return this[_0x374cd7(0x2d2)]['colors'];}set[_0x394f56(0x21f)](_0x467dc9){const _0x12ec2d=_0x394f56;this['options'][_0x12ec2d(0x21f)]=_0x467dc9,this[_0x12ec2d(0x221)]&&this['particleSystem']['setOptions']({'colors':_0x467dc9}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x1b563b=_0x394f56;this['scene']=this[_0x1b563b(0x215)]['scene'],this['camera']=this['_map'][_0x1b563b(0x288)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x1b563b(0x200)][_0x1b563b(0x2d7)]['add'](this['primitives']),this[_0x1b563b(0x234)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x1b563b(0x2bd)](_0x1b563b(0x1fd),this[_0x1b563b(0x1fd)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this[_0x1b563b(0x215)]['on'](mars3d__namespace[_0x1b563b(0x2c3)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x1b563b(0x2d0)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x1b563b(0x26e)]&&this['setData'](this['_data']);}['_removedHook'](){const _0x52ce4e=_0x394f56;window[_0x52ce4e(0x28d)]('resize',this[_0x52ce4e(0x1fd)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this[_0x52ce4e(0x28e)],this),this[_0x52ce4e(0x215)][_0x52ce4e(0x262)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x52ce4e(0x262)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this[_0x52ce4e(0x215)]['scene'][_0x52ce4e(0x2d7)]['remove'](this['primitives']);}['resize'](){const _0x5dd81b=_0x394f56;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x5dd81b(0x2d7)][_0x5dd81b(0x20e)](),this[_0x5dd81b(0x215)]['once'](mars3d__namespace['EventType']['preRender'],this[_0x5dd81b(0x28e)],this);}['_onMap_preRenderEvent'](_0x5c1284){const _0x46fa07=_0x394f56;this[_0x46fa07(0x221)]['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x4d4aef){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x382fdc){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x3b51bd){const _0x5dd85f=_0x394f56;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this[_0x5dd85f(0x222)]=!![]);}['_onMouseUpEvent'](_0x5edc93){const _0x3f88e4=_0x394f56;if(!this[_0x3f88e4(0x261)]||!this[_0x3f88e4(0x221)])return;this['mouse_down']&&this[_0x3f88e4(0x222)]&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this[_0x3f88e4(0x222)]=![];}['redraw'](){const _0x4d1df1=_0x394f56;if(!this[_0x4d1df1(0x215)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0xebab4a){const _0x2b6ddd=_0x394f56;this['_data']=_0xebab4a,this[_0x2b6ddd(0x221)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0xebab4a,this['getOptions'](),this[_0x2b6ddd(0x234)]),this[_0x2b6ddd(0x2d5)]();}['_setOptionsHook'](_0x413e6c,_0x32eda5){if(_0x413e6c)for(const _0x97f4ee in _0x413e6c){this[_0x97f4ee]=_0x413e6c[_0x97f4ee];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x2f618d=_0x394f56,_0x36d9ef=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this[_0x2f618d(0x280)]=_0x36d9ef*_0x36d9ef,{'particlesTextureSize':_0x36d9ef,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this[_0x2f618d(0x271)],'colors':this['colors']};}['addPrimitives'](){const _0x213309=_0x394f56;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x213309(0x1ff)]),this['primitives'][_0x213309(0x248)](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this[_0x213309(0x2d7)]['add'](this['particleSystem']['particlesComputing'][_0x213309(0x2d7)]['updatePosition']),this['primitives']['add'](this[_0x213309(0x221)]['particlesComputing']['primitives'][_0x213309(0x2c8)]),this[_0x213309(0x2d7)]['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this[_0x213309(0x2d7)][_0x213309(0x248)](this['particleSystem']['particlesRendering'][_0x213309(0x2d7)]['segments']),this[_0x213309(0x2d7)][_0x213309(0x248)](this['particleSystem']['particlesRendering']['primitives']['trails']),this[_0x213309(0x2d7)]['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x30b2db=_0x394f56;let _0x4c84c3=this[_0x30b2db(0x288)]['computeViewRectangle'](this['scene']['globe'][_0x30b2db(0x29d)]);if(!_0x4c84c3){const _0x342b61=this[_0x30b2db(0x215)]['getExtent']();_0x4c84c3=Cesium$1[_0x30b2db(0x2b1)]['fromDegrees'](_0x342b61[_0x30b2db(0x1f9)],_0x342b61['ymin'],_0x342b61['xmax'],_0x342b61['ymax']);}const _0x500857=Util['viewRectangleToLonLatRange'](_0x4c84c3);this['viewerParameters'][_0x30b2db(0x21a)]['x']=_0x500857[_0x30b2db(0x27a)][_0x30b2db(0x27c)],this['viewerParameters']['lonRange']['y']=_0x500857['lon']['max'],this['viewerParameters']['latRange']['x']=_0x500857[_0x30b2db(0x241)]['min'],this['viewerParameters'][_0x30b2db(0x2a4)]['y']=_0x500857['lat'][_0x30b2db(0x21d)];const _0x20b5f4=this['camera']['getPixelSize'](this[_0x30b2db(0x25e)],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x20b5f4>0x0&&(this['viewerParameters'][_0x30b2db(0x2ab)]=_0x20b5f4);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0xdeb789 in this){delete this[_0xdeb789];}}}class CanvasWindField{constructor(_0x48c783){this['setOptions'](_0x48c783);}get['speedRate'](){const _0x8d9a86=_0x394f56;return this[_0x8d9a86(0x243)];}set['speedRate'](_0x2bb099){const _0x4d0147=_0x394f56;this['_speedRate']=(0x64-(_0x2bb099>0x63?0x63:_0x2bb099))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0x4d0147(0x1f9)])/this[_0x4d0147(0x243)],(this['ymax']-this['ymin'])/this[_0x4d0147(0x243)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x5c981c){const _0x4250da=_0x394f56;this[_0x4250da(0x2a1)]=_0x5c981c;}['setOptions'](_0x4d6376){const _0x1d6bbc=_0x394f56;this['options']=_0x4d6376,this['maxAge']=_0x4d6376['maxAge']||0x78,this['speedRate']=_0x4d6376['speedRate']||0x32,this[_0x1d6bbc(0x2a2)]=[];const _0x469da5=_0x4d6376[_0x1d6bbc(0x280)]||0x1000;for(let _0x2547a2=0x0;_0x2547a2<_0x469da5;_0x2547a2++){const _0x45cf1b=this[_0x1d6bbc(0x2bb)](new CanvasParticle());this['particles'][_0x1d6bbc(0x296)](_0x45cf1b);}}['setDate'](_0x10049a){const _0xd89133=_0x394f56;this['rows']=_0x10049a[_0xd89133(0x2b4)],this['cols']=_0x10049a[_0xd89133(0x233)],this['xmin']=_0x10049a['xmin'],this['xmax']=_0x10049a['xmax'],this['ymin']=_0x10049a['ymin'],this[_0xd89133(0x252)]=_0x10049a['ymax'],this[_0xd89133(0x228)]=[];const _0xc422e9=_0x10049a[_0xd89133(0x25a)],_0x3f3286=_0x10049a['vdata'];let _0x5d8774=![];_0xc422e9['length']===this['rows']&&_0xc422e9[0x0][_0xd89133(0x28b)]===this[_0xd89133(0x233)]&&(_0x5d8774=!![]);let _0x269f4f=0x0,_0x5781af=null,_0xe07bae=null;for(let _0xd7cbc7=0x0;_0xd7cbc7<this['rows'];_0xd7cbc7++){_0x5781af=[];for(let _0x3c314f=0x0;_0x3c314f<this['cols'];_0x3c314f++,_0x269f4f++){_0x5d8774?_0xe07bae=this['_calcUV'](_0xc422e9[_0xd7cbc7][_0x3c314f],_0x3f3286[_0xd7cbc7][_0x3c314f]):_0xe07bae=this[_0xd89133(0x24d)](_0xc422e9[_0x269f4f],_0x3f3286[_0x269f4f]),_0x5781af['push'](_0xe07bae);}this['grid']['push'](_0x5781af);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){delete this['rows'],delete this['cols'],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x13002c,_0x40670d){const _0x1c06b6=_0x394f56,_0x6b762d=(_0x13002c-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x366562=(this[_0x1c06b6(0x252)]-_0x40670d)/(this[_0x1c06b6(0x252)]-this['ymin'])*(this['rows']-0x1);return[_0x6b762d,_0x366562];}['getUVByXY'](_0x52ee75,_0x580b80){const _0x2eaa2a=_0x394f56;if(_0x52ee75<0x0||_0x52ee75>=this['cols']||_0x580b80>=this['rows'])return[0x0,0x0,0x0];const _0x1a5af5=Math['floor'](_0x52ee75),_0x24253f=Math['floor'](_0x580b80);if(_0x1a5af5===_0x52ee75&&_0x24253f===_0x580b80)return this['grid'][_0x580b80][_0x52ee75];const _0x49c084=_0x1a5af5+0x1,_0x227289=_0x24253f+0x1,_0xcb6306=this[_0x2eaa2a(0x2b5)](_0x1a5af5,_0x24253f),_0x171d63=this['getUVByXY'](_0x49c084,_0x24253f),_0x4dd704=this['getUVByXY'](_0x1a5af5,_0x227289),_0x3fe75d=this[_0x2eaa2a(0x2b5)](_0x49c084,_0x227289);let _0x16395e=null;try{_0x16395e=this[_0x2eaa2a(0x283)](_0x52ee75-_0x1a5af5,_0x580b80-_0x24253f,_0xcb6306,_0x171d63,_0x4dd704,_0x3fe75d);}catch(_0x3f9563){console['log'](_0x52ee75,_0x580b80);}return _0x16395e;}['_bilinearInterpolation'](_0x2ca976,_0x3b3149,_0x333bd6,_0xbce8b,_0x37e808,_0x10a0c6){const _0x1400f9=_0x394f56,_0x424db3=0x1-_0x2ca976,_0x130732=0x1-_0x3b3149,_0x5f1731=_0x424db3*_0x130732,_0x381d37=_0x2ca976*_0x130732,_0x214a89=_0x424db3*_0x3b3149,_0x5751c7=_0x2ca976*_0x3b3149,_0x93851b=_0x333bd6[0x0]*_0x5f1731+_0xbce8b[0x0]*_0x381d37+_0x37e808[0x0]*_0x214a89+_0x10a0c6[0x0]*_0x5751c7,_0x411423=_0x333bd6[0x1]*_0x5f1731+_0xbce8b[0x1]*_0x381d37+_0x37e808[0x1]*_0x214a89+_0x10a0c6[0x1]*_0x5751c7;return this[_0x1400f9(0x24d)](_0x93851b,_0x411423);}['_calcUV'](_0x11227d,_0x219ce0){const _0x3f7e05=_0x394f56;return[+_0x11227d,+_0x219ce0,Math[_0x3f7e05(0x2d9)](_0x11227d*_0x11227d+_0x219ce0*_0x219ce0)];}[_0x394f56(0x20f)](_0xcc8dc,_0x3159d8){const _0x3c66bd=_0x394f56;if(!this['isInExtent'](_0xcc8dc,_0x3159d8))return null;const _0x2b3c7a=this['toGridXY'](_0xcc8dc,_0x3159d8),_0x5e5c32=this[_0x3c66bd(0x2b5)](_0x2b3c7a[0x0],_0x2b3c7a[0x1]);return _0x5e5c32;}['isInExtent'](_0x5d500d,_0x1efd9f){const _0x224b98=_0x394f56;return _0x5d500d>=this['xmin']&&_0x5d500d<=this['xmax']&&_0x1efd9f>=this[_0x224b98(0x266)]&&_0x1efd9f<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x390317=fRandomByfloat(this['xmin'],this['xmax']),_0x3b826b=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x3b826b,'lng':_0x390317};}['getParticles'](){const _0xcd6e3c=_0x394f56;let _0x52137d,_0x315747,_0x3e882b;for(let _0x48b28d=0x0,_0x18f09d=this['particles']['length'];_0x48b28d<_0x18f09d;_0x48b28d++){let _0x288a72=this['particles'][_0x48b28d];_0x288a72[_0xcd6e3c(0x21c)]<=0x0&&(_0x288a72=this['_randomParticle'](_0x288a72));if(_0x288a72[_0xcd6e3c(0x21c)]>0x0){const _0x47b0c5=_0x288a72[_0xcd6e3c(0x2c5)],_0x2b7b28=_0x288a72['tlat'];_0x3e882b=this['getUVByPoint'](_0x47b0c5,_0x2b7b28),_0x3e882b?(_0x52137d=_0x47b0c5+this['_calc_speedRate'][0x0]*_0x3e882b[0x0],_0x315747=_0x2b7b28+this['_calc_speedRate'][0x1]*_0x3e882b[0x1],_0x288a72['lng']=_0x47b0c5,_0x288a72['lat']=_0x2b7b28,_0x288a72['tlng']=_0x52137d,_0x288a72[_0xcd6e3c(0x25c)]=_0x315747,_0x288a72[_0xcd6e3c(0x2c9)]=_0x3e882b[0x2],_0x288a72['age']--):_0x288a72['age']=0x0;}}return this[_0xcd6e3c(0x2a2)];}[_0x394f56(0x2bb)](_0x55bc4b){const _0x2280fa=_0x394f56;let _0x54e4e3,_0x493b2d;for(let _0x375faa=0x0;_0x375faa<0x1e;_0x375faa++){_0x54e4e3=this[_0x2280fa(0x257)](),_0x493b2d=this['getUVByPoint'](_0x54e4e3[_0x2280fa(0x2a3)],_0x54e4e3['lat']);if(_0x493b2d&&_0x493b2d[0x2]>0x0)break;}if(!_0x493b2d)return _0x55bc4b;const _0x3c91d0=_0x54e4e3['lng']+this['_calc_speedRate'][0x0]*_0x493b2d[0x0],_0x40449b=_0x54e4e3['lat']+this['_calc_speedRate'][0x1]*_0x493b2d[0x1];return _0x55bc4b[_0x2280fa(0x2a3)]=_0x54e4e3[_0x2280fa(0x2a3)],_0x55bc4b['lat']=_0x54e4e3['lat'],_0x55bc4b[_0x2280fa(0x2c5)]=_0x3c91d0,_0x55bc4b['tlat']=_0x40449b,_0x55bc4b['age']=Math['round'](Math['random']()*this['maxAge']),_0x55bc4b['speed']=_0x493b2d[0x2],_0x55bc4b;}['destroy'](){for(const _0x521021 in this){delete this[_0x521021];}}}function fRandomByfloat(_0x475e4c,_0x5ccbf7){const _0x269382=_0x394f56;return _0x475e4c+Math[_0x269382(0x2b0)]()*(_0x5ccbf7-_0x475e4c);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x389e95={}){const _0x2c1f02=_0x394f56;super(_0x389e95),this['_setOptionsHook'](_0x389e95),this[_0x2c1f02(0x26d)]=null,_0x389e95[_0x2c1f02(0x21f)]&&_0x389e95[_0x2c1f02(0x2ad)]&&(this['_colorRamp']=new mars3d__namespace[(_0x2c1f02(0x2af))](_0x389e95));}['_setOptionsHook'](_0x8dd079,_0x5fa40d){const _0xe3e194=_0x394f56;this['frameTime']=0x3e8/(_0x8dd079['frameRate']||0xa),this[_0xe3e194(0x256)]=this['options'][_0xe3e194(0x2a0)]??![],this[_0xe3e194(0x23e)]=_0x8dd079[_0xe3e194(0x23e)]||_0xe3e194(0x205),this['lineWidth']=_0x8dd079['lineWidth']||0x1,this['fixedHeight']=_0x8dd079['fixedHeight']??0x0,this['reverseY']=_0x8dd079['reverseY']??![],this[_0xe3e194(0x2ae)]&&this['windField']['setOptions'](_0x8dd079);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x4c075a=_0x394f56;return this[_0x4c075a(0x215)]['scene']['canvas'][_0x4c075a(0x25d)];}get[_0x394f56(0x298)](){const _0x3f8848=_0x394f56;return this[_0x3f8848(0x215)][_0x3f8848(0x200)]['canvas'][_0x3f8848(0x2d8)];}get['pointerEvents'](){const _0x5eeed9=_0x394f56;return this[_0x5eeed9(0x256)];}set['pointerEvents'](_0x1cafc9){const _0x52383b=_0x394f56;this[_0x52383b(0x256)]=_0x1cafc9;if(!this[_0x52383b(0x26d)])return;_0x1cafc9?this['canvas'][_0x52383b(0x267)]['pointer-events']=_0x52383b(0x2c0):this[_0x52383b(0x26d)]['style']['pointer-events']='none';}get['particlesNumber'](){return this['options']['particlesNumber'];}set[_0x394f56(0x280)](_0x303657){const _0xfef4a7=_0x394f56;this['options'][_0xfef4a7(0x280)]=_0x303657,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){const _0x5f26ae=_0x394f56;return this[_0x5f26ae(0x2d2)][_0x5f26ae(0x1f8)];}set['speedRate'](_0xfd21e9){const _0x5ca1a3=_0x394f56;this[_0x5ca1a3(0x2d2)]['speedRate']=_0xfd21e9,this['windField']&&(this['windField'][_0x5ca1a3(0x1f8)]=_0xfd21e9);}get[_0x394f56(0x211)](){const _0x5318fb=_0x394f56;return this[_0x5318fb(0x2d2)]['maxAge'];}set[_0x394f56(0x211)](_0xa3c08c){const _0x582bbe=_0x394f56;this['options'][_0x582bbe(0x211)]=_0xa3c08c,this['windField']&&(this['windField']['maxAge']=_0xa3c08c);}get['data'](){return this['windData'];}set[_0x394f56(0x2a7)](_0x229e8e){this['setData'](_0x229e8e);}['_showHook'](_0x311422){const _0x3cdc27=_0x394f56;_0x311422?this['_addedHook']():(this[_0x3cdc27(0x1fb)]&&(this[_0x3cdc27(0x2d2)]['data']=this['windData']),this[_0x3cdc27(0x255)]());}['_mountedHook'](){const _0xfcf7d7=_0x394f56;this['options'][_0xfcf7d7(0x272)]?this['initWorker']():this[_0xfcf7d7(0x2ae)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x5f1b40=_0x394f56;this['canvas']=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x5f1b40(0x2a7)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x4e43c5=_0x394f56;this[_0x4e43c5(0x2bc)](),this[_0x4e43c5(0x21b)](),this['canvas']&&(this[_0x4e43c5(0x215)][_0x4e43c5(0x259)][_0x4e43c5(0x20c)](this['canvas']),delete this['canvas']);}['_createCanvas'](){const _0x2cbadd=_0x394f56,_0x1d98c9=mars3d__namespace['DomUtil'][_0x2cbadd(0x27f)]('canvas','mars3d-canvasWind',this['_map']['container']);return _0x1d98c9[_0x2cbadd(0x267)][_0x2cbadd(0x26a)]='absolute',_0x1d98c9['style']['top']='0px',_0x1d98c9[_0x2cbadd(0x267)][_0x2cbadd(0x284)]=_0x2cbadd(0x295),_0x1d98c9[_0x2cbadd(0x267)]['width']=this['_map'][_0x2cbadd(0x200)]['canvas']['clientWidth']+'px',_0x1d98c9['style'][_0x2cbadd(0x2c6)]=this['_map']['scene']['canvas']['clientHeight']+'px',_0x1d98c9['style'][_0x2cbadd(0x2a0)]=this['_pointerEvents']?_0x2cbadd(0x279):'none',_0x1d98c9['style'][_0x2cbadd(0x2dd)]=this['options'][_0x2cbadd(0x2dd)]??0x9,_0x1d98c9[_0x2cbadd(0x1f6)]=this['_map']['scene'][_0x2cbadd(0x26d)][_0x2cbadd(0x25d)],_0x1d98c9['height']=this[_0x2cbadd(0x215)]['scene']['canvas'][_0x2cbadd(0x2d8)],_0x1d98c9;}['resize'](){const _0x5ed571=_0x394f56;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene'][_0x5ed571(0x26d)][_0x5ed571(0x25d)]+'px',this[_0x5ed571(0x26d)][_0x5ed571(0x267)]['height']=this[_0x5ed571(0x215)]['scene']['canvas'][_0x5ed571(0x2d8)]+'px',this[_0x5ed571(0x26d)][_0x5ed571(0x1f6)]=this['_map']['scene']['canvas'][_0x5ed571(0x25d)],this[_0x5ed571(0x26d)]['height']=this['_map'][_0x5ed571(0x200)][_0x5ed571(0x26d)]['clientHeight']);}['bindEvent'](){const _0xaca9e1=_0x394f56,_0x2cd1d7=this;let _0x2e2860=Date[_0xaca9e1(0x2d3)]();(function _0x44098e(){const _0x210d82=_0xaca9e1;_0x2cd1d7[_0x210d82(0x289)]=window['requestAnimationFrame'](_0x44098e);if(_0x2cd1d7['show']&&_0x2cd1d7[_0x210d82(0x2ae)]){const _0x229d73=Date[_0x210d82(0x2d3)](),_0x202cf3=_0x229d73-_0x2e2860;_0x202cf3>_0x2cd1d7['frameTime']&&(_0x2e2860=_0x229d73-_0x202cf3%_0x2cd1d7['frameTime'],_0x2cd1d7['update']());}}(),window['addEventListener']('resize',this[_0xaca9e1(0x1fd)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0xaca9e1(0x290)]&&(this[_0xaca9e1(0x215)]['on'](mars3d__namespace['EventType'][_0xaca9e1(0x2dc)],this['_onMapWhellEvent'],this),this[_0xaca9e1(0x215)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0xaca9e1(0x215)]['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}[_0x394f56(0x21b)](){const _0x123f86=_0x394f56;window[_0x123f86(0x2be)](this[_0x123f86(0x289)]),delete this[_0x123f86(0x289)],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this['_map']['off'](mars3d__namespace[_0x123f86(0x2c3)][_0x123f86(0x2dc)],this['_onMapWhellEvent'],this),this[_0x123f86(0x215)]['off'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x123f86(0x262)](mars3d__namespace['EventType'][_0x123f86(0x2ac)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x5071f7){const _0x4916aa=_0x394f56;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this['canvas'][_0x4916aa(0x267)]['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x2c4981=_0x4916aa;if(!this['show'])return;this['redraw'](),this[_0x2c4981(0x26d)]['style']['visibility']='visible';},0xc8);}[_0x394f56(0x2d0)](_0x817b29){const _0x383eac=_0x394f56;this['mouse_down']=!![],this['_map'][_0x383eac(0x262)](mars3d__namespace['EventType']['mouseMove'],this[_0x383eac(0x237)],this),this[_0x383eac(0x215)]['on'](mars3d__namespace['EventType'][_0x383eac(0x1fc)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x4dfd0d){const _0x128eed=_0x394f56;if(!this[_0x128eed(0x261)]||!this['canvas'])return;this['mouse_down']&&(this[_0x128eed(0x26d)]['style']['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x4aeba2){const _0x4c9c88=_0x394f56;if(!this['show']||!this['canvas'])return;this[_0x4c9c88(0x215)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this[_0x4c9c88(0x212)]=![],this[_0x4c9c88(0x222)]=![];}[_0x394f56(0x206)](_0x37368c){const _0x44b65e=_0x394f56;this[_0x44b65e(0x2bc)](),this['windData']=_0x37368c,this['windField']['setDate'](_0x37368c),this['redraw']();}[_0x394f56(0x27b)](){const _0x548687=_0x394f56;if(!this['show'])return;this[_0x548687(0x2ae)]['setOptions'](this['options']),this['update']();}[_0x394f56(0x2da)](){const _0x4ee60b=_0x394f56;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField']['update']();else{const _0x55f12c=this[_0x4ee60b(0x2ae)]['getParticles']();this['_drawLines'](_0x55f12c);}this[_0x4ee60b(0x225)]=![];}[_0x394f56(0x23a)](_0x3e514e){const _0x1dda83=_0x394f56;this[_0x1dda83(0x1fa)]['globalCompositeOperation']='destination-in',this['canvasContext'][_0x1dda83(0x2d1)](0x0,0x0,this['canvasWidth'],this[_0x1dda83(0x298)]),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x462512=this[_0x1dda83(0x215)]['scene'][_0x1dda83(0x299)]!==Cesium['SceneMode']['SCENE3D'],_0x19d37b=this[_0x1dda83(0x20b)]*0.25;if(this['_colorRamp'])for(let _0x30bb13=0x0,_0x232150=_0x3e514e['length'];_0x30bb13<_0x232150;_0x30bb13++){const _0x273124=_0x3e514e[_0x30bb13],_0x576024=this['_tomap'](_0x273124['lng'],_0x273124[_0x1dda83(0x241)],_0x273124),_0x37861d=this[_0x1dda83(0x1f4)](_0x273124['tlng'],_0x273124[_0x1dda83(0x25c)],_0x273124);if(!_0x576024||!_0x37861d)continue;if(_0x462512&&Math['abs'](_0x576024[0x0]-_0x37861d[0x0])>=_0x19d37b)continue;this[_0x1dda83(0x1fa)][_0x1dda83(0x2a5)](),this['canvasContext'][_0x1dda83(0x271)]=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp'][_0x1dda83(0x2b2)](_0x273124['speed']),this['canvasContext']['moveTo'](_0x576024[0x0],_0x576024[0x1]),this[_0x1dda83(0x1fa)][_0x1dda83(0x28c)](_0x37861d[0x0],_0x37861d[0x1]),this['canvasContext'][_0x1dda83(0x2c1)]();}else{this[_0x1dda83(0x1fa)][_0x1dda83(0x2a5)](),this['canvasContext']['lineWidth']=this['lineWidth'],this['canvasContext'][_0x1dda83(0x220)]=this['color'];for(let _0x150d05=0x0,_0x43bef3=_0x3e514e['length'];_0x150d05<_0x43bef3;_0x150d05++){const _0x313270=_0x3e514e[_0x150d05],_0x27fc88=this[_0x1dda83(0x1f4)](_0x313270['lng'],_0x313270['lat'],_0x313270),_0x2ab3ae=this['_tomap'](_0x313270[_0x1dda83(0x2c5)],_0x313270['tlat'],_0x313270);if(!_0x27fc88||!_0x2ab3ae)continue;if(_0x462512&&Math['abs'](_0x27fc88[0x0]-_0x2ab3ae[0x0])>=_0x19d37b)continue;this['canvasContext']['moveTo'](_0x27fc88[0x0],_0x27fc88[0x1]),this['canvasContext']['lineTo'](_0x2ab3ae[0x0],_0x2ab3ae[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x32b025,_0x59b834,_0x77e8e4){const _0x2343ea=_0x394f56,_0x3ea406=Cesium['Cartesian3']['fromDegrees'](_0x32b025,_0x59b834,this['fixedHeight']),_0x2fddbd=this['_map'][_0x2343ea(0x200)];if(_0x2fddbd[_0x2343ea(0x299)]===Cesium['SceneMode'][_0x2343ea(0x214)]){const _0x2e0fcf=new Cesium['EllipsoidalOccluder'](_0x2fddbd['globe']['ellipsoid'],_0x2fddbd['camera'][_0x2343ea(0x2a8)]),_0x200552=_0x2e0fcf['isPointVisible'](_0x3ea406);if(!_0x200552)return _0x77e8e4['age']=0x0,null;}const _0x1be0b9=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map'][_0x2343ea(0x200)],_0x3ea406);return _0x1be0b9?[_0x1be0b9['x'],_0x1be0b9['y']]:null;}[_0x394f56(0x2bc)](){const _0xc0b3ea=_0x394f56;this[_0xc0b3ea(0x2ae)]['clear'](),delete this['windData'];}['initWorker'](){const _0x6e470e=_0x394f56;this[_0x6e470e(0x272)]=new Worker(this[_0x6e470e(0x2d2)][_0x6e470e(0x272)]),this['worker'][_0x6e470e(0x2c2)]=_0x73cb8d=>{this['_drawLines'](_0x73cb8d['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0xb9ad86=>{const _0x23cb5b=_0x6e470e;this['worker'][_0x23cb5b(0x22c)]({'type':_0x23cb5b(0x1f5),'options':_0xb9ad86});},'setOptions':_0xd7c393=>{const _0x3c5ccb=_0x6e470e;this[_0x3c5ccb(0x272)]['postMessage']({'type':'setOptions','options':_0xd7c393});},'setDate':_0x481e87=>{const _0xd2f46a=_0x6e470e;this['worker'][_0xd2f46a(0x22c)]({'type':'setDate','data':_0x481e87});},'update':()=>{const _0x57ab91=_0x6e470e;if(this[_0x57ab91(0x24f)])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x1cb08f=_0x6e470e;this['worker'][_0x1cb08f(0x22c)]({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil'][_0x394f56(0x251)]('canvasWind',CanvasWindLayer),mars3d__namespace[_0x394f56(0x294)]['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,_0x394f56(0x2bf),{'value':!![]});
}));
