/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.16
 * 编译日期：2023-12-10 22:08:38
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x2f22c1=_0xf508;(function(_0x10693e,_0x5ef924){const _0xae9f3c=_0xf508,_0x4701d2=_0x10693e();while(!![]){try{const _0x2639c1=-parseInt(_0xae9f3c(0xda))/0x1*(-parseInt(_0xae9f3c(0x148))/0x2)+-parseInt(_0xae9f3c(0xe5))/0x3+parseInt(_0xae9f3c(0xb2))/0x4+-parseInt(_0xae9f3c(0xfd))/0x5*(-parseInt(_0xae9f3c(0x12c))/0x6)+parseInt(_0xae9f3c(0xc5))/0x7*(-parseInt(_0xae9f3c(0x10f))/0x8)+parseInt(_0xae9f3c(0x152))/0x9*(parseInt(_0xae9f3c(0xb4))/0xa)+-parseInt(_0xae9f3c(0x17e))/0xb;if(_0x2639c1===_0x5ef924)break;else _0x4701d2['push'](_0x4701d2['shift']());}catch(_0x8e1830){_0x4701d2['push'](_0x4701d2['shift']());}}}(_0x1e6e,0x97aa3));function _interopNamespace(_0x5d3a4a){if(_0x5d3a4a&&_0x5d3a4a['__esModule'])return _0x5d3a4a;var _0x5a49fd=Object['create'](null);return _0x5d3a4a&&Object['keys'](_0x5d3a4a)['forEach'](function(_0x259d0c){const _0x221bea=_0xf508;if(_0x259d0c!==_0x221bea(0x132)){var _0x1b9d13=Object['getOwnPropertyDescriptor'](_0x5d3a4a,_0x259d0c);Object['defineProperty'](_0x5a49fd,_0x259d0c,_0x1b9d13['get']?_0x1b9d13:{'enumerable':!![],'get':function(){return _0x5d3a4a[_0x259d0c];}});}}),_0x5a49fd['default']=_0x5d3a4a,_0x5a49fd;}var mars3d__namespace=_interopNamespace(mars3d);function _0xf508(_0x1da29d,_0x34e236){const _0x1e6e29=_0x1e6e();return _0xf508=function(_0x23fc77,_0x1a1511){_0x23fc77=_0x23fc77-0xab;let _0x279faf=_0x1e6e29[_0x23fc77];return _0x279faf;},_0xf508(_0x1da29d,_0x34e236);}const Cesium$7=mars3d__namespace['Cesium'];function getU(_0xdc424c,_0x3cdf31){const _0x5710eb=_0xf508,_0x19769c=_0xdc424c*Math[_0x5710eb(0xf3)](Cesium$7['Math']['toRadians'](_0x3cdf31));return _0x19769c;}function getV(_0x4674bc,_0x184b55){const _0x1f7b8c=_0xf508,_0xc5192b=_0x4674bc*Math[_0x1f7b8c(0x125)](Cesium$7[_0x1f7b8c(0x189)][_0x1f7b8c(0x15d)](_0x184b55));return _0xc5192b;}function getSpeed(_0x5c8f39,_0x59f91f){const _0x33d875=_0xf508,_0x724832=Math['sqrt'](Math[_0x33d875(0x12f)](_0x5c8f39,0x2)+Math[_0x33d875(0x12f)](_0x59f91f,0x2));return _0x724832;}function getDirection(_0x17c7af,_0x122bfa){let _0x31fc4d=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x122bfa,_0x17c7af));return _0x31fc4d+=_0x31fc4d<0x0?0x168:0x0,_0x31fc4d;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x2f22c1(0x103)];class CustomPrimitive{constructor(_0x4eab2a){const _0x4ea9b3=_0x2f22c1;this['commandType']=_0x4eab2a[_0x4ea9b3(0xe0)],this[_0x4ea9b3(0x15b)]=_0x4eab2a['geometry'],this['attributeLocations']=_0x4eab2a['attributeLocations'],this[_0x4ea9b3(0xeb)]=_0x4eab2a[_0x4ea9b3(0xeb)],this['uniformMap']=_0x4eab2a['uniformMap'],this['vertexShaderSource']=_0x4eab2a['vertexShaderSource'],this[_0x4ea9b3(0x13f)]=_0x4eab2a['fragmentShaderSource'],this['rawRenderState']=_0x4eab2a['rawRenderState'],this['framebuffer']=_0x4eab2a[_0x4ea9b3(0x175)],this[_0x4ea9b3(0xf6)]=_0x4eab2a[_0x4ea9b3(0xf6)],this[_0x4ea9b3(0xcf)]=_0x4eab2a['autoClear']??![],this['preExecute']=_0x4eab2a['preExecute'],this['show']=!![],this[_0x4ea9b3(0x13b)]=undefined,this[_0x4ea9b3(0x14d)]=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this[_0x4ea9b3(0x175)],'pass':Cesium$6[_0x4ea9b3(0x155)]['OPAQUE']}));}[_0x2f22c1(0xab)](_0x3469a4){const _0x29cdb6=_0x2f22c1;switch(this['commandType']){case'Draw':{const _0x187d7c=Cesium$6['VertexArray']['fromGeometry']({'context':_0x3469a4,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage'][_0x29cdb6(0xc9)]}),_0x1dbfbb=Cesium$6['ShaderProgram']['fromCache']({'context':_0x3469a4,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x53eef0=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x1dbfbb,'vertexArray':_0x187d7c,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x53eef0,'uniformMap':this[_0x29cdb6(0x107)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this[_0x29cdb6(0x13f)],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x4b2b14,_0x4ee2c3){const _0x4ac0d2=_0x2f22c1;this['geometry']=_0x4ee2c3;const _0x39f7d2=Cesium$6[_0x4ac0d2(0xec)][_0x4ac0d2(0x181)]({'context':_0x4b2b14,'geometry':this['geometry'],'attributeLocations':this[_0x4ac0d2(0xc6)],'bufferUsage':Cesium$6['BufferUsage'][_0x4ac0d2(0xc9)]});this[_0x4ac0d2(0x13b)]['vertexArray']=_0x39f7d2;}[_0x2f22c1(0x11f)](_0x21ab84){const _0x47f186=_0x2f22c1;if(!this[_0x47f186(0xe2)])return;if(_0x21ab84['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this[_0x47f186(0x13b)])&&(this['commandToExecute']=this['createCommand'](_0x21ab84[_0x47f186(0x11e)])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x21ab84['commandList']['push'](this[_0x47f186(0x14d)]),_0x21ab84['commandList'][_0x47f186(0x167)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x506a36=_0x2f22c1;if(this[_0x506a36(0x14d)]){var _0x277b90,_0x4c1dca;(_0x277b90=this['clearCommand'])!==null&&_0x277b90!==void 0x0&&_0x277b90['vertexArray']&&this[_0x506a36(0x14d)]['vertexArray']['destroy'](),(_0x4c1dca=this[_0x506a36(0x14d)])!==null&&_0x4c1dca!==void 0x0&&_0x4c1dca[_0x506a36(0x101)]&&this['clearCommand'][_0x506a36(0x101)]['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute'][_0x506a36(0xb8)]&&this['commandToExecute'][_0x506a36(0xb8)]['destroy'](),this[_0x506a36(0x13b)]['shaderProgram']&&this['commandToExecute'][_0x506a36(0x101)][_0x506a36(0xac)](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x20bd37=function(){const _0x23aab5=_0xf508,_0x19d393=new Cesium$5[(_0x23aab5(0x172))]({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype'][_0x23aab5(0x185)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x19d393;},_0x3cc840=function(_0x45eca8,_0x4a341e){if(Cesium$5['defined'](_0x4a341e)){const _0x464df5={};_0x464df5['arrayBufferView']=_0x4a341e,_0x45eca8['source']=_0x464df5;}const _0x3fd35d=new Cesium$5['Texture'](_0x45eca8);return _0x3fd35d;},_0x457e07=function(_0x26818a,_0x5aaced,_0x5599a1){const _0x51bec9=new Cesium$5['Framebuffer']({'context':_0x26818a,'colorTextures':[_0x5aaced],'depthTexture':_0x5599a1});return _0x51bec9;},_0x1a09ed=function(_0x126fd3){const _0x484b02=!![],_0x21759e=![],_0x3a11a8={'viewport':_0x126fd3['viewport'],'depthTest':_0x126fd3['depthTest'],'depthMask':_0x126fd3['depthMask'],'blending':_0x126fd3['blending']},_0x1fdb62=Cesium$5['Appearance']['getDefaultRenderState'](_0x484b02,_0x21759e,_0x3a11a8);return _0x1fdb62;},_0x1f91dd=function(_0x353d70){const _0x19a23a=_0xf508,_0x3a40e4={},_0x1b8c26=Cesium$5[_0x19a23a(0x189)]['mod'](_0x353d70['west'],Cesium$5['Math']['TWO_PI']),_0x40606d=Cesium$5['Math']['mod'](_0x353d70['east'],Cesium$5['Math']['TWO_PI']),_0xd518f3=_0x353d70['width'];let _0x490de8,_0x4f78d0;_0xd518f3>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x490de8=0x0,_0x4f78d0=Cesium$5[_0x19a23a(0x189)][_0x19a23a(0x164)]):_0x40606d-_0x1b8c26<_0xd518f3?(_0x490de8=_0x1b8c26,_0x4f78d0=_0x1b8c26+_0xd518f3):(_0x490de8=_0x1b8c26,_0x4f78d0=_0x40606d);_0x3a40e4['lon']={'min':Cesium$5[_0x19a23a(0x189)]['toDegrees'](_0x490de8),'max':Cesium$5[_0x19a23a(0x189)]['toDegrees'](_0x4f78d0)};const _0x5aa84f=_0x353d70[_0x19a23a(0x14a)],_0x52ed70=_0x353d70['north'],_0x4c6438=_0x353d70['height'],_0x33142b=_0x4c6438>Cesium$5[_0x19a23a(0x189)]['PI']/0xc?_0x4c6438/0x2:0x0;let _0x36fa8c=Cesium$5['Math']['clampToLatitudeRange'](_0x5aa84f-_0x33142b),_0x2b474b=Cesium$5['Math'][_0x19a23a(0x18f)](_0x52ed70+_0x33142b);return _0x36fa8c<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x36fa8c=-Cesium$5[_0x19a23a(0x189)]['PI_OVER_TWO']),_0x2b474b>Cesium$5['Math']['PI_OVER_THREE']&&(_0x2b474b=Cesium$5['Math']['PI_OVER_TWO']),_0x3a40e4['lat']={'min':Cesium$5['Math']['toDegrees'](_0x36fa8c),'max':Cesium$5['Math']['toDegrees'](_0x2b474b)},_0x3a40e4;};return{'getFullscreenQuad':_0x20bd37,'createTexture':_0x3cc840,'createFramebuffer':_0x457e07,'createRawRenderState':_0x1a09ed,'viewRectangleToLonLatRange':_0x1f91dd};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x2f22c1(0x103)];class ParticlesRendering{constructor(_0x4e9f96,_0x5edbda,_0x38f813,_0x1d022d,_0x4e6ccf){const _0x3d1490=_0x2f22c1;this[_0x3d1490(0xc2)](_0x4e9f96,_0x5edbda,_0x38f813['colors']),this['createRenderingFramebuffers'](_0x4e9f96),this['createRenderingPrimitives'](_0x4e9f96,_0x38f813,_0x1d022d,_0x4e6ccf);}['createRenderingTextures'](_0x3a7bdd,_0x3f0a7d,_0x1df495){const _0x13f03f=_0x2f22c1,_0x5d27f5={'context':_0x3a7bdd,'width':_0x3a7bdd[_0x13f03f(0x11b)],'height':_0x3a7bdd[_0x13f03f(0x198)],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4[_0x13f03f(0xe4)][_0x13f03f(0xb9)]},_0x37f10e={'context':_0x3a7bdd,'width':_0x3a7bdd[_0x13f03f(0x11b)],'height':_0x3a7bdd['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x13f03f(0xf4)][_0x13f03f(0xf9)],'pixelDatatype':Cesium$4[_0x13f03f(0xe4)]['UNSIGNED_INT']},_0x454775=_0x1df495['length'],_0x466b4d=new Float32Array(_0x454775*0x3);for(let _0x513b7c=0x0;_0x513b7c<_0x454775;_0x513b7c++){const _0x5ed55b=Cesium$4[_0x13f03f(0x154)]['fromCssColorString'](_0x1df495[_0x513b7c]);_0x466b4d[0x3*_0x513b7c]=_0x5ed55b['red'],_0x466b4d[0x3*_0x513b7c+0x1]=_0x5ed55b['green'],_0x466b4d[0x3*_0x513b7c+0x2]=_0x5ed55b[_0x13f03f(0xe9)];}const _0x210100={'context':_0x3a7bdd,'width':_0x454775,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x13f03f(0xe4)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x13f03f(0x126)]['LINEAR'],'magnificationFilter':Cesium$4[_0x13f03f(0x192)]['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x5d27f5),'segmentsDepth':Util['createTexture'](_0x37f10e),'currentTrailsColor':Util[_0x13f03f(0xdd)](_0x5d27f5),'currentTrailsDepth':Util['createTexture'](_0x37f10e),'nextTrailsColor':Util['createTexture'](_0x5d27f5),'nextTrailsDepth':Util[_0x13f03f(0xdd)](_0x37f10e),'colorTable':Util['createTexture'](_0x210100,_0x466b4d)};}[_0x2f22c1(0x18e)](_0x4a3b7e){const _0x1f61aa=_0x2f22c1;this[_0x1f61aa(0xb1)]={'segments':Util['createFramebuffer'](_0x4a3b7e,this['textures']['segmentsColor'],this['textures']['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x4a3b7e,this['textures'][_0x1f61aa(0x18c)],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x4a3b7e,this['textures']['nextTrailsColor'],this['textures'][_0x1f61aa(0x16c)])};}['createSegmentsGeometry'](_0x1c9335){const _0x3c4e43=_0x2f22c1,_0x3d38fb=0x4;let _0x58de73=[];for(let _0x267fd8=0x0;_0x267fd8<_0x1c9335[_0x3c4e43(0x116)];_0x267fd8++){for(let _0x74603b=0x0;_0x74603b<_0x1c9335[_0x3c4e43(0x116)];_0x74603b++){for(let _0x32cdad=0x0;_0x32cdad<_0x3d38fb;_0x32cdad++){_0x58de73['push'](_0x267fd8/_0x1c9335['particlesTextureSize']),_0x58de73[_0x3c4e43(0x167)](_0x74603b/_0x1c9335['particlesTextureSize']);}}}_0x58de73=new Float32Array(_0x58de73);let _0x13d7ca=[];const _0x50bbdc=[-0x1,0x1],_0x9c5075=[-0x1,0x1];for(let _0x1b3e5c=0x0;_0x1b3e5c<_0x1c9335[_0x3c4e43(0xb6)];_0x1b3e5c++){for(let _0x2f60b9=0x0;_0x2f60b9<_0x3d38fb/0x2;_0x2f60b9++){for(let _0x4aaefd=0x0;_0x4aaefd<_0x3d38fb/0x2;_0x4aaefd++){_0x13d7ca['push'](_0x50bbdc[_0x2f60b9]),_0x13d7ca['push'](_0x9c5075[_0x4aaefd]),_0x13d7ca['push'](0x0);}}}_0x13d7ca=new Float32Array(_0x13d7ca);const _0x31a789=0x6*_0x1c9335['maxParticles'],_0x5c6c0b=new Uint32Array(_0x31a789);for(let _0x373931=0x0,_0x241db4=0x0,_0x4d163f=0x0;_0x373931<_0x1c9335[_0x3c4e43(0xb6)];_0x373931++){_0x5c6c0b[_0x241db4++]=_0x4d163f+0x0,_0x5c6c0b[_0x241db4++]=_0x4d163f+0x1,_0x5c6c0b[_0x241db4++]=_0x4d163f+0x2,_0x5c6c0b[_0x241db4++]=_0x4d163f+0x2,_0x5c6c0b[_0x241db4++]=_0x4d163f+0x1,_0x5c6c0b[_0x241db4++]=_0x4d163f+0x3,_0x4d163f+=0x4;}const _0x134646=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x58de73}),'normal':new Cesium$4[(_0x3c4e43(0x131))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x13d7ca})}),'indices':_0x5c6c0b});return _0x134646;}['createRenderingPrimitives'](_0x310efb,_0x435cc3,_0x1bc19f,_0x24e837){const _0x5236ea=_0x2f22c1,_0x262913=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x435cc3),'primitiveType':Cesium$4['PrimitiveType'][_0x5236ea(0xe7)],'uniformMap':{'currentParticlesPosition':function(){return _0x24e837['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x331c76=_0x5236ea;return _0x24e837[_0x331c76(0x151)][_0x331c76(0x106)];},'postProcessingSpeed':function(){return _0x24e837['particlesTextures']['postProcessingSpeed'];},'colorTable':function(){const _0x5d85f0=_0x5236ea;return _0x262913['textures'][_0x5d85f0(0x11d)];},'aspect':function(){const _0x3b330b=_0x5236ea;return _0x310efb[_0x3b330b(0x11b)]/_0x310efb['drawingBufferHeight'];},'pixelSize':function(){return _0x1bc19f['pixelSize'];},'lineWidth':function(){return _0x435cc3['lineWidth'];},'particleHeight':function(){return _0x435cc3['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x5236ea(0x10e)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x5236ea(0x162)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x5236ea(0x130)][_0x5236ea(0xe7)],'uniformMap':{'segmentsColorTexture':function(){const _0x758a2f=_0x5236ea;return _0x262913['textures'][_0x758a2f(0x134)];},'segmentsDepthTexture':function(){return _0x262913['textures']['segmentsDepth'];},'currentTrailsColor':function(){const _0x421f15=_0x5236ea;return _0x262913[_0x421f15(0xb1)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x307fa0=_0x5236ea;return _0x262913['framebuffers'][_0x307fa0(0x129)]['depthTexture'];},'fadeOpacity':function(){return _0x435cc3['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x5236ea(0xf0))]({'defines':[_0x5236ea(0xee)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0x5236ea(0x113)][_0x5236ea(0x16a)]},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x1b5d58=_0x5236ea,_0x3ed69c=_0x262913['framebuffers'][_0x1b5d58(0x129)];_0x262913['framebuffers'][_0x1b5d58(0x129)]=_0x262913['framebuffers']['nextTrails'],_0x262913[_0x1b5d58(0xb1)]['nextTrails']=_0x3ed69c,_0x262913['primitives']['trails']['commandToExecute']['framebuffer']=_0x262913[_0x1b5d58(0xb1)]['nextTrails'],_0x262913['primitives']['trails']['clearCommand']['framebuffer']=_0x262913['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x4ca24c=_0x5236ea;return _0x262913['framebuffers']['nextTrails'][_0x4ca24c(0x17f)](0x0);},'trailsDepthTexture':function(){const _0x2d9eac=_0x5236ea;return _0x262913['framebuffers'][_0x2d9eac(0x115)][_0x2d9eac(0xd3)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x5236ea(0x10e)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x2f22c1(0xf7),updateSpeed_frag=_0x2f22c1(0x15c),updatePosition_frag=_0x2f22c1(0xb7),postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x237f99,_0x3beb9f,_0x3e8966,_0x106509){const _0x36d6d4=_0x2f22c1;this['data']=_0x3beb9f,this[_0x36d6d4(0x124)](_0x237f99,_0x3beb9f),this['createParticlesTextures'](_0x237f99,_0x3e8966,_0x106509),this[_0x36d6d4(0x16f)](_0x3beb9f,_0x3e8966,_0x106509);}['createWindTextures'](_0x56d6b6,_0x460f87){const _0x56f833=_0x2f22c1,_0x1ad1c5={'context':_0x56d6b6,'width':_0x460f87['dimensions']['lon'],'height':_0x460f87[_0x56f833(0xcc)]['lat']*(_0x460f87['dimensions'][_0x56f833(0x153)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x56f833(0xd1)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x56f833(0x126)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x1ad1c5,_0x460f87['U']['array']),'V':Util[_0x56f833(0xdd)](_0x1ad1c5,_0x460f87['V']['array'])};}['createParticlesTextures'](_0x311c20,_0x5d7ccb,_0x463cc3){const _0x493053=_0x2f22c1,_0x19c4e5={'context':_0x311c20,'width':_0x5d7ccb['particlesTextureSize'],'height':_0x5d7ccb['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x493053(0x185)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x493053(0x126)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x493053(0x109)]})},_0x56cd80=this[_0x493053(0x14c)](_0x5d7ccb['maxParticles'],_0x463cc3),_0xbb8b7e=new Float32Array(0x4*_0x5d7ccb['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x19c4e5),'currentParticlesPosition':Util['createTexture'](_0x19c4e5,_0x56cd80),'nextParticlesPosition':Util['createTexture'](_0x19c4e5,_0x56cd80),'currentParticlesSpeed':Util[_0x493053(0xdd)](_0x19c4e5,_0xbb8b7e),'nextParticlesSpeed':Util['createTexture'](_0x19c4e5,_0xbb8b7e),'postProcessingPosition':Util['createTexture'](_0x19c4e5,_0x56cd80),'postProcessingSpeed':Util[_0x493053(0xdd)](_0x19c4e5,_0xbb8b7e)};}['randomizeParticles'](_0x4ff92d,_0x4e551f){const _0x4a39dc=_0x2f22c1,_0x5c1629=new Float32Array(0x4*_0x4ff92d);for(let _0x5841fa=0x0;_0x5841fa<_0x4ff92d;_0x5841fa++){_0x5c1629[0x4*_0x5841fa]=Cesium$3[_0x4a39dc(0x189)][_0x4a39dc(0x10a)](_0x4e551f['lonRange']['x'],_0x4e551f['lonRange']['y']),_0x5c1629[0x4*_0x5841fa+0x1]=Cesium$3['Math']['randomBetween'](_0x4e551f['latRange']['x'],_0x4e551f['latRange']['y']),_0x5c1629[0x4*_0x5841fa+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev'][_0x4a39dc(0x127)],this[_0x4a39dc(0x183)]['lev']['max']),_0x5c1629[0x4*_0x5841fa+0x3]=0x0;}return _0x5c1629;}[_0x2f22c1(0xfb)](){Object['keys'](this['particlesTextures'])['forEach'](_0x4064d4=>{const _0x28b535=_0xf508;this['particlesTextures'][_0x4064d4][_0x28b535(0xac)]();});}['createComputingPrimitives'](_0x309f7e,_0x556d5f,_0x5cac8b){const _0xd4e60f=_0x2f22c1,_0x3513b0=new Cesium$3['Cartesian3'](_0x309f7e['dimensions']['lon'],_0x309f7e[_0xd4e60f(0xcc)]['lat'],_0x309f7e['dimensions']['lev']),_0x5948b1=new Cesium$3['Cartesian3'](_0x309f7e['lon']['min'],_0x309f7e['lat']['min'],_0x309f7e['lev']['min']),_0x190aa4=new Cesium$3['Cartesian3'](_0x309f7e['lon']['max'],_0x309f7e['lat'][_0xd4e60f(0x195)],_0x309f7e['lev']['max']),_0x2b569b=new Cesium$3['Cartesian3']((_0x190aa4['x']-_0x5948b1['x'])/(_0x3513b0['x']-0x1),(_0x190aa4['y']-_0x5948b1['y'])/(_0x3513b0['y']-0x1),_0x3513b0['z']>0x1?(_0x190aa4['z']-_0x5948b1['z'])/(_0x3513b0['z']-0x1):0x1),_0x588b59=new Cesium$3['Cartesian2'](_0x309f7e['U']['min'],_0x309f7e['U'][_0xd4e60f(0x195)]),_0x295567=new Cesium$3[(_0xd4e60f(0xe3))](_0x309f7e['V'][_0xd4e60f(0x127)],_0x309f7e['V'][_0xd4e60f(0x195)]),_0xe6df0b=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x464872=_0xd4e60f;return _0xe6df0b[_0x464872(0x194)]['U'];},'V':function(){const _0x415cb8=_0xd4e60f;return _0xe6df0b[_0x415cb8(0x194)]['V'];},'currentParticlesPosition':function(){const _0x28230b=_0xd4e60f;return _0xe6df0b[_0x28230b(0x151)]['currentParticlesPosition'];},'dimension':function(){return _0x3513b0;},'minimum':function(){return _0x5948b1;},'maximum':function(){return _0x190aa4;},'interval':function(){return _0x2b569b;}},'fragmentShaderSource':new Cesium$3[(_0xd4e60f(0xf0))]({'sources':[getWind_frag]}),'outputTexture':this[_0xd4e60f(0x151)]['particlesWind'],'preExecute':function(){const _0x5d6e61=_0xd4e60f;_0xe6df0b['primitives']['getWind'][_0x5d6e61(0x13b)][_0x5d6e61(0xf6)]=_0xe6df0b['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0xd4e60f(0x176),'uniformMap':{'currentParticlesSpeed':function(){const _0x3fac37=_0xd4e60f;return _0xe6df0b[_0x3fac37(0x151)]['currentParticlesSpeed'];},'particlesWind':function(){return _0xe6df0b['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x588b59;},'vSpeedRange':function(){return _0x295567;},'pixelSize':function(){return _0x5cac8b['pixelSize'];},'speedFactor':function(){const _0x111689=_0xd4e60f;return _0x556d5f[_0x111689(0x105)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x584f3e=_0xd4e60f,_0x3ec655=_0xe6df0b['particlesTextures']['currentParticlesSpeed'];_0xe6df0b['particlesTextures']['currentParticlesSpeed']=_0xe6df0b[_0x584f3e(0x151)][_0x584f3e(0xbd)],_0xe6df0b['particlesTextures']['postProcessingSpeed']=_0x3ec655,_0xe6df0b['primitives'][_0x584f3e(0x102)][_0x584f3e(0x13b)][_0x584f3e(0xf6)]=_0xe6df0b['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0xe6df0b['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0xc2c11f=_0xd4e60f;return _0xe6df0b['particlesTextures'][_0xc2c11f(0x163)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0xd4e60f(0x151)][_0xd4e60f(0xf1)],'preExecute':function(){const _0x1be057=_0xd4e60f,_0x46d5d7=_0xe6df0b['particlesTextures']['currentParticlesPosition'];_0xe6df0b['particlesTextures']['currentParticlesPosition']=_0xe6df0b['particlesTextures']['postProcessingPosition'],_0xe6df0b['particlesTextures']['postProcessingPosition']=_0x46d5d7,_0xe6df0b['primitives']['updatePosition'][_0x1be057(0x13b)]['outputTexture']=_0xe6df0b['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x3618cf=_0xd4e60f;return _0xe6df0b[_0x3618cf(0x151)][_0x3618cf(0xf1)];},'nextParticlesSpeed':function(){const _0x3a42f2=_0xd4e60f;return _0xe6df0b[_0x3a42f2(0x151)]['nextParticlesSpeed'];},'lonRange':function(){return _0x5cac8b['lonRange'];},'latRange':function(){return _0x5cac8b['latRange'];},'randomCoefficient':function(){const _0xff5be2=Math['random']();return _0xff5be2;},'dropRate':function(){return _0x556d5f['dropRate'];},'dropRateBump':function(){return _0x556d5f['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0xd4e60f(0x151)]['postProcessingPosition'],'preExecute':function(){const _0x6a471a=_0xd4e60f;_0xe6df0b['primitives']['postProcessingPosition'][_0x6a471a(0x13b)]['outputTexture']=_0xe6df0b['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0xd4e60f(0x176),'uniformMap':{'postProcessingPosition':function(){const _0x16a39e=_0xd4e60f;return _0xe6df0b[_0x16a39e(0x151)]['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0xe6df0b['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0xd4e60f(0x151)]['postProcessingSpeed'],'preExecute':function(){const _0x41d4ce=_0xd4e60f;_0xe6df0b['primitives']['postProcessingSpeed']['commandToExecute'][_0x41d4ce(0xf6)]=_0xe6df0b['particlesTextures'][_0x41d4ce(0xbd)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0xb9ff96,_0x33c7b2,_0x5aab88,_0x55de83){const _0x34a65b=_0x2f22c1;this['context']=_0xb9ff96,_0x33c7b2={..._0x33c7b2},_0x33c7b2['udata']&&_0x33c7b2[_0x34a65b(0x171)]&&(_0x33c7b2['dimensions']={},_0x33c7b2['dimensions'][_0x34a65b(0xcd)]=_0x33c7b2['cols'],_0x33c7b2[_0x34a65b(0xcc)]['lat']=_0x33c7b2['rows'],_0x33c7b2['dimensions'][_0x34a65b(0x153)]=_0x33c7b2[_0x34a65b(0x153)]||0x1,_0x33c7b2[_0x34a65b(0xcd)]={},_0x33c7b2['lon']['min']=_0x33c7b2['xmin'],_0x33c7b2['lon']['max']=_0x33c7b2[_0x34a65b(0x119)],_0x33c7b2[_0x34a65b(0x16e)]={},_0x33c7b2['lat']['min']=_0x33c7b2['ymin'],_0x33c7b2['lat'][_0x34a65b(0x195)]=_0x33c7b2[_0x34a65b(0x17d)],_0x33c7b2[_0x34a65b(0x153)]={},_0x33c7b2['lev'][_0x34a65b(0x127)]=_0x33c7b2['levmin']??0x1,_0x33c7b2['lev']['max']=_0x33c7b2[_0x34a65b(0x168)]??0x1,_0x33c7b2['U']={},_0x33c7b2['U']['array']=new Float32Array(_0x33c7b2['udata']),_0x33c7b2['U']['min']=_0x33c7b2[_0x34a65b(0x12b)]??Math['min'](..._0x33c7b2[_0x34a65b(0xad)]),_0x33c7b2['U']['max']=_0x33c7b2[_0x34a65b(0x139)]??Math['max'](..._0x33c7b2['udata']),_0x33c7b2['V']={},_0x33c7b2['V']['array']=new Float32Array(_0x33c7b2[_0x34a65b(0x171)]),_0x33c7b2['V']['min']=_0x33c7b2['vmin']??Math['min'](..._0x33c7b2[_0x34a65b(0x171)]),_0x33c7b2['V']['max']=_0x33c7b2['vmax']??Math[_0x34a65b(0x195)](..._0x33c7b2['vdata'])),this['data']=_0x33c7b2,this['options']=_0x5aab88,this['viewerParameters']=_0x55de83,this[_0x34a65b(0xbc)]=new ParticlesComputing(this[_0x34a65b(0x11e)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x34a65b(0x183)],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x2f22c1(0x15f)](_0x1c0e31){const _0x318180=_0x2f22c1;this[_0x318180(0xbc)][_0x318180(0xfb)](),Object[_0x318180(0xba)](this['particlesComputing']['windTextures'])['forEach'](_0x4c742b=>{this['particlesComputing']['windTextures'][_0x4c742b]['destroy']();}),this['particlesRendering'][_0x318180(0xd8)]['colorTable'][_0x318180(0xac)](),Object[_0x318180(0xba)](this['particlesRendering']['framebuffers'])['forEach'](_0x8c5fb4=>{this['particlesRendering']['framebuffers'][_0x8c5fb4]['destroy']();}),this['context']=_0x1c0e31,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this[_0x318180(0x193)],this['viewerParameters'],this[_0x318180(0xbc)]);}['clearFramebuffers'](){const _0x4f45b4=_0x2f22c1,_0x253282=new Cesium$2[(_0x4f45b4(0xff))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x4f45b4(0x140)]});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x1c0b7e=>{const _0x26860f=_0x4f45b4;_0x253282['framebuffer']=this['particlesRendering']['framebuffers'][_0x1c0b7e],_0x253282[_0x26860f(0xdf)](this['context']);});}['refreshParticles'](_0x338056){const _0x1a4393=_0x2f22c1;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this['particlesComputing']['createParticlesTextures'](this['context'],this[_0x1a4393(0x193)],this[_0x1a4393(0xd4)]);if(_0x338056){var _0x531f4b;const _0x5728c8=this['particlesRendering'][_0x1a4393(0xc1)](this['options']);this[_0x1a4393(0xed)]['primitives']['segments'][_0x1a4393(0x15b)]=_0x5728c8;const _0x2d8748=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x5728c8,'attributeLocations':this['particlesRendering']['primitives'][_0x1a4393(0x162)][_0x1a4393(0xc6)],'bufferUsage':Cesium$2[_0x1a4393(0x156)]['STATIC_DRAW']});(_0x531f4b=this[_0x1a4393(0xed)]['primitives'])!==null&&_0x531f4b!==void 0x0&&(_0x531f4b=_0x531f4b['segments'])!==null&&_0x531f4b!==void 0x0&&_0x531f4b[_0x1a4393(0x13b)]&&(this['particlesRendering'][_0x1a4393(0x197)]['segments'][_0x1a4393(0x13b)]['vertexArray']=_0x2d8748);}}['setOptions'](_0x347dc7){const _0x350489=_0x2f22c1;let _0x162599=![];this['options']['maxParticles']!==_0x347dc7[_0x350489(0xb6)]&&(_0x162599=!![]),Object['keys'](_0x347dc7)['forEach'](_0x529e70=>{this['options'][_0x529e70]=_0x347dc7[_0x529e70];}),this['refreshParticles'](_0x162599);}['applyViewerParameters'](_0x34e2eb){const _0x27dd2b=_0x2f22c1;Object['keys'](_0x34e2eb)['forEach'](_0xa6522=>{this['viewerParameters'][_0xa6522]=_0x34e2eb[_0xa6522];}),this[_0x27dd2b(0x110)](![]);}['destroy'](){const _0x9ba53b=_0x2f22c1;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object[_0x9ba53b(0xba)](this[_0x9ba53b(0xbc)][_0x9ba53b(0x194)])['forEach'](_0x331a63=>{this['particlesComputing']['windTextures'][_0x331a63]['destroy']();}),this[_0x9ba53b(0xed)]['textures'][_0x9ba53b(0x11d)][_0x9ba53b(0xac)](),Object[_0x9ba53b(0xba)](this['particlesRendering']['framebuffers'])[_0x9ba53b(0x160)](_0x2e7db7=>{const _0x2fa177=_0x9ba53b;this['particlesRendering'][_0x2fa177(0xb1)][_0x2e7db7]['destroy']();});for(const _0x4ccac5 in this){delete this[_0x4ccac5];}}}const Cesium$1=mars3d__namespace[_0x2f22c1(0x103)],BaseLayer$1=mars3d__namespace[_0x2f22c1(0x123)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x2f22c1(0x15a)]};class WindLayer extends BaseLayer$1{constructor(_0x3915b4={}){const _0x2000ee=_0x2f22c1;_0x3915b4={...DEF_OPTIONS,..._0x3915b4},super(_0x3915b4),this[_0x2000ee(0x178)](_0x3915b4);}get[_0x2f22c1(0x123)](){return this['primitives'];}get[_0x2f22c1(0x183)](){return this['_data'];}set['data'](_0x2f99d3){this['setData'](_0x2f99d3);}get['colors'](){const _0x4fa268=_0x2f22c1;return this['options'][_0x4fa268(0x10b)];}set['colors'](_0x4b9c26){const _0x186a54=_0x2f22c1;this['options'][_0x186a54(0x10b)]=_0x4b9c26,this['particleSystem']&&this['particleSystem'][_0x186a54(0x187)]({'colors':_0x4b9c26}),this[_0x186a54(0x144)]();}['_mountedHook'](){}[_0x2f22c1(0x136)](){const _0x4884e9=_0x2f22c1;this[_0x4884e9(0x12d)]=this['_map']['scene'],this['camera']=this['_map'][_0x4884e9(0xaf)],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map']['scene'][_0x4884e9(0x197)]['add'](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3'][_0x4884e9(0x184)],0.99*0x615299),this[_0x4884e9(0x149)](),window['addEventListener'](_0x4884e9(0x144),this[_0x4884e9(0x144)][_0x4884e9(0x128)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x4884e9(0xde)]['on'](mars3d__namespace[_0x4884e9(0x174)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace[_0x4884e9(0x174)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x4884e9(0xea)](this['_data']);}[_0x2f22c1(0x100)](){const _0x562073=_0x2f22c1;window[_0x562073(0x11a)]('resize',this[_0x562073(0x144)]),this['_map']['off'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map'][_0x562073(0x135)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x562073(0x135)](mars3d__namespace[_0x562073(0x174)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x562073(0x135)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x562073(0x135)](mars3d__namespace['EventType']['mouseMove'],this[_0x562073(0x11c)],this),this['primitives']['removeAll'](),this[_0x562073(0xde)][_0x562073(0x12d)]['primitives']['remove'](this['primitives']);}[_0x2f22c1(0x144)](){const _0x26b976=_0x2f22c1;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this[_0x26b976(0xde)]['once'](mars3d__namespace['EventType'][_0x26b976(0x12e)],this['_onMap_preRenderEvent'],this);}[_0x2f22c1(0xf5)](_0x419059){const _0x615355=_0x2f22c1;this[_0x615355(0xc7)][_0x615355(0x15f)](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x2f22c1(0xe8)](_0x2adaae){const _0x2886dd=_0x2f22c1;clearTimeout(this[_0x2886dd(0x108)]);if(!this[_0x2886dd(0xe2)]||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}[_0x2f22c1(0xd9)](_0xf9c727){const _0x476eaf=_0x2f22c1;this[_0x476eaf(0x12a)]=!![];}['_onMouseMoveEvent'](_0x42a0c7){const _0x165164=_0x2f22c1;if(!this['show']||!this[_0x165164(0xc7)])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}[_0x2f22c1(0xae)](_0x5f12ab){const _0x1d135b=_0x2f22c1;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this[_0x1d135b(0x12a)]=![],this['mouse_move']=![];}['redraw'](){const _0x1a6c3b=_0x2f22c1;if(!this[_0x1a6c3b(0xde)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x1a6c3b(0xdb)](this['viewerParameters']),this['primitives'][_0x1a6c3b(0xe2)]=!![];}[_0x2f22c1(0xea)](_0x2c427b){const _0x356e6c=_0x2f22c1;this['_data']=_0x2c427b,this['particleSystem']&&this[_0x356e6c(0xc7)]['destroy'](),this[_0x356e6c(0xc7)]=new ParticleSystem(this[_0x356e6c(0x12d)]['context'],_0x2c427b,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}['_setOptionsHook'](_0x5d3442,_0x1d25f0){if(_0x5d3442)for(const _0x4da1f5 in _0x5d3442){this[_0x4da1f5]=_0x5d3442[_0x4da1f5];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}[_0x2f22c1(0xfc)](){const _0x2f8023=_0x2f22c1,_0x3a8e0a=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x3a8e0a*_0x3a8e0a,{'particlesTextureSize':_0x3a8e0a,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x2f8023(0xdc)],'dropRate':this['dropRate'],'dropRateBump':this[_0x2f8023(0xf8)],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x2f8023(0x10b)]};}[_0x2f22c1(0xb0)](){const _0x5d3fe1=_0x2f22c1;this[_0x5d3fe1(0x197)][_0x5d3fe1(0xc3)](this['particleSystem'][_0x5d3fe1(0xbc)][_0x5d3fe1(0x197)][_0x5d3fe1(0x146)]),this[_0x5d3fe1(0x197)]['add'](this[_0x5d3fe1(0xc7)]['particlesComputing'][_0x5d3fe1(0x197)][_0x5d3fe1(0x102)]),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x5d3fe1(0x197)][_0x5d3fe1(0x143)]),this['primitives']['add'](this[_0x5d3fe1(0xc7)]['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this[_0x5d3fe1(0xc7)][_0x5d3fe1(0xbc)]['primitives']['postProcessingSpeed']),this['primitives']['add'](this['particleSystem'][_0x5d3fe1(0xed)]['primitives']['segments']),this['primitives'][_0x5d3fe1(0xc3)](this[_0x5d3fe1(0xc7)][_0x5d3fe1(0xed)]['primitives'][_0x5d3fe1(0x190)]),this['primitives']['add'](this['particleSystem'][_0x5d3fe1(0xed)][_0x5d3fe1(0x197)]['screen']);}['updateViewerParameters'](){const _0x5a3aed=_0x2f22c1;let _0x353c3f=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x353c3f){const _0x26ad07=this['_map']['getExtent']();_0x353c3f=Cesium$1['Rectangle']['fromDegrees'](_0x26ad07['xmin'],_0x26ad07['ymin'],_0x26ad07['xmax'],_0x26ad07['ymax']);}const _0x2167a5=Util[_0x5a3aed(0x179)](_0x353c3f);this['viewerParameters']['lonRange']['x']=_0x2167a5[_0x5a3aed(0xcd)][_0x5a3aed(0x127)],this['viewerParameters']['lonRange']['y']=_0x2167a5['lon']['max'],this['viewerParameters']['latRange']['x']=_0x2167a5['lat']['min'],this['viewerParameters']['latRange']['y']=_0x2167a5[_0x5a3aed(0x16e)]['max'];const _0x2da09a=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this[_0x5a3aed(0x12d)]['drawingBufferHeight']);_0x2da09a>0x0&&(this['viewerParameters']['pixelSize']=_0x2da09a);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer'][_0x2f22c1(0x161)]=WindLayer;class CanvasParticle{constructor(){const _0x4c2a40=_0x2f22c1;this['lng']=null,this[_0x4c2a40(0x16e)]=null,this[_0x4c2a40(0x18b)]=null,this[_0x4c2a40(0x159)]=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x20ffc2 in this){delete this[_0x20ffc2];}}}function _0x1e6e(){const _0x45cd14=['xmax','removeEventListener','drawingBufferWidth','_onMouseMoveEvent','colorTable','context','update','clear','WindUtil','maxAge','layer','createWindTextures','sin','TextureMinificationFilter','min','bind','currentTrails','mouse_down','umin','1157574fwBMIO','scene','preRender','pow','PrimitiveType','GeometryAttribute','default','initWorker','segmentsColor','off','_addedHook','create','_createCanvas','umax','_speedRate','commandToExecute','speed','worker','all','fragmentShaderSource','OPAQUE','pointer-events','getParticles','updatePosition','resize','mouseMove','getWind','globe','413636juoKfm','updateViewerParameters','south','getRandomLatLng','randomizeParticles','clearCommand','redraw','getUVByXY','canvasHeight','particlesTextures','99dfAmKJ','lev','Color','Pass','BufferUsage','ellipsoid','absolute','tlat','rgb(206,255,255)','geometry','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','toRadians','canvasWind','canvasResize','forEach','WindLayer','segments','currentParticlesSpeed','TWO_PI','container','windData','push','levmax','canvas','ALWAYS','_colorRamp','nextTrailsDepth','mars3d-canvasWind','lat','createComputingPrimitives','age','vdata','Geometry','beginPath','EventType','framebuffer','Compute','floor','_setOptionsHook','viewRectangleToLonLatRange','lighter','addEventListener','lineTo','ymax','1266903WvOPow','getColorTexture','clientHeight','fromGeometry','color','data','ZERO','FLOAT','animateFrame','setOptions','setDate','Math','rows','tlng','currentTrailsColor','_drawLines','createRenderingFramebuffers','clampToLatitudeRange','trails','length','TextureMagnificationFilter','options','windTextures','max','_tomap','primitives','drawingBufferHeight','createCommand','destroy','udata','_onMouseUpEvent','camera','addPrimitives','framebuffers','4072936SYOaro','CanvasWindField','249190VPLmaz','clientWidth','maxParticles','uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a','vertexArray','UNSIGNED_BYTE','keys','SceneMode','particlesComputing','postProcessingSpeed','globalCompositeOperation','random','_pointerEvents','createSegmentsGeometry','createRenderingTextures','add','_updateIng2','14NcQRYS','attributeLocations','particleSystem','visibility','STATIC_DRAW','none','canvasContext','dimensions','lon','now','autoClear','globalAlpha','LUMINANCE','particlesNumber','depthTexture','viewerParameters','fixedHeight','style','_canrefresh','textures','_onMouseDownEvent','2mChOCs','applyViewerParameters','fadeOpacity','createTexture','_map','execute','commandType','postMessage','show','Cartesian2','PixelDatatype','3204150EvlKNt','Cartesian3','TRIANGLES','_onMapWhellEvent','blue','setData','primitiveType','VertexArray','particlesRendering','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','width','ShaderSource','nextParticlesPosition','_calcUV','cos','PixelFormat','_onMap_preRenderEvent','outputTexture','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','dropRateBump','DEPTH_COMPONENT','canvasWidth','destroyParticlesTextures','getOptions','5QMMfHO','pointerEvents','ClearCommand','_removedHook','shaderProgram','updateSpeed','Cesium','mouseHidden','speedFactor','postProcessingPosition','uniformMap','refreshTimer','NEAREST','randomBetween','colors','windField','cols','createRawRenderState','377864rKdnIR','refreshParticles','getUVByPoint','mouse_move','DepthFunction','_randomParticle','nextTrails','particlesTextureSize','wgs84ToWindowCoordinates','lineWidth'];_0x1e6e=function(){return _0x45cd14;};return _0x1e6e();}class CanvasWindField{constructor(_0x3c1735){this['setOptions'](_0x3c1735);}get['speedRate'](){const _0x32e974=_0x2f22c1;return this[_0x32e974(0x13a)];}set['speedRate'](_0x3c8e25){const _0x52115e=_0x2f22c1;this['_speedRate']=(0x64-(_0x3c8e25>0x63?0x63:_0x3c8e25))*0x64,this['_calc_speedRate']=[(this[_0x52115e(0x119)]-this['xmin'])/this['_speedRate'],(this[_0x52115e(0x17d)]-this['ymin'])/this['_speedRate']];}get[_0x2f22c1(0x122)](){return this['_maxAge'];}set['maxAge'](_0x408a45){this['_maxAge']=_0x408a45;}[_0x2f22c1(0x187)](_0x3538c4){const _0x5c50dd=_0x2f22c1;this['options']=_0x3538c4,this['maxAge']=_0x3538c4['maxAge']||0x78,this['speedRate']=_0x3538c4['speedRate']||0x32,this['particles']=[];const _0x3a9d70=_0x3538c4['particlesNumber']||0x1000;for(let _0x126c57=0x0;_0x126c57<_0x3a9d70;_0x126c57++){const _0x14d29f=this[_0x5c50dd(0x114)](new CanvasParticle());this['particles'][_0x5c50dd(0x167)](_0x14d29f);}}['setDate'](_0x3be32e){const _0x587f4c=_0x2f22c1;this[_0x587f4c(0x18a)]=_0x3be32e[_0x587f4c(0x18a)],this['cols']=_0x3be32e['cols'],this['xmin']=_0x3be32e['xmin'],this[_0x587f4c(0x119)]=_0x3be32e['xmax'],this['ymin']=_0x3be32e['ymin'],this['ymax']=_0x3be32e['ymax'],this['grid']=[];const _0xfc13c9=_0x3be32e['udata'],_0x5355b9=_0x3be32e['vdata'];let _0x38b8eb=![];_0xfc13c9[_0x587f4c(0x191)]===this['rows']&&_0xfc13c9[0x0]['length']===this['cols']&&(_0x38b8eb=!![]);let _0x21573f=0x0,_0xdb46ca=null,_0x47c1db=null;for(let _0x497abe=0x0;_0x497abe<this['rows'];_0x497abe++){_0xdb46ca=[];for(let _0x3d4ce0=0x0;_0x3d4ce0<this['cols'];_0x3d4ce0++,_0x21573f++){_0x38b8eb?_0x47c1db=this['_calcUV'](_0xfc13c9[_0x497abe][_0x3d4ce0],_0x5355b9[_0x497abe][_0x3d4ce0]):_0x47c1db=this['_calcUV'](_0xfc13c9[_0x21573f],_0x5355b9[_0x21573f]),_0xdb46ca['push'](_0x47c1db);}this['grid']['push'](_0xdb46ca);}this['options']['reverseY']&&this['grid']['reverse']();}['clear'](){const _0x3a0c6e=_0x2f22c1;delete this['rows'],delete this[_0x3a0c6e(0x10d)],delete this['xmin'],delete this['xmax'],delete this['ymin'],delete this[_0x3a0c6e(0x17d)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x492ca7,_0x4ad4a3){const _0x566839=_0x2f22c1,_0x47ba30=(_0x492ca7-this['xmin'])/(this[_0x566839(0x119)]-this['xmin'])*(this[_0x566839(0x10d)]-0x1),_0x1e728d=(this['ymax']-_0x4ad4a3)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x47ba30,_0x1e728d];}['getUVByXY'](_0x38f908,_0x8592d1){const _0x23f901=_0x2f22c1;if(_0x38f908<0x0||_0x38f908>=this['cols']||_0x8592d1>=this['rows'])return[0x0,0x0,0x0];const _0x3c0996=Math[_0x23f901(0x177)](_0x38f908),_0x4ff563=Math['floor'](_0x8592d1);if(_0x3c0996===_0x38f908&&_0x4ff563===_0x8592d1)return this['grid'][_0x8592d1][_0x38f908];const _0x4f8c57=_0x3c0996+0x1,_0x1d3e48=_0x4ff563+0x1,_0x98749e=this['getUVByXY'](_0x3c0996,_0x4ff563),_0x31ccd2=this['getUVByXY'](_0x4f8c57,_0x4ff563),_0x275d99=this['getUVByXY'](_0x3c0996,_0x1d3e48),_0x4e15dc=this[_0x23f901(0x14f)](_0x4f8c57,_0x1d3e48);let _0x1b17af=null;try{_0x1b17af=this['_bilinearInterpolation'](_0x38f908-_0x3c0996,_0x8592d1-_0x4ff563,_0x98749e,_0x31ccd2,_0x275d99,_0x4e15dc);}catch(_0x4a2e5c){console['log'](_0x38f908,_0x8592d1);}return _0x1b17af;}['_bilinearInterpolation'](_0x336766,_0x575904,_0x2265b8,_0x47b60b,_0x4a25b4,_0x380dc1){const _0x20bb12=0x1-_0x336766,_0x35a6b6=0x1-_0x575904,_0x39dca2=_0x20bb12*_0x35a6b6,_0x48f9e7=_0x336766*_0x35a6b6,_0x1279c2=_0x20bb12*_0x575904,_0x13488e=_0x336766*_0x575904,_0x314ed0=_0x2265b8[0x0]*_0x39dca2+_0x47b60b[0x0]*_0x48f9e7+_0x4a25b4[0x0]*_0x1279c2+_0x380dc1[0x0]*_0x13488e,_0x522b0e=_0x2265b8[0x1]*_0x39dca2+_0x47b60b[0x1]*_0x48f9e7+_0x4a25b4[0x1]*_0x1279c2+_0x380dc1[0x1]*_0x13488e;return this['_calcUV'](_0x314ed0,_0x522b0e);}[_0x2f22c1(0xf2)](_0x478399,_0x6864b3){return[+_0x478399,+_0x6864b3,Math['sqrt'](_0x478399*_0x478399+_0x6864b3*_0x6864b3)];}[_0x2f22c1(0x111)](_0x29a062,_0x4ac237){if(!this['isInExtent'](_0x29a062,_0x4ac237))return null;const _0x234cd6=this['toGridXY'](_0x29a062,_0x4ac237),_0x5dae29=this['getUVByXY'](_0x234cd6[0x0],_0x234cd6[0x1]);return _0x5dae29;}['isInExtent'](_0x46e03c,_0x41ad3d){const _0x32271a=_0x2f22c1;return _0x46e03c>=this['xmin']&&_0x46e03c<=this['xmax']&&_0x41ad3d>=this['ymin']&&_0x41ad3d<=this[_0x32271a(0x17d)]?!![]:![];}[_0x2f22c1(0x14b)](){const _0x6cb949=_0x2f22c1,_0x19b4ec=fRandomByfloat(this['xmin'],this['xmax']),_0x2519d6=fRandomByfloat(this['ymin'],this[_0x6cb949(0x17d)]);return{'lat':_0x2519d6,'lng':_0x19b4ec};}[_0x2f22c1(0x142)](){const _0x3c36b1=_0x2f22c1;let _0x5d7d5d,_0x442e5d,_0x1ff42d;for(let _0x53400c=0x0,_0x8a51ae=this['particles'][_0x3c36b1(0x191)];_0x53400c<_0x8a51ae;_0x53400c++){let _0x2454e1=this['particles'][_0x53400c];_0x2454e1[_0x3c36b1(0x170)]<=0x0&&(_0x2454e1=this['_randomParticle'](_0x2454e1));if(_0x2454e1['age']>0x0){const _0xa8cb4f=_0x2454e1[_0x3c36b1(0x18b)],_0xea2985=_0x2454e1['tlat'];_0x1ff42d=this['getUVByPoint'](_0xa8cb4f,_0xea2985),_0x1ff42d?(_0x5d7d5d=_0xa8cb4f+this['_calc_speedRate'][0x0]*_0x1ff42d[0x0],_0x442e5d=_0xea2985+this['_calc_speedRate'][0x1]*_0x1ff42d[0x1],_0x2454e1['lng']=_0xa8cb4f,_0x2454e1['lat']=_0xea2985,_0x2454e1[_0x3c36b1(0x18b)]=_0x5d7d5d,_0x2454e1[_0x3c36b1(0x159)]=_0x442e5d,_0x2454e1[_0x3c36b1(0x13c)]=_0x1ff42d[0x2],_0x2454e1[_0x3c36b1(0x170)]--):_0x2454e1['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x3438b1){const _0x5517a6=_0x2f22c1;let _0x297abb,_0x5af45f;for(let _0x3b8664=0x0;_0x3b8664<0x1e;_0x3b8664++){_0x297abb=this['getRandomLatLng'](),_0x5af45f=this['getUVByPoint'](_0x297abb['lng'],_0x297abb[_0x5517a6(0x16e)]);if(_0x5af45f&&_0x5af45f[0x2]>0x0)break;}if(!_0x5af45f)return _0x3438b1;const _0x2ceb31=_0x297abb['lng']+this['_calc_speedRate'][0x0]*_0x5af45f[0x0],_0x28f270=_0x297abb[_0x5517a6(0x16e)]+this['_calc_speedRate'][0x1]*_0x5af45f[0x1];return _0x3438b1['lng']=_0x297abb['lng'],_0x3438b1['lat']=_0x297abb['lat'],_0x3438b1['tlng']=_0x2ceb31,_0x3438b1['tlat']=_0x28f270,_0x3438b1['age']=Math['round'](Math['random']()*this['maxAge']),_0x3438b1['speed']=_0x5af45f[0x2],_0x3438b1;}[_0x2f22c1(0xac)](){for(const _0x55207b in this){delete this[_0x55207b];}}}function fRandomByfloat(_0x5a1a1f,_0x334467){const _0x5e50cc=_0x2f22c1;return _0x5a1a1f+Math[_0x5e50cc(0xbf)]()*(_0x334467-_0x5a1a1f);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x7a9299={}){const _0x380edc=_0x2f22c1;super(_0x7a9299),this['_setOptionsHook'](_0x7a9299),this['canvas']=null,_0x7a9299[_0x380edc(0x10b)]&&_0x7a9299['steps']&&(this['_colorRamp']=new mars3d__namespace['ColorRamp'](_0x7a9299));}['_setOptionsHook'](_0x248e25,_0x1b7986){const _0x5e5eaf=_0x2f22c1;this['frameTime']=0x3e8/(_0x248e25['frameRate']||0xa),this['_pointerEvents']=this[_0x5e5eaf(0x193)]['pointerEvents']??![],this['color']=_0x248e25[_0x5e5eaf(0x182)]||'#ffffff',this[_0x5e5eaf(0x118)]=_0x248e25['lineWidth']||0x1,this['fixedHeight']=_0x248e25['fixedHeight']??0x0,this['reverseY']=_0x248e25['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x248e25);}get['layer'](){return this['canvas'];}get[_0x2f22c1(0xfa)](){const _0x20dac0=_0x2f22c1;return this['_map'][_0x20dac0(0x12d)]['canvas'][_0x20dac0(0xb5)];}get['canvasHeight'](){const _0x5eb906=_0x2f22c1;return this[_0x5eb906(0xde)]['scene']['canvas'][_0x5eb906(0x180)];}get[_0x2f22c1(0xfe)](){const _0xae2e81=_0x2f22c1;return this[_0xae2e81(0xc0)];}set['pointerEvents'](_0x5720f0){const _0x35768b=_0x2f22c1;this['_pointerEvents']=_0x5720f0;if(!this[_0x35768b(0x169)])return;_0x5720f0?this['canvas']['style'][_0x35768b(0x141)]=_0x35768b(0x13e):this['canvas'][_0x35768b(0xd6)][_0x35768b(0x141)]=_0x35768b(0xca);}get['particlesNumber'](){const _0x44de0a=_0x2f22c1;return this[_0x44de0a(0x193)]['particlesNumber'];}set[_0x2f22c1(0xd2)](_0x40e363){const _0x2aaf84=_0x2f22c1;this[_0x2aaf84(0x193)][_0x2aaf84(0xd2)]=_0x40e363,clearTimeout(this[_0x2aaf84(0xd7)]),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0x399eb0){const _0x2822c6=_0x2f22c1;this['options']['speedRate']=_0x399eb0,this[_0x2822c6(0x10c)]&&(this['windField']['speedRate']=_0x399eb0);}get['maxAge'](){const _0x34aba6=_0x2f22c1;return this[_0x34aba6(0x193)][_0x34aba6(0x122)];}set['maxAge'](_0xdabfa8){const _0x1628fc=_0x2f22c1;this['options'][_0x1628fc(0x122)]=_0xdabfa8,this['windField']&&(this[_0x1628fc(0x10c)]['maxAge']=_0xdabfa8);}get['data'](){const _0x4ce957=_0x2f22c1;return this[_0x4ce957(0x166)];}set['data'](_0x5220f4){const _0x4cd61c=_0x2f22c1;this[_0x4cd61c(0xea)](_0x5220f4);}['_showHook'](_0x31a1b2){const _0x1cdc8d=_0x2f22c1;_0x31a1b2?this[_0x1cdc8d(0x136)]():(this['windData']&&(this[_0x1cdc8d(0x193)][_0x1cdc8d(0x183)]=this['windData']),this[_0x1cdc8d(0x100)]());}['_mountedHook'](){this['options']['worker']?this['initWorker']():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x3b9b0e=_0x2f22c1;this['canvas']=this[_0x3b9b0e(0x138)](),this['canvasContext']=this[_0x3b9b0e(0x169)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x3b9b0e(0xea)](this[_0x3b9b0e(0x193)]['data']);}['_removedHook'](){const _0x115a84=_0x2f22c1;this[_0x115a84(0x120)](),this['unbindEvent'](),this['canvas']&&(this['_map'][_0x115a84(0x165)]['removeChild'](this[_0x115a84(0x169)]),delete this['canvas']);}['_createCanvas'](){const _0x10ad17=_0x2f22c1,_0x50a8cc=mars3d__namespace['DomUtil'][_0x10ad17(0x137)]('canvas',_0x10ad17(0x16d),this['_map']['container']);return _0x50a8cc[_0x10ad17(0xd6)]['position']=_0x10ad17(0x158),_0x50a8cc[_0x10ad17(0xd6)]['top']='0px',_0x50a8cc[_0x10ad17(0xd6)]['left']='0px',_0x50a8cc[_0x10ad17(0xd6)]['width']=this['_map'][_0x10ad17(0x12d)]['canvas'][_0x10ad17(0xb5)]+'px',_0x50a8cc[_0x10ad17(0xd6)]['height']=this['_map'][_0x10ad17(0x12d)]['canvas'][_0x10ad17(0x180)]+'px',_0x50a8cc['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x50a8cc['style']['zIndex']=this['options']['zIndex']??0x9,_0x50a8cc[_0x10ad17(0xef)]=this['_map']['scene']['canvas'][_0x10ad17(0xb5)],_0x50a8cc['height']=this['_map']['scene'][_0x10ad17(0x169)]['clientHeight'],_0x50a8cc;}['resize'](){const _0x563558=_0x2f22c1;this[_0x563558(0x169)]&&(this[_0x563558(0x169)]['style']['width']=this['_map'][_0x563558(0x12d)]['canvas']['clientWidth']+'px',this[_0x563558(0x169)][_0x563558(0xd6)]['height']=this['_map'][_0x563558(0x12d)]['canvas']['clientHeight']+'px',this[_0x563558(0x169)]['width']=this['_map'][_0x563558(0x12d)]['canvas']['clientWidth'],this['canvas']['height']=this[_0x563558(0xde)][_0x563558(0x12d)]['canvas'][_0x563558(0x180)]);}['bindEvent'](){const _0x37c90e=_0x2f22c1,_0x38c262=this;let _0x2ab11d=Date[_0x37c90e(0xce)]();(function _0x92bb5d(){const _0x49ce74=_0x37c90e;_0x38c262['animateFrame']=window['requestAnimationFrame'](_0x92bb5d);if(_0x38c262['show']&&_0x38c262['windField']){const _0x3f52ca=Date[_0x49ce74(0xce)](),_0x373f1c=_0x3f52ca-_0x2ab11d;_0x373f1c>_0x38c262['frameTime']&&(_0x2ab11d=_0x3f52ca-_0x373f1c%_0x38c262['frameTime'],_0x38c262[_0x49ce74(0x11f)]());}}(),window[_0x37c90e(0x17b)]('resize',this[_0x37c90e(0x144)][_0x37c90e(0x128)](this),![]),this['mouse_down']=![],this[_0x37c90e(0x112)]=![],this[_0x37c90e(0x193)][_0x37c90e(0x104)]&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x37c90e(0xde)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x37c90e(0xd9)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x37c90e(0xae)],this)));}['unbindEvent'](){const _0x512014=_0x2f22c1;window['cancelAnimationFrame'](this[_0x512014(0x186)]),delete this[_0x512014(0x186)],window[_0x512014(0x11a)]('resize',this['resize']),this['options']['mouseHidden']&&(this['_map'][_0x512014(0x135)](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x512014(0xde)]['off'](mars3d__namespace[_0x512014(0x174)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x512014(0x174)]['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x512014(0x135)](mars3d__namespace['EventType'][_0x512014(0x145)],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x4283e8){const _0xe520f6=_0x2f22c1;clearTimeout(this[_0xe520f6(0x108)]);if(!this[_0xe520f6(0xe2)]||!this['canvas'])return;this['canvas'][_0xe520f6(0xd6)][_0xe520f6(0xc8)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x1b3daa=_0xe520f6;if(!this['show'])return;this['redraw'](),this['canvas']['style'][_0x1b3daa(0xc8)]='visible';},0xc8);}['_onMouseDownEvent'](_0x2e568d){const _0x2567fc=_0x2f22c1;this[_0x2567fc(0x12a)]=!![],this['_map'][_0x2567fc(0x135)](mars3d__namespace['EventType'][_0x2567fc(0x145)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x2567fc(0x174)][_0x2567fc(0x145)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x40e391){const _0x5191fe=_0x2f22c1;if(!this['show']||!this['canvas'])return;this[_0x5191fe(0x12a)]&&(this['canvas']['style'][_0x5191fe(0xc8)]='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x1075f7){const _0x78641a=_0x2f22c1;if(!this[_0x78641a(0xe2)]||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x78641a(0x12a)]&&this[_0x78641a(0x112)]&&this['redraw'](),this[_0x78641a(0x169)]['style']['visibility']='visible',this[_0x78641a(0x12a)]=![],this['mouse_move']=![];}['setData'](_0x410688){const _0x461382=_0x2f22c1;this['clear'](),this[_0x461382(0x166)]=_0x410688,this['windField'][_0x461382(0x188)](_0x410688),this[_0x461382(0x14e)]();}['redraw'](){const _0x5ed31f=_0x2f22c1;if(!this['show'])return;this['windField']['setOptions'](this[_0x5ed31f(0x193)]),this['update']();}['update'](){const _0xf5d2e4=_0x2f22c1;if(this['_updateIng'])return;this['_updateIng']=!![];if(this['worker'])this['windField'][_0xf5d2e4(0x11f)]();else{const _0x29f6a1=this['windField']['getParticles']();this[_0xf5d2e4(0x18d)](_0x29f6a1);}this['_updateIng']=![];}['_drawLines'](_0xd3dbf9){const _0x35230e=_0x2f22c1;this['canvasContext']['globalCompositeOperation']='destination-in',this['canvasContext']['fillRect'](0x0,0x0,this[_0x35230e(0xfa)],this[_0x35230e(0x150)]),this['canvasContext'][_0x35230e(0xbe)]=_0x35230e(0x17a),this[_0x35230e(0xcb)][_0x35230e(0xd0)]=0.9;const _0x2178d5=this['_map']['scene']['mode']!==Cesium[_0x35230e(0xbb)]['SCENE3D'],_0x3fe7e1=this['canvasWidth']*0.25;if(this[_0x35230e(0x16b)])for(let _0x52428e=0x0,_0x10b651=_0xd3dbf9[_0x35230e(0x191)];_0x52428e<_0x10b651;_0x52428e++){const _0x3f6d17=_0xd3dbf9[_0x52428e],_0x1b13ff=this[_0x35230e(0x196)](_0x3f6d17['lng'],_0x3f6d17['lat'],_0x3f6d17),_0x5a23e4=this['_tomap'](_0x3f6d17['tlng'],_0x3f6d17[_0x35230e(0x159)],_0x3f6d17);if(!_0x1b13ff||!_0x5a23e4)continue;if(_0x2178d5&&Math['abs'](_0x1b13ff[0x0]-_0x5a23e4[0x0])>=_0x3fe7e1)continue;this['canvasContext']['beginPath'](),this[_0x35230e(0xcb)]['lineWidth']=this['lineWidth'],this[_0x35230e(0xcb)]['strokeStyle']=this[_0x35230e(0x16b)]['getColor'](_0x3f6d17['speed']),this['canvasContext']['moveTo'](_0x1b13ff[0x0],_0x1b13ff[0x1]),this['canvasContext'][_0x35230e(0x17c)](_0x5a23e4[0x0],_0x5a23e4[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x35230e(0x173)](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x35230e(0xcb)]['strokeStyle']=this['color'];for(let _0x303646=0x0,_0x430fdd=_0xd3dbf9['length'];_0x303646<_0x430fdd;_0x303646++){const _0x14a5fa=_0xd3dbf9[_0x303646],_0x1ed1f3=this['_tomap'](_0x14a5fa['lng'],_0x14a5fa[_0x35230e(0x16e)],_0x14a5fa),_0x5daaf6=this['_tomap'](_0x14a5fa['tlng'],_0x14a5fa['tlat'],_0x14a5fa);if(!_0x1ed1f3||!_0x5daaf6)continue;if(_0x2178d5&&Math['abs'](_0x1ed1f3[0x0]-_0x5daaf6[0x0])>=_0x3fe7e1)continue;this['canvasContext']['moveTo'](_0x1ed1f3[0x0],_0x1ed1f3[0x1]),this['canvasContext']['lineTo'](_0x5daaf6[0x0],_0x5daaf6[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x78f572,_0x26e0b5,_0x592eaf){const _0x37f96c=_0x2f22c1,_0x29421d=Cesium[_0x37f96c(0xe6)]['fromDegrees'](_0x78f572,_0x26e0b5,this[_0x37f96c(0xd5)]),_0x18e40c=this['_map']['scene'];if(_0x18e40c['mode']===Cesium['SceneMode']['SCENE3D']){const _0x454162=new Cesium['EllipsoidalOccluder'](_0x18e40c[_0x37f96c(0x147)][_0x37f96c(0x157)],_0x18e40c['camera']['positionWC']),_0xd5cbce=_0x454162['isPointVisible'](_0x29421d);if(!_0xd5cbce)return _0x592eaf[_0x37f96c(0x170)]=0x0,null;}const _0x3e256c=Cesium['SceneTransforms'][_0x37f96c(0x117)](this[_0x37f96c(0xde)][_0x37f96c(0x12d)],_0x29421d);return _0x3e256c?[_0x3e256c['x'],_0x3e256c['y']]:null;}['clear'](){const _0x50d79a=_0x2f22c1;this['windField'][_0x50d79a(0x120)](),delete this[_0x50d79a(0x166)];}[_0x2f22c1(0x133)](){const _0xbca8f5=_0x2f22c1;this['worker']=new Worker(this['options'][_0xbca8f5(0x13d)]),this['worker']['onmessage']=_0xe1c46d=>{const _0x1c615e=_0xbca8f5;this[_0x1c615e(0x18d)](_0xe1c46d['data']['particles']),this['_updateIng2']=![];},this['windField']={'init':_0x278f0b=>{this['worker']['postMessage']({'type':'init','options':_0x278f0b});},'setOptions':_0x226643=>{const _0x2897d5=_0xbca8f5;this['worker']['postMessage']({'type':_0x2897d5(0x187),'options':_0x226643});},'setDate':_0x1f9d31=>{const _0x1e593b=_0xbca8f5;this['worker'][_0x1e593b(0xe1)]({'type':'setDate','data':_0x1f9d31});},'update':()=>{const _0x3ba5f6=_0xbca8f5;if(this[_0x3ba5f6(0xc4)])return;this['_updateIng2']=!![],this[_0x3ba5f6(0x13d)][_0x3ba5f6(0xe1)]({'type':_0x3ba5f6(0x11f)});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this[_0xbca8f5(0x10c)]['init'](this['options']);}}mars3d__namespace['LayerUtil']['register'](_0x2f22c1(0x15e),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x2f22c1(0x121)]=WindUtil,exports[_0x2f22c1(0xb3)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x2f22c1(0x121)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
