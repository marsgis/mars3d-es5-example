/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.12
 * 编译日期：2024-05-03 15:00:37
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x58230d=_0x4502;(function(_0x154bf6,_0x47bc5d){const _0x5bcf2a=_0x4502,_0x289d15=_0x154bf6();while(!![]){try{const _0x48a007=parseInt(_0x5bcf2a(0x135))/0x1*(-parseInt(_0x5bcf2a(0x1a1))/0x2)+-parseInt(_0x5bcf2a(0x1a3))/0x3+parseInt(_0x5bcf2a(0x103))/0x4+-parseInt(_0x5bcf2a(0x1f4))/0x5+-parseInt(_0x5bcf2a(0x13f))/0x6*(parseInt(_0x5bcf2a(0x122))/0x7)+parseInt(_0x5bcf2a(0x13d))/0x8*(parseInt(_0x5bcf2a(0x17d))/0x9)+-parseInt(_0x5bcf2a(0x1d2))/0xa*(-parseInt(_0x5bcf2a(0x16e))/0xb);if(_0x48a007===_0x47bc5d)break;else _0x289d15['push'](_0x289d15['shift']());}catch(_0x123c22){_0x289d15['push'](_0x289d15['shift']());}}}(_0x2262,0xbbce6));function _interopNamespace(_0x2e313a){const _0x1d27c0=_0x4502;if(_0x2e313a&&_0x2e313a[_0x1d27c0(0x1c7)])return _0x2e313a;var _0x319d29=Object[_0x1d27c0(0x169)](null);return _0x2e313a&&Object['keys'](_0x2e313a)['forEach'](function(_0x5c1534){const _0x4711bf=_0x1d27c0;if(_0x5c1534!==_0x4711bf(0x1a9)){var _0x253a9c=Object['getOwnPropertyDescriptor'](_0x2e313a,_0x5c1534);Object['defineProperty'](_0x319d29,_0x5c1534,_0x253a9c['get']?_0x253a9c:{'enumerable':!![],'get':function(){return _0x2e313a[_0x5c1534];}});}}),_0x319d29['default']=_0x2e313a,_0x319d29;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x58230d(0x14d)];function getU(_0x40f946,_0x1482a9){const _0x3d9090=_0x58230d,_0x1c0f64=_0x40f946*Math['cos'](Cesium$7[_0x3d9090(0x188)][_0x3d9090(0x168)](_0x1482a9));return _0x1c0f64;}function getV(_0x56e6b9,_0x2a6087){const _0x5b8c24=_0x58230d,_0x363d4b=_0x56e6b9*Math['sin'](Cesium$7['Math'][_0x5b8c24(0x168)](_0x2a6087));return _0x363d4b;}function getSpeed(_0x4515bd,_0x2f3552){const _0xa9ba80=_0x58230d,_0x8d633=Math[_0xa9ba80(0x12e)](Math['pow'](_0x4515bd,0x2)+Math['pow'](_0x2f3552,0x2));return _0x8d633;}function getDirection(_0x676e4d,_0x24d597){let _0x189812=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x24d597,_0x676e4d));return _0x189812+=_0x189812<0x0?0x168:0x0,_0x189812;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x58230d(0x14d)];class CustomPrimitive{constructor(_0x497b69){const _0x2bd9f7=_0x58230d;this['commandType']=_0x497b69['commandType'],this[_0x2bd9f7(0x176)]=_0x497b69['geometry'],this[_0x2bd9f7(0x131)]=_0x497b69['attributeLocations'],this[_0x2bd9f7(0x1d9)]=_0x497b69[_0x2bd9f7(0x1d9)],this['uniformMap']=_0x497b69['uniformMap'],this[_0x2bd9f7(0x117)]=_0x497b69['vertexShaderSource'],this['fragmentShaderSource']=_0x497b69['fragmentShaderSource'],this['rawRenderState']=_0x497b69['rawRenderState'],this['framebuffer']=_0x497b69['framebuffer'],this['outputTexture']=_0x497b69['outputTexture'],this['autoClear']=_0x497b69[_0x2bd9f7(0x18b)]??![],this['preExecute']=_0x497b69['preExecute'],this['show']=!![],this[_0x2bd9f7(0x19f)]=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x2bd9f7(0x165)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}['createCommand'](_0xf45fe6){const _0x37aeed=_0x58230d;switch(this['commandType']){case _0x37aeed(0x1b5):{const _0x185f82=Cesium$6['VertexArray']['fromGeometry']({'context':_0xf45fe6,'geometry':this[_0x37aeed(0x176)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x37aeed(0x16f)]['STATIC_DRAW']}),_0x16b42e=Cesium$6[_0x37aeed(0x1e2)]['fromCache']({'context':_0xf45fe6,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x137a8c=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x16b42e,'vertexArray':_0x185f82,'modelMatrix':Cesium$6['Matrix4'][_0x37aeed(0x10f)],'renderState':_0x137a8c,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case _0x37aeed(0x14b):{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this[_0x37aeed(0x1d5)],'persists':!![]});}}}[_0x58230d(0x177)](_0x88e962,_0x3e060c){const _0x2b188a=_0x58230d;this['geometry']=_0x3e060c;const _0x3602b0=Cesium$6['VertexArray'][_0x2b188a(0x1e0)]({'context':_0x88e962,'geometry':this['geometry'],'attributeLocations':this[_0x2b188a(0x131)],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']});this[_0x2b188a(0x19f)][_0x2b188a(0x1aa)]=_0x3602b0;}[_0x58230d(0x12f)](_0xad9894){const _0xa86533=_0x58230d;if(!this['show'])return;if(_0xad9894[_0xa86533(0x10e)]!==Cesium$6['SceneMode'][_0xa86533(0x17c)])return;!Cesium$6[_0xa86533(0x1ef)](this[_0xa86533(0x19f)])&&(this['commandToExecute']=this[_0xa86533(0x12c)](_0xad9894['context'])),Cesium$6[_0xa86533(0x1ef)](this[_0xa86533(0x1ed)])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0xad9894['commandList'][_0xa86533(0xff)](this[_0xa86533(0x165)]),_0xad9894['commandList'][_0xa86533(0xff)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x454284=_0x58230d;if(this['clearCommand']){var _0x1aae4f,_0x375982;(_0x1aae4f=this['clearCommand'])!==null&&_0x1aae4f!==void 0x0&&_0x1aae4f['vertexArray']&&this['clearCommand']['vertexArray'][_0x454284(0x1d1)](),(_0x375982=this['clearCommand'])!==null&&_0x375982!==void 0x0&&_0x375982['shaderProgram']&&this['clearCommand']['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x454284(0x1d1)](),this[_0x454284(0x19f)]['shaderProgram']&&this[_0x454284(0x19f)]['shaderProgram'][_0x454284(0x1d1)](),delete this[_0x454284(0x19f)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x11ce5e=function(){const _0x4c4160=_0x4502,_0x4f92f0=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x4c4160(0x1a8))]({'position':new Cesium$5[(_0x4c4160(0x111))]({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x4c4160(0x1d6)][_0x4c4160(0x148)],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x4f92f0;},_0x26ced8=function(_0x1f3176,_0x4cd77e){const _0x2cccba=_0x4502;if(Cesium$5[_0x2cccba(0x1ef)](_0x4cd77e)){const _0x42ac3d={};_0x42ac3d[_0x2cccba(0x152)]=_0x4cd77e,_0x1f3176['source']=_0x42ac3d;}const _0x5198de=new Cesium$5['Texture'](_0x1f3176);return _0x5198de;},_0x263918=function(_0x1dca7a,_0x3af5f0,_0x427e82){const _0x4a1858=new Cesium$5['Framebuffer']({'context':_0x1dca7a,'colorTextures':[_0x3af5f0],'depthTexture':_0x427e82});return _0x4a1858;},_0x1575fe=function(_0x187bec){const _0x65c913=_0x4502,_0x30209e=!![],_0x36b668=![],_0x10d681={'viewport':_0x187bec[_0x65c913(0x1bd)],'depthTest':_0x187bec['depthTest'],'depthMask':_0x187bec['depthMask'],'blending':_0x187bec[_0x65c913(0x1b7)]},_0xfa6081=Cesium$5[_0x65c913(0x1e8)]['getDefaultRenderState'](_0x30209e,_0x36b668,_0x10d681);return _0xfa6081;},_0x5390fa=function(_0x3ea877){const _0x4a76bd=_0x4502,_0x5a06a4={},_0xb54064=Cesium$5[_0x4a76bd(0x188)]['mod'](_0x3ea877['west'],Cesium$5['Math']['TWO_PI']),_0x5e5ffe=Cesium$5[_0x4a76bd(0x188)]['mod'](_0x3ea877[_0x4a76bd(0x1b3)],Cesium$5['Math']['TWO_PI']),_0x1770d2=_0x3ea877['width'];let _0x359ed9,_0x416d7e;_0x1770d2>Cesium$5['Math'][_0x4a76bd(0x1ab)]?(_0x359ed9=0x0,_0x416d7e=Cesium$5['Math']['TWO_PI']):_0x5e5ffe-_0xb54064<_0x1770d2?(_0x359ed9=_0xb54064,_0x416d7e=_0xb54064+_0x1770d2):(_0x359ed9=_0xb54064,_0x416d7e=_0x5e5ffe);_0x5a06a4['lon']={'min':Cesium$5['Math'][_0x4a76bd(0x174)](_0x359ed9),'max':Cesium$5['Math']['toDegrees'](_0x416d7e)};const _0xb2bd30=_0x3ea877[_0x4a76bd(0x149)],_0x594d02=_0x3ea877['north'],_0x5b4ca2=_0x3ea877[_0x4a76bd(0x105)],_0x923098=_0x5b4ca2>Cesium$5['Math']['PI']/0xc?_0x5b4ca2/0x2:0x0;let _0x4279c2=Cesium$5[_0x4a76bd(0x188)]['clampToLatitudeRange'](_0xb2bd30-_0x923098),_0x1840ad=Cesium$5[_0x4a76bd(0x188)][_0x4a76bd(0x16d)](_0x594d02+_0x923098);return _0x4279c2<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x4279c2=-Cesium$5[_0x4a76bd(0x188)]['PI_OVER_TWO']),_0x1840ad>Cesium$5['Math']['PI_OVER_THREE']&&(_0x1840ad=Cesium$5['Math'][_0x4a76bd(0x185)]),_0x5a06a4['lat']={'min':Cesium$5['Math'][_0x4a76bd(0x174)](_0x4279c2),'max':Cesium$5[_0x4a76bd(0x188)][_0x4a76bd(0x174)](_0x1840ad)},_0x5a06a4;};return{'getFullscreenQuad':_0x11ce5e,'createTexture':_0x26ced8,'createFramebuffer':_0x263918,'createRawRenderState':_0x1575fe,'viewRectangleToLonLatRange':_0x5390fa};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x58230d(0x1d8),screenDraw_frag=_0x58230d(0x121);const Cesium$4=mars3d__namespace[_0x58230d(0x14d)];class ParticlesRendering{constructor(_0x565774,_0x17b268,_0x97b1ad,_0xd1e0c8,_0x5d06b1){this['createRenderingTextures'](_0x565774,_0x17b268,_0x97b1ad['colors']),this['createRenderingFramebuffers'](_0x565774),this['createRenderingPrimitives'](_0x565774,_0x97b1ad,_0xd1e0c8,_0x5d06b1);}['createRenderingTextures'](_0x56d434,_0x4a9b40,_0x257e1c){const _0x3c419f=_0x58230d,_0x5cfc50={'context':_0x56d434,'width':_0x56d434['drawingBufferWidth'],'height':_0x56d434[_0x3c419f(0x101)],'pixelFormat':Cesium$4['PixelFormat'][_0x3c419f(0x182)],'pixelDatatype':Cesium$4[_0x3c419f(0x19b)][_0x3c419f(0x189)]},_0x161256={'context':_0x56d434,'width':_0x56d434['drawingBufferWidth'],'height':_0x56d434[_0x3c419f(0x101)],'pixelFormat':Cesium$4[_0x3c419f(0x198)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x23579a=_0x257e1c['length'],_0x4af205=new Float32Array(_0x23579a*0x3);for(let _0x4d3337=0x0;_0x4d3337<_0x23579a;_0x4d3337++){const _0x37cf73=Cesium$4['Color'][_0x3c419f(0x143)](_0x257e1c[_0x4d3337]);_0x4af205[0x3*_0x4d3337]=_0x37cf73['red'],_0x4af205[0x3*_0x4d3337+0x1]=_0x37cf73['green'],_0x4af205[0x3*_0x4d3337+0x2]=_0x37cf73['blue'];}const _0x540ca1={'context':_0x56d434,'width':_0x23579a,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x3c419f(0x112)],'pixelDatatype':Cesium$4[_0x3c419f(0x19b)]['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4[_0x3c419f(0x196)]['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util['createTexture'](_0x5cfc50),'segmentsDepth':Util['createTexture'](_0x161256),'currentTrailsColor':Util[_0x3c419f(0x179)](_0x5cfc50),'currentTrailsDepth':Util[_0x3c419f(0x179)](_0x161256),'nextTrailsColor':Util[_0x3c419f(0x179)](_0x5cfc50),'nextTrailsDepth':Util[_0x3c419f(0x179)](_0x161256),'colorTable':Util['createTexture'](_0x540ca1,_0x4af205)};}['createRenderingFramebuffers'](_0x2fdca5){const _0xda251f=_0x58230d;this['framebuffers']={'segments':Util[_0xda251f(0x19e)](_0x2fdca5,this[_0xda251f(0x1cb)][_0xda251f(0x130)],this['textures']['segmentsDepth']),'currentTrails':Util[_0xda251f(0x19e)](_0x2fdca5,this['textures'][_0xda251f(0x187)],this['textures'][_0xda251f(0x140)]),'nextTrails':Util['createFramebuffer'](_0x2fdca5,this[_0xda251f(0x1cb)][_0xda251f(0x14a)],this['textures'][_0xda251f(0x102)])};}[_0x58230d(0x13a)](_0x12559a){const _0x3def39=_0x58230d,_0xe387b7=0x4;let _0x49c4fc=[];for(let _0x3d020c=0x0;_0x3d020c<_0x12559a[_0x3def39(0x166)];_0x3d020c++){for(let _0x1661dc=0x0;_0x1661dc<_0x12559a['particlesTextureSize'];_0x1661dc++){for(let _0x908af=0x0;_0x908af<_0xe387b7;_0x908af++){_0x49c4fc['push'](_0x3d020c/_0x12559a['particlesTextureSize']),_0x49c4fc['push'](_0x1661dc/_0x12559a['particlesTextureSize']);}}}_0x49c4fc=new Float32Array(_0x49c4fc);let _0x48a0a0=[];const _0x578698=[-0x1,0x1],_0x4be79e=[-0x1,0x1];for(let _0x2b0561=0x0;_0x2b0561<_0x12559a[_0x3def39(0x14e)];_0x2b0561++){for(let _0x5f1795=0x0;_0x5f1795<_0xe387b7/0x2;_0x5f1795++){for(let _0x529c81=0x0;_0x529c81<_0xe387b7/0x2;_0x529c81++){_0x48a0a0['push'](_0x578698[_0x5f1795]),_0x48a0a0['push'](_0x4be79e[_0x529c81]),_0x48a0a0['push'](0x0);}}}_0x48a0a0=new Float32Array(_0x48a0a0);const _0xffa68=0x6*_0x12559a['maxParticles'],_0x4ae75e=new Uint32Array(_0xffa68);for(let _0x130f16=0x0,_0x1c0b75=0x0,_0x1f54fe=0x0;_0x130f16<_0x12559a['maxParticles'];_0x130f16++){_0x4ae75e[_0x1c0b75++]=_0x1f54fe+0x0,_0x4ae75e[_0x1c0b75++]=_0x1f54fe+0x1,_0x4ae75e[_0x1c0b75++]=_0x1f54fe+0x2,_0x4ae75e[_0x1c0b75++]=_0x1f54fe+0x2,_0x4ae75e[_0x1c0b75++]=_0x1f54fe+0x1,_0x4ae75e[_0x1c0b75++]=_0x1f54fe+0x3,_0x1f54fe+=0x4;}const _0x13f7d8=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x3def39(0x148)],'componentsPerAttribute':0x2,'values':_0x49c4fc}),'normal':new Cesium$4[(_0x3def39(0x111))]({'componentDatatype':Cesium$4[_0x3def39(0x1d6)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x48a0a0})}),'indices':_0x4ae75e});return _0x13f7d8;}['createRenderingPrimitives'](_0x541833,_0x5be039,_0x1611ac,_0x26e718){const _0x15ecac=_0x58230d,_0x540f5e=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x5be039),'primitiveType':Cesium$4[_0x15ecac(0x192)][_0x15ecac(0x12b)],'uniformMap':{'currentParticlesPosition':function(){return _0x26e718['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x26e718['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x19cd77=_0x15ecac;return _0x26e718[_0x19cd77(0x1c1)][_0x19cd77(0x15d)];},'colorTable':function(){const _0x139481=_0x15ecac;return _0x540f5e[_0x139481(0x1cb)][_0x139481(0x142)];},'aspect':function(){return _0x541833['drawingBufferWidth']/_0x541833['drawingBufferHeight'];},'pixelSize':function(){return _0x1611ac['pixelSize'];},'lineWidth':function(){return _0x5be039['lineWidth'];},'particleHeight':function(){const _0x28f811=_0x15ecac;return _0x5be039[_0x28f811(0x11c)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x15ecac(0x10d)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x15ecac(0x17e)][_0x15ecac(0x173)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x15ecac(0x192)]['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x540f5e['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x4d616e=_0x15ecac;return _0x540f5e['textures'][_0x4d616e(0x157)];},'currentTrailsColor':function(){const _0x21604f=_0x15ecac;return _0x540f5e['framebuffers']['currentTrails'][_0x21604f(0x158)](0x0);},'trailsDepthTexture':function(){const _0x28a42e=_0x15ecac;return _0x540f5e['framebuffers'][_0x28a42e(0x1f2)][_0x28a42e(0x1ac)];},'fadeOpacity':function(){return _0x5be039['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x2fbc79=_0x15ecac,_0x3e9560=_0x540f5e['framebuffers']['currentTrails'];_0x540f5e[_0x2fbc79(0x17e)][_0x2fbc79(0x1f2)]=_0x540f5e[_0x2fbc79(0x17e)]['nextTrails'],_0x540f5e['framebuffers']['nextTrails']=_0x3e9560,_0x540f5e['primitives'][_0x2fbc79(0x145)][_0x2fbc79(0x19f)]['framebuffer']=_0x540f5e[_0x2fbc79(0x17e)]['nextTrails'],_0x540f5e[_0x2fbc79(0x1da)]['trails']['clearCommand']['framebuffer']=_0x540f5e[_0x2fbc79(0x17e)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x1acb8b=_0x15ecac;return _0x540f5e['framebuffers'][_0x1acb8b(0x1b6)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x48713b=_0x15ecac;return _0x540f5e['framebuffers'][_0x48713b(0x1b6)][_0x48713b(0x1ac)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x15ecac(0x180)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x42cb6a,_0x4b361d,_0x3cfaa4,_0x2bf810){const _0x37c610=_0x58230d;this['data']=_0x4b361d,this['createWindTextures'](_0x42cb6a,_0x4b361d),this[_0x37c610(0x10a)](_0x42cb6a,_0x3cfaa4,_0x2bf810),this['createComputingPrimitives'](_0x4b361d,_0x3cfaa4,_0x2bf810);}['createWindTextures'](_0x1be1d8,_0x497eb3){const _0x10fc19=_0x58230d,_0x2124bf={'context':_0x1be1d8,'width':_0x497eb3['dimensions'][_0x10fc19(0x154)],'height':_0x497eb3[_0x10fc19(0x1dc)]['lat']*(_0x497eb3['dimensions'][_0x10fc19(0x17b)]||0x1),'pixelFormat':Cesium$3['PixelFormat'][_0x10fc19(0x1c0)],'pixelDatatype':Cesium$3[_0x10fc19(0x19b)][_0x10fc19(0x148)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x10fc19(0x196)]['NEAREST'],'magnificationFilter':Cesium$3[_0x10fc19(0x1c4)][_0x10fc19(0x1e1)]})};this[_0x10fc19(0x1a5)]={'U':Util['createTexture'](_0x2124bf,_0x497eb3['U'][_0x10fc19(0x14f)]),'V':Util['createTexture'](_0x2124bf,_0x497eb3['V'][_0x10fc19(0x14f)])};}['createParticlesTextures'](_0x23123f,_0xd02bad,_0x19451e){const _0x11064b=_0x58230d,_0x3b6653={'context':_0x23123f,'width':_0xd02bad['particlesTextureSize'],'height':_0xd02bad[_0x11064b(0x166)],'pixelFormat':Cesium$3[_0x11064b(0x198)]['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x11064b(0x1c4)][_0x11064b(0x1e1)]})},_0x1edc99=this['randomizeParticles'](_0xd02bad['maxParticles'],_0x19451e),_0xd461dc=new Float32Array(0x4*_0xd02bad['maxParticles'])['fill'](0x0);this[_0x11064b(0x1c1)]={'particlesWind':Util[_0x11064b(0x179)](_0x3b6653),'currentParticlesPosition':Util['createTexture'](_0x3b6653,_0x1edc99),'nextParticlesPosition':Util['createTexture'](_0x3b6653,_0x1edc99),'currentParticlesSpeed':Util[_0x11064b(0x179)](_0x3b6653,_0xd461dc),'nextParticlesSpeed':Util[_0x11064b(0x179)](_0x3b6653,_0xd461dc),'postProcessingPosition':Util['createTexture'](_0x3b6653,_0x1edc99),'postProcessingSpeed':Util[_0x11064b(0x179)](_0x3b6653,_0xd461dc)};}['randomizeParticles'](_0x3493b8,_0x204342){const _0x47482f=_0x58230d,_0x3e45e6=new Float32Array(0x4*_0x3493b8);for(let _0x249698=0x0;_0x249698<_0x3493b8;_0x249698++){_0x3e45e6[0x4*_0x249698]=Cesium$3['Math'][_0x47482f(0x1df)](_0x204342['lonRange']['x'],_0x204342['lonRange']['y']),_0x3e45e6[0x4*_0x249698+0x1]=Cesium$3['Math'][_0x47482f(0x1df)](_0x204342[_0x47482f(0x18f)]['x'],_0x204342['latRange']['y']),_0x3e45e6[0x4*_0x249698+0x2]=Cesium$3['Math'][_0x47482f(0x1df)](this[_0x47482f(0x14c)]['lev']['min'],this['data'][_0x47482f(0x17b)]['max']),_0x3e45e6[0x4*_0x249698+0x3]=0x0;}return _0x3e45e6;}['destroyParticlesTextures'](){const _0x682b2a=_0x58230d;Object['keys'](this[_0x682b2a(0x1c1)])[_0x682b2a(0x1b0)](_0x53de58=>{const _0x3c0bb6=_0x682b2a;this[_0x3c0bb6(0x1c1)][_0x53de58]['destroy']();});}[_0x58230d(0x1af)](_0x559079,_0x5f544a,_0x35db3c){const _0x1495fa=_0x58230d,_0x1de679=new Cesium$3['Cartesian3'](_0x559079[_0x1495fa(0x1dc)][_0x1495fa(0x154)],_0x559079[_0x1495fa(0x1dc)]['lat'],_0x559079['dimensions']['lev']),_0x3b043e=new Cesium$3[(_0x1495fa(0x104))](_0x559079['lon']['min'],_0x559079['lat']['min'],_0x559079['lev'][_0x1495fa(0x1d3)]),_0x2bc375=new Cesium$3['Cartesian3'](_0x559079['lon']['max'],_0x559079[_0x1495fa(0x136)]['max'],_0x559079['lev']['max']),_0x2a030b=new Cesium$3['Cartesian3']((_0x2bc375['x']-_0x3b043e['x'])/(_0x1de679['x']-0x1),(_0x2bc375['y']-_0x3b043e['y'])/(_0x1de679['y']-0x1),_0x1de679['z']>0x1?(_0x2bc375['z']-_0x3b043e['z'])/(_0x1de679['z']-0x1):0x1),_0x657f8a=new Cesium$3['Cartesian2'](_0x559079['U']['min'],_0x559079['U']['max']),_0x31d421=new Cesium$3['Cartesian2'](_0x559079['V']['min'],_0x559079['V']['max']),_0x5ea5e9=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x5ea5e9['windTextures']['U'];},'V':function(){return _0x5ea5e9['windTextures']['V'];},'currentParticlesPosition':function(){return _0x5ea5e9['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x1de679;},'minimum':function(){return _0x3b043e;},'maximum':function(){return _0x2bc375;},'interval':function(){return _0x2a030b;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0xf06d57=_0x1495fa;_0x5ea5e9['primitives']['getWind']['commandToExecute'][_0xf06d57(0x1d5)]=_0x5ea5e9['particlesTextures'][_0xf06d57(0x110)];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x5bf1b9=_0x1495fa;return _0x5ea5e9[_0x5bf1b9(0x1c1)]['currentParticlesSpeed'];},'particlesWind':function(){return _0x5ea5e9['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x657f8a;},'vSpeedRange':function(){return _0x31d421;},'pixelSize':function(){return _0x35db3c['pixelSize'];},'speedFactor':function(){return _0x5f544a['speedFactor'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x14bf6f=_0x1495fa,_0x468c57=_0x5ea5e9['particlesTextures']['currentParticlesSpeed'];_0x5ea5e9['particlesTextures']['currentParticlesSpeed']=_0x5ea5e9['particlesTextures']['postProcessingSpeed'],_0x5ea5e9['particlesTextures'][_0x14bf6f(0x15d)]=_0x468c57,_0x5ea5e9[_0x14bf6f(0x1da)][_0x14bf6f(0x164)]['commandToExecute']['outputTexture']=_0x5ea5e9['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x1495fa(0x14b),'uniformMap':{'currentParticlesPosition':function(){const _0x39cdad=_0x1495fa;return _0x5ea5e9[_0x39cdad(0x1c1)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x5ea5e9['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x1495fa(0x1c1)]['nextParticlesPosition'],'preExecute':function(){const _0x219b7f=_0x1495fa,_0x184c15=_0x5ea5e9[_0x219b7f(0x1c1)]['currentParticlesPosition'];_0x5ea5e9[_0x219b7f(0x1c1)][_0x219b7f(0x186)]=_0x5ea5e9[_0x219b7f(0x1c1)]['postProcessingPosition'],_0x5ea5e9['particlesTextures'][_0x219b7f(0x109)]=_0x184c15,_0x5ea5e9['primitives'][_0x219b7f(0x129)][_0x219b7f(0x19f)][_0x219b7f(0x1d5)]=_0x5ea5e9[_0x219b7f(0x1c1)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){const _0x3bf569=_0x1495fa;return _0x5ea5e9[_0x3bf569(0x1c1)]['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x5ea5e9['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x35db3c['lonRange'];},'latRange':function(){return _0x35db3c['latRange'];},'randomCoefficient':function(){const _0x509b5d=_0x1495fa,_0x3b9ad8=Math[_0x509b5d(0x170)]();return _0x3b9ad8;},'dropRate':function(){return _0x5f544a['dropRate'];},'dropRateBump':function(){return _0x5f544a['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x1495fa(0x13e))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x1495fa(0x1c1)][_0x1495fa(0x109)],'preExecute':function(){const _0x44e715=_0x1495fa;_0x5ea5e9['primitives'][_0x44e715(0x109)][_0x44e715(0x19f)]['outputTexture']=_0x5ea5e9['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){const _0x5ca6dd=_0x1495fa;return _0x5ea5e9[_0x5ca6dd(0x1c1)]['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x4fd065=_0x1495fa;return _0x5ea5e9['particlesTextures'][_0x4fd065(0x195)];}},'fragmentShaderSource':new Cesium$3[(_0x1495fa(0x13e))]({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x450e1f=_0x1495fa;_0x5ea5e9['primitives'][_0x450e1f(0x15d)]['commandToExecute']['outputTexture']=_0x5ea5e9[_0x450e1f(0x1c1)][_0x450e1f(0x15d)];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x295320,_0x98760a,_0xbcbf30,_0x5b6940){const _0x328e24=_0x58230d;this['context']=_0x295320,_0x98760a={..._0x98760a},_0x98760a['udata']&&_0x98760a['vdata']&&(_0x98760a[_0x328e24(0x1dc)]={},_0x98760a[_0x328e24(0x1dc)]['lon']=_0x98760a['cols'],_0x98760a['dimensions']['lat']=_0x98760a[_0x328e24(0x1c6)],_0x98760a['dimensions']['lev']=_0x98760a['lev']||0x1,_0x98760a[_0x328e24(0x154)]={},_0x98760a['lon']['min']=_0x98760a[_0x328e24(0x163)],_0x98760a['lon'][_0x328e24(0x19d)]=_0x98760a[_0x328e24(0x134)],_0x98760a['lat']={},_0x98760a['lat']['min']=_0x98760a[_0x328e24(0x1be)],_0x98760a['lat'][_0x328e24(0x19d)]=_0x98760a['ymax'],_0x98760a[_0x328e24(0x17b)]={},_0x98760a['lev']['min']=_0x98760a[_0x328e24(0x133)]??0x1,_0x98760a['lev']['max']=_0x98760a['levmax']??0x1,_0x98760a['U']={},_0x98760a['U']['array']=new Float32Array(_0x98760a[_0x328e24(0x128)]),_0x98760a['U']['min']=_0x98760a[_0x328e24(0x156)]??Math['min'](..._0x98760a['udata']),_0x98760a['U']['max']=_0x98760a[_0x328e24(0x172)]??Math['max'](..._0x98760a[_0x328e24(0x128)]),_0x98760a['V']={},_0x98760a['V']['array']=new Float32Array(_0x98760a['vdata']),_0x98760a['V'][_0x328e24(0x1d3)]=_0x98760a['vmin']??Math['min'](..._0x98760a['vdata']),_0x98760a['V']['max']=_0x98760a[_0x328e24(0x11a)]??Math['max'](..._0x98760a['vdata'])),this['data']=_0x98760a,this['options']=_0xbcbf30,this['viewerParameters']=_0x5b6940,this['particlesComputing']=new ParticlesComputing(this[_0x328e24(0x11e)],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x328e24(0x11e)],this['data'],this[_0x328e24(0x1bc)],this[_0x328e24(0x11d)],this['particlesComputing']);}['canvasResize'](_0x1d8504){const _0x1d9295=_0x58230d;this['particlesComputing']['destroyParticlesTextures'](),Object[_0x1d9295(0x159)](this[_0x1d9295(0x1f0)]['windTextures'])[_0x1d9295(0x1b0)](_0x28257e=>{const _0x1ff8cb=_0x1d9295;this['particlesComputing']['windTextures'][_0x28257e][_0x1ff8cb(0x1d1)]();}),this[_0x1d9295(0x1c3)][_0x1d9295(0x1cb)]['colorTable']['destroy'](),Object[_0x1d9295(0x159)](this['particlesRendering']['framebuffers'])['forEach'](_0x233049=>{this['particlesRendering']['framebuffers'][_0x233049]['destroy']();}),this['context']=_0x1d8504,this[_0x1d9295(0x1f0)]=new ParticlesComputing(this['context'],this['data'],this[_0x1d9295(0x1bc)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x1d9295(0x11e)],this[_0x1d9295(0x14c)],this['options'],this[_0x1d9295(0x11d)],this[_0x1d9295(0x1f0)]);}['clearFramebuffers'](){const _0x51592d=_0x58230d,_0x14ae05=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x51592d(0x1f5))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass'][_0x51592d(0x1a4)]});Object['keys'](this['particlesRendering'][_0x51592d(0x17e)])['forEach'](_0x2c6bf9=>{const _0x216039=_0x51592d;_0x14ae05['framebuffer']=this[_0x216039(0x1c3)]['framebuffers'][_0x2c6bf9],_0x14ae05['execute'](this['context']);});}['refreshParticles'](_0x17708e){const _0x3e3434=_0x58230d;this[_0x3e3434(0x151)](),this[_0x3e3434(0x1f0)][_0x3e3434(0x132)](),this['particlesComputing']['createParticlesTextures'](this['context'],this['options'],this[_0x3e3434(0x11d)]);if(_0x17708e){var _0x2d9333;const _0xa7f0c2=this['particlesRendering']['createSegmentsGeometry'](this[_0x3e3434(0x1bc)]);this[_0x3e3434(0x1c3)]['primitives'][_0x3e3434(0x173)][_0x3e3434(0x176)]=_0xa7f0c2;const _0x17609d=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0xa7f0c2,'attributeLocations':this[_0x3e3434(0x1c3)]['primitives'][_0x3e3434(0x173)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage'][_0x3e3434(0x1e7)]});(_0x2d9333=this['particlesRendering'][_0x3e3434(0x1da)])!==null&&_0x2d9333!==void 0x0&&(_0x2d9333=_0x2d9333['segments'])!==null&&_0x2d9333!==void 0x0&&_0x2d9333['commandToExecute']&&(this['particlesRendering']['primitives']['segments'][_0x3e3434(0x19f)]['vertexArray']=_0x17609d);}}[_0x58230d(0x11f)](_0xc1f00c){const _0x544829=_0x58230d;let _0x3bd032=![];this['options'][_0x544829(0x14e)]!==_0xc1f00c['maxParticles']&&(_0x3bd032=!![]),Object[_0x544829(0x159)](_0xc1f00c)['forEach'](_0x3819bf=>{const _0x3a7b3f=_0x544829;this[_0x3a7b3f(0x1bc)][_0x3819bf]=_0xc1f00c[_0x3819bf];}),this['refreshParticles'](_0x3bd032);}['applyViewerParameters'](_0x4159b2){const _0x2f5bc7=_0x58230d;Object[_0x2f5bc7(0x159)](_0x4159b2)['forEach'](_0x4ba9e3=>{this['viewerParameters'][_0x4ba9e3]=_0x4159b2[_0x4ba9e3];}),this['refreshParticles'](![]);}['destroy'](){const _0x46879e=_0x58230d;clearTimeout(this[_0x46879e(0x1ad)]),this[_0x46879e(0x1f0)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])[_0x46879e(0x1b0)](_0x263ad2=>{this['particlesComputing']['windTextures'][_0x263ad2]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x46879e(0x159)](this['particlesRendering']['framebuffers'])['forEach'](_0x560b57=>{this['particlesRendering']['framebuffers'][_0x560b57]['destroy']();});for(const _0x4fc40c in this){delete this[_0x4fc40c];}}}const Cesium$1=mars3d__namespace[_0x58230d(0x14d)],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x140611={}){_0x140611={...DEF_OPTIONS,..._0x140611},super(_0x140611),this['_setOptionsHook'](_0x140611);}get[_0x58230d(0x191)](){return this['primitives'];}get['data'](){return this['_data'];}set['data'](_0x49fd74){this['setData'](_0x49fd74);}get[_0x58230d(0x126)](){const _0x464434=_0x58230d;return this['options'][_0x464434(0x126)];}set['colors'](_0x4c1cb3){const _0x207a27=_0x58230d;this[_0x207a27(0x1bc)]['colors']=_0x4c1cb3,this['particleSystem']&&this['particleSystem']['setOptions']({'colors':_0x4c1cb3}),this['resize']();}['_mountedHook'](){}[_0x58230d(0x1cc)](){const _0x1073d6=_0x58230d;this['scene']=this[_0x1073d6(0xfd)]['scene'],this['camera']=this[_0x1073d6(0xfd)][_0x1073d6(0x150)],this['primitives']=new Cesium$1[(_0x1073d6(0x1d4))](),this['_map']['scene'][_0x1073d6(0x1da)][_0x1073d6(0x15a)](this['primitives']),this['viewerParameters']={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x1073d6(0x144)](_0x1073d6(0x1c2),this['resize']['bind'](this),![]),this[_0x1073d6(0x139)]=![],this['mouse_move']=![],this[_0x1073d6(0xfd)]['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace[_0x1073d6(0x1eb)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x1073d6(0x10c)],this['_onMouseUpEvent'],this),this[_0x1073d6(0xfd)]['on'](mars3d__namespace[_0x1073d6(0x1eb)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x1073d6(0x1ec)]);}['_removedHook'](){const _0x49f15d=_0x58230d;window['removeEventListener']('resize',this['resize']),this['_map'][_0x49f15d(0x12a)](mars3d__namespace[_0x49f15d(0x1eb)][_0x49f15d(0x13b)],this[_0x49f15d(0x146)],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x49f15d(0x155)],this[_0x49f15d(0x1a6)],this),this[_0x49f15d(0xfd)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x49f15d(0x12a)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x49f15d(0x1da)]['removeAll'](),this['_map']['scene'][_0x49f15d(0x1da)]['remove'](this['primitives']);}['resize'](){const _0x3d3321=_0x58230d;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace[_0x3d3321(0x1eb)]['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x553cc4){this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}[_0x58230d(0x1e9)](_0x35060e){const _0xa9c972=_0x58230d;clearTimeout(this[_0xa9c972(0x141)]);if(!this['show']||!this[_0xa9c972(0x1d7)])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x4accbb){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x3cb7c6){const _0x319255=_0x58230d;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&(this['primitives'][_0x319255(0x106)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x16569e){const _0x48928d=_0x58230d;if(!this['show']||!this['particleSystem'])return;this[_0x48928d(0x139)]&&this['mouse_move']&&this['redraw'](),this[_0x48928d(0x1da)][_0x48928d(0x106)]=!![],this['mouse_down']=![],this[_0x48928d(0x119)]=![];}['redraw'](){const _0x268eaf=_0x58230d;if(!this['_map']||!this[_0x268eaf(0x106)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this[_0x268eaf(0x11d)]),this[_0x268eaf(0x1da)]['show']=!![];}['setData'](_0x42363d){const _0x256f73=_0x58230d;this['_data']=_0x42363d,this[_0x256f73(0x1d7)]&&this['particleSystem']['destroy'](),this[_0x256f73(0x1d7)]=new ParticleSystem(this[_0x256f73(0x1f1)]['context'],_0x42363d,this['getOptions'](),this['viewerParameters']),this['addPrimitives']();}[_0x58230d(0x1c5)](_0x934a56,_0x3f82ba){const _0x3b5c17=_0x58230d;if(_0x934a56)for(const _0x37eeeb in _0x934a56){this[_0x37eeeb]=_0x934a56[_0x37eeeb];}this['particleSystem']&&this[_0x3b5c17(0x1d7)][_0x3b5c17(0x11f)](this['getOptions']());}['getOptions'](){const _0x42a747=_0x58230d,_0x55e691=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x55e691*_0x55e691,{'particlesTextureSize':_0x55e691,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x42a747(0x113)],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this[_0x42a747(0x1a0)],'colors':this['colors']};}[_0x58230d(0x115)](){const _0x163a47=_0x58230d;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives'][_0x163a47(0x15a)](this['particleSystem']['particlesComputing']['primitives'][_0x163a47(0x164)]),this['primitives']['add'](this['particleSystem'][_0x163a47(0x1f0)]['primitives']['updatePosition']),this[_0x163a47(0x1da)]['add'](this['particleSystem']['particlesComputing']['primitives'][_0x163a47(0x109)]),this['primitives'][_0x163a47(0x15a)](this['particleSystem'][_0x163a47(0x1f0)]['primitives']['postProcessingSpeed']),this[_0x163a47(0x1da)]['add'](this['particleSystem'][_0x163a47(0x1c3)]['primitives']['segments']),this['primitives']['add'](this[_0x163a47(0x1d7)][_0x163a47(0x1c3)][_0x163a47(0x1da)][_0x163a47(0x145)]),this[_0x163a47(0x1da)]['add'](this['particleSystem']['particlesRendering'][_0x163a47(0x1da)]['screen']);}['updateViewerParameters'](){const _0x4a5881=_0x58230d;let _0x5b1046=this['camera'][_0x4a5881(0x124)](this['scene']['globe'][_0x4a5881(0x15f)]);if(!_0x5b1046){const _0x5b5428=this['_map']['getExtent']();_0x5b1046=Cesium$1['Rectangle']['fromDegrees'](_0x5b5428['xmin'],_0x5b5428['ymin'],_0x5b5428['xmax'],_0x5b5428[_0x4a5881(0x1d0)]);}const _0x4ed3ef=Util['viewRectangleToLonLatRange'](_0x5b1046);this[_0x4a5881(0x11d)]['lonRange']['x']=_0x4ed3ef['lon']['min'],this['viewerParameters'][_0x4a5881(0x175)]['y']=_0x4ed3ef[_0x4a5881(0x154)][_0x4a5881(0x19d)],this[_0x4a5881(0x11d)][_0x4a5881(0x18f)]['x']=_0x4ed3ef['lat']['min'],this['viewerParameters'][_0x4a5881(0x18f)]['y']=_0x4ed3ef[_0x4a5881(0x136)]['max'];const _0x40bc6d=this['camera']['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0x40bc6d>0x0&&(this['viewerParameters']['pixelSize']=_0x40bc6d);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;function _0x2262(){const _0x5697ea=['worker','bind','randomBetween','fromGeometry','NEAREST','ShaderProgram','_calcUV','visible','strokeStyle','_pointerEvents','STATIC_DRAW','Appearance','_onMapWhellEvent','_onMouseUpEvent','EventType','_data','preExecute','canvasWind','defined','particlesComputing','scene','currentTrails','_drawLines','1542250ELdPKd','Color','_map','beginPath','push','age','drawingBufferHeight','nextTrailsDepth','4419092waPPWd','Cartesian3','height','show','canvas','grid','postProcessingPosition','createParticlesTextures','CanvasWindField','mouseUp','createRawRenderState','mode','IDENTITY','particlesWind','GeometryAttribute','RGB','dropRate','_colorRamp','addPrimitives','setData','vertexShaderSource','getUVByXY','mouse_move','vmax','pointerEvents','particleHeight','viewerParameters','context','setOptions','length','uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','7Vfszan','isPointVisible','computeViewRectangle','frameTime','colors','getRandomLatLng','udata','updatePosition','off','TRIANGLES','createCommand','canvasWidth','sqrt','update','segmentsColor','attributeLocations','destroyParticlesTextures','levmin','xmax','182807vHAFSJ','lat','cols','stroke','mouse_down','createSegmentsGeometry','preRender','zIndex','3339112ydzptU','ShaderSource','3208614Jhnuhf','currentTrailsDepth','refreshTimer','colorTable','fromCssColorString','addEventListener','trails','_onMap_preRenderEvent','_calc_speedRate','FLOAT','south','nextTrailsColor','Compute','data','Cesium','maxParticles','array','camera','clearFramebuffers','arrayBufferView','removeChild','lon','mouseDown','umin','segmentsDepth','getColorTexture','keys','add','tlng','globe','postProcessingSpeed','canvasContext','ellipsoid','frameRate','clear','0px','xmin','updateSpeed','clearCommand','particlesTextureSize','onmessage','toRadians','create','particles','speedRate','auto','clampToLatitudeRange','66dyKrXA','BufferUsage','random','clientWidth','umax','segments','toDegrees','lonRange','geometry','setGeometry','steps','createTexture','mars3d-canvasWind','lev','SCENE3D','9tXIMic','framebuffers','EllipsoidalOccluder','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','lineTo','RGBA','reverse','hidden','PI_OVER_TWO','currentParticlesPosition','currentTrailsColor','Math','UNSIGNED_BYTE','_removedHook','autoClear','SceneTransforms','redraw','windData','latRange','_speedRate','layer','PrimitiveType','_randomParticle','windField','nextParticlesSpeed','TextureMinificationFilter','reverseY','PixelFormat','absolute','style','PixelDatatype','initWorker','max','createFramebuffer','commandToExecute','lineWidth','6TTAxpL','_mountedHook','3244458HgVegc','OPAQUE','windTextures','_onMouseDownEvent','_tomap','GeometryAttributes','default','vertexArray','THREE_PI_OVER_TWO','depthTexture','canrefresh','position','createComputingPrimitives','forEach','floor','postMessage','east','now','Draw','nextTrails','blending','vdata','wheel','particlesNumber','none','options','viewport','ymin','_createCanvas','LUMINANCE','particlesTextures','resize','particlesRendering','TextureMagnificationFilter','_setOptionsHook','rows','__esModule','lng','_onMouseMoveEvent','_bilinearInterpolation','textures','_addedHook','getParticles','WindUtil','_updateIng','ymax','destroy','2867030vFlGQv','min','PrimitiveCollection','outputTexture','ComponentDatatype','particleSystem','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','primitiveType','primitives','maxAge','dimensions'];_0x2262=function(){return _0x5697ea;};return _0x2262();}class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x39ad97 in this){delete this[_0x39ad97];}}}class CanvasWindField{constructor(_0x288e5b){this['setOptions'](_0x288e5b);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x37eda7){const _0x401018=_0x58230d;this['_speedRate']=(0x64-(_0x37eda7>0x63?0x63:_0x37eda7))*0x64,this['_calc_speedRate']=[(this[_0x401018(0x134)]-this['xmin'])/this['_speedRate'],(this['ymax']-this['ymin'])/this[_0x401018(0x190)]];}get[_0x58230d(0x1db)](){return this['_maxAge'];}set['maxAge'](_0x5b62b3){this['_maxAge']=_0x5b62b3;}['setOptions'](_0x1a770e){const _0x1a2535=_0x58230d;this[_0x1a2535(0x1bc)]=_0x1a770e,this['maxAge']=_0x1a770e['maxAge']||0x78,this['speedRate']=_0x1a770e['speedRate']||0x32,this[_0x1a2535(0x16a)]=[];const _0x23adb0=_0x1a770e['particlesNumber']||0x1000;for(let _0x507578=0x0;_0x507578<_0x23adb0;_0x507578++){const _0x8188c3=this[_0x1a2535(0x193)](new CanvasParticle());this[_0x1a2535(0x16a)]['push'](_0x8188c3);}}['setDate'](_0x528e26){const _0x4e361a=_0x58230d;this[_0x4e361a(0x1c6)]=_0x528e26['rows'],this[_0x4e361a(0x137)]=_0x528e26['cols'],this[_0x4e361a(0x163)]=_0x528e26['xmin'],this['xmax']=_0x528e26[_0x4e361a(0x134)],this['ymin']=_0x528e26[_0x4e361a(0x1be)],this[_0x4e361a(0x1d0)]=_0x528e26['ymax'],this[_0x4e361a(0x108)]=[];const _0xc38eec=_0x528e26[_0x4e361a(0x128)],_0x4d5a25=_0x528e26[_0x4e361a(0x1b8)];let _0x2b8873=![];_0xc38eec['length']===this[_0x4e361a(0x1c6)]&&_0xc38eec[0x0]['length']===this['cols']&&(_0x2b8873=!![]);let _0x5599d0=0x0,_0x193f15=null,_0x447854=null;for(let _0x5a6224=0x0;_0x5a6224<this['rows'];_0x5a6224++){_0x193f15=[];for(let _0x55422c=0x0;_0x55422c<this[_0x4e361a(0x137)];_0x55422c++,_0x5599d0++){_0x2b8873?_0x447854=this[_0x4e361a(0x1e3)](_0xc38eec[_0x5a6224][_0x55422c],_0x4d5a25[_0x5a6224][_0x55422c]):_0x447854=this['_calcUV'](_0xc38eec[_0x5599d0],_0x4d5a25[_0x5599d0]),_0x193f15[_0x4e361a(0xff)](_0x447854);}this['grid']['push'](_0x193f15);}this[_0x4e361a(0x1bc)]['reverseY']&&this['grid'][_0x4e361a(0x183)]();}[_0x58230d(0x161)](){const _0x586b60=_0x58230d;delete this[_0x586b60(0x1c6)],delete this['cols'],delete this[_0x586b60(0x163)],delete this['xmax'],delete this['ymin'],delete this[_0x586b60(0x1d0)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x367fe2,_0x4cb040){const _0x1b90e6=_0x58230d,_0x53af9f=(_0x367fe2-this['xmin'])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0x302590=(this['ymax']-_0x4cb040)/(this['ymax']-this['ymin'])*(this[_0x1b90e6(0x1c6)]-0x1);return[_0x53af9f,_0x302590];}['getUVByXY'](_0xc605e3,_0x1107bd){const _0xc617eb=_0x58230d;if(_0xc605e3<0x0||_0xc605e3>=this['cols']||_0x1107bd>=this['rows'])return[0x0,0x0,0x0];const _0x569c96=Math['floor'](_0xc605e3),_0x94ac36=Math[_0xc617eb(0x1b1)](_0x1107bd);if(_0x569c96===_0xc605e3&&_0x94ac36===_0x1107bd)return this['grid'][_0x1107bd][_0xc605e3];const _0xfaaa6b=_0x569c96+0x1,_0xa47b35=_0x94ac36+0x1,_0x1974ea=this['getUVByXY'](_0x569c96,_0x94ac36),_0x14285e=this[_0xc617eb(0x118)](_0xfaaa6b,_0x94ac36),_0x36d74f=this['getUVByXY'](_0x569c96,_0xa47b35),_0x1f70cd=this['getUVByXY'](_0xfaaa6b,_0xa47b35);let _0x1d3b83=null;try{_0x1d3b83=this[_0xc617eb(0x1ca)](_0xc605e3-_0x569c96,_0x1107bd-_0x94ac36,_0x1974ea,_0x14285e,_0x36d74f,_0x1f70cd);}catch(_0x4db46a){console['log'](_0xc605e3,_0x1107bd);}return _0x1d3b83;}[_0x58230d(0x1ca)](_0x533ff9,_0x4d6c81,_0x2c0d78,_0x234b2c,_0x23f2de,_0x5ab8da){const _0x549151=_0x58230d,_0x983834=0x1-_0x533ff9,_0x199dab=0x1-_0x4d6c81,_0x16ac51=_0x983834*_0x199dab,_0x571fc1=_0x533ff9*_0x199dab,_0x1be11d=_0x983834*_0x4d6c81,_0x349712=_0x533ff9*_0x4d6c81,_0x36bddd=_0x2c0d78[0x0]*_0x16ac51+_0x234b2c[0x0]*_0x571fc1+_0x23f2de[0x0]*_0x1be11d+_0x5ab8da[0x0]*_0x349712,_0x52057c=_0x2c0d78[0x1]*_0x16ac51+_0x234b2c[0x1]*_0x571fc1+_0x23f2de[0x1]*_0x1be11d+_0x5ab8da[0x1]*_0x349712;return this[_0x549151(0x1e3)](_0x36bddd,_0x52057c);}[_0x58230d(0x1e3)](_0x5a7402,_0x394c49){const _0x5666c8=_0x58230d;return[+_0x5a7402,+_0x394c49,Math[_0x5666c8(0x12e)](_0x5a7402*_0x5a7402+_0x394c49*_0x394c49)];}['getUVByPoint'](_0x55dda3,_0x390752){const _0x18d6b8=_0x58230d;if(!this['isInExtent'](_0x55dda3,_0x390752))return null;const _0x5e1c4b=this['toGridXY'](_0x55dda3,_0x390752),_0x5724e7=this[_0x18d6b8(0x118)](_0x5e1c4b[0x0],_0x5e1c4b[0x1]);return _0x5724e7;}['isInExtent'](_0x8c81d5,_0x21b50b){return _0x8c81d5>=this['xmin']&&_0x8c81d5<=this['xmax']&&_0x21b50b>=this['ymin']&&_0x21b50b<=this['ymax']?!![]:![];}[_0x58230d(0x127)](){const _0x169f0a=_0x58230d,_0x135d9f=fRandomByfloat(this['xmin'],this[_0x169f0a(0x134)]),_0x472bf8=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x472bf8,'lng':_0x135d9f};}[_0x58230d(0x1cd)](){const _0xc65713=_0x58230d;let _0x2ae5b1,_0x121892,_0x2ed71f;for(let _0x4b2202=0x0,_0x1b3873=this['particles'][_0xc65713(0x120)];_0x4b2202<_0x1b3873;_0x4b2202++){let _0x52ec99=this[_0xc65713(0x16a)][_0x4b2202];_0x52ec99['age']<=0x0&&(_0x52ec99=this['_randomParticle'](_0x52ec99));if(_0x52ec99[_0xc65713(0x100)]>0x0){const _0x1b49b0=_0x52ec99[_0xc65713(0x15b)],_0x57bddd=_0x52ec99['tlat'];_0x2ed71f=this['getUVByPoint'](_0x1b49b0,_0x57bddd),_0x2ed71f?(_0x2ae5b1=_0x1b49b0+this['_calc_speedRate'][0x0]*_0x2ed71f[0x0],_0x121892=_0x57bddd+this[_0xc65713(0x147)][0x1]*_0x2ed71f[0x1],_0x52ec99[_0xc65713(0x1c8)]=_0x1b49b0,_0x52ec99[_0xc65713(0x136)]=_0x57bddd,_0x52ec99['tlng']=_0x2ae5b1,_0x52ec99['tlat']=_0x121892,_0x52ec99['speed']=_0x2ed71f[0x2],_0x52ec99[_0xc65713(0x100)]--):_0x52ec99[_0xc65713(0x100)]=0x0;}}return this['particles'];}[_0x58230d(0x193)](_0x41002e){const _0x14b63b=_0x58230d;let _0x436f8d,_0x4f9456;for(let _0x2184bb=0x0;_0x2184bb<0x1e;_0x2184bb++){_0x436f8d=this['getRandomLatLng'](),_0x4f9456=this['getUVByPoint'](_0x436f8d[_0x14b63b(0x1c8)],_0x436f8d['lat']);if(_0x4f9456&&_0x4f9456[0x2]>0x0)break;}if(!_0x4f9456)return _0x41002e;const _0x193057=_0x436f8d['lng']+this[_0x14b63b(0x147)][0x0]*_0x4f9456[0x0],_0x3a256c=_0x436f8d[_0x14b63b(0x136)]+this['_calc_speedRate'][0x1]*_0x4f9456[0x1];return _0x41002e['lng']=_0x436f8d['lng'],_0x41002e['lat']=_0x436f8d[_0x14b63b(0x136)],_0x41002e[_0x14b63b(0x15b)]=_0x193057,_0x41002e['tlat']=_0x3a256c,_0x41002e[_0x14b63b(0x100)]=Math['round'](Math[_0x14b63b(0x170)]()*this['maxAge']),_0x41002e['speed']=_0x4f9456[0x2],_0x41002e;}['destroy'](){for(const _0x3726ab in this){delete this[_0x3726ab];}}}function fRandomByfloat(_0x502b6a,_0x55b4e4){const _0xb28771=_0x58230d;return _0x502b6a+Math[_0xb28771(0x170)]()*(_0x55b4e4-_0x502b6a);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];function _0x4502(_0x106261,_0xce4ab){const _0x226200=_0x2262();return _0x4502=function(_0x450232,_0x466edd){_0x450232=_0x450232-0xfd;let _0x26d644=_0x226200[_0x450232];return _0x26d644;},_0x4502(_0x106261,_0xce4ab);}class CanvasWindLayer extends BaseLayer{constructor(_0x411559={}){const _0x4fcd9d=_0x58230d;super(_0x411559),this[_0x4fcd9d(0x1c5)](_0x411559),this['canvas']=null,_0x411559['colors']&&_0x411559[_0x4fcd9d(0x178)]&&(this[_0x4fcd9d(0x114)]=new mars3d__namespace['ColorRamp'](_0x411559));}[_0x58230d(0x1c5)](_0x144011,_0x4b93c2){const _0x154ebc=_0x58230d;this[_0x154ebc(0x125)]=0x3e8/(_0x144011[_0x154ebc(0x160)]||0xa),this['_pointerEvents']=this[_0x154ebc(0x1bc)][_0x154ebc(0x11b)]??![],this['color']=_0x144011['color']||'#ffffff',this['lineWidth']=_0x144011[_0x154ebc(0x1a0)]||0x1,this['fixedHeight']=_0x144011['fixedHeight']??0x0,this[_0x154ebc(0x197)]=_0x144011[_0x154ebc(0x197)]??![],this['windField']&&this['windField']['setOptions'](_0x144011);}get['layer'](){return this['canvas'];}get[_0x58230d(0x12d)](){const _0xa06a47=_0x58230d;return this['_map'][_0xa06a47(0x1f1)][_0xa06a47(0x107)]['clientWidth'];}get['canvasHeight'](){return this['_map']['scene']['canvas']['clientHeight'];}get['pointerEvents'](){const _0x93356f=_0x58230d;return this[_0x93356f(0x1e6)];}set['pointerEvents'](_0x1557d5){const _0x318eb4=_0x58230d;this['_pointerEvents']=_0x1557d5;if(!this['canvas'])return;_0x1557d5?this['canvas']['style']['pointer-events']='all':this[_0x318eb4(0x107)]['style']['pointer-events']=_0x318eb4(0x1bb);}get['particlesNumber'](){const _0x56b688=_0x58230d;return this['options'][_0x56b688(0x1ba)];}set[_0x58230d(0x1ba)](_0xf072b9){this['options']['particlesNumber']=_0xf072b9,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{const _0x65f30a=_0x4502;this[_0x65f30a(0x18d)]();},0x1f4);}get[_0x58230d(0x16b)](){const _0x1ee96a=_0x58230d;return this[_0x1ee96a(0x1bc)]['speedRate'];}set['speedRate'](_0x541936){const _0x235e0e=_0x58230d;this[_0x235e0e(0x1bc)][_0x235e0e(0x16b)]=_0x541936,this['windField']&&(this['windField']['speedRate']=_0x541936);}get['maxAge'](){const _0x5f437a=_0x58230d;return this['options'][_0x5f437a(0x1db)];}set[_0x58230d(0x1db)](_0x4bfe6d){const _0x4f602d=_0x58230d;this['options']['maxAge']=_0x4bfe6d,this[_0x4f602d(0x194)]&&(this['windField']['maxAge']=_0x4bfe6d);}get['data'](){return this['windData'];}set[_0x58230d(0x14c)](_0x3d4a38){this['setData'](_0x3d4a38);}['_showHook'](_0x363f63){_0x363f63?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}[_0x58230d(0x1a2)](){const _0x187b5d=_0x58230d;this['options'][_0x187b5d(0x1dd)]?this[_0x187b5d(0x19c)]():this['windField']=new CanvasWindField(this['options']);}['_addedHook'](){const _0x5214db=_0x58230d;this['canvas']=this[_0x5214db(0x1bf)](),this[_0x5214db(0x15e)]=this[_0x5214db(0x107)]['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options'][_0x5214db(0x14c)]&&this['setData'](this['options']['data']);}[_0x58230d(0x18a)](){const _0x51cb65=_0x58230d;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container'][_0x51cb65(0x153)](this[_0x51cb65(0x107)]),delete this[_0x51cb65(0x107)]);}[_0x58230d(0x1bf)](){const _0x743c82=_0x58230d,_0x3d71db=mars3d__namespace['DomUtil'][_0x743c82(0x169)](_0x743c82(0x107),_0x743c82(0x17a),this['_map']['container']);return _0x3d71db['style'][_0x743c82(0x1ae)]=_0x743c82(0x199),_0x3d71db[_0x743c82(0x19a)]['top']=_0x743c82(0x162),_0x3d71db['style']['left']='0px',_0x3d71db['style']['width']=this[_0x743c82(0xfd)][_0x743c82(0x1f1)]['canvas']['clientWidth']+'px',_0x3d71db[_0x743c82(0x19a)]['height']=this[_0x743c82(0xfd)]['scene']['canvas']['clientHeight']+'px',_0x3d71db[_0x743c82(0x19a)]['pointerEvents']=this['_pointerEvents']?_0x743c82(0x16c):'none',_0x3d71db['style']['zIndex']=this[_0x743c82(0x1bc)][_0x743c82(0x13c)]??0x9,_0x3d71db['width']=this['_map']['scene']['canvas']['clientWidth'],_0x3d71db['height']=this[_0x743c82(0xfd)]['scene']['canvas']['clientHeight'],_0x3d71db;}[_0x58230d(0x1c2)](){const _0x1fd0ab=_0x58230d;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style'][_0x1fd0ab(0x105)]=this['_map'][_0x1fd0ab(0x1f1)][_0x1fd0ab(0x107)]['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas'][_0x1fd0ab(0x171)],this[_0x1fd0ab(0x107)]['height']=this['_map'][_0x1fd0ab(0x1f1)]['canvas']['clientHeight']);}['bindEvent'](){const _0x1a84e6=_0x58230d,_0x1a732a=this;let _0x532145=Date['now']();(function _0x2381a1(){const _0x258505=_0x4502;_0x1a732a['animateFrame']=window['requestAnimationFrame'](_0x2381a1);if(_0x1a732a['show']&&_0x1a732a['windField']){const _0x5b6536=Date[_0x258505(0x1b4)](),_0x2cad3a=_0x5b6536-_0x532145;_0x2cad3a>_0x1a732a['frameTime']&&(_0x532145=_0x5b6536-_0x2cad3a%_0x1a732a['frameTime'],_0x1a732a['update']());}}(),window['addEventListener'](_0x1a84e6(0x1c2),this['resize'][_0x1a84e6(0x1de)](this),![]),this['mouse_down']=![],this[_0x1a84e6(0x119)]=![],this['options']['mouseHidden']&&(this[_0x1a84e6(0xfd)]['on'](mars3d__namespace['EventType'][_0x1a84e6(0x1b9)],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace[_0x1a84e6(0x1eb)]['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0xf5ad84=_0x58230d;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this[_0xf5ad84(0xfd)][_0xf5ad84(0x12a)](mars3d__namespace['EventType'][_0xf5ad84(0x1b9)],this['_onMapWhellEvent'],this),this[_0xf5ad84(0xfd)][_0xf5ad84(0x12a)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0xf5ad84(0xfd)]['off'](mars3d__namespace[_0xf5ad84(0x1eb)]['mouseUp'],this[_0xf5ad84(0x1ea)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0xf5ad84(0x1c9)],this));}['_onMapWhellEvent'](_0x59c6ea){const _0x441736=_0x58230d;clearTimeout(this[_0x441736(0x141)]);if(!this['show']||!this[_0x441736(0x107)])return;this['canvas']['style']['visibility']='hidden',this[_0x441736(0x141)]=setTimeout(()=>{const _0x2b4fcc=_0x441736;if(!this['show'])return;this['redraw'](),this['canvas']['style']['visibility']=_0x2b4fcc(0x1e4);},0xc8);}['_onMouseDownEvent'](_0x41e2ba){const _0x35c73c=_0x58230d;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x35c73c(0x1eb)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x35c73c(0x1c9)],this);}['_onMouseMoveEvent'](_0x21dd11){const _0x4bcaa3=_0x58230d;if(!this[_0x4bcaa3(0x106)]||!this['canvas'])return;this[_0x4bcaa3(0x139)]&&(this['canvas'][_0x4bcaa3(0x19a)]['visibility']=_0x4bcaa3(0x184),this[_0x4bcaa3(0x119)]=!![]);}['_onMouseUpEvent'](_0x53816e){const _0x37f64d=_0x58230d;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x37f64d(0x139)]&&this['mouse_move']&&this[_0x37f64d(0x18d)](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this['mouse_move']=![];}[_0x58230d(0x116)](_0x5addf4){this['clear'](),this['windData']=_0x5addf4,this['windField']['setDate'](_0x5addf4),this['redraw']();}['redraw'](){const _0x320e39=_0x58230d;if(!this['show'])return;this['windField']['setOptions'](this[_0x320e39(0x1bc)]),this['update']();}[_0x58230d(0x12f)](){const _0x4f49ae=_0x58230d;if(this[_0x4f49ae(0x1cf)])return;this[_0x4f49ae(0x1cf)]=!![];if(this['worker'])this[_0x4f49ae(0x194)]['update']();else{const _0x5a8111=this[_0x4f49ae(0x194)]['getParticles']();this['_drawLines'](_0x5a8111);}this['_updateIng']=![];}['_drawLines'](_0x4fadb2){const _0x3a66a2=_0x58230d;this[_0x3a66a2(0x15e)]['globalCompositeOperation']='destination-in',this[_0x3a66a2(0x15e)]['fillRect'](0x0,0x0,this[_0x3a66a2(0x12d)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext']['globalAlpha']=0.9;const _0x179916=this['_map'][_0x3a66a2(0x1f1)]['mode']!==Cesium['SceneMode']['SCENE3D'],_0x5b21cd=this[_0x3a66a2(0x12d)]*0.25;if(this['_colorRamp'])for(let _0x2aee7f=0x0,_0x13a104=_0x4fadb2['length'];_0x2aee7f<_0x13a104;_0x2aee7f++){const _0x33a473=_0x4fadb2[_0x2aee7f],_0x488ddb=this[_0x3a66a2(0x1a7)](_0x33a473[_0x3a66a2(0x1c8)],_0x33a473['lat'],_0x33a473),_0x335070=this['_tomap'](_0x33a473['tlng'],_0x33a473['tlat'],_0x33a473);if(!_0x488ddb||!_0x335070)continue;if(_0x179916&&Math['abs'](_0x488ddb[0x0]-_0x335070[0x0])>=_0x5b21cd)continue;this['canvasContext']['beginPath'](),this['canvasContext'][_0x3a66a2(0x1a0)]=this[_0x3a66a2(0x1a0)],this[_0x3a66a2(0x15e)]['strokeStyle']=this[_0x3a66a2(0x114)]['getColor'](_0x33a473['speed']),this['canvasContext']['moveTo'](_0x488ddb[0x0],_0x488ddb[0x1]),this['canvasContext']['lineTo'](_0x335070[0x0],_0x335070[0x1]),this[_0x3a66a2(0x15e)][_0x3a66a2(0x138)]();}else{this['canvasContext'][_0x3a66a2(0xfe)](),this['canvasContext'][_0x3a66a2(0x1a0)]=this['lineWidth'],this[_0x3a66a2(0x15e)][_0x3a66a2(0x1e5)]=this['color'];for(let _0x3a39ea=0x0,_0x56e979=_0x4fadb2[_0x3a66a2(0x120)];_0x3a39ea<_0x56e979;_0x3a39ea++){const _0x2907dd=_0x4fadb2[_0x3a39ea],_0x48387f=this['_tomap'](_0x2907dd['lng'],_0x2907dd[_0x3a66a2(0x136)],_0x2907dd),_0x43c071=this['_tomap'](_0x2907dd['tlng'],_0x2907dd['tlat'],_0x2907dd);if(!_0x48387f||!_0x43c071)continue;if(_0x179916&&Math['abs'](_0x48387f[0x0]-_0x43c071[0x0])>=_0x5b21cd)continue;this['canvasContext']['moveTo'](_0x48387f[0x0],_0x48387f[0x1]),this['canvasContext'][_0x3a66a2(0x181)](_0x43c071[0x0],_0x43c071[0x1]);}this['canvasContext'][_0x3a66a2(0x138)]();}}['_tomap'](_0x19725e,_0x1d7a29,_0x1563d8){const _0x19ea71=_0x58230d,_0x192267=Cesium['Cartesian3']['fromDegrees'](_0x19725e,_0x1d7a29,this['fixedHeight']),_0xee1bd1=this['_map']['scene'];if(_0xee1bd1['mode']===Cesium['SceneMode'][_0x19ea71(0x17c)]){const _0x4c85fb=new Cesium[(_0x19ea71(0x17f))](_0xee1bd1[_0x19ea71(0x15c)]['ellipsoid'],_0xee1bd1['camera']['positionWC']),_0x3e6522=_0x4c85fb[_0x19ea71(0x123)](_0x192267);if(!_0x3e6522)return _0x1563d8[_0x19ea71(0x100)]=0x0,null;}const _0xff47c1=Cesium[_0x19ea71(0x18c)]['wgs84ToWindowCoordinates'](this[_0x19ea71(0xfd)][_0x19ea71(0x1f1)],_0x192267);return _0xff47c1?[_0xff47c1['x'],_0xff47c1['y']]:null;}['clear'](){const _0x424c90=_0x58230d;this[_0x424c90(0x194)]['clear'](),delete this[_0x424c90(0x18e)];}['initWorker'](){const _0x32ddcc=_0x58230d;this['worker']=new Worker(this[_0x32ddcc(0x1bc)][_0x32ddcc(0x1dd)]),this[_0x32ddcc(0x1dd)][_0x32ddcc(0x167)]=_0x493724=>{const _0x57e5d6=_0x32ddcc;this[_0x57e5d6(0x1f3)](_0x493724['data'][_0x57e5d6(0x16a)]),this['_updateIng2']=![];},this[_0x32ddcc(0x194)]={'init':_0x4d7d32=>{const _0x27c3ca=_0x32ddcc;this[_0x27c3ca(0x1dd)]['postMessage']({'type':'init','options':_0x4d7d32});},'setOptions':_0x5d291b=>{const _0xdf7f57=_0x32ddcc;this[_0xdf7f57(0x1dd)]['postMessage']({'type':'setOptions','options':_0x5d291b});},'setDate':_0x1a200d=>{const _0x5d71ac=_0x32ddcc;this['worker'][_0x5d71ac(0x1b2)]({'type':'setDate','data':_0x1a200d});},'update':()=>{const _0x2282a8=_0x32ddcc;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker'][_0x2282a8(0x1b2)]({'type':'update'});},'clear':()=>{const _0x1b6e19=_0x32ddcc;this['worker']['postMessage']({'type':_0x1b6e19(0x161)});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register'](_0x58230d(0x1ee),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x58230d(0x10b)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x58230d(0x1ce)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
