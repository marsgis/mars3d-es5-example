/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.17
 * 编译日期：2023-12-17 23:57:32
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x1296a0=_0x4d21;(function(_0x16dca3,_0x4b0767){const _0x183c31=_0x4d21,_0x3465c0=_0x16dca3();while(!![]){try{const _0x50c078=parseInt(_0x183c31(0xf8))/0x1+parseInt(_0x183c31(0xd7))/0x2*(parseInt(_0x183c31(0x102))/0x3)+parseInt(_0x183c31(0x11c))/0x4*(-parseInt(_0x183c31(0x18d))/0x5)+parseInt(_0x183c31(0x18f))/0x6+parseInt(_0x183c31(0x139))/0x7*(parseInt(_0x183c31(0x155))/0x8)+parseInt(_0x183c31(0x118))/0x9*(parseInt(_0x183c31(0x16b))/0xa)+-parseInt(_0x183c31(0xe3))/0xb;if(_0x50c078===_0x4b0767)break;else _0x3465c0['push'](_0x3465c0['shift']());}catch(_0x252fb1){_0x3465c0['push'](_0x3465c0['shift']());}}}(_0x2116,0x22170));function _interopNamespace(_0x590b1f){const _0xc7bdc7=_0x4d21;if(_0x590b1f&&_0x590b1f['__esModule'])return _0x590b1f;var _0x26f10b=Object['create'](null);return _0x590b1f&&Object[_0xc7bdc7(0x108)](_0x590b1f)['forEach'](function(_0x296662){const _0x1e2fc5=_0xc7bdc7;if(_0x296662!==_0x1e2fc5(0x158)){var _0x3b3f6e=Object[_0x1e2fc5(0xf3)](_0x590b1f,_0x296662);Object['defineProperty'](_0x26f10b,_0x296662,_0x3b3f6e['get']?_0x3b3f6e:{'enumerable':!![],'get':function(){return _0x590b1f[_0x296662];}});}}),_0x26f10b['default']=_0x590b1f,_0x26f10b;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace[_0x1296a0(0x12d)];function getU(_0x3c3dfb,_0xe1b50d){const _0x3014d4=_0x1296a0,_0x741dec=_0x3c3dfb*Math['cos'](Cesium$7['Math'][_0x3014d4(0x119)](_0xe1b50d));return _0x741dec;}function getV(_0x592360,_0x2910df){const _0x23388f=_0x1296a0,_0x4363ae=_0x592360*Math['sin'](Cesium$7[_0x23388f(0x11e)]['toRadians'](_0x2910df));return _0x4363ae;}function _0x4d21(_0xe3a28f,_0x398dd2){const _0x211635=_0x2116();return _0x4d21=function(_0x4d21ba,_0x3aea07){_0x4d21ba=_0x4d21ba-0xd5;let _0xc53591=_0x211635[_0x4d21ba];return _0xc53591;},_0x4d21(_0xe3a28f,_0x398dd2);}function getSpeed(_0x356ac5,_0x2cc7ab){const _0x2a4b7e=_0x1296a0,_0x429a59=Math[_0x2a4b7e(0x154)](Math['pow'](_0x356ac5,0x2)+Math['pow'](_0x2cc7ab,0x2));return _0x429a59;}function getDirection(_0x1ddf88,_0x2c5627){let _0x25f29c=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x2c5627,_0x1ddf88));return _0x25f29c+=_0x25f29c<0x0?0x168:0x0,_0x25f29c;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace[_0x1296a0(0x12d)];class CustomPrimitive{constructor(_0x1939de){const _0x3127fc=_0x1296a0;this['commandType']=_0x1939de[_0x3127fc(0x1b6)],this['geometry']=_0x1939de[_0x3127fc(0xd9)],this['attributeLocations']=_0x1939de['attributeLocations'],this[_0x3127fc(0xde)]=_0x1939de['primitiveType'],this['uniformMap']=_0x1939de['uniformMap'],this['vertexShaderSource']=_0x1939de['vertexShaderSource'],this['fragmentShaderSource']=_0x1939de['fragmentShaderSource'],this[_0x3127fc(0x19e)]=_0x1939de['rawRenderState'],this[_0x3127fc(0xe0)]=_0x1939de[_0x3127fc(0xe0)],this[_0x3127fc(0x103)]=_0x1939de['outputTexture'],this['autoClear']=_0x1939de['autoClear']??![],this[_0x3127fc(0xfa)]=_0x1939de['preExecute'],this['show']=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this['autoClear']&&(this[_0x3127fc(0x137)]=new Cesium$6['ClearCommand']({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x3127fc(0x1a6)]}));}['createCommand'](_0x3a9195){const _0x5a7a8a=_0x1296a0;switch(this[_0x5a7a8a(0x1b6)]){case'Draw':{const _0x127c32=Cesium$6['VertexArray']['fromGeometry']({'context':_0x3a9195,'geometry':this[_0x5a7a8a(0xd9)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x4d049b=Cesium$6['ShaderProgram']['fromCache']({'context':_0x3a9195,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this[_0x5a7a8a(0x11a)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x3b0a77=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x4d049b,'vertexArray':_0x127c32,'modelMatrix':Cesium$6['Matrix4'][_0x5a7a8a(0x15b)],'renderState':_0x3b0a77,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x5a7a8a(0xed)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x30f585,_0x57229b){const _0x96f4f0=_0x1296a0;this[_0x96f4f0(0xd9)]=_0x57229b;const _0x594eea=Cesium$6[_0x96f4f0(0x15a)][_0x96f4f0(0x107)]({'context':_0x30f585,'geometry':this[_0x96f4f0(0xd9)],'attributeLocations':this[_0x96f4f0(0x150)],'bufferUsage':Cesium$6['BufferUsage'][_0x96f4f0(0x166)]});this['commandToExecute']['vertexArray']=_0x594eea;}['update'](_0x458cfc){if(!this['show'])return;if(_0x458cfc['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this['commandToExecute']=this['createCommand'](_0x458cfc['context'])),Cesium$6['defined'](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0x458cfc['commandList']['push'](this['clearCommand']),_0x458cfc['commandList']['push'](this['commandToExecute']);}['isDestroyed'](){return![];}[_0x1296a0(0xe4)](){const _0x6538c7=_0x1296a0;if(this[_0x6538c7(0x137)]){var _0x3342a6,_0x5409fe;(_0x3342a6=this[_0x6538c7(0x137)])!==null&&_0x3342a6!==void 0x0&&_0x3342a6['vertexArray']&&this[_0x6538c7(0x137)]['vertexArray'][_0x6538c7(0xe4)](),(_0x5409fe=this['clearCommand'])!==null&&_0x5409fe!==void 0x0&&_0x5409fe[_0x6538c7(0x11b)]&&this[_0x6538c7(0x137)]['shaderProgram']['destroy'](),delete this[_0x6538c7(0x137)];}return this[_0x6538c7(0xf9)]&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x6538c7(0xe4)](),this[_0x6538c7(0xf9)]['shaderProgram']&&this['commandToExecute'][_0x6538c7(0x11b)]['destroy'](),delete this['commandToExecute']),Cesium$6[_0x6538c7(0x13b)](this);}}const Cesium$5=mars3d__namespace[_0x1296a0(0x12d)],Util=(function(){const _0x23a987=function(){const _0x58aaab=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x58aaab;},_0xe9fc73=function(_0x18f8fa,_0x27b29d){const _0x3d0324=_0x4d21;if(Cesium$5['defined'](_0x27b29d)){const _0x25e59b={};_0x25e59b['arrayBufferView']=_0x27b29d,_0x18f8fa['source']=_0x25e59b;}const _0x49123e=new Cesium$5[(_0x3d0324(0x13a))](_0x18f8fa);return _0x49123e;},_0x372407=function(_0x3944f9,_0x1b7e96,_0x189f09){const _0x3c2d38=new Cesium$5['Framebuffer']({'context':_0x3944f9,'colorTextures':[_0x1b7e96],'depthTexture':_0x189f09});return _0x3c2d38;},_0x12cb10=function(_0x212dc1){const _0x2a757a=_0x4d21,_0x21c1c8=!![],_0x288259=![],_0xd87070={'viewport':_0x212dc1['viewport'],'depthTest':_0x212dc1[_0x2a757a(0x110)],'depthMask':_0x212dc1['depthMask'],'blending':_0x212dc1['blending']},_0x1755fe=Cesium$5['Appearance'][_0x2a757a(0x138)](_0x21c1c8,_0x288259,_0xd87070);return _0x1755fe;},_0x3aeae0=function(_0x31c88c){const _0x491301=_0x4d21,_0x4f45ed={},_0xf0089c=Cesium$5['Math']['mod'](_0x31c88c['west'],Cesium$5[_0x491301(0x11e)][_0x491301(0x13e)]),_0x393a86=Cesium$5['Math'][_0x491301(0x10a)](_0x31c88c['east'],Cesium$5['Math']['TWO_PI']),_0x38c8fa=_0x31c88c['width'];let _0x150f2c,_0x3ce49b;_0x38c8fa>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x150f2c=0x0,_0x3ce49b=Cesium$5['Math'][_0x491301(0x13e)]):_0x393a86-_0xf0089c<_0x38c8fa?(_0x150f2c=_0xf0089c,_0x3ce49b=_0xf0089c+_0x38c8fa):(_0x150f2c=_0xf0089c,_0x3ce49b=_0x393a86);_0x4f45ed['lon']={'min':Cesium$5[_0x491301(0x11e)]['toDegrees'](_0x150f2c),'max':Cesium$5['Math']['toDegrees'](_0x3ce49b)};const _0x53093c=_0x31c88c['south'],_0x3666b4=_0x31c88c['north'],_0x433180=_0x31c88c['height'],_0x37871c=_0x433180>Cesium$5['Math']['PI']/0xc?_0x433180/0x2:0x0;let _0x29f54d=Cesium$5[_0x491301(0x11e)][_0x491301(0x191)](_0x53093c-_0x37871c),_0x2203b=Cesium$5['Math']['clampToLatitudeRange'](_0x3666b4+_0x37871c);return _0x29f54d<-Cesium$5[_0x491301(0x11e)][_0x491301(0x141)]&&(_0x29f54d=-Cesium$5['Math']['PI_OVER_TWO']),_0x2203b>Cesium$5[_0x491301(0x11e)][_0x491301(0x141)]&&(_0x2203b=Cesium$5[_0x491301(0x11e)][_0x491301(0x193)]),_0x4f45ed['lat']={'min':Cesium$5['Math']['toDegrees'](_0x29f54d),'max':Cesium$5['Math']['toDegrees'](_0x2203b)},_0x4f45ed;};return{'getFullscreenQuad':_0x23a987,'createTexture':_0xe9fc73,'createFramebuffer':_0x372407,'createRawRenderState':_0x12cb10,'viewRectangleToLonLatRange':_0x3aeae0};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x1296a0(0x1a4),trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x443040,_0x361708,_0x354c31,_0x50c214,_0x26906f){const _0x27fd0f=_0x1296a0;this['createRenderingTextures'](_0x443040,_0x361708,_0x354c31['colors']),this['createRenderingFramebuffers'](_0x443040),this[_0x27fd0f(0x17a)](_0x443040,_0x354c31,_0x50c214,_0x26906f);}['createRenderingTextures'](_0x3b2197,_0x3b6bcc,_0x2ea5dd){const _0x536b00=_0x1296a0,_0x5b6b3b={'context':_0x3b2197,'width':_0x3b2197['drawingBufferWidth'],'height':_0x3b2197[_0x536b00(0xe6)],'pixelFormat':Cesium$4['PixelFormat'][_0x536b00(0x151)],'pixelDatatype':Cesium$4['PixelDatatype'][_0x536b00(0xf1)]},_0x176ea7={'context':_0x3b2197,'width':_0x3b2197[_0x536b00(0xe2)],'height':_0x3b2197['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x16f1ee=_0x2ea5dd[_0x536b00(0x132)],_0x590214=new Float32Array(_0x16f1ee*0x3);for(let _0x430915=0x0;_0x430915<_0x16f1ee;_0x430915++){const _0x493bd9=Cesium$4['Color']['fromCssColorString'](_0x2ea5dd[_0x430915]);_0x590214[0x3*_0x430915]=_0x493bd9['red'],_0x590214[0x3*_0x430915+0x1]=_0x493bd9['green'],_0x590214[0x3*_0x430915+0x2]=_0x493bd9['blue'];}const _0x36c24d={'context':_0x3b2197,'width':_0x16f1ee,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4[(_0x536b00(0x136))]({'minificationFilter':Cesium$4[_0x536b00(0x143)][_0x536b00(0x169)],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x536b00(0x169)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x5b6b3b),'segmentsDepth':Util['createTexture'](_0x176ea7),'currentTrailsColor':Util[_0x536b00(0x164)](_0x5b6b3b),'currentTrailsDepth':Util['createTexture'](_0x176ea7),'nextTrailsColor':Util[_0x536b00(0x164)](_0x5b6b3b),'nextTrailsDepth':Util['createTexture'](_0x176ea7),'colorTable':Util[_0x536b00(0x164)](_0x36c24d,_0x590214)};}[_0x1296a0(0xec)](_0x5a8065){const _0xcc6ca6=_0x1296a0;this['framebuffers']={'segments':Util['createFramebuffer'](_0x5a8065,this[_0xcc6ca6(0x198)]['segmentsColor'],this[_0xcc6ca6(0x198)][_0xcc6ca6(0x145)]),'currentTrails':Util['createFramebuffer'](_0x5a8065,this['textures'][_0xcc6ca6(0x1a9)],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x5a8065,this['textures']['nextTrailsColor'],this['textures'][_0xcc6ca6(0x14d)])};}['createSegmentsGeometry'](_0x3dcab5){const _0x3d19ba=_0x1296a0,_0x4da25f=0x4;let _0x1b2f56=[];for(let _0x20389d=0x0;_0x20389d<_0x3dcab5['particlesTextureSize'];_0x20389d++){for(let _0x2c7280=0x0;_0x2c7280<_0x3dcab5['particlesTextureSize'];_0x2c7280++){for(let _0x3f8306=0x0;_0x3f8306<_0x4da25f;_0x3f8306++){_0x1b2f56['push'](_0x20389d/_0x3dcab5['particlesTextureSize']),_0x1b2f56['push'](_0x2c7280/_0x3dcab5['particlesTextureSize']);}}}_0x1b2f56=new Float32Array(_0x1b2f56);let _0x4f0af8=[];const _0xee189=[-0x1,0x1],_0x5950f9=[-0x1,0x1];for(let _0x2a710c=0x0;_0x2a710c<_0x3dcab5['maxParticles'];_0x2a710c++){for(let _0x40c8f9=0x0;_0x40c8f9<_0x4da25f/0x2;_0x40c8f9++){for(let _0x4af5ee=0x0;_0x4af5ee<_0x4da25f/0x2;_0x4af5ee++){_0x4f0af8[_0x3d19ba(0xda)](_0xee189[_0x40c8f9]),_0x4f0af8['push'](_0x5950f9[_0x4af5ee]),_0x4f0af8['push'](0x0);}}}_0x4f0af8=new Float32Array(_0x4f0af8);const _0x14d007=0x6*_0x3dcab5['maxParticles'],_0x4c9ecf=new Uint32Array(_0x14d007);for(let _0x2564a3=0x0,_0x14cc41=0x0,_0x749dc4=0x0;_0x2564a3<_0x3dcab5['maxParticles'];_0x2564a3++){_0x4c9ecf[_0x14cc41++]=_0x749dc4+0x0,_0x4c9ecf[_0x14cc41++]=_0x749dc4+0x1,_0x4c9ecf[_0x14cc41++]=_0x749dc4+0x2,_0x4c9ecf[_0x14cc41++]=_0x749dc4+0x2,_0x4c9ecf[_0x14cc41++]=_0x749dc4+0x1,_0x4c9ecf[_0x14cc41++]=_0x749dc4+0x3,_0x749dc4+=0x4;}const _0x4965bb=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x1b2f56}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x3d19ba(0x18e)],'componentsPerAttribute':0x3,'values':_0x4f0af8})}),'indices':_0x4c9ecf});return _0x4965bb;}[_0x1296a0(0x17a)](_0x472ded,_0x523fe1,_0x3249d2,_0xf6e658){const _0xd53cb2=_0x1296a0,_0x31c987=this;this[_0xd53cb2(0x142)]={'segments':new CustomPrimitive({'commandType':_0xd53cb2(0x15d),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x523fe1),'primitiveType':Cesium$4[_0xd53cb2(0x14f)]['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x4c47ab=_0xd53cb2;return _0xf6e658[_0x4c47ab(0x152)][_0x4c47ab(0x100)];},'postProcessingPosition':function(){return _0xf6e658['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x4ccd5f=_0xd53cb2;return _0xf6e658['particlesTextures'][_0x4ccd5f(0xe8)];},'colorTable':function(){return _0x31c987['textures']['colorTable'];},'aspect':function(){const _0x412b0c=_0xd53cb2;return _0x472ded['drawingBufferWidth']/_0x472ded[_0x412b0c(0xe6)];},'pixelSize':function(){const _0x1ec9de=_0xd53cb2;return _0x3249d2[_0x1ec9de(0x167)];},'lineWidth':function(){const _0x1c6738=_0xd53cb2;return _0x523fe1[_0x1c6738(0x197)];},'particleHeight':function(){return _0x523fe1['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0xd53cb2(0xf4))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0xd53cb2(0xdc)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0xd53cb2(0x14f)][_0xd53cb2(0x1b1)],'uniformMap':{'segmentsColorTexture':function(){const _0x58b50b=_0xd53cb2;return _0x31c987['textures'][_0x58b50b(0x131)];},'segmentsDepthTexture':function(){const _0x103925=_0xd53cb2;return _0x31c987[_0x103925(0x198)]['segmentsDepth'];},'currentTrailsColor':function(){const _0x3425fb=_0xd53cb2;return _0x31c987[_0x3425fb(0xdc)]['currentTrails'][_0x3425fb(0x127)](0x0);},'trailsDepthTexture':function(){const _0xe7eb64=_0xd53cb2;return _0x31c987[_0xe7eb64(0xdc)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x523fe1['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xd53cb2(0x195)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0xd53cb2(0xf4))]({'defines':[_0xd53cb2(0x175)],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0xd53cb2(0xd5)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4[_0xd53cb2(0x173)]['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0xd53cb2(0xdc)][_0xd53cb2(0x19f)],'autoClear':!![],'preExecute':function(){const _0x16cdb8=_0xd53cb2,_0x1b697c=_0x31c987['framebuffers']['currentTrails'];_0x31c987[_0x16cdb8(0xdc)]['currentTrails']=_0x31c987['framebuffers']['nextTrails'],_0x31c987['framebuffers']['nextTrails']=_0x1b697c,_0x31c987[_0x16cdb8(0x142)][_0x16cdb8(0x159)][_0x16cdb8(0xf9)]['framebuffer']=_0x31c987['framebuffers']['nextTrails'],_0x31c987['primitives']['trails']['clearCommand']['framebuffer']=_0x31c987['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0xd53cb2(0x14f)]['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x49b91a=_0xd53cb2;return _0x31c987[_0x49b91a(0xdc)]['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x14fdf8=_0xd53cb2;return _0x31c987[_0x14fdf8(0xdc)]['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':[_0xd53cb2(0x195)],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}function _0x2116(){const _0x42c9fe=['initWorker','71811WIPmaZ','commandToExecute','preExecute','getRandomLatLng','particleSystem','ClearCommand','once','getOptions','currentParticlesPosition','umin','6DiYGKn','outputTexture','moveTo','reverse','_updateIng','fromGeometry','keys','_randomParticle','mod','camera','width','unbindEvent','EventType','clientWidth','depthTest','_speedRate','mouseHidden','setOptions','_onMouseUpEvent','fillRect','globalCompositeOperation','windData','18aMsBZD','toRadians','vertexShaderSource','shaderProgram','720XaEwAW','scene','Math','clientHeight','vdata','rows','resize','maxAge','none','random','speed','getColorTexture','fadeOpacity','animateFrame','createWindTextures','_calc_speedRate','particlesComputing','Cesium','_onMap_preRenderEvent','position','context','segmentsColor','length','maxParticles','particlesNumber','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','Sampler','clearCommand','getDefaultRenderState','7HKldpk','Texture','destroyObject','ymin','worker','TWO_PI','setData','pointer-events','PI_OVER_THREE','primitives','TextureMinificationFilter','particlesRendering','segmentsDepth','_colorRamp','_onMouseDownEvent','lon','style','getColor','forEach','canvas','nextTrailsDepth','tlng','PrimitiveType','attributeLocations','RGBA','particlesTextures','speedFactor','sqrt','241712MueSTS','canvasWidth','ceil','default','trails','VertexArray','IDENTITY','fixedHeight','Draw','ellipsoid','data','WindUtil','off','left','segments','createTexture','randomBetween','STATIC_DRAW','pixelSize','frameRate','LINEAR','removeChild','1234890KciIRX','postProcessingPosition','clearFramebuffers','updatePosition','nextParticlesSpeed','particlesTextureSize','windField','show','DepthFunction','min','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','mouseUp','mouse_down','_map','applyViewerParameters','createRenderingPrimitives','height','_bilinearInterpolation','cancelAnimationFrame','viewerParameters','createComputingPrimitives','NEAREST','xmin','createSegmentsGeometry','_mountedHook','lat','add','Cartesian3','canvasHeight','_tomap','register','lng','particles','addPrimitives','6740HDiBSS','FLOAT','82854lDrNrK','latRange','clampToLatitudeRange','nextParticlesPosition','PI_OVER_TWO','_onMapWhellEvent','DISABLE_GL_POSITION_LOG_DEPTH','canvasContext','lineWidth','textures','fromDegrees','lev','windTextures','age','floor','rawRenderState','nextTrails','addEventListener','pointerEvents','update','ColorRamp','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','__esModule','OPAQUE','redraw','beginPath','currentTrailsColor','reverseY','visibility','execute','absolute','refreshParticles','removeEventListener','speedRate','TRIANGLES','mouseDown','layer','_onMouseMoveEvent','cols','commandType','_maxAge','lineTo','mouseMove','colors','dimensions','createRawRenderState','Compute','98678BFdVCp','max','geometry','push','color','framebuffers','Rectangle','primitiveType','array','framebuffer','tlat','drawingBufferWidth','871398AvYvNS','destroy','mode','drawingBufferHeight','xmax','postProcessingSpeed','options','_createCanvas','rgb(206,255,255)','createRenderingFramebuffers','Pass','udata','ymax','postMessage','UNSIGNED_BYTE','wheel','getOwnPropertyDescriptor','ShaderSource','bindEvent','Cartesian2'];_0x2116=function(){return _0x42c9fe;};return _0x2116();}var getWind_frag=_0x1296a0(0x135),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0xf00fd,_0x1c8a7a,_0x33020a,_0x5dc27d){const _0x155efc=_0x1296a0;this[_0x155efc(0x15f)]=_0x1c8a7a,this[_0x155efc(0x12a)](_0xf00fd,_0x1c8a7a),this['createParticlesTextures'](_0xf00fd,_0x33020a,_0x5dc27d),this[_0x155efc(0x17f)](_0x1c8a7a,_0x33020a,_0x5dc27d);}[_0x1296a0(0x12a)](_0x187639,_0x17d852){const _0x3d5455=_0x1296a0,_0x278016={'context':_0x187639,'width':_0x17d852['dimensions'][_0x3d5455(0x148)],'height':_0x17d852['dimensions'][_0x3d5455(0x184)]*(_0x17d852[_0x3d5455(0x1bb)]['lev']||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x3d5455(0x18e)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x278016,_0x17d852['U']['array']),'V':Util['createTexture'](_0x278016,_0x17d852['V'][_0x3d5455(0xdf)])};}['createParticlesTextures'](_0x4c5336,_0x38a96c,_0x3b648d){const _0x21f786=_0x1296a0,_0x257778={'context':_0x4c5336,'width':_0x38a96c[_0x21f786(0x170)],'height':_0x38a96c['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter'][_0x21f786(0x180)]})},_0x12f4cd=this['randomizeParticles'](_0x38a96c['maxParticles'],_0x3b648d),_0x5df6cb=new Float32Array(0x4*_0x38a96c[_0x21f786(0x133)])['fill'](0x0);this[_0x21f786(0x152)]={'particlesWind':Util['createTexture'](_0x257778),'currentParticlesPosition':Util[_0x21f786(0x164)](_0x257778,_0x12f4cd),'nextParticlesPosition':Util['createTexture'](_0x257778,_0x12f4cd),'currentParticlesSpeed':Util['createTexture'](_0x257778,_0x5df6cb),'nextParticlesSpeed':Util['createTexture'](_0x257778,_0x5df6cb),'postProcessingPosition':Util['createTexture'](_0x257778,_0x12f4cd),'postProcessingSpeed':Util[_0x21f786(0x164)](_0x257778,_0x5df6cb)};}['randomizeParticles'](_0x5c9367,_0x2386ed){const _0x2c6012=_0x1296a0,_0x2e6eaa=new Float32Array(0x4*_0x5c9367);for(let _0x4bf1a4=0x0;_0x4bf1a4<_0x5c9367;_0x4bf1a4++){_0x2e6eaa[0x4*_0x4bf1a4]=Cesium$3['Math']['randomBetween'](_0x2386ed['lonRange']['x'],_0x2386ed['lonRange']['y']),_0x2e6eaa[0x4*_0x4bf1a4+0x1]=Cesium$3[_0x2c6012(0x11e)][_0x2c6012(0x165)](_0x2386ed[_0x2c6012(0x190)]['x'],_0x2386ed['latRange']['y']),_0x2e6eaa[0x4*_0x4bf1a4+0x2]=Cesium$3[_0x2c6012(0x11e)]['randomBetween'](this[_0x2c6012(0x15f)]['lev']['min'],this['data']['lev'][_0x2c6012(0xd8)]),_0x2e6eaa[0x4*_0x4bf1a4+0x3]=0x0;}return _0x2e6eaa;}['destroyParticlesTextures'](){const _0x252815=_0x1296a0;Object['keys'](this[_0x252815(0x152)])[_0x252815(0x14b)](_0x32f96f=>{this['particlesTextures'][_0x32f96f]['destroy']();});}['createComputingPrimitives'](_0x117dca,_0x35827d,_0x44c983){const _0x53d152=_0x1296a0,_0x3c4102=new Cesium$3['Cartesian3'](_0x117dca['dimensions']['lon'],_0x117dca[_0x53d152(0x1bb)]['lat'],_0x117dca['dimensions'][_0x53d152(0x19a)]),_0x2f98de=new Cesium$3['Cartesian3'](_0x117dca['lon'][_0x53d152(0x174)],_0x117dca['lat'][_0x53d152(0x174)],_0x117dca[_0x53d152(0x19a)]['min']),_0x5bd570=new Cesium$3[(_0x53d152(0x186))](_0x117dca['lon'][_0x53d152(0xd8)],_0x117dca['lat'][_0x53d152(0xd8)],_0x117dca['lev']['max']),_0x112cd7=new Cesium$3[(_0x53d152(0x186))]((_0x5bd570['x']-_0x2f98de['x'])/(_0x3c4102['x']-0x1),(_0x5bd570['y']-_0x2f98de['y'])/(_0x3c4102['y']-0x1),_0x3c4102['z']>0x1?(_0x5bd570['z']-_0x2f98de['z'])/(_0x3c4102['z']-0x1):0x1),_0x3677e0=new Cesium$3[(_0x53d152(0xf6))](_0x117dca['U']['min'],_0x117dca['U'][_0x53d152(0xd8)]),_0x4e3b47=new Cesium$3['Cartesian2'](_0x117dca['V']['min'],_0x117dca['V']['max']),_0x5eae2e=this;this[_0x53d152(0x142)]={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){const _0x54101b=_0x53d152;return _0x5eae2e[_0x54101b(0x19b)]['U'];},'V':function(){return _0x5eae2e['windTextures']['V'];},'currentParticlesPosition':function(){const _0x3dd403=_0x53d152;return _0x5eae2e['particlesTextures'][_0x3dd403(0x100)];},'dimension':function(){return _0x3c4102;},'minimum':function(){return _0x2f98de;},'maximum':function(){return _0x5bd570;},'interval':function(){return _0x112cd7;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x53d152(0x152)]['particlesWind'],'preExecute':function(){const _0x9ce5c4=_0x53d152;_0x5eae2e[_0x9ce5c4(0x142)]['getWind'][_0x9ce5c4(0xf9)]['outputTexture']=_0x5eae2e['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':_0x53d152(0xd6),'uniformMap':{'currentParticlesSpeed':function(){return _0x5eae2e['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){return _0x5eae2e['particlesTextures']['particlesWind'];},'uSpeedRange':function(){return _0x3677e0;},'vSpeedRange':function(){return _0x4e3b47;},'pixelSize':function(){return _0x44c983['pixelSize'];},'speedFactor':function(){const _0x58d56d=_0x53d152;return _0x35827d[_0x58d56d(0x153)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x53d152(0x16f)],'preExecute':function(){const _0x8d6793=_0x53d152,_0x26919c=_0x5eae2e[_0x8d6793(0x152)]['currentParticlesSpeed'];_0x5eae2e[_0x8d6793(0x152)]['currentParticlesSpeed']=_0x5eae2e['particlesTextures']['postProcessingSpeed'],_0x5eae2e[_0x8d6793(0x152)]['postProcessingSpeed']=_0x26919c,_0x5eae2e[_0x8d6793(0x142)]['updateSpeed']['commandToExecute']['outputTexture']=_0x5eae2e['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){return _0x5eae2e['particlesTextures']['currentParticlesPosition'];},'currentParticlesSpeed':function(){return _0x5eae2e['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x53d152(0x152)][_0x53d152(0x192)],'preExecute':function(){const _0x5a4e52=_0x53d152,_0x55597e=_0x5eae2e['particlesTextures']['currentParticlesPosition'];_0x5eae2e['particlesTextures'][_0x5a4e52(0x100)]=_0x5eae2e['particlesTextures']['postProcessingPosition'],_0x5eae2e['particlesTextures']['postProcessingPosition']=_0x55597e,_0x5eae2e['primitives']['updatePosition']['commandToExecute'][_0x5a4e52(0x103)]=_0x5eae2e['particlesTextures'][_0x5a4e52(0x192)];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x5eae2e['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x1590da=_0x53d152;return _0x5eae2e[_0x1590da(0x152)]['nextParticlesSpeed'];},'lonRange':function(){return _0x44c983['lonRange'];},'latRange':function(){return _0x44c983['latRange'];},'randomCoefficient':function(){const _0x1ecc17=Math['random']();return _0x1ecc17;},'dropRate':function(){return _0x35827d['dropRate'];},'dropRateBump':function(){return _0x35827d['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x53d152(0xf4))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x57a699=_0x53d152;_0x5eae2e['primitives']['postProcessingPosition']['commandToExecute'][_0x57a699(0x103)]=_0x5eae2e['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'postProcessingPosition':function(){return _0x5eae2e['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){const _0x436164=_0x53d152;return _0x5eae2e['particlesTextures'][_0x436164(0x16f)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this[_0x53d152(0x152)]['postProcessingSpeed'],'preExecute':function(){_0x5eae2e['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x5eae2e['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x2d1fc5,_0x15f8da,_0x57dad9,_0x478507){const _0x104fba=_0x1296a0;this['context']=_0x2d1fc5,_0x15f8da={..._0x15f8da},_0x15f8da[_0x104fba(0xee)]&&_0x15f8da['vdata']&&(_0x15f8da['dimensions']={},_0x15f8da['dimensions']['lon']=_0x15f8da['cols'],_0x15f8da['dimensions']['lat']=_0x15f8da['rows'],_0x15f8da['dimensions'][_0x104fba(0x19a)]=_0x15f8da[_0x104fba(0x19a)]||0x1,_0x15f8da['lon']={},_0x15f8da['lon']['min']=_0x15f8da['xmin'],_0x15f8da[_0x104fba(0x148)]['max']=_0x15f8da['xmax'],_0x15f8da['lat']={},_0x15f8da[_0x104fba(0x184)][_0x104fba(0x174)]=_0x15f8da['ymin'],_0x15f8da['lat']['max']=_0x15f8da['ymax'],_0x15f8da['lev']={},_0x15f8da[_0x104fba(0x19a)]['min']=_0x15f8da['levmin']??0x1,_0x15f8da['lev']['max']=_0x15f8da['levmax']??0x1,_0x15f8da['U']={},_0x15f8da['U'][_0x104fba(0xdf)]=new Float32Array(_0x15f8da['udata']),_0x15f8da['U'][_0x104fba(0x174)]=_0x15f8da[_0x104fba(0x101)]??Math['min'](..._0x15f8da['udata']),_0x15f8da['U'][_0x104fba(0xd8)]=_0x15f8da['umax']??Math['max'](..._0x15f8da[_0x104fba(0xee)]),_0x15f8da['V']={},_0x15f8da['V'][_0x104fba(0xdf)]=new Float32Array(_0x15f8da['vdata']),_0x15f8da['V']['min']=_0x15f8da['vmin']??Math['min'](..._0x15f8da['vdata']),_0x15f8da['V'][_0x104fba(0xd8)]=_0x15f8da['vmax']??Math['max'](..._0x15f8da['vdata'])),this[_0x104fba(0x15f)]=_0x15f8da,this['options']=_0x57dad9,this['viewerParameters']=_0x478507,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0x104fba(0x144)]=new ParticlesRendering(this[_0x104fba(0x130)],this[_0x104fba(0x15f)],this['options'],this['viewerParameters'],this[_0x104fba(0x12c)]);}['canvasResize'](_0x218341){const _0x1c3e40=_0x1296a0;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x387f43=>{const _0x38921d=_0x4d21;this['particlesComputing'][_0x38921d(0x19b)][_0x387f43]['destroy']();}),this['particlesRendering'][_0x1c3e40(0x198)]['colorTable'][_0x1c3e40(0xe4)](),Object[_0x1c3e40(0x108)](this['particlesRendering']['framebuffers'])['forEach'](_0x55b70b=>{const _0x4cf7ee=_0x1c3e40;this[_0x4cf7ee(0x144)]['framebuffers'][_0x55b70b]['destroy']();}),this['context']=_0x218341,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x1c3e40(0x130)],this['data'],this['options'],this['viewerParameters'],this['particlesComputing']);}[_0x1296a0(0x16d)](){const _0xe2113a=_0x1296a0,_0x234efd=new Cesium$2[(_0xe2113a(0xfd))]({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0xe2113a(0xed)]['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x46bdf0=>{const _0x1b8159=_0xe2113a;_0x234efd['framebuffer']=this['particlesRendering']['framebuffers'][_0x46bdf0],_0x234efd[_0x1b8159(0x1ac)](this[_0x1b8159(0x130)]);});}['refreshParticles'](_0x912250){const _0x530faf=_0x1296a0;this['clearFramebuffers'](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x530faf(0x12c)]['createParticlesTextures'](this[_0x530faf(0x130)],this['options'],this['viewerParameters']);if(_0x912250){var _0x56f666;const _0xac866c=this['particlesRendering'][_0x530faf(0x182)](this[_0x530faf(0xe9)]);this[_0x530faf(0x144)][_0x530faf(0x142)][_0x530faf(0x163)]['geometry']=_0xac866c;const _0x216628=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0xac866c,'attributeLocations':this['particlesRendering']['primitives'][_0x530faf(0x163)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x56f666=this['particlesRendering']['primitives'])!==null&&_0x56f666!==void 0x0&&(_0x56f666=_0x56f666['segments'])!==null&&_0x56f666!==void 0x0&&_0x56f666['commandToExecute']&&(this['particlesRendering']['primitives']['segments']['commandToExecute']['vertexArray']=_0x216628);}}['setOptions'](_0x1e29c9){const _0x2ec58d=_0x1296a0;let _0x4f085a=![];this['options'][_0x2ec58d(0x133)]!==_0x1e29c9['maxParticles']&&(_0x4f085a=!![]),Object['keys'](_0x1e29c9)[_0x2ec58d(0x14b)](_0x8f861=>{this['options'][_0x8f861]=_0x1e29c9[_0x8f861];}),this['refreshParticles'](_0x4f085a);}[_0x1296a0(0x179)](_0x532964){const _0x56204d=_0x1296a0;Object['keys'](_0x532964)['forEach'](_0x5dd5d9=>{const _0x469c17=_0x4d21;this[_0x469c17(0x17e)][_0x5dd5d9]=_0x532964[_0x5dd5d9];}),this[_0x56204d(0x1ae)](![]);}['destroy'](){const _0x28bf1b=_0x1296a0;clearTimeout(this['canrefresh']),this[_0x28bf1b(0x12c)]['destroyParticlesTextures'](),Object['keys'](this[_0x28bf1b(0x12c)][_0x28bf1b(0x19b)])[_0x28bf1b(0x14b)](_0x24dfe5=>{const _0x491451=_0x28bf1b;this['particlesComputing'][_0x491451(0x19b)][_0x24dfe5]['destroy']();}),this['particlesRendering'][_0x28bf1b(0x198)]['colorTable']['destroy'](),Object['keys'](this['particlesRendering'][_0x28bf1b(0xdc)])['forEach'](_0x5afceb=>{const _0xa247bf=_0x28bf1b;this['particlesRendering'][_0xa247bf(0xdc)][_0x5afceb]['destroy']();});for(const _0x2dc2fe in this){delete this[_0x2dc2fe];}}}const Cesium$1=mars3d__namespace[_0x1296a0(0x12d)],BaseLayer$1=mars3d__namespace[_0x1296a0(0x1b3)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x1296a0(0xeb)]};class WindLayer extends BaseLayer$1{constructor(_0x1f836c={}){_0x1f836c={...DEF_OPTIONS,..._0x1f836c},super(_0x1f836c),this['_setOptionsHook'](_0x1f836c);}get[_0x1296a0(0x1b3)](){const _0x188111=_0x1296a0;return this[_0x188111(0x142)];}get[_0x1296a0(0x15f)](){return this['_data'];}set['data'](_0x175b62){this['setData'](_0x175b62);}get[_0x1296a0(0x1ba)](){const _0x474209=_0x1296a0;return this[_0x474209(0xe9)]['colors'];}set['colors'](_0x5d7ad6){const _0x27d86b=_0x1296a0;this['options'][_0x27d86b(0x1ba)]=_0x5d7ad6,this[_0x27d86b(0xfc)]&&this['particleSystem'][_0x27d86b(0x113)]({'colors':_0x5d7ad6}),this['resize']();}[_0x1296a0(0x183)](){}['_addedHook'](){const _0x34e419=_0x1296a0;this['scene']=this[_0x34e419(0x178)]['scene'],this['camera']=this[_0x34e419(0x178)][_0x34e419(0x10b)],this[_0x34e419(0x142)]=new Cesium$1['PrimitiveCollection'](),this['_map']['scene']['primitives'][_0x34e419(0x185)](this['primitives']),this[_0x34e419(0x17e)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x34e419(0xf6))](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x34e419(0x1a0)](_0x34e419(0x122),this[_0x34e419(0x122)]['bind'](this),![]),this[_0x34e419(0x177)]=![],this['mouse_move']=![],this[_0x34e419(0x178)]['on'](mars3d__namespace[_0x34e419(0x10e)]['wheel'],this[_0x34e419(0x194)],this),this[_0x34e419(0x178)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x34e419(0x147)],this),this[_0x34e419(0x178)]['on'](mars3d__namespace[_0x34e419(0x10e)]['mouseUp'],this['_onMouseUpEvent'],this),this[_0x34e419(0x178)]['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x34e419(0x1b4)],this),this['_data']&&this['setData'](this['_data']);}['_removedHook'](){const _0x184c52=_0x1296a0;window['removeEventListener']('resize',this[_0x184c52(0x122)]),this[_0x184c52(0x178)][_0x184c52(0x161)](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x184c52(0xf2)],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x184c52(0x10e)][_0x184c52(0x1b2)],this[_0x184c52(0x147)],this),this['_map']['off'](mars3d__namespace[_0x184c52(0x10e)][_0x184c52(0x176)],this['_onMouseUpEvent'],this),this['_map'][_0x184c52(0x161)](mars3d__namespace['EventType'][_0x184c52(0x1b9)],this['_onMouseMoveEvent'],this),this[_0x184c52(0x142)]['removeAll'](),this[_0x184c52(0x178)]['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x26301f=_0x1296a0;if(!this['show']||!this['particleSystem'])return;this[_0x26301f(0x142)]['show']=![],this['primitives']['removeAll'](),this[_0x26301f(0x178)][_0x26301f(0xfe)](mars3d__namespace[_0x26301f(0x10e)]['preRender'],this[_0x26301f(0x12e)],this);}['_onMap_preRenderEvent'](_0x41e103){this['particleSystem']['canvasResize'](this['scene']['context']),this['addPrimitives'](),this['primitives']['show']=!![];}['_onMapWhellEvent'](_0x1f005b){const _0x9b75fa=_0x1296a0;clearTimeout(this['refreshTimer']);if(!this[_0x9b75fa(0x172)]||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{const _0x64f6c2=_0x9b75fa;if(!this[_0x64f6c2(0x172)])return;this[_0x64f6c2(0x1a7)]();},0xc8);}['_onMouseDownEvent'](_0x2753b6){this['mouse_down']=!![];}['_onMouseMoveEvent'](_0x2a37b1){const _0x5ad80f=_0x1296a0;if(!this[_0x5ad80f(0x172)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives'][_0x5ad80f(0x172)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0xb38aec){const _0x5d4d9d=_0x1296a0;if(!this['show']||!this['particleSystem'])return;this[_0x5d4d9d(0x177)]&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this[_0x5d4d9d(0x177)]=![],this['mouse_move']=![];}['redraw'](){const _0x4f2627=_0x1296a0;if(!this[_0x4f2627(0x178)]||!this[_0x4f2627(0x172)])return;this['updateViewerParameters'](),this['particleSystem'][_0x4f2627(0x179)](this['viewerParameters']),this[_0x4f2627(0x142)]['show']=!![];}['setData'](_0x51f378){const _0x55460f=_0x1296a0;this['_data']=_0x51f378,this['particleSystem']&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this['scene']['context'],_0x51f378,this[_0x55460f(0xff)](),this['viewerParameters']),this[_0x55460f(0x18c)]();}['_setOptionsHook'](_0x249ff8,_0x3261a0){const _0x339c90=_0x1296a0;if(_0x249ff8)for(const _0x2cacc9 in _0x249ff8){this[_0x2cacc9]=_0x249ff8[_0x2cacc9];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x339c90(0xff)]());}['getOptions'](){const _0x5c9088=_0x1296a0,_0x49dd28=Math[_0x5c9088(0x157)](Math['sqrt'](this['particlesNumber']));return this[_0x5c9088(0x134)]=_0x49dd28*_0x49dd28,{'particlesTextureSize':_0x49dd28,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x5c9088(0x128)],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this[_0x5c9088(0x153)],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x55b129=_0x1296a0;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this['primitives'][_0x55b129(0x185)](this['particleSystem'][_0x55b129(0x12c)][_0x55b129(0x142)]['updateSpeed']),this['primitives']['add'](this['particleSystem'][_0x55b129(0x12c)]['primitives'][_0x55b129(0x16e)]),this['primitives'][_0x55b129(0x185)](this[_0x55b129(0xfc)]['particlesComputing']['primitives'][_0x55b129(0x16c)]),this['primitives'][_0x55b129(0x185)](this['particleSystem']['particlesComputing'][_0x55b129(0x142)][_0x55b129(0xe8)]),this[_0x55b129(0x142)][_0x55b129(0x185)](this[_0x55b129(0xfc)]['particlesRendering']['primitives']['segments']),this['primitives'][_0x55b129(0x185)](this[_0x55b129(0xfc)]['particlesRendering'][_0x55b129(0x142)][_0x55b129(0x159)]),this[_0x55b129(0x142)][_0x55b129(0x185)](this['particleSystem']['particlesRendering'][_0x55b129(0x142)]['screen']);}['updateViewerParameters'](){const _0x5c8cc1=_0x1296a0;let _0x33ee80=this[_0x5c8cc1(0x10b)]['computeViewRectangle'](this['scene']['globe'][_0x5c8cc1(0x15e)]);if(!_0x33ee80){const _0x3d2a39=this['_map']['getExtent']();_0x33ee80=Cesium$1[_0x5c8cc1(0xdd)][_0x5c8cc1(0x199)](_0x3d2a39['xmin'],_0x3d2a39[_0x5c8cc1(0x13c)],_0x3d2a39[_0x5c8cc1(0xe7)],_0x3d2a39['ymax']);}const _0xa801df=Util['viewRectangleToLonLatRange'](_0x33ee80);this['viewerParameters']['lonRange']['x']=_0xa801df[_0x5c8cc1(0x148)]['min'],this['viewerParameters']['lonRange']['y']=_0xa801df['lon']['max'],this['viewerParameters']['latRange']['x']=_0xa801df['lat'][_0x5c8cc1(0x174)],this[_0x5c8cc1(0x17e)][_0x5c8cc1(0x190)]['y']=_0xa801df[_0x5c8cc1(0x184)][_0x5c8cc1(0xd8)];const _0x11ec45=this[_0x5c8cc1(0x10b)]['getPixelSize'](this['globeBoundingSphere'],this[_0x5c8cc1(0x11d)]['drawingBufferWidth'],this[_0x5c8cc1(0x11d)][_0x5c8cc1(0xe6)]);_0x11ec45>0x0&&(this['viewerParameters'][_0x5c8cc1(0x167)]=_0x11ec45);}}mars3d__namespace['LayerUtil'][_0x1296a0(0x189)]('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){const _0x5aa9ec=_0x1296a0;this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this[_0x5aa9ec(0x126)]=null;}['destroy'](){for(const _0x103e05 in this){delete this[_0x103e05];}}}class CanvasWindField{constructor(_0x1e0a11){this['setOptions'](_0x1e0a11);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x1b90f1){const _0x3264c3=_0x1296a0;this['_speedRate']=(0x64-(_0x1b90f1>0x63?0x63:_0x1b90f1))*0x64,this[_0x3264c3(0x12b)]=[(this[_0x3264c3(0xe7)]-this['xmin'])/this[_0x3264c3(0x111)],(this['ymax']-this['ymin'])/this[_0x3264c3(0x111)]];}get['maxAge'](){const _0x36e1c7=_0x1296a0;return this[_0x36e1c7(0x1b7)];}set['maxAge'](_0x522a68){this['_maxAge']=_0x522a68;}['setOptions'](_0x3d2211){const _0x49aaa7=_0x1296a0;this['options']=_0x3d2211,this[_0x49aaa7(0x123)]=_0x3d2211['maxAge']||0x78,this['speedRate']=_0x3d2211[_0x49aaa7(0x1b0)]||0x32,this[_0x49aaa7(0x18b)]=[];const _0x374a35=_0x3d2211['particlesNumber']||0x1000;for(let _0x5b1587=0x0;_0x5b1587<_0x374a35;_0x5b1587++){const _0x50808a=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0x50808a);}}['setDate'](_0x2342fe){const _0x27cbb3=_0x1296a0;this[_0x27cbb3(0x121)]=_0x2342fe['rows'],this['cols']=_0x2342fe['cols'],this[_0x27cbb3(0x181)]=_0x2342fe['xmin'],this['xmax']=_0x2342fe['xmax'],this[_0x27cbb3(0x13c)]=_0x2342fe[_0x27cbb3(0x13c)],this['ymax']=_0x2342fe[_0x27cbb3(0xef)],this['grid']=[];const _0x51c47e=_0x2342fe['udata'],_0x1623d7=_0x2342fe[_0x27cbb3(0x120)];let _0x50f147=![];_0x51c47e['length']===this[_0x27cbb3(0x121)]&&_0x51c47e[0x0]['length']===this[_0x27cbb3(0x1b5)]&&(_0x50f147=!![]);let _0x465dd4=0x0,_0x288440=null,_0x34dec9=null;for(let _0x2aef5b=0x0;_0x2aef5b<this['rows'];_0x2aef5b++){_0x288440=[];for(let _0x18f324=0x0;_0x18f324<this['cols'];_0x18f324++,_0x465dd4++){_0x50f147?_0x34dec9=this['_calcUV'](_0x51c47e[_0x2aef5b][_0x18f324],_0x1623d7[_0x2aef5b][_0x18f324]):_0x34dec9=this['_calcUV'](_0x51c47e[_0x465dd4],_0x1623d7[_0x465dd4]),_0x288440[_0x27cbb3(0xda)](_0x34dec9);}this['grid'][_0x27cbb3(0xda)](_0x288440);}this['options'][_0x27cbb3(0x1aa)]&&this['grid'][_0x27cbb3(0x105)]();}['clear'](){const _0x57d2bb=_0x1296a0;delete this['rows'],delete this['cols'],delete this[_0x57d2bb(0x181)],delete this[_0x57d2bb(0xe7)],delete this['ymin'],delete this[_0x57d2bb(0xef)],delete this['grid'],delete this['particles'];}['toGridXY'](_0x5e719c,_0x395d9e){const _0x3ebf42=_0x1296a0,_0x3a1a7d=(_0x5e719c-this['xmin'])/(this[_0x3ebf42(0xe7)]-this['xmin'])*(this['cols']-0x1),_0x35d1c1=(this['ymax']-_0x395d9e)/(this[_0x3ebf42(0xef)]-this['ymin'])*(this['rows']-0x1);return[_0x3a1a7d,_0x35d1c1];}['getUVByXY'](_0xf70290,_0x3b321b){const _0x52d461=_0x1296a0;if(_0xf70290<0x0||_0xf70290>=this['cols']||_0x3b321b>=this['rows'])return[0x0,0x0,0x0];const _0x393564=Math[_0x52d461(0x19d)](_0xf70290),_0x4ad7ad=Math['floor'](_0x3b321b);if(_0x393564===_0xf70290&&_0x4ad7ad===_0x3b321b)return this['grid'][_0x3b321b][_0xf70290];const _0x3e7b09=_0x393564+0x1,_0x246d60=_0x4ad7ad+0x1,_0x462485=this['getUVByXY'](_0x393564,_0x4ad7ad),_0x119d0e=this['getUVByXY'](_0x3e7b09,_0x4ad7ad),_0x57d798=this['getUVByXY'](_0x393564,_0x246d60),_0x30e379=this['getUVByXY'](_0x3e7b09,_0x246d60);let _0x44af60=null;try{_0x44af60=this['_bilinearInterpolation'](_0xf70290-_0x393564,_0x3b321b-_0x4ad7ad,_0x462485,_0x119d0e,_0x57d798,_0x30e379);}catch(_0x12664a){console['log'](_0xf70290,_0x3b321b);}return _0x44af60;}[_0x1296a0(0x17c)](_0x35029a,_0x184c06,_0x4bf9d3,_0x20dce7,_0x46e9b4,_0x2f031b){const _0x42d105=0x1-_0x35029a,_0x44e43a=0x1-_0x184c06,_0x4a02ba=_0x42d105*_0x44e43a,_0x732652=_0x35029a*_0x44e43a,_0x140a9a=_0x42d105*_0x184c06,_0x940db5=_0x35029a*_0x184c06,_0x5d95af=_0x4bf9d3[0x0]*_0x4a02ba+_0x20dce7[0x0]*_0x732652+_0x46e9b4[0x0]*_0x140a9a+_0x2f031b[0x0]*_0x940db5,_0x3c16c9=_0x4bf9d3[0x1]*_0x4a02ba+_0x20dce7[0x1]*_0x732652+_0x46e9b4[0x1]*_0x140a9a+_0x2f031b[0x1]*_0x940db5;return this['_calcUV'](_0x5d95af,_0x3c16c9);}['_calcUV'](_0x3b2569,_0x419d44){return[+_0x3b2569,+_0x419d44,Math['sqrt'](_0x3b2569*_0x3b2569+_0x419d44*_0x419d44)];}['getUVByPoint'](_0x2aafd1,_0x3d891e){if(!this['isInExtent'](_0x2aafd1,_0x3d891e))return null;const _0x21b6d0=this['toGridXY'](_0x2aafd1,_0x3d891e),_0x364432=this['getUVByXY'](_0x21b6d0[0x0],_0x21b6d0[0x1]);return _0x364432;}['isInExtent'](_0x1fdde4,_0xc671d1){const _0x50afa2=_0x1296a0;return _0x1fdde4>=this[_0x50afa2(0x181)]&&_0x1fdde4<=this[_0x50afa2(0xe7)]&&_0xc671d1>=this[_0x50afa2(0x13c)]&&_0xc671d1<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x592a95=_0x1296a0,_0x535337=fRandomByfloat(this['xmin'],this[_0x592a95(0xe7)]),_0x42303c=fRandomByfloat(this[_0x592a95(0x13c)],this[_0x592a95(0xef)]);return{'lat':_0x42303c,'lng':_0x535337};}['getParticles'](){const _0x189eba=_0x1296a0;let _0x2f0bd2,_0xfca45a,_0x461979;for(let _0x4bb7b3=0x0,_0x143331=this[_0x189eba(0x18b)]['length'];_0x4bb7b3<_0x143331;_0x4bb7b3++){let _0x4243cc=this['particles'][_0x4bb7b3];_0x4243cc['age']<=0x0&&(_0x4243cc=this[_0x189eba(0x109)](_0x4243cc));if(_0x4243cc[_0x189eba(0x19c)]>0x0){const _0x4fac22=_0x4243cc['tlng'],_0x2ebd4b=_0x4243cc[_0x189eba(0xe1)];_0x461979=this['getUVByPoint'](_0x4fac22,_0x2ebd4b),_0x461979?(_0x2f0bd2=_0x4fac22+this['_calc_speedRate'][0x0]*_0x461979[0x0],_0xfca45a=_0x2ebd4b+this['_calc_speedRate'][0x1]*_0x461979[0x1],_0x4243cc['lng']=_0x4fac22,_0x4243cc['lat']=_0x2ebd4b,_0x4243cc[_0x189eba(0x14e)]=_0x2f0bd2,_0x4243cc['tlat']=_0xfca45a,_0x4243cc['speed']=_0x461979[0x2],_0x4243cc['age']--):_0x4243cc['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x4d4496){const _0x34f0b4=_0x1296a0;let _0x27f114,_0xf1600b;for(let _0x1826b9=0x0;_0x1826b9<0x1e;_0x1826b9++){_0x27f114=this[_0x34f0b4(0xfb)](),_0xf1600b=this['getUVByPoint'](_0x27f114['lng'],_0x27f114[_0x34f0b4(0x184)]);if(_0xf1600b&&_0xf1600b[0x2]>0x0)break;}if(!_0xf1600b)return _0x4d4496;const _0x8f5fa5=_0x27f114[_0x34f0b4(0x18a)]+this[_0x34f0b4(0x12b)][0x0]*_0xf1600b[0x0],_0x1c051f=_0x27f114['lat']+this[_0x34f0b4(0x12b)][0x1]*_0xf1600b[0x1];return _0x4d4496['lng']=_0x27f114['lng'],_0x4d4496[_0x34f0b4(0x184)]=_0x27f114['lat'],_0x4d4496['tlng']=_0x8f5fa5,_0x4d4496[_0x34f0b4(0xe1)]=_0x1c051f,_0x4d4496[_0x34f0b4(0x19c)]=Math['round'](Math['random']()*this[_0x34f0b4(0x123)]),_0x4d4496['speed']=_0xf1600b[0x2],_0x4d4496;}[_0x1296a0(0xe4)](){for(const _0x5c6d0e in this){delete this[_0x5c6d0e];}}}function fRandomByfloat(_0x318969,_0x95d376){const _0xa2b29d=_0x1296a0;return _0x318969+Math[_0xa2b29d(0x125)]()*(_0x95d376-_0x318969);}const Cesium=mars3d__namespace[_0x1296a0(0x12d)],BaseLayer=mars3d__namespace[_0x1296a0(0x1b3)]['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0xae4f1a={}){const _0xa99b03=_0x1296a0;super(_0xae4f1a),this['_setOptionsHook'](_0xae4f1a),this[_0xa99b03(0x14c)]=null,_0xae4f1a[_0xa99b03(0x1ba)]&&_0xae4f1a['steps']&&(this[_0xa99b03(0x146)]=new mars3d__namespace[(_0xa99b03(0x1a3))](_0xae4f1a));}['_setOptionsHook'](_0x45df28,_0xf8280f){const _0x4ffa2a=_0x1296a0;this['frameTime']=0x3e8/(_0x45df28[_0x4ffa2a(0x168)]||0xa),this['_pointerEvents']=this['options'][_0x4ffa2a(0x1a1)]??![],this[_0x4ffa2a(0xdb)]=_0x45df28[_0x4ffa2a(0xdb)]||'#ffffff',this['lineWidth']=_0x45df28['lineWidth']||0x1,this['fixedHeight']=_0x45df28['fixedHeight']??0x0,this['reverseY']=_0x45df28[_0x4ffa2a(0x1aa)]??![],this['windField']&&this['windField']['setOptions'](_0x45df28);}get[_0x1296a0(0x1b3)](){const _0x5f4a37=_0x1296a0;return this[_0x5f4a37(0x14c)];}get[_0x1296a0(0x156)](){const _0x59f838=_0x1296a0;return this['_map']['scene'][_0x59f838(0x14c)]['clientWidth'];}get[_0x1296a0(0x187)](){const _0x312852=_0x1296a0;return this['_map']['scene'][_0x312852(0x14c)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set[_0x1296a0(0x1a1)](_0x19a2fd){const _0x3e2873=_0x1296a0;this['_pointerEvents']=_0x19a2fd;if(!this[_0x3e2873(0x14c)])return;_0x19a2fd?this[_0x3e2873(0x14c)]['style']['pointer-events']='all':this['canvas'][_0x3e2873(0x149)][_0x3e2873(0x140)]=_0x3e2873(0x124);}get['particlesNumber'](){const _0x419140=_0x1296a0;return this[_0x419140(0xe9)]['particlesNumber'];}set['particlesNumber'](_0x2bc323){this['options']['particlesNumber']=_0x2bc323,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{const _0x5b1eab=_0x4d21;this[_0x5b1eab(0x1a7)]();},0x1f4);}get[_0x1296a0(0x1b0)](){return this['options']['speedRate'];}set[_0x1296a0(0x1b0)](_0x4af531){const _0xffc673=_0x1296a0;this['options']['speedRate']=_0x4af531,this[_0xffc673(0x171)]&&(this['windField']['speedRate']=_0x4af531);}get['maxAge'](){const _0x475bdc=_0x1296a0;return this['options'][_0x475bdc(0x123)];}set['maxAge'](_0x1eafd1){const _0x115024=_0x1296a0;this['options'][_0x115024(0x123)]=_0x1eafd1,this['windField']&&(this[_0x115024(0x171)]['maxAge']=_0x1eafd1);}get['data'](){const _0xad27ec=_0x1296a0;return this[_0xad27ec(0x117)];}set['data'](_0x2cc93d){this['setData'](_0x2cc93d);}['_showHook'](_0x313acb){_0x313acb?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0x185fc5=_0x1296a0;this[_0x185fc5(0xe9)]['worker']?this[_0x185fc5(0xf7)]():this['windField']=new CanvasWindField(this[_0x185fc5(0xe9)]);}['_addedHook'](){const _0x305145=_0x1296a0;this[_0x305145(0x14c)]=this[_0x305145(0xea)](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x305145(0xf5)](),this['options'][_0x305145(0x15f)]&&this['setData'](this['options']['data']);}['_removedHook'](){const _0x431013=_0x1296a0;this['clear'](),this[_0x431013(0x10d)](),this['canvas']&&(this['_map']['container'][_0x431013(0x16a)](this['canvas']),delete this[_0x431013(0x14c)]);}['_createCanvas'](){const _0x551487=_0x1296a0,_0x190062=mars3d__namespace['DomUtil']['create'](_0x551487(0x14c),'mars3d-canvasWind',this[_0x551487(0x178)]['container']);return _0x190062['style'][_0x551487(0x12f)]=_0x551487(0x1ad),_0x190062['style']['top']='0px',_0x190062['style'][_0x551487(0x162)]='0px',_0x190062[_0x551487(0x149)][_0x551487(0x10c)]=this['_map']['scene']['canvas']['clientWidth']+'px',_0x190062[_0x551487(0x149)][_0x551487(0x17b)]=this[_0x551487(0x178)][_0x551487(0x11d)]['canvas'][_0x551487(0x11f)]+'px',_0x190062['style']['pointerEvents']=this['_pointerEvents']?'auto':_0x551487(0x124),_0x190062[_0x551487(0x149)]['zIndex']=this['options']['zIndex']??0x9,_0x190062['width']=this['_map']['scene']['canvas']['clientWidth'],_0x190062[_0x551487(0x17b)]=this[_0x551487(0x178)]['scene'][_0x551487(0x14c)][_0x551487(0x11f)],_0x190062;}[_0x1296a0(0x122)](){const _0x4da9a6=_0x1296a0;this[_0x4da9a6(0x14c)]&&(this['canvas']['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this[_0x4da9a6(0x14c)]['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas'][_0x4da9a6(0x10f)],this['canvas']['height']=this['_map'][_0x4da9a6(0x11d)]['canvas']['clientHeight']);}['bindEvent'](){const _0x5b9a34=_0x1296a0,_0x5a2875=this;let _0x19c01c=Date['now']();(function _0x5c5a19(){const _0x49ad92=_0x4d21;_0x5a2875[_0x49ad92(0x129)]=window['requestAnimationFrame'](_0x5c5a19);if(_0x5a2875['show']&&_0x5a2875['windField']){const _0x4c7aa0=Date['now'](),_0x432425=_0x4c7aa0-_0x19c01c;_0x432425>_0x5a2875['frameTime']&&(_0x19c01c=_0x4c7aa0-_0x432425%_0x5a2875['frameTime'],_0x5a2875['update']());}}(),window[_0x5b9a34(0x1a0)]('resize',this[_0x5b9a34(0x122)]['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options'][_0x5b9a34(0x112)]&&(this['_map']['on'](mars3d__namespace['EventType'][_0x5b9a34(0xf2)],this['_onMapWhellEvent'],this),this[_0x5b9a34(0x178)]['on'](mars3d__namespace['EventType'][_0x5b9a34(0x1b2)],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x3ef7af=_0x1296a0;window[_0x3ef7af(0x17d)](this['animateFrame']),delete this[_0x3ef7af(0x129)],window[_0x3ef7af(0x1af)]('resize',this['resize']),this[_0x3ef7af(0xe9)]['mouseHidden']&&(this[_0x3ef7af(0x178)]['off'](mars3d__namespace[_0x3ef7af(0x10e)][_0x3ef7af(0xf2)],this[_0x3ef7af(0x194)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x3ef7af(0x1b2)],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x3ef7af(0x176)],this[_0x3ef7af(0x114)],this),this['_map']['off'](mars3d__namespace[_0x3ef7af(0x10e)]['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0xaa31b){const _0x365db9=_0x1296a0;clearTimeout(this['refreshTimer']);if(!this['show']||!this['canvas'])return;this[_0x365db9(0x14c)]['style'][_0x365db9(0x1ab)]='hidden',this['refreshTimer']=setTimeout(()=>{const _0x39b6fa=_0x365db9;if(!this[_0x39b6fa(0x172)])return;this[_0x39b6fa(0x1a7)](),this['canvas'][_0x39b6fa(0x149)]['visibility']='visible';},0xc8);}['_onMouseDownEvent'](_0x4ecb91){const _0x4dba5a=_0x1296a0;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace['EventType'][_0x4dba5a(0x1b9)],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x4dba5a(0x10e)]['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x285923){const _0x4d9624=_0x1296a0;if(!this['show']||!this['canvas'])return;this[_0x4d9624(0x177)]&&(this['canvas'][_0x4d9624(0x149)]['visibility']='hidden',this['mouse_move']=!![]);}[_0x1296a0(0x114)](_0x32771f){const _0x306223=_0x1296a0;if(!this[_0x306223(0x172)]||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType'][_0x306223(0x1b9)],this[_0x306223(0x1b4)],this),this[_0x306223(0x177)]&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x306223(0x1ab)]='visible',this['mouse_down']=![],this['mouse_move']=![];}[_0x1296a0(0x13f)](_0x9db2e6){this['clear'](),this['windData']=_0x9db2e6,this['windField']['setDate'](_0x9db2e6),this['redraw']();}[_0x1296a0(0x1a7)](){const _0x4220d8=_0x1296a0;if(!this['show'])return;this['windField']['setOptions'](this[_0x4220d8(0xe9)]),this['update']();}[_0x1296a0(0x1a2)](){const _0xede5cf=_0x1296a0;if(this['_updateIng'])return;this[_0xede5cf(0x106)]=!![];if(this[_0xede5cf(0x13d)])this['windField']['update']();else{const _0x21ae23=this['windField']['getParticles']();this['_drawLines'](_0x21ae23);}this[_0xede5cf(0x106)]=![];}['_drawLines'](_0x4a6090){const _0x576138=_0x1296a0;this['canvasContext'][_0x576138(0x116)]='destination-in',this['canvasContext'][_0x576138(0x115)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this[_0x576138(0x196)][_0x576138(0x116)]='lighter',this['canvasContext']['globalAlpha']=0.9;const _0xfaee66=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x50ef1f=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x10ac1f=0x0,_0x4eae5c=_0x4a6090['length'];_0x10ac1f<_0x4eae5c;_0x10ac1f++){const _0x4893d5=_0x4a6090[_0x10ac1f],_0x5e7078=this['_tomap'](_0x4893d5['lng'],_0x4893d5['lat'],_0x4893d5),_0x1a66f5=this['_tomap'](_0x4893d5['tlng'],_0x4893d5['tlat'],_0x4893d5);if(!_0x5e7078||!_0x1a66f5)continue;if(_0xfaee66&&Math['abs'](_0x5e7078[0x0]-_0x1a66f5[0x0])>=_0x50ef1f)continue;this['canvasContext'][_0x576138(0x1a8)](),this[_0x576138(0x196)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this['_colorRamp'][_0x576138(0x14a)](_0x4893d5['speed']),this['canvasContext'][_0x576138(0x104)](_0x5e7078[0x0],_0x5e7078[0x1]),this['canvasContext'][_0x576138(0x1b8)](_0x1a66f5[0x0],_0x1a66f5[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x576138(0x1a8)](),this[_0x576138(0x196)]['lineWidth']=this['lineWidth'],this[_0x576138(0x196)]['strokeStyle']=this['color'];for(let _0xe3b3e5=0x0,_0x37fd61=_0x4a6090['length'];_0xe3b3e5<_0x37fd61;_0xe3b3e5++){const _0x1c6b06=_0x4a6090[_0xe3b3e5],_0x26ecdc=this[_0x576138(0x188)](_0x1c6b06[_0x576138(0x18a)],_0x1c6b06[_0x576138(0x184)],_0x1c6b06),_0x268c6d=this['_tomap'](_0x1c6b06[_0x576138(0x14e)],_0x1c6b06['tlat'],_0x1c6b06);if(!_0x26ecdc||!_0x268c6d)continue;if(_0xfaee66&&Math['abs'](_0x26ecdc[0x0]-_0x268c6d[0x0])>=_0x50ef1f)continue;this['canvasContext'][_0x576138(0x104)](_0x26ecdc[0x0],_0x26ecdc[0x1]),this['canvasContext'][_0x576138(0x1b8)](_0x268c6d[0x0],_0x268c6d[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0xf51bcf,_0x12cbec,_0x380287){const _0x1aab49=_0x1296a0,_0x2ef2da=Cesium[_0x1aab49(0x186)]['fromDegrees'](_0xf51bcf,_0x12cbec,this[_0x1aab49(0x15c)]),_0x1ae01c=this[_0x1aab49(0x178)][_0x1aab49(0x11d)];if(_0x1ae01c[_0x1aab49(0xe5)]===Cesium['SceneMode']['SCENE3D']){const _0x5f0637=new Cesium['EllipsoidalOccluder'](_0x1ae01c['globe']['ellipsoid'],_0x1ae01c['camera']['positionWC']),_0x1a3146=_0x5f0637['isPointVisible'](_0x2ef2da);if(!_0x1a3146)return _0x380287['age']=0x0,null;}const _0x44c1f2=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map'][_0x1aab49(0x11d)],_0x2ef2da);return _0x44c1f2?[_0x44c1f2['x'],_0x44c1f2['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x4f1082=_0x1296a0;this[_0x4f1082(0x13d)]=new Worker(this[_0x4f1082(0xe9)]['worker']),this['worker']['onmessage']=_0x33b000=>{this['_drawLines'](_0x33b000['data']['particles']),this['_updateIng2']=![];},this[_0x4f1082(0x171)]={'init':_0x5ac995=>{this['worker']['postMessage']({'type':'init','options':_0x5ac995});},'setOptions':_0x31e087=>{const _0x22670f=_0x4f1082;this[_0x22670f(0x13d)]['postMessage']({'type':_0x22670f(0x113),'options':_0x31e087});},'setDate':_0x5a690e=>{const _0x3ac180=_0x4f1082;this['worker'][_0x3ac180(0xf0)]({'type':'setDate','data':_0x5a690e});},'update':()=>{const _0x137dff=_0x4f1082;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':_0x137dff(0x1a2)});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace[_0x1296a0(0x160)]=WindUtil,exports['CanvasWindField']=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports[_0x1296a0(0x160)]=WindUtil,Object['defineProperty'](exports,_0x1296a0(0x1a5),{'value':!![]});
}));
