/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.6.12
 * 编译日期：2023-11-07 21:55:49
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x3bb793=_0x52d6;(function(_0x39b753,_0x232e82){const _0x9c7598=_0x52d6,_0x1e2409=_0x39b753();while(!![]){try{const _0x33006f=-parseInt(_0x9c7598(0x144))/0x1*(parseInt(_0x9c7598(0x1c0))/0x2)+parseInt(_0x9c7598(0x162))/0x3+parseInt(_0x9c7598(0x16a))/0x4+-parseInt(_0x9c7598(0x15b))/0x5*(parseInt(_0x9c7598(0x1c4))/0x6)+parseInt(_0x9c7598(0x14b))/0x7*(parseInt(_0x9c7598(0x188))/0x8)+-parseInt(_0x9c7598(0x13a))/0x9+parseInt(_0x9c7598(0x1b2))/0xa*(parseInt(_0x9c7598(0x12d))/0xb);if(_0x33006f===_0x232e82)break;else _0x1e2409['push'](_0x1e2409['shift']());}catch(_0x350e36){_0x1e2409['push'](_0x1e2409['shift']());}}}(_0x3bcb,0xb97f9));function _interopNamespace(_0x36cc3f){const _0x171869=_0x52d6;if(_0x36cc3f&&_0x36cc3f['__esModule'])return _0x36cc3f;var _0x1a943f=Object[_0x171869(0x1b7)](null);return _0x36cc3f&&Object['keys'](_0x36cc3f)['forEach'](function(_0x29a574){const _0x32698c=_0x171869;if(_0x29a574!=='default'){var _0xb2e5bf=Object['getOwnPropertyDescriptor'](_0x36cc3f,_0x29a574);Object[_0x32698c(0x13c)](_0x1a943f,_0x29a574,_0xb2e5bf['get']?_0xb2e5bf:{'enumerable':!![],'get':function(){return _0x36cc3f[_0x29a574];}});}}),_0x1a943f['default']=_0x36cc3f,_0x1a943f;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x507bf1,_0x3bed28){const _0x20db35=_0x507bf1*Math['cos'](Cesium$7['Math']['toRadians'](_0x3bed28));return _0x20db35;}function getV(_0x1a9088,_0x36c041){const _0x449aec=_0x52d6,_0x10921c=_0x1a9088*Math[_0x449aec(0x148)](Cesium$7['Math']['toRadians'](_0x36c041));return _0x10921c;}function _0x3bcb(){const _0x5ec7a4=['CanvasWindField','vertexShaderSource','TextureMagnificationFilter','currentTrails','colors','_pointerEvents','source','createCommand','particlesTextureSize','uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a','currentParticlesPosition','dimensions','Appearance','latRange','pointerEvents','ShaderSource','container','WindUtil','SceneMode','randomizeParticles','clientHeight','fragmentShaderSource','commandToExecute','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','lat','FLOAT','postMessage','CanvasWindLayer','setDate','pointer-events','_drawLines','_onMapWhellEvent','IDENTITY','style','xmax','_addedHook','_onMap_preRenderEvent','Rectangle','data','_calcUV','drawingBufferWidth','particlesTextures','getRandomLatLng','position','postProcessingPosition','TRIANGLES','particlesComputing','framebuffer','PI_OVER_TWO','_data','rows','mouseMove','camera','PixelFormat','SCENE3D','options','xmin','currentTrailsDepth','Draw','TWO_PI','22807103yPskfo','ZERO','addPrimitives','trails','DrawCommand','ymax','cols','mouseDown','NEAREST','pow','segments','primitives','toDegrees','3661677UKQnnA','nextTrails','defineProperty','viewerParameters','Compute','umin','RenderState','fillRect','preExecute','forEach','3281UJMcKc','array','getOptions','redraw','sin','shaderProgram','vmin','4631326BrjrEC','grid','GeometryAttribute','_maxAge','lon','animateFrame','color','Matrix4','getPixelSize','GeometryAttributes','defined','lng','mouse_down','BoundingSphere','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','mouse_move','5AvEVhp','PI_OVER_THREE','initWorker','Texture','drawingBufferHeight','createSegmentsGeometry','Cartesian2','781515PokoAF','_tomap','resize','textures','commandList','visibility','createWindTextures','STATIC_DRAW','1729536KAQXyW','UNSIGNED_INT','reverseY','scene','_onMouseMoveEvent','moveTo','windData','particles','keys','geometry','add','setOptions','green','push','ceil','left','Math','updatePosition','colorTable','getUVByXY','mouseUp','vdata','randomBetween','Cartesian3','clear','postProcessingSpeed','commandType','ComponentDatatype','clientWidth','lonRange','8mNOhPg','speedRate','refreshTimer','update','_colorRamp','layer','canvasContext','rawRenderState','ClearCommand','mouseHidden','canvas','EllipsoidalOccluder','dropRate','canvasHeight','particleSystem','getWind','particlesRendering','clearFramebuffers','_map','canvasResize','updateViewerParameters','min','tlng','mode','attributeLocations','windTextures','speed','height','destroyParticlesTextures','tlat','clearCommand','max','Cesium','context','currentParticlesSpeed','_updateIng','fixedHeight','_removedHook','LayerUtil','rgb(206,255,255)','ymin','WindLayer','10Qbyfuw','Pass','RGBA','maxParticles','age','create','all','Color','framebuffers','lev','VertexArray','getUVByPoint','fromCache','wgs84ToWindowCoordinates','554zCQKaz','createRenderingPrimitives','outputTexture','globeBoundingSphere','8114334leoCga','speedFactor','_onMouseDownEvent','windField','vertexArray','EventType','createComputingPrimitives','worker','autoClear','off','maxAge','removeChild','setData','show','destroy','lineWidth','createTexture','_setOptionsHook','_calc_speedRate','onmessage','particlesNumber','primitiveType','toGridXY'];_0x3bcb=function(){return _0x5ec7a4;};return _0x3bcb();}function getSpeed(_0x54f0b9,_0x3b6445){const _0x26eab5=_0x52d6,_0x5fa7fb=Math['sqrt'](Math['pow'](_0x54f0b9,0x2)+Math[_0x26eab5(0x136)](_0x3b6445,0x2));return _0x5fa7fb;}function getDirection(_0x3a528e,_0xc2fc59){const _0x42f838=_0x52d6;let _0x3df81f=Cesium$7['Math'][_0x42f838(0x139)](Math['atan2'](_0xc2fc59,_0x3a528e));return _0x3df81f+=_0x3df81f<0x0?0x168:0x0,_0x3df81f;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x27f034){const _0x602971=_0x52d6;this['commandType']=_0x27f034[_0x602971(0x184)],this['geometry']=_0x27f034['geometry'],this[_0x602971(0x1a0)]=_0x27f034['attributeLocations'],this['primitiveType']=_0x27f034['primitiveType'],this['uniformMap']=_0x27f034['uniformMap'],this[_0x602971(0x1dc)]=_0x27f034['vertexShaderSource'],this['fragmentShaderSource']=_0x27f034[_0x602971(0x106)],this['rawRenderState']=_0x27f034[_0x602971(0x18f)],this['framebuffer']=_0x27f034['framebuffer'],this['outputTexture']=_0x27f034[_0x602971(0x1c2)],this['autoClear']=_0x27f034['autoClear']??![],this['preExecute']=_0x27f034[_0x602971(0x142)],this['show']=!![],this[_0x602971(0x107)]=undefined,this['clearCommand']=undefined,this[_0x602971(0x1cc)]&&(this[_0x602971(0x1a6)]=new Cesium$6[(_0x602971(0x190))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE']}));}[_0x3bb793(0x1e2)](_0x1903f3){const _0x2acf5f=_0x3bb793;switch(this['commandType']){case'Draw':{const _0x2ed467=Cesium$6['VertexArray']['fromGeometry']({'context':_0x1903f3,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x946167=Cesium$6['ShaderProgram'][_0x2acf5f(0x1be)]({'context':_0x1903f3,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this['fragmentShaderSource']}),_0x570a1d=Cesium$6[_0x2acf5f(0x140)]['fromCache'](this[_0x2acf5f(0x18f)]);return new Cesium$6[(_0x2acf5f(0x131))]({'primitiveType':this[_0x2acf5f(0x1d9)],'shaderProgram':_0x946167,'vertexArray':_0x2ed467,'modelMatrix':Cesium$6[_0x2acf5f(0x152)][_0x2acf5f(0x111)],'renderState':_0x570a1d,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass']['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x56eee2,_0x31f2cb){const _0x53a3da=_0x3bb793;this[_0x53a3da(0x173)]=_0x31f2cb;const _0x2e2634=Cesium$6['VertexArray']['fromGeometry']({'context':_0x56eee2,'geometry':this['geometry'],'attributeLocations':this[_0x53a3da(0x1a0)],'bufferUsage':Cesium$6['BufferUsage'][_0x53a3da(0x169)]});this[_0x53a3da(0x107)]['vertexArray']=_0x2e2634;}['update'](_0xe4bac3){const _0x1f4ab9=_0x3bb793;if(!this['show'])return;if(_0xe4bac3['mode']!==Cesium$6[_0x1f4ab9(0x103)]['SCENE3D'])return;!Cesium$6['defined'](this['commandToExecute'])&&(this[_0x1f4ab9(0x107)]=this[_0x1f4ab9(0x1e2)](_0xe4bac3['context'])),Cesium$6[_0x1f4ab9(0x155)](this['preExecute'])&&this[_0x1f4ab9(0x142)](),Cesium$6['defined'](this[_0x1f4ab9(0x1a6)])&&_0xe4bac3['commandList']['push'](this[_0x1f4ab9(0x1a6)]),_0xe4bac3[_0x1f4ab9(0x166)][_0x1f4ab9(0x177)](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x53caef=_0x3bb793;if(this['clearCommand']){var _0x4f1edc,_0xb8812e;(_0x4f1edc=this['clearCommand'])!==null&&_0x4f1edc!==void 0x0&&_0x4f1edc['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0xb8812e=this['clearCommand'])!==null&&_0xb8812e!==void 0x0&&_0xb8812e['shaderProgram']&&this[_0x53caef(0x1a6)]['shaderProgram']['destroy'](),delete this['clearCommand'];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray']['destroy'](),this['commandToExecute'][_0x53caef(0x149)]&&this[_0x53caef(0x107)]['shaderProgram'][_0x53caef(0x1d2)](),delete this[_0x53caef(0x107)]),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0x2dedf1=function(){const _0x3bc3c5=_0x52d6,_0x5465bf=new Cesium$5['Geometry']({'attributes':new Cesium$5[(_0x3bc3c5(0x154))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x3bc3c5(0x185)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x5465bf;},_0x94dd33=function(_0x1721f5,_0x337c79){const _0x1afbb1=_0x52d6;if(Cesium$5['defined'](_0x337c79)){const _0x11395b={};_0x11395b['arrayBufferView']=_0x337c79,_0x1721f5[_0x1afbb1(0x1e1)]=_0x11395b;}const _0x3db4a2=new Cesium$5[(_0x1afbb1(0x15e))](_0x1721f5);return _0x3db4a2;},_0x532605=function(_0x3e6427,_0x40f2c1,_0x57736d){const _0x3844b8=new Cesium$5['Framebuffer']({'context':_0x3e6427,'colorTextures':[_0x40f2c1],'depthTexture':_0x57736d});return _0x3844b8;},_0x39836e=function(_0x128be1){const _0x183256=_0x52d6,_0x56a3e8=!![],_0xf19dfd=![],_0x2483d6={'viewport':_0x128be1['viewport'],'depthTest':_0x128be1['depthTest'],'depthMask':_0x128be1['depthMask'],'blending':_0x128be1['blending']},_0x52b6df=Cesium$5[_0x183256(0x1e7)]['getDefaultRenderState'](_0x56a3e8,_0xf19dfd,_0x2483d6);return _0x52b6df;},_0x1077e0=function(_0x3260f4){const _0x4e00ce=_0x52d6,_0x512746={},_0x41c425=Cesium$5['Math']['mod'](_0x3260f4['west'],Cesium$5[_0x4e00ce(0x17a)]['TWO_PI']),_0x1c04b0=Cesium$5[_0x4e00ce(0x17a)]['mod'](_0x3260f4['east'],Cesium$5['Math']['TWO_PI']),_0x116315=_0x3260f4['width'];let _0x5c2670,_0x527413;_0x116315>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x5c2670=0x0,_0x527413=Cesium$5[_0x4e00ce(0x17a)][_0x4e00ce(0x12c)]):_0x1c04b0-_0x41c425<_0x116315?(_0x5c2670=_0x41c425,_0x527413=_0x41c425+_0x116315):(_0x5c2670=_0x41c425,_0x527413=_0x1c04b0);_0x512746[_0x4e00ce(0x14f)]={'min':Cesium$5['Math']['toDegrees'](_0x5c2670),'max':Cesium$5['Math']['toDegrees'](_0x527413)};const _0x366bcb=_0x3260f4['south'],_0x533cc6=_0x3260f4['north'],_0x35f251=_0x3260f4['height'],_0x3917b3=_0x35f251>Cesium$5[_0x4e00ce(0x17a)]['PI']/0xc?_0x35f251/0x2:0x0;let _0x290fba=Cesium$5['Math']['clampToLatitudeRange'](_0x366bcb-_0x3917b3),_0x3881e5=Cesium$5['Math']['clampToLatitudeRange'](_0x533cc6+_0x3917b3);return _0x290fba<-Cesium$5['Math']['PI_OVER_THREE']&&(_0x290fba=-Cesium$5['Math']['PI_OVER_TWO']),_0x3881e5>Cesium$5['Math'][_0x4e00ce(0x15c)]&&(_0x3881e5=Cesium$5[_0x4e00ce(0x17a)][_0x4e00ce(0x121)]),_0x512746['lat']={'min':Cesium$5['Math'][_0x4e00ce(0x139)](_0x290fba),'max':Cesium$5['Math']['toDegrees'](_0x3881e5)},_0x512746;};return{'getFullscreenQuad':_0x2dedf1,'createTexture':_0x94dd33,'createFramebuffer':_0x532605,'createRawRenderState':_0x39836e,'viewRectangleToLonLatRange':_0x1077e0};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag=_0x3bb793(0x159),screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x3b1f83,_0x1a0e4e,_0x555e58,_0x3391ae,_0x9d4396){this['createRenderingTextures'](_0x3b1f83,_0x1a0e4e,_0x555e58['colors']),this['createRenderingFramebuffers'](_0x3b1f83),this['createRenderingPrimitives'](_0x3b1f83,_0x555e58,_0x3391ae,_0x9d4396);}['createRenderingTextures'](_0x177783,_0x279638,_0x3346c3){const _0x4e3987=_0x3bb793,_0x3452ca={'context':_0x177783,'width':_0x177783[_0x4e3987(0x119)],'height':_0x177783['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x9bed5d={'context':_0x177783,'width':_0x177783['drawingBufferWidth'],'height':_0x177783[_0x4e3987(0x15f)],'pixelFormat':Cesium$4[_0x4e3987(0x126)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x4e3987(0x16b)]},_0x402eef=_0x3346c3['length'],_0x566bf3=new Float32Array(_0x402eef*0x3);for(let _0x5f3754=0x0;_0x5f3754<_0x402eef;_0x5f3754++){const _0x359a97=Cesium$4['Color']['fromCssColorString'](_0x3346c3[_0x5f3754]);_0x566bf3[0x3*_0x5f3754]=_0x359a97['red'],_0x566bf3[0x3*_0x5f3754+0x1]=_0x359a97[_0x4e3987(0x176)],_0x566bf3[0x3*_0x5f3754+0x2]=_0x359a97['blue'];}const _0x430bee={'context':_0x177783,'width':_0x402eef,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4['TextureMagnificationFilter']['LINEAR']})};this['textures']={'segmentsColor':Util[_0x4e3987(0x1d4)](_0x3452ca),'segmentsDepth':Util['createTexture'](_0x9bed5d),'currentTrailsColor':Util['createTexture'](_0x3452ca),'currentTrailsDepth':Util['createTexture'](_0x9bed5d),'nextTrailsColor':Util['createTexture'](_0x3452ca),'nextTrailsDepth':Util['createTexture'](_0x9bed5d),'colorTable':Util['createTexture'](_0x430bee,_0x566bf3)};}['createRenderingFramebuffers'](_0x4c39f5){const _0x3b17d0=_0x3bb793;this['framebuffers']={'segments':Util['createFramebuffer'](_0x4c39f5,this[_0x3b17d0(0x165)]['segmentsColor'],this[_0x3b17d0(0x165)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x4c39f5,this['textures']['currentTrailsColor'],this['textures'][_0x3b17d0(0x12a)]),'nextTrails':Util['createFramebuffer'](_0x4c39f5,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x2b709f){const _0x419ece=_0x3bb793,_0x1117b1=0x4;let _0x5c1a38=[];for(let _0x60702b=0x0;_0x60702b<_0x2b709f['particlesTextureSize'];_0x60702b++){for(let _0x1ec201=0x0;_0x1ec201<_0x2b709f[_0x419ece(0x1e3)];_0x1ec201++){for(let _0x52faba=0x0;_0x52faba<_0x1117b1;_0x52faba++){_0x5c1a38[_0x419ece(0x177)](_0x60702b/_0x2b709f['particlesTextureSize']),_0x5c1a38[_0x419ece(0x177)](_0x1ec201/_0x2b709f['particlesTextureSize']);}}}_0x5c1a38=new Float32Array(_0x5c1a38);let _0x235cb3=[];const _0x5486e6=[-0x1,0x1],_0x55a728=[-0x1,0x1];for(let _0x1762a0=0x0;_0x1762a0<_0x2b709f['maxParticles'];_0x1762a0++){for(let _0x14530d=0x0;_0x14530d<_0x1117b1/0x2;_0x14530d++){for(let _0x5e73db=0x0;_0x5e73db<_0x1117b1/0x2;_0x5e73db++){_0x235cb3['push'](_0x5486e6[_0x14530d]),_0x235cb3[_0x419ece(0x177)](_0x55a728[_0x5e73db]),_0x235cb3['push'](0x0);}}}_0x235cb3=new Float32Array(_0x235cb3);const _0x476b1d=0x6*_0x2b709f['maxParticles'],_0x3c5068=new Uint32Array(_0x476b1d);for(let _0x40eb8e=0x0,_0x4cf131=0x0,_0x733e11=0x0;_0x40eb8e<_0x2b709f['maxParticles'];_0x40eb8e++){_0x3c5068[_0x4cf131++]=_0x733e11+0x0,_0x3c5068[_0x4cf131++]=_0x733e11+0x1,_0x3c5068[_0x4cf131++]=_0x733e11+0x2,_0x3c5068[_0x4cf131++]=_0x733e11+0x2,_0x3c5068[_0x4cf131++]=_0x733e11+0x1,_0x3c5068[_0x4cf131++]=_0x733e11+0x3,_0x733e11+=0x4;}const _0x3e9da3=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x419ece(0x10a)],'componentsPerAttribute':0x2,'values':_0x5c1a38}),'normal':new Cesium$4[(_0x419ece(0x14d))]({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':_0x235cb3})}),'indices':_0x3c5068});return _0x3e9da3;}[_0x3bb793(0x1c1)](_0x268909,_0x3a5d7e,_0x28f470,_0x347643){const _0x10389e=_0x3bb793,_0x442e8d=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x10389e(0x160)](_0x3a5d7e),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x347643['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){const _0x5f19fb=_0x10389e;return _0x347643[_0x5f19fb(0x11a)][_0x5f19fb(0x11d)];},'postProcessingSpeed':function(){const _0x1a93a2=_0x10389e;return _0x347643['particlesTextures'][_0x1a93a2(0x183)];},'colorTable':function(){const _0x38631f=_0x10389e;return _0x442e8d[_0x38631f(0x165)]['colorTable'];},'aspect':function(){return _0x268909['drawingBufferWidth']/_0x268909['drawingBufferHeight'];},'pixelSize':function(){return _0x28f470['pixelSize'];},'lineWidth':function(){const _0x81992c=_0x10389e;return _0x3a5d7e[_0x81992c(0x1d3)];},'particleHeight':function(){return _0x3a5d7e['particleHeight'];}},'vertexShaderSource':new Cesium$4[(_0x10389e(0x1ea))]({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x10389e(0x1ea))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers']['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x10389e(0x12b),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType'][_0x10389e(0x11e)],'uniformMap':{'segmentsColorTexture':function(){return _0x442e8d['textures']['segmentsColor'];},'segmentsDepthTexture':function(){return _0x442e8d['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x442e8d['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x442e8d['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x3a5d7e['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x10389e(0x108)],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this[_0x10389e(0x1ba)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x4a8fd6=_0x10389e,_0x296eb8=_0x442e8d[_0x4a8fd6(0x1ba)][_0x4a8fd6(0x1de)];_0x442e8d[_0x4a8fd6(0x1ba)][_0x4a8fd6(0x1de)]=_0x442e8d[_0x4a8fd6(0x1ba)]['nextTrails'],_0x442e8d['framebuffers']['nextTrails']=_0x296eb8,_0x442e8d[_0x4a8fd6(0x138)][_0x4a8fd6(0x130)]['commandToExecute']['framebuffer']=_0x442e8d['framebuffers']['nextTrails'],_0x442e8d['primitives'][_0x4a8fd6(0x130)]['clearCommand']['framebuffer']=_0x442e8d['framebuffers'][_0x4a8fd6(0x13b)];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){return _0x442e8d['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x442e8d['framebuffers']['nextTrails']['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x10389e(0x108)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag=_0x3bb793(0x1e4),updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';function _0x52d6(_0x53654e,_0x333b7f){const _0x3bcb43=_0x3bcb();return _0x52d6=function(_0x52d674,_0x2770d5){_0x52d674=_0x52d674-0x102;let _0x5b7b8f=_0x3bcb43[_0x52d674];return _0x5b7b8f;},_0x52d6(_0x53654e,_0x333b7f);}const Cesium$3=mars3d__namespace[_0x3bb793(0x1a8)];class ParticlesComputing{constructor(_0x34d341,_0xb05f78,_0x93852a,_0x25aadd){const _0x279233=_0x3bb793;this['data']=_0xb05f78,this[_0x279233(0x168)](_0x34d341,_0xb05f78),this['createParticlesTextures'](_0x34d341,_0x93852a,_0x25aadd),this[_0x279233(0x1ca)](_0xb05f78,_0x93852a,_0x25aadd);}['createWindTextures'](_0x4346b1,_0x5bc30c){const _0x48d4a7=_0x3bb793,_0x401916={'context':_0x4346b1,'width':_0x5bc30c['dimensions'][_0x48d4a7(0x14f)],'height':_0x5bc30c['dimensions']['lat']*(_0x5bc30c['dimensions'][_0x48d4a7(0x1bb)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x48d4a7(0x1dd)][_0x48d4a7(0x135)]})};this['windTextures']={'U':Util['createTexture'](_0x401916,_0x5bc30c['U']['array']),'V':Util[_0x48d4a7(0x1d4)](_0x401916,_0x5bc30c['V'][_0x48d4a7(0x145)])};}['createParticlesTextures'](_0x3eaa84,_0x16ea26,_0x22f35e){const _0x926e77=_0x3bb793,_0x34f4a4={'context':_0x3eaa84,'width':_0x16ea26['particlesTextureSize'],'height':_0x16ea26[_0x926e77(0x1e3)],'pixelFormat':Cesium$3['PixelFormat'][_0x926e77(0x1b4)],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x926e77(0x135)],'magnificationFilter':Cesium$3[_0x926e77(0x1dd)]['NEAREST']})},_0x4c38cc=this[_0x926e77(0x104)](_0x16ea26['maxParticles'],_0x22f35e),_0xbfa98e=new Float32Array(0x4*_0x16ea26[_0x926e77(0x1b5)])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0x34f4a4),'currentParticlesPosition':Util['createTexture'](_0x34f4a4,_0x4c38cc),'nextParticlesPosition':Util['createTexture'](_0x34f4a4,_0x4c38cc),'currentParticlesSpeed':Util['createTexture'](_0x34f4a4,_0xbfa98e),'nextParticlesSpeed':Util['createTexture'](_0x34f4a4,_0xbfa98e),'postProcessingPosition':Util['createTexture'](_0x34f4a4,_0x4c38cc),'postProcessingSpeed':Util['createTexture'](_0x34f4a4,_0xbfa98e)};}['randomizeParticles'](_0xdc88fc,_0x2ccc08){const _0x2ea5b8=_0x3bb793,_0x265064=new Float32Array(0x4*_0xdc88fc);for(let _0x14820a=0x0;_0x14820a<_0xdc88fc;_0x14820a++){_0x265064[0x4*_0x14820a]=Cesium$3['Math'][_0x2ea5b8(0x180)](_0x2ccc08['lonRange']['x'],_0x2ccc08[_0x2ea5b8(0x187)]['y']),_0x265064[0x4*_0x14820a+0x1]=Cesium$3[_0x2ea5b8(0x17a)]['randomBetween'](_0x2ccc08[_0x2ea5b8(0x1e8)]['x'],_0x2ccc08[_0x2ea5b8(0x1e8)]['y']),_0x265064[0x4*_0x14820a+0x2]=Cesium$3[_0x2ea5b8(0x17a)]['randomBetween'](this[_0x2ea5b8(0x117)][_0x2ea5b8(0x1bb)]['min'],this['data'][_0x2ea5b8(0x1bb)][_0x2ea5b8(0x1a7)]),_0x265064[0x4*_0x14820a+0x3]=0x0;}return _0x265064;}[_0x3bb793(0x1a4)](){Object['keys'](this['particlesTextures'])['forEach'](_0xc468ed=>{const _0x57e533=_0x52d6;this[_0x57e533(0x11a)][_0xc468ed]['destroy']();});}['createComputingPrimitives'](_0x21d120,_0x56f3cb,_0x4317b5){const _0x5d8388=_0x3bb793,_0x37a640=new Cesium$3['Cartesian3'](_0x21d120[_0x5d8388(0x1e6)]['lon'],_0x21d120[_0x5d8388(0x1e6)]['lat'],_0x21d120['dimensions']['lev']),_0x122bcd=new Cesium$3['Cartesian3'](_0x21d120['lon']['min'],_0x21d120['lat']['min'],_0x21d120[_0x5d8388(0x1bb)]['min']),_0x4ca282=new Cesium$3['Cartesian3'](_0x21d120[_0x5d8388(0x14f)][_0x5d8388(0x1a7)],_0x21d120['lat']['max'],_0x21d120['lev']['max']),_0x3c2d0b=new Cesium$3['Cartesian3']((_0x4ca282['x']-_0x122bcd['x'])/(_0x37a640['x']-0x1),(_0x4ca282['y']-_0x122bcd['y'])/(_0x37a640['y']-0x1),_0x37a640['z']>0x1?(_0x4ca282['z']-_0x122bcd['z'])/(_0x37a640['z']-0x1):0x1),_0x3b2f77=new Cesium$3['Cartesian2'](_0x21d120['U']['min'],_0x21d120['U']['max']),_0x639c0f=new Cesium$3[(_0x5d8388(0x161))](_0x21d120['V']['min'],_0x21d120['V']['max']),_0x1e1df0=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x1e1df0['windTextures']['U'];},'V':function(){const _0x53e3f2=_0x5d8388;return _0x1e1df0[_0x53e3f2(0x1a1)]['V'];},'currentParticlesPosition':function(){return _0x1e1df0['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x37a640;},'minimum':function(){return _0x122bcd;},'maximum':function(){return _0x4ca282;},'interval':function(){return _0x3c2d0b;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x39532f=_0x5d8388;_0x1e1df0['primitives'][_0x39532f(0x197)][_0x39532f(0x107)]['outputTexture']=_0x1e1df0[_0x39532f(0x11a)]['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x1e1df0['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x191a9c=_0x5d8388;return _0x1e1df0[_0x191a9c(0x11a)]['particlesWind'];},'uSpeedRange':function(){return _0x3b2f77;},'vSpeedRange':function(){return _0x639c0f;},'pixelSize':function(){return _0x4317b5['pixelSize'];},'speedFactor':function(){const _0x405e69=_0x5d8388;return _0x56f3cb[_0x405e69(0x1c5)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x52afb8=_0x5d8388,_0x6d13a=_0x1e1df0[_0x52afb8(0x11a)][_0x52afb8(0x1aa)];_0x1e1df0['particlesTextures']['currentParticlesSpeed']=_0x1e1df0['particlesTextures']['postProcessingSpeed'],_0x1e1df0[_0x52afb8(0x11a)][_0x52afb8(0x183)]=_0x6d13a,_0x1e1df0['primitives']['updateSpeed']['commandToExecute']['outputTexture']=_0x1e1df0[_0x52afb8(0x11a)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x428f5c=_0x5d8388;return _0x1e1df0[_0x428f5c(0x11a)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x53a17a=_0x5d8388;return _0x1e1df0[_0x53a17a(0x11a)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updatePosition_frag]}),'outputTexture':this[_0x5d8388(0x11a)]['nextParticlesPosition'],'preExecute':function(){const _0xf51e13=_0x5d8388,_0x53ce48=_0x1e1df0[_0xf51e13(0x11a)]['currentParticlesPosition'];_0x1e1df0['particlesTextures'][_0xf51e13(0x1e5)]=_0x1e1df0['particlesTextures']['postProcessingPosition'],_0x1e1df0['particlesTextures']['postProcessingPosition']=_0x53ce48,_0x1e1df0['primitives'][_0xf51e13(0x17b)][_0xf51e13(0x107)]['outputTexture']=_0x1e1df0[_0xf51e13(0x11a)]['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x5d8388(0x13e),'uniformMap':{'nextParticlesPosition':function(){return _0x1e1df0['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x1e1df0['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){return _0x4317b5['lonRange'];},'latRange':function(){return _0x4317b5['latRange'];},'randomCoefficient':function(){const _0xd785ff=Math['random']();return _0xd785ff;},'dropRate':function(){const _0x5efb41=_0x5d8388;return _0x56f3cb[_0x5efb41(0x194)];},'dropRateBump':function(){return _0x56f3cb['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures']['postProcessingPosition'],'preExecute':function(){const _0x3cd3d6=_0x5d8388;_0x1e1df0[_0x3cd3d6(0x138)]['postProcessingPosition']['commandToExecute']['outputTexture']=_0x1e1df0['particlesTextures'][_0x3cd3d6(0x11d)];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x5d8388(0x13e),'uniformMap':{'postProcessingPosition':function(){const _0x2c8142=_0x5d8388;return _0x1e1df0['particlesTextures'][_0x2c8142(0x11d)];},'nextParticlesSpeed':function(){return _0x1e1df0['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){const _0x3b0bd3=_0x5d8388;_0x1e1df0['primitives'][_0x3b0bd3(0x183)]['commandToExecute']['outputTexture']=_0x1e1df0['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace[_0x3bb793(0x1a8)];class ParticleSystem{constructor(_0x1b4caf,_0x5cc180,_0x5735e9,_0x58f19a){const _0x1ae548=_0x3bb793;this['context']=_0x1b4caf,_0x5cc180={..._0x5cc180},_0x5cc180['udata']&&_0x5cc180[_0x1ae548(0x17f)]&&(_0x5cc180['dimensions']={},_0x5cc180[_0x1ae548(0x1e6)][_0x1ae548(0x14f)]=_0x5cc180['cols'],_0x5cc180['dimensions']['lat']=_0x5cc180[_0x1ae548(0x123)],_0x5cc180['dimensions']['lev']=_0x5cc180['lev']||0x1,_0x5cc180[_0x1ae548(0x14f)]={},_0x5cc180['lon']['min']=_0x5cc180['xmin'],_0x5cc180['lon']['max']=_0x5cc180['xmax'],_0x5cc180[_0x1ae548(0x109)]={},_0x5cc180['lat']['min']=_0x5cc180['ymin'],_0x5cc180['lat'][_0x1ae548(0x1a7)]=_0x5cc180[_0x1ae548(0x132)],_0x5cc180['lev']={},_0x5cc180[_0x1ae548(0x1bb)]['min']=_0x5cc180['levmin']??0x1,_0x5cc180[_0x1ae548(0x1bb)]['max']=_0x5cc180['levmax']??0x1,_0x5cc180['U']={},_0x5cc180['U']['array']=new Float32Array(_0x5cc180['udata']),_0x5cc180['U']['min']=_0x5cc180[_0x1ae548(0x13f)]??Math['min'](..._0x5cc180['udata']),_0x5cc180['U']['max']=_0x5cc180['umax']??Math[_0x1ae548(0x1a7)](..._0x5cc180['udata']),_0x5cc180['V']={},_0x5cc180['V']['array']=new Float32Array(_0x5cc180[_0x1ae548(0x17f)]),_0x5cc180['V']['min']=_0x5cc180[_0x1ae548(0x14a)]??Math[_0x1ae548(0x19d)](..._0x5cc180['vdata']),_0x5cc180['V'][_0x1ae548(0x1a7)]=_0x5cc180['vmax']??Math['max'](..._0x5cc180[_0x1ae548(0x17f)])),this['data']=_0x5cc180,this['options']=_0x5735e9,this[_0x1ae548(0x13d)]=_0x58f19a,this['particlesComputing']=new ParticlesComputing(this[_0x1ae548(0x1a9)],this['data'],this[_0x1ae548(0x128)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this[_0x1ae548(0x1a9)],this['data'],this['options'],this[_0x1ae548(0x13d)],this[_0x1ae548(0x11f)]);}[_0x3bb793(0x19b)](_0x3853b7){const _0x7a937d=_0x3bb793;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this[_0x7a937d(0x11f)]['windTextures'])['forEach'](_0x552b2b=>{this['particlesComputing']['windTextures'][_0x552b2b]['destroy']();}),this[_0x7a937d(0x198)]['textures'][_0x7a937d(0x17c)][_0x7a937d(0x1d2)](),Object[_0x7a937d(0x172)](this['particlesRendering'][_0x7a937d(0x1ba)])[_0x7a937d(0x143)](_0x43eb9c=>{const _0x2bc8bd=_0x7a937d;this[_0x2bc8bd(0x198)][_0x2bc8bd(0x1ba)][_0x43eb9c]['destroy']();}),this[_0x7a937d(0x1a9)]=_0x3853b7,this[_0x7a937d(0x11f)]=new ParticlesComputing(this[_0x7a937d(0x1a9)],this['data'],this['options'],this[_0x7a937d(0x13d)]),this[_0x7a937d(0x198)]=new ParticlesRendering(this[_0x7a937d(0x1a9)],this[_0x7a937d(0x117)],this[_0x7a937d(0x128)],this['viewerParameters'],this['particlesComputing']);}['clearFramebuffers'](){const _0xd84c80=_0x3bb793,_0x4aa2db=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0xd84c80(0x1b9))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2[_0xd84c80(0x1b3)]['OPAQUE']});Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x57e147=>{const _0x437daa=_0xd84c80;_0x4aa2db[_0x437daa(0x120)]=this[_0x437daa(0x198)]['framebuffers'][_0x57e147],_0x4aa2db['execute'](this['context']);});}['refreshParticles'](_0x250e03){const _0x7220dd=_0x3bb793;this[_0x7220dd(0x199)](),this[_0x7220dd(0x11f)]['destroyParticlesTextures'](),this[_0x7220dd(0x11f)]['createParticlesTextures'](this['context'],this['options'],this[_0x7220dd(0x13d)]);if(_0x250e03){var _0x434800;const _0x15bf58=this['particlesRendering']['createSegmentsGeometry'](this['options']);this[_0x7220dd(0x198)][_0x7220dd(0x138)][_0x7220dd(0x137)][_0x7220dd(0x173)]=_0x15bf58;const _0x450e08=Cesium$2[_0x7220dd(0x1bc)]['fromGeometry']({'context':this['context'],'geometry':_0x15bf58,'attributeLocations':this['particlesRendering']['primitives'][_0x7220dd(0x137)]['attributeLocations'],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x434800=this['particlesRendering']['primitives'])!==null&&_0x434800!==void 0x0&&(_0x434800=_0x434800['segments'])!==null&&_0x434800!==void 0x0&&_0x434800['commandToExecute']&&(this[_0x7220dd(0x198)]['primitives'][_0x7220dd(0x137)]['commandToExecute'][_0x7220dd(0x1c8)]=_0x450e08);}}['setOptions'](_0x273774){const _0x771465=_0x3bb793;let _0xd39fa7=![];this['options'][_0x771465(0x1b5)]!==_0x273774['maxParticles']&&(_0xd39fa7=!![]),Object[_0x771465(0x172)](_0x273774)['forEach'](_0x7ea2df=>{const _0x33e642=_0x771465;this[_0x33e642(0x128)][_0x7ea2df]=_0x273774[_0x7ea2df];}),this['refreshParticles'](_0xd39fa7);}['applyViewerParameters'](_0x2e758a){Object['keys'](_0x2e758a)['forEach'](_0x139b97=>{const _0x40f180=_0x52d6;this[_0x40f180(0x13d)][_0x139b97]=_0x2e758a[_0x139b97];}),this['refreshParticles'](![]);}['destroy'](){const _0x4e79de=_0x3bb793;clearTimeout(this['canrefresh']),this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing'][_0x4e79de(0x1a1)])['forEach'](_0x3d14f3=>{const _0x349a5d=_0x4e79de;this[_0x349a5d(0x11f)][_0x349a5d(0x1a1)][_0x3d14f3]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x4e79de(0x1d2)](),Object['keys'](this['particlesRendering'][_0x4e79de(0x1ba)])['forEach'](_0xf3e000=>{const _0x56543f=_0x4e79de;this['particlesRendering']['framebuffers'][_0xf3e000][_0x56543f(0x1d2)]();});for(const _0x4f2bfe in this){delete this[_0x4f2bfe];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace['layer']['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x3bb793(0x1af)]};class WindLayer extends BaseLayer$1{constructor(_0x2e1799={}){_0x2e1799={...DEF_OPTIONS,..._0x2e1799},super(_0x2e1799),this['_setOptionsHook'](_0x2e1799);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x3bb793(0x117)](_0x1b66a2){const _0x576404=_0x3bb793;this[_0x576404(0x1d0)](_0x1b66a2);}get['colors'](){return this['options']['colors'];}set['colors'](_0x2c222c){const _0x1f0be4=_0x3bb793;this[_0x1f0be4(0x128)]['colors']=_0x2c222c,this[_0x1f0be4(0x196)]&&this['particleSystem'][_0x1f0be4(0x175)]({'colors':_0x2c222c}),this['resize']();}['_mountedHook'](){}['_addedHook'](){const _0x134835=_0x3bb793;this['scene']=this['_map']['scene'],this[_0x134835(0x125)]=this['_map']['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x134835(0x16d)]['primitives'][_0x134835(0x174)](this['primitives']),this[_0x134835(0x13d)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1[(_0x134835(0x161))](),'pixelSize':0x0},this[_0x134835(0x1c3)]=new Cesium$1[(_0x134835(0x158))](Cesium$1[_0x134835(0x181)][_0x134835(0x12e)],0.99*0x615299),this[_0x134835(0x19c)](),window['addEventListener'](_0x134835(0x164),this['resize']['bind'](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['_map']['on'](mars3d__namespace[_0x134835(0x1c9)]['wheel'],this['_onMapWhellEvent'],this),this[_0x134835(0x19a)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x134835(0x16e)],this),this[_0x134835(0x122)]&&this['setData'](this[_0x134835(0x122)]);}[_0x3bb793(0x1ad)](){const _0x3c874a=_0x3bb793;window['removeEventListener'](_0x3c874a(0x164),this[_0x3c874a(0x164)]),this['_map'][_0x3c874a(0x1cd)](mars3d__namespace[_0x3c874a(0x1c9)]['preRender'],this['_onMap_preRenderEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x3c874a(0x1cd)](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x3c874a(0x19a)]['off'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x3c874a(0x19a)]['off'](mars3d__namespace[_0x3c874a(0x1c9)]['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this['primitives']);}['resize'](){const _0x1ba66d=_0x3bb793;if(!this[_0x1ba66d(0x1d1)]||!this['particleSystem'])return;this['primitives']['show']=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this[_0x1ba66d(0x115)],this);}['_onMap_preRenderEvent'](_0x2c2375){const _0x23b82f=_0x3bb793;this[_0x23b82f(0x196)]['canvasResize'](this['scene'][_0x23b82f(0x1a9)]),this[_0x23b82f(0x12f)](),this[_0x23b82f(0x138)]['show']=!![];}[_0x3bb793(0x110)](_0x4d26de){const _0x1d0d66=_0x3bb793;clearTimeout(this['refreshTimer']);if(!this[_0x1d0d66(0x1d1)]||!this['particleSystem'])return;this['primitives'][_0x1d0d66(0x1d1)]=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x233cc5){this['mouse_down']=!![];}[_0x3bb793(0x16e)](_0x477a61){const _0x3548fa=_0x3bb793;if(!this['show']||!this[_0x3548fa(0x196)])return;this['mouse_down']&&(this['primitives'][_0x3548fa(0x1d1)]=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x1ce657){const _0x5214df=_0x3bb793;if(!this[_0x5214df(0x1d1)]||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this[_0x5214df(0x157)]=![],this['mouse_move']=![];}['redraw'](){const _0x7a62c5=_0x3bb793;if(!this[_0x7a62c5(0x19a)]||!this['show'])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x7a62c5(0x138)][_0x7a62c5(0x1d1)]=!![];}['setData'](_0x200160){const _0x29ecab=_0x3bb793;this['_data']=_0x200160,this[_0x29ecab(0x196)]&&this['particleSystem'][_0x29ecab(0x1d2)](),this[_0x29ecab(0x196)]=new ParticleSystem(this['scene'][_0x29ecab(0x1a9)],_0x200160,this['getOptions'](),this[_0x29ecab(0x13d)]),this['addPrimitives']();}[_0x3bb793(0x1d5)](_0x198e97,_0x5c1341){const _0x10a245=_0x3bb793;if(_0x198e97)for(const _0x4f0832 in _0x198e97){this[_0x4f0832]=_0x198e97[_0x4f0832];}this['particleSystem']&&this['particleSystem']['setOptions'](this[_0x10a245(0x146)]());}[_0x3bb793(0x146)](){const _0x5a976d=_0x3bb793,_0x1ec365=Math[_0x5a976d(0x178)](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x1ec365*_0x1ec365,{'particlesTextureSize':_0x1ec365,'maxParticles':this[_0x5a976d(0x1d8)],'particleHeight':this['fixedHeight'],'fadeOpacity':this['fadeOpacity'],'dropRate':this[_0x5a976d(0x194)],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this['colors']};}['addPrimitives'](){const _0x4c5269=_0x3bb793;this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x4c5269(0x138)]['getWind']),this['primitives']['add'](this[_0x4c5269(0x196)]['particlesComputing'][_0x4c5269(0x138)]['updateSpeed']),this['primitives']['add'](this[_0x4c5269(0x196)][_0x4c5269(0x11f)][_0x4c5269(0x138)]['updatePosition']),this['primitives']['add'](this['particleSystem']['particlesComputing'][_0x4c5269(0x138)][_0x4c5269(0x11d)]),this['primitives'][_0x4c5269(0x174)](this['particleSystem']['particlesComputing']['primitives']['postProcessingSpeed']),this['primitives'][_0x4c5269(0x174)](this[_0x4c5269(0x196)]['particlesRendering'][_0x4c5269(0x138)][_0x4c5269(0x137)]),this['primitives']['add'](this['particleSystem'][_0x4c5269(0x198)]['primitives'][_0x4c5269(0x130)]),this['primitives']['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0xe93261=_0x3bb793;let _0xa9befd=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0xa9befd){const _0x10a8a3=this['_map']['getExtent']();_0xa9befd=Cesium$1[_0xe93261(0x116)]['fromDegrees'](_0x10a8a3[_0xe93261(0x129)],_0x10a8a3[_0xe93261(0x1b0)],_0x10a8a3[_0xe93261(0x113)],_0x10a8a3[_0xe93261(0x132)]);}const _0x2821b6=Util['viewRectangleToLonLatRange'](_0xa9befd);this['viewerParameters'][_0xe93261(0x187)]['x']=_0x2821b6['lon'][_0xe93261(0x19d)],this['viewerParameters'][_0xe93261(0x187)]['y']=_0x2821b6['lon'][_0xe93261(0x1a7)],this[_0xe93261(0x13d)]['latRange']['x']=_0x2821b6['lat']['min'],this[_0xe93261(0x13d)][_0xe93261(0x1e8)]['y']=_0x2821b6[_0xe93261(0x109)][_0xe93261(0x1a7)];const _0xa7d246=this['camera'][_0xe93261(0x153)](this[_0xe93261(0x1c3)],this[_0xe93261(0x16d)]['drawingBufferWidth'],this['scene']['drawingBufferHeight']);_0xa7d246>0x0&&(this['viewerParameters']['pixelSize']=_0xa7d246);}}mars3d__namespace[_0x3bb793(0x1ae)]['register']('wind',WindLayer),mars3d__namespace['layer'][_0x3bb793(0x1b1)]=WindLayer;class CanvasParticle{constructor(){const _0x2752bd=_0x3bb793;this[_0x2752bd(0x156)]=null,this['lat']=null,this[_0x2752bd(0x19e)]=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0xb800ab in this){delete this[_0xb800ab];}}}class CanvasWindField{constructor(_0xfe0cae){this['setOptions'](_0xfe0cae);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x1a2df5){const _0x54dd55=_0x3bb793;this['_speedRate']=(0x64-(_0x1a2df5>0x63?0x63:_0x1a2df5))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this['ymax']-this[_0x54dd55(0x1b0)])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x30a01c){const _0x47f80e=_0x3bb793;this[_0x47f80e(0x14e)]=_0x30a01c;}['setOptions'](_0x386953){const _0x416e64=_0x3bb793;this['options']=_0x386953,this['maxAge']=_0x386953[_0x416e64(0x1ce)]||0x78,this[_0x416e64(0x189)]=_0x386953[_0x416e64(0x189)]||0x32,this['particles']=[];const _0x45910c=_0x386953['particlesNumber']||0x1000;for(let _0x3c689b=0x0;_0x3c689b<_0x45910c;_0x3c689b++){const _0xddee20=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0xddee20);}}[_0x3bb793(0x10d)](_0x586d25){const _0x48a4c6=_0x3bb793;this['rows']=_0x586d25[_0x48a4c6(0x123)],this['cols']=_0x586d25['cols'],this['xmin']=_0x586d25['xmin'],this['xmax']=_0x586d25['xmax'],this['ymin']=_0x586d25['ymin'],this['ymax']=_0x586d25['ymax'],this[_0x48a4c6(0x14c)]=[];const _0x6e0891=_0x586d25['udata'],_0x24694d=_0x586d25[_0x48a4c6(0x17f)];let _0x5d4301=![];_0x6e0891['length']===this['rows']&&_0x6e0891[0x0]['length']===this['cols']&&(_0x5d4301=!![]);let _0x330684=0x0,_0x3a54e0=null,_0x103a60=null;for(let _0x14bc90=0x0;_0x14bc90<this['rows'];_0x14bc90++){_0x3a54e0=[];for(let _0x14355d=0x0;_0x14355d<this['cols'];_0x14355d++,_0x330684++){_0x5d4301?_0x103a60=this['_calcUV'](_0x6e0891[_0x14bc90][_0x14355d],_0x24694d[_0x14bc90][_0x14355d]):_0x103a60=this[_0x48a4c6(0x118)](_0x6e0891[_0x330684],_0x24694d[_0x330684]),_0x3a54e0['push'](_0x103a60);}this['grid'][_0x48a4c6(0x177)](_0x3a54e0);}this['options'][_0x48a4c6(0x16c)]&&this['grid']['reverse']();}['clear'](){const _0x17b7a8=_0x3bb793;delete this[_0x17b7a8(0x123)],delete this['cols'],delete this[_0x17b7a8(0x129)],delete this['xmax'],delete this[_0x17b7a8(0x1b0)],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x3ad281,_0x361eaa){const _0x5e6c25=_0x3bb793,_0x4bbdb9=(_0x3ad281-this['xmin'])/(this['xmax']-this['xmin'])*(this[_0x5e6c25(0x133)]-0x1),_0x31dff3=(this[_0x5e6c25(0x132)]-_0x361eaa)/(this['ymax']-this['ymin'])*(this[_0x5e6c25(0x123)]-0x1);return[_0x4bbdb9,_0x31dff3];}['getUVByXY'](_0x1b5971,_0xddb7bf){const _0x74f094=_0x3bb793;if(_0x1b5971<0x0||_0x1b5971>=this[_0x74f094(0x133)]||_0xddb7bf>=this['rows'])return[0x0,0x0,0x0];const _0x3cb68a=Math['floor'](_0x1b5971),_0x48b0ea=Math['floor'](_0xddb7bf);if(_0x3cb68a===_0x1b5971&&_0x48b0ea===_0xddb7bf)return this[_0x74f094(0x14c)][_0xddb7bf][_0x1b5971];const _0x2f2f27=_0x3cb68a+0x1,_0x2f96db=_0x48b0ea+0x1,_0x51ad1d=this['getUVByXY'](_0x3cb68a,_0x48b0ea),_0x1e9a06=this[_0x74f094(0x17d)](_0x2f2f27,_0x48b0ea),_0x515eae=this['getUVByXY'](_0x3cb68a,_0x2f96db),_0x5ea01d=this[_0x74f094(0x17d)](_0x2f2f27,_0x2f96db);let _0x20238d=null;try{_0x20238d=this['_bilinearInterpolation'](_0x1b5971-_0x3cb68a,_0xddb7bf-_0x48b0ea,_0x51ad1d,_0x1e9a06,_0x515eae,_0x5ea01d);}catch(_0x1bf84b){console['log'](_0x1b5971,_0xddb7bf);}return _0x20238d;}['_bilinearInterpolation'](_0x3994d0,_0x582a5d,_0x4016a5,_0x1ac5f9,_0x4f37b6,_0x5da585){const _0x22c9cd=0x1-_0x3994d0,_0x1d4361=0x1-_0x582a5d,_0x287064=_0x22c9cd*_0x1d4361,_0x2076c5=_0x3994d0*_0x1d4361,_0x497192=_0x22c9cd*_0x582a5d,_0xd532f2=_0x3994d0*_0x582a5d,_0x1df3e8=_0x4016a5[0x0]*_0x287064+_0x1ac5f9[0x0]*_0x2076c5+_0x4f37b6[0x0]*_0x497192+_0x5da585[0x0]*_0xd532f2,_0x57bd3d=_0x4016a5[0x1]*_0x287064+_0x1ac5f9[0x1]*_0x2076c5+_0x4f37b6[0x1]*_0x497192+_0x5da585[0x1]*_0xd532f2;return this['_calcUV'](_0x1df3e8,_0x57bd3d);}['_calcUV'](_0x2dfd86,_0x57a89c){return[+_0x2dfd86,+_0x57a89c,Math['sqrt'](_0x2dfd86*_0x2dfd86+_0x57a89c*_0x57a89c)];}[_0x3bb793(0x1bd)](_0x12446c,_0x57b8cb){const _0x3f804d=_0x3bb793;if(!this['isInExtent'](_0x12446c,_0x57b8cb))return null;const _0x3a12e0=this[_0x3f804d(0x1da)](_0x12446c,_0x57b8cb),_0x38291f=this['getUVByXY'](_0x3a12e0[0x0],_0x3a12e0[0x1]);return _0x38291f;}['isInExtent'](_0x2797b4,_0x41e450){const _0x4e74c3=_0x3bb793;return _0x2797b4>=this['xmin']&&_0x2797b4<=this['xmax']&&_0x41e450>=this[_0x4e74c3(0x1b0)]&&_0x41e450<=this['ymax']?!![]:![];}['getRandomLatLng'](){const _0x5bc41e=_0x3bb793,_0x2bf2a7=fRandomByfloat(this['xmin'],this[_0x5bc41e(0x113)]),_0x17524b=fRandomByfloat(this[_0x5bc41e(0x1b0)],this['ymax']);return{'lat':_0x17524b,'lng':_0x2bf2a7};}['getParticles'](){const _0x1a7a85=_0x3bb793;let _0x49320c,_0xfe8d62,_0x2162ac;for(let _0x5c8deb=0x0,_0x35aa15=this['particles']['length'];_0x5c8deb<_0x35aa15;_0x5c8deb++){let _0x432e52=this[_0x1a7a85(0x171)][_0x5c8deb];_0x432e52['age']<=0x0&&(_0x432e52=this['_randomParticle'](_0x432e52));if(_0x432e52['age']>0x0){const _0x587431=_0x432e52['tlng'],_0x5843df=_0x432e52['tlat'];_0x2162ac=this['getUVByPoint'](_0x587431,_0x5843df),_0x2162ac?(_0x49320c=_0x587431+this[_0x1a7a85(0x1d6)][0x0]*_0x2162ac[0x0],_0xfe8d62=_0x5843df+this['_calc_speedRate'][0x1]*_0x2162ac[0x1],_0x432e52['lng']=_0x587431,_0x432e52['lat']=_0x5843df,_0x432e52['tlng']=_0x49320c,_0x432e52['tlat']=_0xfe8d62,_0x432e52['speed']=_0x2162ac[0x2],_0x432e52['age']--):_0x432e52['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x43ac43){const _0x1df1a7=_0x3bb793;let _0x58999b,_0x727afa;for(let _0x47f43d=0x0;_0x47f43d<0x1e;_0x47f43d++){_0x58999b=this[_0x1df1a7(0x11b)](),_0x727afa=this[_0x1df1a7(0x1bd)](_0x58999b['lng'],_0x58999b[_0x1df1a7(0x109)]);if(_0x727afa&&_0x727afa[0x2]>0x0)break;}if(!_0x727afa)return _0x43ac43;const _0x394979=_0x58999b['lng']+this[_0x1df1a7(0x1d6)][0x0]*_0x727afa[0x0],_0x45bea6=_0x58999b['lat']+this['_calc_speedRate'][0x1]*_0x727afa[0x1];return _0x43ac43['lng']=_0x58999b['lng'],_0x43ac43[_0x1df1a7(0x109)]=_0x58999b['lat'],_0x43ac43[_0x1df1a7(0x19e)]=_0x394979,_0x43ac43['tlat']=_0x45bea6,_0x43ac43[_0x1df1a7(0x1b6)]=Math['round'](Math['random']()*this['maxAge']),_0x43ac43[_0x1df1a7(0x1a2)]=_0x727afa[0x2],_0x43ac43;}['destroy'](){for(const _0x185e20 in this){delete this[_0x185e20];}}}function fRandomByfloat(_0x139698,_0x392375){return _0x139698+Math['random']()*(_0x392375-_0x139698);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x3612c2={}){const _0x49abc9=_0x3bb793;super(_0x3612c2),this['_setOptionsHook'](_0x3612c2),this['canvas']=null,_0x3612c2[_0x49abc9(0x1df)]&&_0x3612c2['steps']&&(this[_0x49abc9(0x18c)]=new mars3d__namespace['ColorRamp'](_0x3612c2));}[_0x3bb793(0x1d5)](_0x49d0aa,_0x4b1d0b){const _0x146f01=_0x3bb793;this['frameTime']=0x3e8/(_0x49d0aa['frameRate']||0xa),this['_pointerEvents']=this['options'][_0x146f01(0x1e9)]??![],this[_0x146f01(0x151)]=_0x49d0aa['color']||'#ffffff',this['lineWidth']=_0x49d0aa['lineWidth']||0x1,this['fixedHeight']=_0x49d0aa[_0x146f01(0x1ac)]??0x0,this['reverseY']=_0x49d0aa['reverseY']??![],this['windField']&&this['windField']['setOptions'](_0x49d0aa);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x5456ca=_0x3bb793;return this['_map'][_0x5456ca(0x16d)]['canvas']['clientWidth'];}get[_0x3bb793(0x195)](){return this['_map']['scene']['canvas']['clientHeight'];}get[_0x3bb793(0x1e9)](){return this['_pointerEvents'];}set['pointerEvents'](_0x583648){const _0x36d7c5=_0x3bb793;this['_pointerEvents']=_0x583648;if(!this['canvas'])return;_0x583648?this[_0x36d7c5(0x192)][_0x36d7c5(0x112)]['pointer-events']=_0x36d7c5(0x1b8):this['canvas']['style'][_0x36d7c5(0x10e)]='none';}get['particlesNumber'](){const _0x1053a1=_0x3bb793;return this['options'][_0x1053a1(0x1d8)];}set[_0x3bb793(0x1d8)](_0x302034){const _0xab5a01=_0x3bb793;this[_0xab5a01(0x128)]['particlesNumber']=_0x302034,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{const _0x181e52=_0xab5a01;this[_0x181e52(0x147)]();},0x1f4);}get['speedRate'](){const _0x32d04e=_0x3bb793;return this[_0x32d04e(0x128)]['speedRate'];}set['speedRate'](_0x2df976){const _0x5c558a=_0x3bb793;this['options']['speedRate']=_0x2df976,this[_0x5c558a(0x1c7)]&&(this['windField']['speedRate']=_0x2df976);}get['maxAge'](){const _0x213648=_0x3bb793;return this['options'][_0x213648(0x1ce)];}set['maxAge'](_0x14e50a){const _0x4ef541=_0x3bb793;this['options'][_0x4ef541(0x1ce)]=_0x14e50a,this['windField']&&(this[_0x4ef541(0x1c7)]['maxAge']=_0x14e50a);}get['data'](){const _0x26034c=_0x3bb793;return this[_0x26034c(0x170)];}set[_0x3bb793(0x117)](_0xfad269){this['setData'](_0xfad269);}['_showHook'](_0x57605f){const _0x27c379=_0x3bb793;_0x57605f?this[_0x27c379(0x114)]():(this['windData']&&(this['options'][_0x27c379(0x117)]=this['windData']),this['_removedHook']());}['_mountedHook'](){const _0xbe99e5=_0x3bb793;this['options']['worker']?this[_0xbe99e5(0x15d)]():this['windField']=new CanvasWindField(this[_0xbe99e5(0x128)]);}[_0x3bb793(0x114)](){const _0x2c6842=_0x3bb793;this[_0x2c6842(0x192)]=this['_createCanvas'](),this['canvasContext']=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this[_0x2c6842(0x1d0)](this['options']['data']);}['_removedHook'](){const _0x275346=_0x3bb793;this['clear'](),this['unbindEvent'](),this['canvas']&&(this[_0x275346(0x19a)][_0x275346(0x1eb)][_0x275346(0x1cf)](this[_0x275346(0x192)]),delete this[_0x275346(0x192)]);}['_createCanvas'](){const _0x1fd265=_0x3bb793,_0x4479ff=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0x1fd265(0x19a)]['container']);return _0x4479ff['style'][_0x1fd265(0x11c)]='absolute',_0x4479ff[_0x1fd265(0x112)]['top']='0px',_0x4479ff['style'][_0x1fd265(0x179)]='0px',_0x4479ff['style']['width']=this['_map'][_0x1fd265(0x16d)]['canvas'][_0x1fd265(0x186)]+'px',_0x4479ff['style']['height']=this[_0x1fd265(0x19a)]['scene']['canvas'][_0x1fd265(0x105)]+'px',_0x4479ff['style']['pointerEvents']=this[_0x1fd265(0x1e0)]?'auto':'none',_0x4479ff[_0x1fd265(0x112)]['zIndex']=this['options']['zIndex']??0x9,_0x4479ff['width']=this[_0x1fd265(0x19a)]['scene']['canvas']['clientWidth'],_0x4479ff[_0x1fd265(0x1a3)]=this['_map']['scene']['canvas'][_0x1fd265(0x105)],_0x4479ff;}['resize'](){const _0x5d0ec4=_0x3bb793;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this['canvas']['style'][_0x5d0ec4(0x1a3)]=this['_map']['scene']['canvas']['clientHeight']+'px',this['canvas']['width']=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x4cfbcf=_0x3bb793,_0x50b76c=this;let _0x28efe9=Date['now']();(function _0x10e9f0(){const _0x33b9c4=_0x52d6;_0x50b76c[_0x33b9c4(0x150)]=window['requestAnimationFrame'](_0x10e9f0);if(_0x50b76c[_0x33b9c4(0x1d1)]&&_0x50b76c['windField']){const _0x289da4=Date['now'](),_0x4dbbcf=_0x289da4-_0x28efe9;_0x4dbbcf>_0x50b76c['frameTime']&&(_0x28efe9=_0x289da4-_0x4dbbcf%_0x50b76c['frameTime'],_0x50b76c['update']());}}(),window['addEventListener']('resize',this[_0x4cfbcf(0x164)]['bind'](this),![]),this[_0x4cfbcf(0x157)]=![],this[_0x4cfbcf(0x15a)]=![],this['options'][_0x4cfbcf(0x191)]&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this[_0x4cfbcf(0x110)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x4cfbcf(0x134)],this[_0x4cfbcf(0x1c6)],this),this['_map']['on'](mars3d__namespace['EventType'][_0x4cfbcf(0x17e)],this['_onMouseUpEvent'],this)));}['unbindEvent'](){const _0x315440=_0x3bb793;window['cancelAnimationFrame'](this['animateFrame']),delete this['animateFrame'],window['removeEventListener'](_0x315440(0x164),this['resize']),this[_0x315440(0x128)]['mouseHidden']&&(this[_0x315440(0x19a)]['off'](mars3d__namespace[_0x315440(0x1c9)]['wheel'],this['_onMapWhellEvent'],this),this['_map']['off'](mars3d__namespace[_0x315440(0x1c9)]['mouseDown'],this[_0x315440(0x1c6)],this),this['_map'][_0x315440(0x1cd)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType'][_0x315440(0x124)],this['_onMouseMoveEvent'],this));}[_0x3bb793(0x110)](_0x11d5f3){const _0x27de27=_0x3bb793;clearTimeout(this[_0x27de27(0x18a)]);if(!this[_0x27de27(0x1d1)]||!this['canvas'])return;this['canvas']['style']['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x5c6932=_0x27de27;if(!this['show'])return;this['redraw'](),this['canvas'][_0x5c6932(0x112)][_0x5c6932(0x167)]='visible';},0xc8);}['_onMouseDownEvent'](_0xd6843e){const _0x20c089=_0x3bb793;this[_0x20c089(0x157)]=!![],this[_0x20c089(0x19a)]['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this[_0x20c089(0x16e)],this);}[_0x3bb793(0x16e)](_0x2807f7){const _0x25e41a=_0x3bb793;if(!this['show']||!this[_0x25e41a(0x192)])return;this['mouse_down']&&(this['canvas'][_0x25e41a(0x112)]['visibility']='hidden',this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x1a6647){const _0x2c41c8=_0x3bb793;if(!this['show']||!this['canvas'])return;this[_0x2c41c8(0x19a)][_0x2c41c8(0x1cd)](mars3d__namespace[_0x2c41c8(0x1c9)]['mouseMove'],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['canvas']['style']['visibility']='visible',this['mouse_down']=![],this[_0x2c41c8(0x15a)]=![];}['setData'](_0x2803d9){this['clear'](),this['windData']=_0x2803d9,this['windField']['setDate'](_0x2803d9),this['redraw']();}['redraw'](){const _0x1b73f5=_0x3bb793;if(!this[_0x1b73f5(0x1d1)])return;this[_0x1b73f5(0x1c7)][_0x1b73f5(0x175)](this[_0x1b73f5(0x128)]),this['update']();}['update'](){const _0x5bf32e=_0x3bb793;if(this[_0x5bf32e(0x1ab)])return;this[_0x5bf32e(0x1ab)]=!![];if(this[_0x5bf32e(0x1cb)])this[_0x5bf32e(0x1c7)]['update']();else{const _0x15d872=this[_0x5bf32e(0x1c7)]['getParticles']();this[_0x5bf32e(0x10f)](_0x15d872);}this[_0x5bf32e(0x1ab)]=![];}['_drawLines'](_0x6fd3dd){const _0x3af59a=_0x3bb793;this['canvasContext']['globalCompositeOperation']='destination-in',this[_0x3af59a(0x18e)][_0x3af59a(0x141)](0x0,0x0,this['canvasWidth'],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x3af59a(0x18e)]['globalAlpha']=0.9;const _0x3558d9=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x467925=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x447011=0x0,_0x4b261f=_0x6fd3dd['length'];_0x447011<_0x4b261f;_0x447011++){const _0x151372=_0x6fd3dd[_0x447011],_0x569afe=this[_0x3af59a(0x163)](_0x151372['lng'],_0x151372['lat'],_0x151372),_0x75a84e=this[_0x3af59a(0x163)](_0x151372['tlng'],_0x151372['tlat'],_0x151372);if(!_0x569afe||!_0x75a84e)continue;if(_0x3558d9&&Math['abs'](_0x569afe[0x0]-_0x75a84e[0x0])>=_0x467925)continue;this['canvasContext']['beginPath'](),this[_0x3af59a(0x18e)]['lineWidth']=this[_0x3af59a(0x1d3)],this['canvasContext']['strokeStyle']=this['_colorRamp']['getColor'](_0x151372['speed']),this['canvasContext'][_0x3af59a(0x16f)](_0x569afe[0x0],_0x569afe[0x1]),this['canvasContext']['lineTo'](_0x75a84e[0x0],_0x75a84e[0x1]),this['canvasContext']['stroke']();}else{this[_0x3af59a(0x18e)]['beginPath'](),this['canvasContext']['lineWidth']=this['lineWidth'],this[_0x3af59a(0x18e)]['strokeStyle']=this['color'];for(let _0x111e01=0x0,_0x476a37=_0x6fd3dd['length'];_0x111e01<_0x476a37;_0x111e01++){const _0x59cf5f=_0x6fd3dd[_0x111e01],_0x480942=this['_tomap'](_0x59cf5f['lng'],_0x59cf5f['lat'],_0x59cf5f),_0x32eb76=this[_0x3af59a(0x163)](_0x59cf5f['tlng'],_0x59cf5f[_0x3af59a(0x1a5)],_0x59cf5f);if(!_0x480942||!_0x32eb76)continue;if(_0x3558d9&&Math['abs'](_0x480942[0x0]-_0x32eb76[0x0])>=_0x467925)continue;this['canvasContext']['moveTo'](_0x480942[0x0],_0x480942[0x1]),this['canvasContext']['lineTo'](_0x32eb76[0x0],_0x32eb76[0x1]);}this['canvasContext']['stroke']();}}['_tomap'](_0x5e5cf9,_0x5ee6f2,_0x285648){const _0x5c34c5=_0x3bb793,_0x3c0d68=Cesium['Cartesian3']['fromDegrees'](_0x5e5cf9,_0x5ee6f2,this['fixedHeight']),_0x2ded05=this['_map']['scene'];if(_0x2ded05[_0x5c34c5(0x19f)]===Cesium[_0x5c34c5(0x103)][_0x5c34c5(0x127)]){const _0x2b16cc=new Cesium[(_0x5c34c5(0x193))](_0x2ded05['globe']['ellipsoid'],_0x2ded05['camera']['positionWC']),_0x3785b4=_0x2b16cc['isPointVisible'](_0x3c0d68);if(!_0x3785b4)return _0x285648[_0x5c34c5(0x1b6)]=0x0,null;}const _0x4cb13f=Cesium['SceneTransforms'][_0x5c34c5(0x1bf)](this['_map'][_0x5c34c5(0x16d)],_0x3c0d68);return _0x4cb13f?[_0x4cb13f['x'],_0x4cb13f['y']]:null;}[_0x3bb793(0x182)](){const _0x4476d5=_0x3bb793;this[_0x4476d5(0x1c7)][_0x4476d5(0x182)](),delete this['windData'];}['initWorker'](){const _0x4e2122=_0x3bb793;this['worker']=new Worker(this['options'][_0x4e2122(0x1cb)]),this['worker'][_0x4e2122(0x1d7)]=_0x86933f=>{const _0x17f5ac=_0x4e2122;this[_0x17f5ac(0x10f)](_0x86933f['data']['particles']),this['_updateIng2']=![];},this[_0x4e2122(0x1c7)]={'init':_0x4871b3=>{this['worker']['postMessage']({'type':'init','options':_0x4871b3});},'setOptions':_0x512b0e=>{const _0x54400e=_0x4e2122;this['worker']['postMessage']({'type':_0x54400e(0x175),'options':_0x512b0e});},'setDate':_0x15c68a=>{this['worker']['postMessage']({'type':'setDate','data':_0x15c68a});},'update':()=>{const _0x37c102=_0x4e2122;if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker'][_0x37c102(0x10b)]({'type':_0x37c102(0x18b)});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField']['init'](this['options']);}}mars3d__namespace['LayerUtil']['register']('canvasWind',CanvasWindLayer),mars3d__namespace[_0x3bb793(0x18d)][_0x3bb793(0x10c)]=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x3bb793(0x1db)]=CanvasWindField,exports[_0x3bb793(0x10c)]=CanvasWindLayer,exports[_0x3bb793(0x1b1)]=WindLayer,exports[_0x3bb793(0x102)]=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
