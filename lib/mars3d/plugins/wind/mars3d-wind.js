/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.9
 * 编译日期：2024-03-28 22:19:58
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2024-01-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';function _0x2bbb(){const _0xfea132=['uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a','particleSystem','lonRange','initWorker','unbindEvent','canvasWidth','particlesComputing','width','show','primitives','ymin','canvasHeight','canvasResize','updatePosition','_addedHook','ceil','depthTexture','animateFrame','_createCanvas','postProcessingSpeed','data','trails','_onMouseDownEvent','vertexShaderSource','init','pixelSize','createRawRenderState','off','11911949bflLsb','color','min','height','rows','canvasWind','particlesRendering','Draw','_onMouseUpEvent','EventType','ShaderProgram','_calcUV','in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a','toRadians','_onMouseMoveEvent','mouse_move','remove','4wSAFeA','array','50694FPZAPe','age','_drawLines','onmessage','autoClear','createRenderingTextures','execute','dropRateBump','resize','mouseMove','Cesium','canvasContext','speedFactor','PixelDatatype','21251600tgfeZj','add','randomBetween','PI_OVER_THREE','randomizeParticles','getUVByPoint','wheel','createWindTextures','NEAREST','Sampler','colors','destroyParticlesTextures','stroke','preExecute','xmin','currentParticlesPosition','DISABLE_LOG_DEPTH_FRAGMENT_WRITE','segments','lineWidth','globe','framebuffer','absolute','commandType','fromGeometry','isPointVisible','textures','BufferUsage','TWO_PI','_colorRamp','visibility','addPrimitives','dimensions','STATIC_DRAW','fixedHeight','setDate','createTexture','green','ClearCommand','requestAnimationFrame','Compute','forEach','lineTo','maxAge','length','ymax','dropRate','canvas','1IcNQoA','update','push','applyViewerParameters','ShaderSource','nextParticlesPosition','max','defined','removeChild','viewerParameters','windField','refreshTimer','commandToExecute','vdata','Cartesian3','Geometry','isInExtent','vmin','TextureMagnificationFilter','GeometryAttribute','windTextures','xmax','_bilinearInterpolation','6862374yTNcOC','style','layer','cancelAnimationFrame','_setOptionsHook','destroy','lat','UNSIGNED_INT','141525aTgiqG','setOptions','keys','attributeLocations','PixelFormat','setData','SceneMode','uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a','currentTrails','viewRectangleToLonLatRange','particlesTextures','particlesWind','maxParticles','getOwnPropertyDescriptor','clientWidth','refreshParticles','grid','particlesNumber','_removedHook','__esModule','createCommand','outputTexture','strokeStyle','toGridXY','_onMap_preRenderEvent','sqrt','lon','tlng','pointerEvents','CanvasWindField','uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a','get','Pass','tlat','nextTrails','1320453iXpsBS','TRIANGLES','currentParticlesSpeed','viewport','472835AxzbBE','getUVByXY','latRange','windData','fillRect','pow','mouse_down','globalCompositeOperation','getOptions','create','fragmentShaderSource','particles','redraw','_data','CanvasWindLayer','clearCommand','getRandomLatLng','clear','OPAQUE','geometry','screen','canrefresh','_speedRate','cols','sin','mode','options','uniformMap','addEventListener','drawingBufferWidth','createParticlesTextures','getContext','_calc_speedRate','moveTo','264TnNYMc','lev','worker','setGeometry','lng','THREE_PI_OVER_TWO','scene','speedRate','udata','beginPath','GeometryAttributes','Math','camera','all','_map','mouseUp','FLOAT','hidden','framebuffers','LINEAR','clearFramebuffers','commandList','PrimitiveType','UNSIGNED_BYTE','particlesTextureSize','_onMapWhellEvent','reverseY','postProcessingPosition','fadeOpacity'];_0x2bbb=function(){return _0xfea132;};return _0x2bbb();}const _0x4217c4=_0x21fd;(function(_0x51dda1,_0x2e29ea){const _0x57f8c3=_0x21fd,_0x13d6a4=_0x51dda1();while(!![]){try{const _0x160956=-parseInt(_0x57f8c3(0x14b))/0x1*(parseInt(_0x57f8c3(0x10e))/0x2)+-parseInt(_0x57f8c3(0x18d))/0x3+-parseInt(_0x57f8c3(0x10c))/0x4*(-parseInt(_0x57f8c3(0x191))/0x5)+parseInt(_0x57f8c3(0x162))/0x6+parseInt(_0x57f8c3(0xfb))/0x7+parseInt(_0x57f8c3(0xc2))/0x8*(parseInt(_0x57f8c3(0x16a))/0x9)+-parseInt(_0x57f8c3(0x11c))/0xa;if(_0x160956===_0x2e29ea)break;else _0x13d6a4['push'](_0x13d6a4['shift']());}catch(_0x400335){_0x13d6a4['push'](_0x13d6a4['shift']());}}}(_0x2bbb,0xd3fae));function _interopNamespace(_0x258391){const _0x39966c=_0x21fd;if(_0x258391&&_0x258391[_0x39966c(0x17d)])return _0x258391;var _0x11b735=Object[_0x39966c(0xa9)](null);return _0x258391&&Object['keys'](_0x258391)['forEach'](function(_0x4c2867){const _0x2a1335=_0x39966c;if(_0x4c2867!=='default'){var _0x53e123=Object[_0x2a1335(0x177)](_0x258391,_0x4c2867);Object['defineProperty'](_0x11b735,_0x4c2867,_0x53e123[_0x2a1335(0x189)]?_0x53e123:{'enumerable':!![],'get':function(){return _0x258391[_0x4c2867];}});}}),_0x11b735['default']=_0x258391,_0x11b735;}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x3b2031,_0x3356e6){const _0x207d04=_0x21fd,_0x7a51a9=_0x3b2031*Math['cos'](Cesium$7['Math'][_0x207d04(0x108)](_0x3356e6));return _0x7a51a9;}function getV(_0x4da3e2,_0x2620af){const _0x58f6a1=_0x21fd,_0x3ce810=_0x4da3e2*Math[_0x58f6a1(0xb8)](Cesium$7[_0x58f6a1(0xcd)]['toRadians'](_0x2620af));return _0x3ce810;}function getSpeed(_0x40a92,_0x218e40){const _0xc4c26a=_0x21fd,_0x415d52=Math['sqrt'](Math[_0xc4c26a(0x196)](_0x40a92,0x2)+Math['pow'](_0x218e40,0x2));return _0x415d52;}function getDirection(_0xc90810,_0x47e8dd){let _0x2f43ad=Cesium$7['Math']['toDegrees'](Math['atan2'](_0x47e8dd,_0xc90810));return _0x2f43ad+=_0x2f43ad<0x0?0x168:0x0,_0x2f43ad;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x4e6acd){const _0x1e4631=_0x21fd;this[_0x1e4631(0x132)]=_0x4e6acd[_0x1e4631(0x132)],this['geometry']=_0x4e6acd[_0x1e4631(0xb3)],this[_0x1e4631(0x16d)]=_0x4e6acd[_0x1e4631(0x16d)],this['primitiveType']=_0x4e6acd['primitiveType'],this['uniformMap']=_0x4e6acd[_0x1e4631(0xbb)],this['vertexShaderSource']=_0x4e6acd[_0x1e4631(0xf6)],this['fragmentShaderSource']=_0x4e6acd['fragmentShaderSource'],this['rawRenderState']=_0x4e6acd['rawRenderState'],this['framebuffer']=_0x4e6acd['framebuffer'],this[_0x1e4631(0x17f)]=_0x4e6acd['outputTexture'],this[_0x1e4631(0x112)]=_0x4e6acd['autoClear']??![],this['preExecute']=_0x4e6acd['preExecute'],this[_0x1e4631(0xe7)]=!![],this['commandToExecute']=undefined,this['clearCommand']=undefined,this[_0x1e4631(0x112)]&&(this['clearCommand']=new Cesium$6[(_0x1e4631(0x141))]({'color':new Cesium$6['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x1e4631(0xb2)]}));}[_0x4217c4(0x17e)](_0x2e308b){const _0x3f95cb=_0x4217c4;switch(this['commandType']){case _0x3f95cb(0x102):{const _0x30abb3=Cesium$6['VertexArray']['fromGeometry']({'context':_0x2e308b,'geometry':this['geometry'],'attributeLocations':this[_0x3f95cb(0x16d)],'bufferUsage':Cesium$6[_0x3f95cb(0x136)]['STATIC_DRAW']}),_0x3fec4e=Cesium$6[_0x3f95cb(0x105)]['fromCache']({'context':_0x2e308b,'attributeLocations':this['attributeLocations'],'vertexShaderSource':this['vertexShaderSource'],'fragmentShaderSource':this[_0x3f95cb(0xaa)]}),_0x11b01e=Cesium$6['RenderState']['fromCache'](this['rawRenderState']);return new Cesium$6['DrawCommand']({'primitiveType':this['primitiveType'],'shaderProgram':_0x3fec4e,'vertexArray':_0x30abb3,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x11b01e,'uniformMap':this[_0x3f95cb(0xbb)],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6[_0x3f95cb(0x18a)]['OPAQUE'],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6['ComputeCommand']({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}[_0x4217c4(0xc5)](_0x2734f6,_0x26d251){const _0x4c17a2=_0x4217c4;this['geometry']=_0x26d251;const _0x5c3813=Cesium$6['VertexArray']['fromGeometry']({'context':_0x2734f6,'geometry':this['geometry'],'attributeLocations':this[_0x4c17a2(0x16d)],'bufferUsage':Cesium$6['BufferUsage'][_0x4c17a2(0x13c)]});this['commandToExecute']['vertexArray']=_0x5c3813;}['update'](_0x415de1){const _0x16b8bd=_0x4217c4;if(!this['show'])return;if(_0x415de1[_0x16b8bd(0xb9)]!==Cesium$6[_0x16b8bd(0x170)]['SCENE3D'])return;!Cesium$6[_0x16b8bd(0x152)](this['commandToExecute'])&&(this[_0x16b8bd(0x157)]=this['createCommand'](_0x415de1['context'])),Cesium$6[_0x16b8bd(0x152)](this[_0x16b8bd(0x129)])&&this[_0x16b8bd(0x129)](),Cesium$6['defined'](this['clearCommand'])&&_0x415de1[_0x16b8bd(0xd7)][_0x16b8bd(0x14d)](this[_0x16b8bd(0xaf)]),_0x415de1[_0x16b8bd(0xd7)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x423455=_0x4217c4;if(this['clearCommand']){var _0x2e5295,_0x59364a;(_0x2e5295=this['clearCommand'])!==null&&_0x2e5295!==void 0x0&&_0x2e5295['vertexArray']&&this['clearCommand']['vertexArray']['destroy'](),(_0x59364a=this['clearCommand'])!==null&&_0x59364a!==void 0x0&&_0x59364a['shaderProgram']&&this[_0x423455(0xaf)]['shaderProgram']['destroy'](),delete this[_0x423455(0xaf)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x423455(0x167)](),this['commandToExecute']['shaderProgram']&&this['commandToExecute']['shaderProgram']['destroy'](),delete this[_0x423455(0x157)]),Cesium$6['destroyObject'](this);}}function _0x21fd(_0x55f9b9,_0xd15d35){const _0x2bbb9d=_0x2bbb();return _0x21fd=function(_0x21fd14,_0xe8758){_0x21fd14=_0x21fd14-0xa8;let _0x379561=_0x2bbb9d[_0x21fd14];return _0x379561;},_0x21fd(_0x55f9b9,_0xd15d35);}const Cesium$5=mars3d__namespace[_0x4217c4(0x118)],Util=(function(){const _0x1541cf=function(){const _0x2bca58=_0x21fd,_0x5980de=new Cesium$5[(_0x2bca58(0x15a))]({'attributes':new Cesium$5[(_0x2bca58(0xcc))]({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x5980de;},_0x758107=function(_0x4135d9,_0x5f5d0e){if(Cesium$5['defined'](_0x5f5d0e)){const _0x4bc459={};_0x4bc459['arrayBufferView']=_0x5f5d0e,_0x4135d9['source']=_0x4bc459;}const _0x5e3801=new Cesium$5['Texture'](_0x4135d9);return _0x5e3801;},_0x1aed3f=function(_0x6755f7,_0xf7748e,_0x274eb1){const _0x89bde7=new Cesium$5['Framebuffer']({'context':_0x6755f7,'colorTextures':[_0xf7748e],'depthTexture':_0x274eb1});return _0x89bde7;},_0x4f9de4=function(_0xedcad1){const _0xd452de=_0x21fd,_0x308203=!![],_0x3dbac0=![],_0x247981={'viewport':_0xedcad1[_0xd452de(0x190)],'depthTest':_0xedcad1['depthTest'],'depthMask':_0xedcad1['depthMask'],'blending':_0xedcad1['blending']},_0x151200=Cesium$5['Appearance']['getDefaultRenderState'](_0x308203,_0x3dbac0,_0x247981);return _0x151200;},_0x56f853=function(_0x533b87){const _0x1302ee=_0x21fd,_0x1c406d={},_0x450de9=Cesium$5['Math']['mod'](_0x533b87['west'],Cesium$5['Math'][_0x1302ee(0x137)]),_0x152779=Cesium$5['Math']['mod'](_0x533b87['east'],Cesium$5[_0x1302ee(0xcd)][_0x1302ee(0x137)]),_0x36e79b=_0x533b87['width'];let _0x54f39f,_0x2747cf;_0x36e79b>Cesium$5['Math'][_0x1302ee(0xc7)]?(_0x54f39f=0x0,_0x2747cf=Cesium$5['Math']['TWO_PI']):_0x152779-_0x450de9<_0x36e79b?(_0x54f39f=_0x450de9,_0x2747cf=_0x450de9+_0x36e79b):(_0x54f39f=_0x450de9,_0x2747cf=_0x152779);_0x1c406d[_0x1302ee(0x184)]={'min':Cesium$5['Math']['toDegrees'](_0x54f39f),'max':Cesium$5['Math']['toDegrees'](_0x2747cf)};const _0x11dd95=_0x533b87['south'],_0x15c2a0=_0x533b87['north'],_0x43cc38=_0x533b87[_0x1302ee(0xfe)],_0x4e8fb2=_0x43cc38>Cesium$5['Math']['PI']/0xc?_0x43cc38/0x2:0x0;let _0x5ac8d5=Cesium$5['Math']['clampToLatitudeRange'](_0x11dd95-_0x4e8fb2),_0x44851a=Cesium$5['Math']['clampToLatitudeRange'](_0x15c2a0+_0x4e8fb2);return _0x5ac8d5<-Cesium$5['Math'][_0x1302ee(0x11f)]&&(_0x5ac8d5=-Cesium$5['Math']['PI_OVER_TWO']),_0x44851a>Cesium$5['Math'][_0x1302ee(0x11f)]&&(_0x44851a=Cesium$5['Math']['PI_OVER_TWO']),_0x1c406d['lat']={'min':Cesium$5['Math']['toDegrees'](_0x5ac8d5),'max':Cesium$5['Math']['toDegrees'](_0x44851a)},_0x1c406d;};return{'getFullscreenQuad':_0x1541cf,'createTexture':_0x758107,'createFramebuffer':_0x1aed3f,'createRawRenderState':_0x4f9de4,'viewRectangleToLonLatRange':_0x56f853};}());var segmentDraw_vert='in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a',segmentDraw_frag='uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a',fullscreen_vert=_0x4217c4(0x107),trailDraw_frag=_0x4217c4(0x188),screenDraw_frag=_0x4217c4(0xdf);const Cesium$4=mars3d__namespace['Cesium'];class ParticlesRendering{constructor(_0x87767d,_0xb30fe9,_0x5e4e22,_0x2ef3f4,_0x2501f7){const _0xe184ca=_0x4217c4;this[_0xe184ca(0x113)](_0x87767d,_0xb30fe9,_0x5e4e22['colors']),this['createRenderingFramebuffers'](_0x87767d),this['createRenderingPrimitives'](_0x87767d,_0x5e4e22,_0x2ef3f4,_0x2501f7);}['createRenderingTextures'](_0x3c65a3,_0x2d9d09,_0x3f6eec){const _0x5e744b=_0x4217c4,_0x498e89={'context':_0x3c65a3,'width':_0x3c65a3[_0x5e744b(0xbd)],'height':_0x3c65a3['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x5e744b(0x16e)]['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype'][_0x5e744b(0xd9)]},_0x3f2a1e={'context':_0x3c65a3,'width':_0x3c65a3[_0x5e744b(0xbd)],'height':_0x3c65a3['drawingBufferHeight'],'pixelFormat':Cesium$4[_0x5e744b(0x16e)]['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4[_0x5e744b(0x11b)][_0x5e744b(0x169)]},_0x393c2c=_0x3f6eec['length'],_0x1fbe6f=new Float32Array(_0x393c2c*0x3);for(let _0x5e6d09=0x0;_0x5e6d09<_0x393c2c;_0x5e6d09++){const _0x1c4a85=Cesium$4['Color']['fromCssColorString'](_0x3f6eec[_0x5e6d09]);_0x1fbe6f[0x3*_0x5e6d09]=_0x1c4a85['red'],_0x1fbe6f[0x3*_0x5e6d09+0x1]=_0x1c4a85[_0x5e744b(0x140)],_0x1fbe6f[0x3*_0x5e6d09+0x2]=_0x1c4a85['blue'];}const _0x2a0e4a={'context':_0x3c65a3,'width':_0x393c2c,'height':0x1,'pixelFormat':Cesium$4['PixelFormat']['RGB'],'pixelDatatype':Cesium$4[_0x5e744b(0x11b)]['FLOAT'],'sampler':new Cesium$4[(_0x5e744b(0x125))]({'minificationFilter':Cesium$4['TextureMinificationFilter'][_0x5e744b(0xd5)],'magnificationFilter':Cesium$4['TextureMagnificationFilter'][_0x5e744b(0xd5)]})};this['textures']={'segmentsColor':Util['createTexture'](_0x498e89),'segmentsDepth':Util['createTexture'](_0x3f2a1e),'currentTrailsColor':Util[_0x5e744b(0x13f)](_0x498e89),'currentTrailsDepth':Util['createTexture'](_0x3f2a1e),'nextTrailsColor':Util['createTexture'](_0x498e89),'nextTrailsDepth':Util[_0x5e744b(0x13f)](_0x3f2a1e),'colorTable':Util['createTexture'](_0x2a0e4a,_0x1fbe6f)};}['createRenderingFramebuffers'](_0x1262c5){const _0x4350f0=_0x4217c4;this[_0x4350f0(0xd4)]={'segments':Util['createFramebuffer'](_0x1262c5,this[_0x4350f0(0x135)]['segmentsColor'],this[_0x4350f0(0x135)]['segmentsDepth']),'currentTrails':Util['createFramebuffer'](_0x1262c5,this['textures']['currentTrailsColor'],this['textures']['currentTrailsDepth']),'nextTrails':Util['createFramebuffer'](_0x1262c5,this['textures']['nextTrailsColor'],this['textures']['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x5d2a46){const _0x1a1ef1=_0x4217c4,_0x18b3dc=0x4;let _0x2d45ed=[];for(let _0x3ca5b5=0x0;_0x3ca5b5<_0x5d2a46[_0x1a1ef1(0xda)];_0x3ca5b5++){for(let _0x541c9b=0x0;_0x541c9b<_0x5d2a46['particlesTextureSize'];_0x541c9b++){for(let _0x29f353=0x0;_0x29f353<_0x18b3dc;_0x29f353++){_0x2d45ed[_0x1a1ef1(0x14d)](_0x3ca5b5/_0x5d2a46['particlesTextureSize']),_0x2d45ed[_0x1a1ef1(0x14d)](_0x541c9b/_0x5d2a46['particlesTextureSize']);}}}_0x2d45ed=new Float32Array(_0x2d45ed);let _0x57dbef=[];const _0x3950a7=[-0x1,0x1],_0xb0425e=[-0x1,0x1];for(let _0x52a3cf=0x0;_0x52a3cf<_0x5d2a46[_0x1a1ef1(0x176)];_0x52a3cf++){for(let _0x2e034b=0x0;_0x2e034b<_0x18b3dc/0x2;_0x2e034b++){for(let _0x1bf9db=0x0;_0x1bf9db<_0x18b3dc/0x2;_0x1bf9db++){_0x57dbef[_0x1a1ef1(0x14d)](_0x3950a7[_0x2e034b]),_0x57dbef[_0x1a1ef1(0x14d)](_0xb0425e[_0x1bf9db]),_0x57dbef[_0x1a1ef1(0x14d)](0x0);}}}_0x57dbef=new Float32Array(_0x57dbef);const _0x275f3e=0x6*_0x5d2a46['maxParticles'],_0x3ee7b0=new Uint32Array(_0x275f3e);for(let _0x46a9e0=0x0,_0x18feaa=0x0,_0x26f440=0x0;_0x46a9e0<_0x5d2a46['maxParticles'];_0x46a9e0++){_0x3ee7b0[_0x18feaa++]=_0x26f440+0x0,_0x3ee7b0[_0x18feaa++]=_0x26f440+0x1,_0x3ee7b0[_0x18feaa++]=_0x26f440+0x2,_0x3ee7b0[_0x18feaa++]=_0x26f440+0x2,_0x3ee7b0[_0x18feaa++]=_0x26f440+0x1,_0x3ee7b0[_0x18feaa++]=_0x26f440+0x3,_0x26f440+=0x4;}const _0x20fd9d=new Cesium$4['Geometry']({'attributes':new Cesium$4['GeometryAttributes']({'st':new Cesium$4[(_0x1a1ef1(0x15e))]({'componentDatatype':Cesium$4['ComponentDatatype'][_0x1a1ef1(0xd2)],'componentsPerAttribute':0x2,'values':_0x2d45ed}),'normal':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype'][_0x1a1ef1(0xd2)],'componentsPerAttribute':0x3,'values':_0x57dbef})}),'indices':_0x3ee7b0});return _0x20fd9d;}['createRenderingPrimitives'](_0x41cad2,_0x2301c0,_0x309bbc,_0x4e5078){const _0x5a7225=_0x4217c4,_0x1e65f3=this;this['primitives']={'segments':new CustomPrimitive({'commandType':_0x5a7225(0x102),'attributeLocations':{'st':0x0,'normal':0x1},'geometry':this['createSegmentsGeometry'](_0x2301c0),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){const _0x21af47=_0x5a7225;return _0x4e5078['particlesTextures'][_0x21af47(0x12b)];},'postProcessingPosition':function(){return _0x4e5078['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x5a792a=_0x5a7225;return _0x4e5078['particlesTextures'][_0x5a792a(0xf2)];},'colorTable':function(){return _0x1e65f3['textures']['colorTable'];},'aspect':function(){return _0x41cad2['drawingBufferWidth']/_0x41cad2['drawingBufferHeight'];},'pixelSize':function(){return _0x309bbc['pixelSize'];},'lineWidth':function(){return _0x2301c0['lineWidth'];},'particleHeight':function(){return _0x2301c0['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4[(_0x5a7225(0x14f))]({'sources':[segmentDraw_frag]}),'rawRenderState':Util[_0x5a7225(0xf9)]({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this['framebuffers'][_0x5a7225(0x12d)],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x5a7225(0x102),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){const _0x13525a=_0x5a7225;return _0x1e65f3[_0x13525a(0x135)]['segmentsColor'];},'segmentsDepthTexture':function(){return _0x1e65f3['textures']['segmentsDepth'];},'currentTrailsColor':function(){return _0x1e65f3['framebuffers']['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x17ff93=_0x5a7225;return _0x1e65f3[_0x17ff93(0xd4)]['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x2301c0['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction']['ALWAYS']},'depthMask':!![]}),'framebuffer':this['framebuffers']['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x3a3d52=_0x5a7225,_0x504ade=_0x1e65f3['framebuffers'][_0x3a3d52(0x172)];_0x1e65f3[_0x3a3d52(0xd4)][_0x3a3d52(0x172)]=_0x1e65f3['framebuffers']['nextTrails'],_0x1e65f3['framebuffers'][_0x3a3d52(0x18c)]=_0x504ade,_0x1e65f3['primitives'][_0x3a3d52(0xf4)]['commandToExecute'][_0x3a3d52(0x130)]=_0x1e65f3['framebuffers']['nextTrails'],_0x1e65f3['primitives'][_0x3a3d52(0xf4)]['clearCommand']['framebuffer']=_0x1e65f3[_0x3a3d52(0xd4)]['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4[_0x5a7225(0xd8)][_0x5a7225(0x18e)],'uniformMap':{'trailsColorTexture':function(){return _0x1e65f3['framebuffers']['nextTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x4bc8b1=_0x5a7225;return _0x1e65f3['framebuffers']['nextTrails'][_0x4bc8b1(0xef)];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'defines':[_0x5a7225(0x12c)],'sources':[screenDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag='//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a',updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag=_0x4217c4(0x171);const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x558561,_0x211b84,_0x36fdc7,_0x5c2ecc){const _0x587812=_0x4217c4;this['data']=_0x211b84,this['createWindTextures'](_0x558561,_0x211b84),this[_0x587812(0xbe)](_0x558561,_0x36fdc7,_0x5c2ecc),this['createComputingPrimitives'](_0x211b84,_0x36fdc7,_0x5c2ecc);}[_0x4217c4(0x123)](_0x3b8b35,_0x30f036){const _0x124b84=_0x4217c4,_0x37bd32={'context':_0x3b8b35,'width':_0x30f036['dimensions'][_0x124b84(0x184)],'height':_0x30f036['dimensions']['lat']*(_0x30f036['dimensions'][_0x124b84(0xc3)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3[_0x124b84(0x11b)][_0x124b84(0xd2)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter']['NEAREST'],'magnificationFilter':Cesium$3[_0x124b84(0x15d)]['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x37bd32,_0x30f036['U'][_0x124b84(0x10d)]),'V':Util['createTexture'](_0x37bd32,_0x30f036['V']['array'])};}[_0x4217c4(0xbe)](_0x249678,_0x25ae24,_0x21783f){const _0x5e2f86=_0x4217c4,_0x3945c8={'context':_0x249678,'width':_0x25ae24['particlesTextureSize'],'height':_0x25ae24['particlesTextureSize'],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype']['FLOAT'],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x5e2f86(0x124)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x3a936d=this['randomizeParticles'](_0x25ae24[_0x5e2f86(0x176)],_0x21783f),_0x35f926=new Float32Array(0x4*_0x25ae24['maxParticles'])['fill'](0x0);this[_0x5e2f86(0x174)]={'particlesWind':Util['createTexture'](_0x3945c8),'currentParticlesPosition':Util['createTexture'](_0x3945c8,_0x3a936d),'nextParticlesPosition':Util['createTexture'](_0x3945c8,_0x3a936d),'currentParticlesSpeed':Util['createTexture'](_0x3945c8,_0x35f926),'nextParticlesSpeed':Util[_0x5e2f86(0x13f)](_0x3945c8,_0x35f926),'postProcessingPosition':Util['createTexture'](_0x3945c8,_0x3a936d),'postProcessingSpeed':Util['createTexture'](_0x3945c8,_0x35f926)};}[_0x4217c4(0x120)](_0x5330e6,_0x2364ee){const _0x5c8df9=_0x4217c4,_0x36f742=new Float32Array(0x4*_0x5330e6);for(let _0x5eea97=0x0;_0x5eea97<_0x5330e6;_0x5eea97++){_0x36f742[0x4*_0x5eea97]=Cesium$3['Math'][_0x5c8df9(0x11e)](_0x2364ee['lonRange']['x'],_0x2364ee['lonRange']['y']),_0x36f742[0x4*_0x5eea97+0x1]=Cesium$3['Math'][_0x5c8df9(0x11e)](_0x2364ee['latRange']['x'],_0x2364ee['latRange']['y']),_0x36f742[0x4*_0x5eea97+0x2]=Cesium$3['Math'][_0x5c8df9(0x11e)](this[_0x5c8df9(0xf3)]['lev']['min'],this['data']['lev']['max']),_0x36f742[0x4*_0x5eea97+0x3]=0x0;}return _0x36f742;}[_0x4217c4(0x127)](){const _0x51fe3f=_0x4217c4;Object['keys'](this[_0x51fe3f(0x174)])['forEach'](_0x2ad48e=>{const _0x4c8300=_0x51fe3f;this[_0x4c8300(0x174)][_0x2ad48e]['destroy']();});}['createComputingPrimitives'](_0x2d29d6,_0x15de32,_0x3ddbd4){const _0x50f441=_0x4217c4,_0x3c5b55=new Cesium$3['Cartesian3'](_0x2d29d6['dimensions']['lon'],_0x2d29d6['dimensions']['lat'],_0x2d29d6[_0x50f441(0x13b)][_0x50f441(0xc3)]),_0x29ec61=new Cesium$3['Cartesian3'](_0x2d29d6[_0x50f441(0x184)]['min'],_0x2d29d6['lat'][_0x50f441(0xfd)],_0x2d29d6[_0x50f441(0xc3)][_0x50f441(0xfd)]),_0x30843d=new Cesium$3['Cartesian3'](_0x2d29d6['lon']['max'],_0x2d29d6[_0x50f441(0x168)][_0x50f441(0x151)],_0x2d29d6[_0x50f441(0xc3)][_0x50f441(0x151)]),_0x13f657=new Cesium$3[(_0x50f441(0x159))]((_0x30843d['x']-_0x29ec61['x'])/(_0x3c5b55['x']-0x1),(_0x30843d['y']-_0x29ec61['y'])/(_0x3c5b55['y']-0x1),_0x3c5b55['z']>0x1?(_0x30843d['z']-_0x29ec61['z'])/(_0x3c5b55['z']-0x1):0x1),_0x285cbd=new Cesium$3['Cartesian2'](_0x2d29d6['U']['min'],_0x2d29d6['U'][_0x50f441(0x151)]),_0x1a8596=new Cesium$3['Cartesian2'](_0x2d29d6['V'][_0x50f441(0xfd)],_0x2d29d6['V']['max']),_0x25611e=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':_0x50f441(0x143),'uniformMap':{'U':function(){const _0x486cec=_0x50f441;return _0x25611e[_0x486cec(0x15f)]['U'];},'V':function(){return _0x25611e['windTextures']['V'];},'currentParticlesPosition':function(){return _0x25611e['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x3c5b55;},'minimum':function(){return _0x29ec61;},'maximum':function(){return _0x30843d;},'interval':function(){return _0x13f657;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this[_0x50f441(0x174)][_0x50f441(0x175)],'preExecute':function(){_0x25611e['primitives']['getWind']['commandToExecute']['outputTexture']=_0x25611e['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){return _0x25611e['particlesTextures']['currentParticlesSpeed'];},'particlesWind':function(){const _0x414a09=_0x50f441;return _0x25611e['particlesTextures'][_0x414a09(0x175)];},'uSpeedRange':function(){return _0x285cbd;},'vSpeedRange':function(){return _0x1a8596;},'pixelSize':function(){return _0x3ddbd4['pixelSize'];},'speedFactor':function(){const _0x2c9a3f=_0x50f441;return _0x15de32[_0x2c9a3f(0x11a)];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[updateSpeed_frag]}),'outputTexture':this['particlesTextures']['nextParticlesSpeed'],'preExecute':function(){const _0x4718df=_0x50f441,_0xa8c9f2=_0x25611e['particlesTextures']['currentParticlesSpeed'];_0x25611e[_0x4718df(0x174)][_0x4718df(0x18f)]=_0x25611e['particlesTextures'][_0x4718df(0xf2)],_0x25611e[_0x4718df(0x174)][_0x4718df(0xf2)]=_0xa8c9f2,_0x25611e['primitives']['updateSpeed'][_0x4718df(0x157)]['outputTexture']=_0x25611e['particlesTextures']['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesPosition':function(){const _0x27a9c3=_0x50f441;return _0x25611e[_0x27a9c3(0x174)]['currentParticlesPosition'];},'currentParticlesSpeed':function(){const _0x2bf63f=_0x50f441;return _0x25611e[_0x2bf63f(0x174)]['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x50f441(0x14f))]({'sources':[updatePosition_frag]}),'outputTexture':this[_0x50f441(0x174)][_0x50f441(0x150)],'preExecute':function(){const _0x45dbf3=_0x50f441,_0x1254fd=_0x25611e[_0x45dbf3(0x174)]['currentParticlesPosition'];_0x25611e[_0x45dbf3(0x174)]['currentParticlesPosition']=_0x25611e['particlesTextures'][_0x45dbf3(0xdd)],_0x25611e['particlesTextures']['postProcessingPosition']=_0x1254fd,_0x25611e[_0x45dbf3(0xe8)][_0x45dbf3(0xec)][_0x45dbf3(0x157)]['outputTexture']=_0x25611e['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':'Compute','uniformMap':{'nextParticlesPosition':function(){return _0x25611e['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){return _0x25611e['particlesTextures']['nextParticlesSpeed'];},'lonRange':function(){const _0x11a392=_0x50f441;return _0x3ddbd4[_0x11a392(0xe1)];},'latRange':function(){return _0x3ddbd4['latRange'];},'randomCoefficient':function(){const _0xbd4d12=Math['random']();return _0xbd4d12;},'dropRate':function(){return _0x15de32['dropRate'];},'dropRateBump':function(){return _0x15de32['dropRateBump'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingPosition_frag]}),'outputTexture':this[_0x50f441(0x174)]['postProcessingPosition'],'preExecute':function(){const _0x2d2cb2=_0x50f441;_0x25611e['primitives'][_0x2d2cb2(0xdd)]['commandToExecute'][_0x2d2cb2(0x17f)]=_0x25611e[_0x2d2cb2(0x174)]['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x50f441(0x143),'uniformMap':{'postProcessingPosition':function(){const _0x373273=_0x50f441;return _0x25611e[_0x373273(0x174)]['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x25611e['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures'][_0x50f441(0xf2)],'preExecute':function(){const _0x58bfd0=_0x50f441;_0x25611e['primitives'][_0x58bfd0(0xf2)]['commandToExecute']['outputTexture']=_0x25611e['particlesTextures']['postProcessingSpeed'];}})};}}const Cesium$2=mars3d__namespace['Cesium'];class ParticleSystem{constructor(_0x4d874e,_0x48f2b6,_0x285c5d,_0x52c450){const _0xd1f6a1=_0x4217c4;this['context']=_0x4d874e,_0x48f2b6={..._0x48f2b6},_0x48f2b6['udata']&&_0x48f2b6[_0xd1f6a1(0x158)]&&(_0x48f2b6['dimensions']={},_0x48f2b6[_0xd1f6a1(0x13b)]['lon']=_0x48f2b6['cols'],_0x48f2b6['dimensions'][_0xd1f6a1(0x168)]=_0x48f2b6['rows'],_0x48f2b6[_0xd1f6a1(0x13b)]['lev']=_0x48f2b6[_0xd1f6a1(0xc3)]||0x1,_0x48f2b6[_0xd1f6a1(0x184)]={},_0x48f2b6[_0xd1f6a1(0x184)]['min']=_0x48f2b6['xmin'],_0x48f2b6['lon']['max']=_0x48f2b6[_0xd1f6a1(0x160)],_0x48f2b6['lat']={},_0x48f2b6[_0xd1f6a1(0x168)][_0xd1f6a1(0xfd)]=_0x48f2b6[_0xd1f6a1(0xe9)],_0x48f2b6['lat'][_0xd1f6a1(0x151)]=_0x48f2b6['ymax'],_0x48f2b6[_0xd1f6a1(0xc3)]={},_0x48f2b6['lev'][_0xd1f6a1(0xfd)]=_0x48f2b6['levmin']??0x1,_0x48f2b6['lev']['max']=_0x48f2b6['levmax']??0x1,_0x48f2b6['U']={},_0x48f2b6['U']['array']=new Float32Array(_0x48f2b6['udata']),_0x48f2b6['U']['min']=_0x48f2b6['umin']??Math['min'](..._0x48f2b6[_0xd1f6a1(0xca)]),_0x48f2b6['U']['max']=_0x48f2b6['umax']??Math['max'](..._0x48f2b6[_0xd1f6a1(0xca)]),_0x48f2b6['V']={},_0x48f2b6['V'][_0xd1f6a1(0x10d)]=new Float32Array(_0x48f2b6['vdata']),_0x48f2b6['V'][_0xd1f6a1(0xfd)]=_0x48f2b6[_0xd1f6a1(0x15c)]??Math['min'](..._0x48f2b6['vdata']),_0x48f2b6['V'][_0xd1f6a1(0x151)]=_0x48f2b6['vmax']??Math['max'](..._0x48f2b6['vdata'])),this[_0xd1f6a1(0xf3)]=_0x48f2b6,this['options']=_0x285c5d,this['viewerParameters']=_0x52c450,this[_0xd1f6a1(0xe5)]=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this[_0xd1f6a1(0x101)]=new ParticlesRendering(this['context'],this['data'],this['options'],this['viewerParameters'],this[_0xd1f6a1(0xe5)]);}['canvasResize'](_0xd86fa4){const _0x52b959=_0x4217c4;this[_0x52b959(0xe5)][_0x52b959(0x127)](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x5ce9b4=>{const _0x1770f=_0x52b959;this['particlesComputing'][_0x1770f(0x15f)][_0x5ce9b4]['destroy']();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object['keys'](this[_0x52b959(0x101)]['framebuffers'])['forEach'](_0xac79bf=>{this['particlesRendering']['framebuffers'][_0xac79bf]['destroy']();}),this['context']=_0xd86fa4,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x52b959(0xf3)],this['options'],this[_0x52b959(0x154)],this['particlesComputing']);}['clearFramebuffers'](){const _0x32e06e=_0x4217c4,_0x1f6b07=new Cesium$2['ClearCommand']({'color':new Cesium$2['Color'](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object['keys'](this[_0x32e06e(0x101)][_0x32e06e(0xd4)])[_0x32e06e(0x144)](_0x5edd73=>{const _0x528aa0=_0x32e06e;_0x1f6b07['framebuffer']=this['particlesRendering'][_0x528aa0(0xd4)][_0x5edd73],_0x1f6b07[_0x528aa0(0x114)](this['context']);});}['refreshParticles'](_0x23015e){const _0x314ff3=_0x4217c4;this[_0x314ff3(0xd6)](),this['particlesComputing']['destroyParticlesTextures'](),this[_0x314ff3(0xe5)][_0x314ff3(0xbe)](this['context'],this['options'],this['viewerParameters']);if(_0x23015e){var _0x53e30b;const _0x45a7e5=this['particlesRendering']['createSegmentsGeometry'](this['options']);this['particlesRendering']['primitives']['segments']['geometry']=_0x45a7e5;const _0x5ba4f0=Cesium$2['VertexArray'][_0x314ff3(0x133)]({'context':this['context'],'geometry':_0x45a7e5,'attributeLocations':this[_0x314ff3(0x101)]['primitives']['segments'][_0x314ff3(0x16d)],'bufferUsage':Cesium$2[_0x314ff3(0x136)][_0x314ff3(0x13c)]});(_0x53e30b=this['particlesRendering']['primitives'])!==null&&_0x53e30b!==void 0x0&&(_0x53e30b=_0x53e30b[_0x314ff3(0x12d)])!==null&&_0x53e30b!==void 0x0&&_0x53e30b[_0x314ff3(0x157)]&&(this['particlesRendering']['primitives'][_0x314ff3(0x12d)]['commandToExecute']['vertexArray']=_0x5ba4f0);}}['setOptions'](_0x125f3b){const _0x1f87b2=_0x4217c4;let _0x3f604b=![];this[_0x1f87b2(0xba)]['maxParticles']!==_0x125f3b['maxParticles']&&(_0x3f604b=!![]),Object[_0x1f87b2(0x16c)](_0x125f3b)['forEach'](_0x311dd8=>{this['options'][_0x311dd8]=_0x125f3b[_0x311dd8];}),this[_0x1f87b2(0x179)](_0x3f604b);}[_0x4217c4(0x14e)](_0x27d610){const _0x3e7696=_0x4217c4;Object['keys'](_0x27d610)[_0x3e7696(0x144)](_0x1ae7e9=>{this['viewerParameters'][_0x1ae7e9]=_0x27d610[_0x1ae7e9];}),this[_0x3e7696(0x179)](![]);}['destroy'](){const _0x28bcc4=_0x4217c4;clearTimeout(this[_0x28bcc4(0xb5)]),this[_0x28bcc4(0xe5)]['destroyParticlesTextures'](),Object[_0x28bcc4(0x16c)](this['particlesComputing'][_0x28bcc4(0x15f)])['forEach'](_0x1b5f8f=>{const _0x1b4769=_0x28bcc4;this[_0x1b4769(0xe5)]['windTextures'][_0x1b5f8f][_0x1b4769(0x167)]();}),this['particlesRendering']['textures']['colorTable']['destroy'](),Object[_0x28bcc4(0x16c)](this['particlesRendering'][_0x28bcc4(0xd4)])['forEach'](_0x176817=>{const _0x48ca26=_0x28bcc4;this[_0x48ca26(0x101)]['framebuffers'][_0x176817]['destroy']();});for(const _0x4b99ac in this){delete this[_0x4b99ac];}}}const Cesium$1=mars3d__namespace[_0x4217c4(0x118)],BaseLayer$1=mars3d__namespace[_0x4217c4(0x164)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':['rgb(206,255,255)']};class WindLayer extends BaseLayer$1{constructor(_0x48d5ca={}){_0x48d5ca={...DEF_OPTIONS,..._0x48d5ca},super(_0x48d5ca),this['_setOptionsHook'](_0x48d5ca);}get['layer'](){const _0x396232=_0x4217c4;return this[_0x396232(0xe8)];}get['data'](){return this['_data'];}set['data'](_0x11bd14){const _0x261dcd=_0x4217c4;this[_0x261dcd(0x16f)](_0x11bd14);}get[_0x4217c4(0x126)](){const _0x130ea1=_0x4217c4;return this[_0x130ea1(0xba)]['colors'];}set['colors'](_0x51c90b){const _0x25dcdf=_0x4217c4;this['options'][_0x25dcdf(0x126)]=_0x51c90b,this['particleSystem']&&this['particleSystem'][_0x25dcdf(0x16b)]({'colors':_0x51c90b}),this['resize']();}['_mountedHook'](){}[_0x4217c4(0xed)](){const _0x2a8c3c=_0x4217c4;this['scene']=this['_map'][_0x2a8c3c(0xc8)],this['camera']=this['_map']['camera'],this[_0x2a8c3c(0xe8)]=new Cesium$1['PrimitiveCollection'](),this[_0x2a8c3c(0xd0)]['scene'][_0x2a8c3c(0xe8)][_0x2a8c3c(0x11d)](this['primitives']),this[_0x2a8c3c(0x154)]={'lonRange':new Cesium$1['Cartesian2'](),'latRange':new Cesium$1['Cartesian2'](),'pixelSize':0x0},this['globeBoundingSphere']=new Cesium$1['BoundingSphere'](Cesium$1[_0x2a8c3c(0x159)]['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window[_0x2a8c3c(0xbc)](_0x2a8c3c(0x116),this['resize']['bind'](this),![]),this[_0x2a8c3c(0x197)]=![],this[_0x2a8c3c(0x10a)]=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this[_0x2a8c3c(0xd0)]['on'](mars3d__namespace[_0x2a8c3c(0x104)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this['setData'](this[_0x2a8c3c(0xad)]);}[_0x4217c4(0x17c)](){const _0x7867cc=_0x4217c4;window['removeEventListener'](_0x7867cc(0x116),this[_0x7867cc(0x116)]),this[_0x7867cc(0xd0)][_0x7867cc(0xfa)](mars3d__namespace[_0x7867cc(0x104)]['preRender'],this[_0x7867cc(0x182)],this),this[_0x7867cc(0xd0)]['off'](mars3d__namespace[_0x7867cc(0x104)]['wheel'],this['_onMapWhellEvent'],this),this['_map'][_0x7867cc(0xfa)](mars3d__namespace['EventType']['mouseDown'],this[_0x7867cc(0xf5)],this),this[_0x7867cc(0xd0)]['off'](mars3d__namespace['EventType']['mouseUp'],this[_0x7867cc(0x103)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['primitives']['removeAll'](),this['_map'][_0x7867cc(0xc8)]['primitives'][_0x7867cc(0x10b)](this['primitives']);}['resize'](){const _0x8266b3=_0x4217c4;if(!this['show']||!this['particleSystem'])return;this['primitives'][_0x8266b3(0xe7)]=![],this['primitives']['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}[_0x4217c4(0x182)](_0x12958f){const _0x3dd222=_0x4217c4;this['particleSystem'][_0x3dd222(0xeb)](this['scene']['context']),this['addPrimitives'](),this[_0x3dd222(0xe8)]['show']=!![];}['_onMapWhellEvent'](_0x454721){const _0x864c1a=_0x4217c4;clearTimeout(this['refreshTimer']);if(!this['show']||!this[_0x864c1a(0xe0)])return;this[_0x864c1a(0xe8)]['show']=![],this[_0x864c1a(0x156)]=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x262f74){this['mouse_down']=!![];}[_0x4217c4(0x109)](_0x585b21){const _0x146de2=_0x4217c4;if(!this[_0x146de2(0xe7)]||!this['particleSystem'])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x511ec3){const _0x548dec=_0x4217c4;if(!this[_0x548dec(0xe7)]||!this['particleSystem'])return;this[_0x548dec(0x197)]&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this['mouse_down']=![],this['mouse_move']=![];}[_0x4217c4(0xac)](){const _0x4e6e5c=_0x4217c4;if(!this['_map']||!this['show'])return;this['updateViewerParameters'](),this['particleSystem'][_0x4e6e5c(0x14e)](this['viewerParameters']),this['primitives']['show']=!![];}['setData'](_0x3e19bc){const _0x1bec60=_0x4217c4;this['_data']=_0x3e19bc,this[_0x1bec60(0xe0)]&&this[_0x1bec60(0xe0)]['destroy'](),this[_0x1bec60(0xe0)]=new ParticleSystem(this[_0x1bec60(0xc8)]['context'],_0x3e19bc,this[_0x1bec60(0xa8)](),this[_0x1bec60(0x154)]),this['addPrimitives']();}['_setOptionsHook'](_0x352a6f,_0x562e71){if(_0x352a6f)for(const _0x1c2360 in _0x352a6f){this[_0x1c2360]=_0x352a6f[_0x1c2360];}this['particleSystem']&&this['particleSystem']['setOptions'](this['getOptions']());}['getOptions'](){const _0x5eef88=_0x4217c4,_0x4b9e24=Math[_0x5eef88(0xee)](Math['sqrt'](this[_0x5eef88(0x17b)]));return this['particlesNumber']=_0x4b9e24*_0x4b9e24,{'particlesTextureSize':_0x4b9e24,'maxParticles':this['particlesNumber'],'particleHeight':this['fixedHeight'],'fadeOpacity':this[_0x5eef88(0xde)],'dropRate':this[_0x5eef88(0x149)],'dropRateBump':this[_0x5eef88(0x115)],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x5eef88(0x126)]};}[_0x4217c4(0x13a)](){const _0x4fae4a=_0x4217c4;this['primitives'][_0x4fae4a(0x11d)](this['particleSystem']['particlesComputing'][_0x4fae4a(0xe8)]['getWind']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['updateSpeed']),this['primitives'][_0x4fae4a(0x11d)](this['particleSystem'][_0x4fae4a(0xe5)]['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['postProcessingPosition']),this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives'][_0x4fae4a(0xf2)]),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x4fae4a(0xe8)]['segments']),this['primitives'][_0x4fae4a(0x11d)](this[_0x4fae4a(0xe0)]['particlesRendering']['primitives'][_0x4fae4a(0xf4)]),this[_0x4fae4a(0xe8)][_0x4fae4a(0x11d)](this[_0x4fae4a(0xe0)][_0x4fae4a(0x101)][_0x4fae4a(0xe8)][_0x4fae4a(0xb4)]);}['updateViewerParameters'](){const _0x3b2b73=_0x4217c4;let _0x423068=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x423068){const _0x45f465=this['_map']['getExtent']();_0x423068=Cesium$1['Rectangle']['fromDegrees'](_0x45f465[_0x3b2b73(0x12a)],_0x45f465['ymin'],_0x45f465[_0x3b2b73(0x160)],_0x45f465[_0x3b2b73(0x148)]);}const _0x507aa6=Util[_0x3b2b73(0x173)](_0x423068);this['viewerParameters']['lonRange']['x']=_0x507aa6[_0x3b2b73(0x184)]['min'],this['viewerParameters']['lonRange']['y']=_0x507aa6['lon'][_0x3b2b73(0x151)],this[_0x3b2b73(0x154)]['latRange']['x']=_0x507aa6['lat']['min'],this['viewerParameters'][_0x3b2b73(0x193)]['y']=_0x507aa6['lat']['max'];const _0x4634c9=this[_0x3b2b73(0xce)]['getPixelSize'](this['globeBoundingSphere'],this['scene'][_0x3b2b73(0xbd)],this['scene']['drawingBufferHeight']);_0x4634c9>0x0&&(this['viewerParameters'][_0x3b2b73(0xf8)]=_0x4634c9);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer']['WindLayer']=WindLayer;class CanvasParticle{constructor(){this['lng']=null,this['lat']=null,this['tlng']=null,this['tlat']=null,this['age']=null,this['speed']=null;}['destroy'](){for(const _0x4d1d30 in this){delete this[_0x4d1d30];}}}class CanvasWindField{constructor(_0x97f784){this['setOptions'](_0x97f784);}get['speedRate'](){return this['_speedRate'];}set['speedRate'](_0x168709){const _0x39f629=_0x4217c4;this['_speedRate']=(0x64-(_0x168709>0x63?0x63:_0x168709))*0x64,this['_calc_speedRate']=[(this['xmax']-this['xmin'])/this['_speedRate'],(this[_0x39f629(0x148)]-this['ymin'])/this[_0x39f629(0xb6)]];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x1ed8d1){this['_maxAge']=_0x1ed8d1;}[_0x4217c4(0x16b)](_0x7ff25d){const _0x1b7504=_0x4217c4;this[_0x1b7504(0xba)]=_0x7ff25d,this[_0x1b7504(0x146)]=_0x7ff25d[_0x1b7504(0x146)]||0x78,this['speedRate']=_0x7ff25d[_0x1b7504(0xc9)]||0x32,this['particles']=[];const _0x1da4c8=_0x7ff25d[_0x1b7504(0x17b)]||0x1000;for(let _0x64e875=0x0;_0x64e875<_0x1da4c8;_0x64e875++){const _0xd67d34=this['_randomParticle'](new CanvasParticle());this['particles']['push'](_0xd67d34);}}[_0x4217c4(0x13e)](_0x4af690){const _0x3061b7=_0x4217c4;this[_0x3061b7(0xff)]=_0x4af690['rows'],this[_0x3061b7(0xb7)]=_0x4af690[_0x3061b7(0xb7)],this['xmin']=_0x4af690[_0x3061b7(0x12a)],this['xmax']=_0x4af690['xmax'],this[_0x3061b7(0xe9)]=_0x4af690[_0x3061b7(0xe9)],this[_0x3061b7(0x148)]=_0x4af690['ymax'],this['grid']=[];const _0x4047c0=_0x4af690['udata'],_0x1fb325=_0x4af690[_0x3061b7(0x158)];let _0xbb9c1f=![];_0x4047c0['length']===this['rows']&&_0x4047c0[0x0]['length']===this['cols']&&(_0xbb9c1f=!![]);let _0x4de8d4=0x0,_0x1182e5=null,_0x4d6aad=null;for(let _0x5da8c6=0x0;_0x5da8c6<this[_0x3061b7(0xff)];_0x5da8c6++){_0x1182e5=[];for(let _0x344b74=0x0;_0x344b74<this['cols'];_0x344b74++,_0x4de8d4++){_0xbb9c1f?_0x4d6aad=this['_calcUV'](_0x4047c0[_0x5da8c6][_0x344b74],_0x1fb325[_0x5da8c6][_0x344b74]):_0x4d6aad=this['_calcUV'](_0x4047c0[_0x4de8d4],_0x1fb325[_0x4de8d4]),_0x1182e5['push'](_0x4d6aad);}this[_0x3061b7(0x17a)][_0x3061b7(0x14d)](_0x1182e5);}this['options']['reverseY']&&this['grid']['reverse']();}[_0x4217c4(0xb1)](){const _0x58363a=_0x4217c4;delete this['rows'],delete this['cols'],delete this[_0x58363a(0x12a)],delete this[_0x58363a(0x160)],delete this['ymin'],delete this[_0x58363a(0x148)],delete this[_0x58363a(0x17a)],delete this['particles'];}[_0x4217c4(0x181)](_0x1ec7f4,_0x24cfab){const _0x1e3f83=_0x4217c4,_0x47e905=(_0x1ec7f4-this[_0x1e3f83(0x12a)])/(this['xmax']-this['xmin'])*(this['cols']-0x1),_0xb9f70d=(this['ymax']-_0x24cfab)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0x47e905,_0xb9f70d];}['getUVByXY'](_0x2f1fbd,_0x103d9f){const _0x1551ee=_0x4217c4;if(_0x2f1fbd<0x0||_0x2f1fbd>=this[_0x1551ee(0xb7)]||_0x103d9f>=this[_0x1551ee(0xff)])return[0x0,0x0,0x0];const _0x538722=Math['floor'](_0x2f1fbd),_0x37dd77=Math['floor'](_0x103d9f);if(_0x538722===_0x2f1fbd&&_0x37dd77===_0x103d9f)return this['grid'][_0x103d9f][_0x2f1fbd];const _0x1b2210=_0x538722+0x1,_0xedea8b=_0x37dd77+0x1,_0x47c046=this['getUVByXY'](_0x538722,_0x37dd77),_0x11c03f=this['getUVByXY'](_0x1b2210,_0x37dd77),_0x11d18c=this['getUVByXY'](_0x538722,_0xedea8b),_0x10233a=this[_0x1551ee(0x192)](_0x1b2210,_0xedea8b);let _0x5bb51d=null;try{_0x5bb51d=this[_0x1551ee(0x161)](_0x2f1fbd-_0x538722,_0x103d9f-_0x37dd77,_0x47c046,_0x11c03f,_0x11d18c,_0x10233a);}catch(_0x472449){console['log'](_0x2f1fbd,_0x103d9f);}return _0x5bb51d;}['_bilinearInterpolation'](_0x405e57,_0x36aab9,_0x2b6431,_0x42569e,_0x1ff3e4,_0x3cd57c){const _0x352128=0x1-_0x405e57,_0x3094ac=0x1-_0x36aab9,_0x233705=_0x352128*_0x3094ac,_0x5a5975=_0x405e57*_0x3094ac,_0x35249b=_0x352128*_0x36aab9,_0x376dd3=_0x405e57*_0x36aab9,_0xf5d260=_0x2b6431[0x0]*_0x233705+_0x42569e[0x0]*_0x5a5975+_0x1ff3e4[0x0]*_0x35249b+_0x3cd57c[0x0]*_0x376dd3,_0x556551=_0x2b6431[0x1]*_0x233705+_0x42569e[0x1]*_0x5a5975+_0x1ff3e4[0x1]*_0x35249b+_0x3cd57c[0x1]*_0x376dd3;return this['_calcUV'](_0xf5d260,_0x556551);}[_0x4217c4(0x106)](_0x4803db,_0x1fbd5c){const _0x56ad0d=_0x4217c4;return[+_0x4803db,+_0x1fbd5c,Math[_0x56ad0d(0x183)](_0x4803db*_0x4803db+_0x1fbd5c*_0x1fbd5c)];}['getUVByPoint'](_0x1148b9,_0x2f20ce){const _0x513372=_0x4217c4;if(!this[_0x513372(0x15b)](_0x1148b9,_0x2f20ce))return null;const _0x7dc6e0=this[_0x513372(0x181)](_0x1148b9,_0x2f20ce),_0x2a5c8e=this[_0x513372(0x192)](_0x7dc6e0[0x0],_0x7dc6e0[0x1]);return _0x2a5c8e;}[_0x4217c4(0x15b)](_0x58dc8b,_0x36e288){const _0x1a1ed9=_0x4217c4;return _0x58dc8b>=this['xmin']&&_0x58dc8b<=this[_0x1a1ed9(0x160)]&&_0x36e288>=this['ymin']&&_0x36e288<=this['ymax']?!![]:![];}[_0x4217c4(0xb0)](){const _0x3eb08a=_0x4217c4,_0x56d749=fRandomByfloat(this['xmin'],this[_0x3eb08a(0x160)]),_0xc9600b=fRandomByfloat(this['ymin'],this[_0x3eb08a(0x148)]);return{'lat':_0xc9600b,'lng':_0x56d749};}['getParticles'](){const _0x2af194=_0x4217c4;let _0x3f38ba,_0x58fe1f,_0x2509a5;for(let _0x52dc4d=0x0,_0x402252=this['particles'][_0x2af194(0x147)];_0x52dc4d<_0x402252;_0x52dc4d++){let _0x5a2282=this['particles'][_0x52dc4d];_0x5a2282[_0x2af194(0x10f)]<=0x0&&(_0x5a2282=this['_randomParticle'](_0x5a2282));if(_0x5a2282['age']>0x0){const _0x228281=_0x5a2282['tlng'],_0x4b94dd=_0x5a2282[_0x2af194(0x18b)];_0x2509a5=this[_0x2af194(0x121)](_0x228281,_0x4b94dd),_0x2509a5?(_0x3f38ba=_0x228281+this['_calc_speedRate'][0x0]*_0x2509a5[0x0],_0x58fe1f=_0x4b94dd+this[_0x2af194(0xc0)][0x1]*_0x2509a5[0x1],_0x5a2282[_0x2af194(0xc6)]=_0x228281,_0x5a2282[_0x2af194(0x168)]=_0x4b94dd,_0x5a2282['tlng']=_0x3f38ba,_0x5a2282['tlat']=_0x58fe1f,_0x5a2282['speed']=_0x2509a5[0x2],_0x5a2282[_0x2af194(0x10f)]--):_0x5a2282['age']=0x0;}}return this['particles'];}['_randomParticle'](_0x7a0749){const _0x434352=_0x4217c4;let _0x57b6f2,_0x1aaf78;for(let _0xd37a36=0x0;_0xd37a36<0x1e;_0xd37a36++){_0x57b6f2=this['getRandomLatLng'](),_0x1aaf78=this['getUVByPoint'](_0x57b6f2['lng'],_0x57b6f2['lat']);if(_0x1aaf78&&_0x1aaf78[0x2]>0x0)break;}if(!_0x1aaf78)return _0x7a0749;const _0x14f66b=_0x57b6f2[_0x434352(0xc6)]+this[_0x434352(0xc0)][0x0]*_0x1aaf78[0x0],_0xd0f567=_0x57b6f2['lat']+this['_calc_speedRate'][0x1]*_0x1aaf78[0x1];return _0x7a0749[_0x434352(0xc6)]=_0x57b6f2['lng'],_0x7a0749['lat']=_0x57b6f2['lat'],_0x7a0749['tlng']=_0x14f66b,_0x7a0749['tlat']=_0xd0f567,_0x7a0749[_0x434352(0x10f)]=Math['round'](Math['random']()*this[_0x434352(0x146)]),_0x7a0749['speed']=_0x1aaf78[0x2],_0x7a0749;}['destroy'](){for(const _0x9d8a20 in this){delete this[_0x9d8a20];}}}function fRandomByfloat(_0x3839bd,_0x32f26e){return _0x3839bd+Math['random']()*(_0x32f26e-_0x3839bd);}const Cesium=mars3d__namespace[_0x4217c4(0x118)],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x22f8c6={}){const _0x27b99c=_0x4217c4;super(_0x22f8c6),this[_0x27b99c(0x166)](_0x22f8c6),this['canvas']=null,_0x22f8c6['colors']&&_0x22f8c6['steps']&&(this[_0x27b99c(0x138)]=new mars3d__namespace['ColorRamp'](_0x22f8c6));}['_setOptionsHook'](_0x3e60c0,_0x8976ec){const _0x1fbd4c=_0x4217c4;this['frameTime']=0x3e8/(_0x3e60c0['frameRate']||0xa),this['_pointerEvents']=this['options']['pointerEvents']??![],this['color']=_0x3e60c0['color']||'#ffffff',this[_0x1fbd4c(0x12e)]=_0x3e60c0[_0x1fbd4c(0x12e)]||0x1,this['fixedHeight']=_0x3e60c0[_0x1fbd4c(0x13d)]??0x0,this[_0x1fbd4c(0xdc)]=_0x3e60c0['reverseY']??![],this['windField']&&this['windField'][_0x1fbd4c(0x16b)](_0x3e60c0);}get['layer'](){return this['canvas'];}get['canvasWidth'](){const _0x5274e3=_0x4217c4;return this['_map'][_0x5274e3(0xc8)]['canvas']['clientWidth'];}get[_0x4217c4(0xea)](){const _0x47619d=_0x4217c4;return this['_map']['scene'][_0x47619d(0x14a)]['clientHeight'];}get['pointerEvents'](){return this['_pointerEvents'];}set['pointerEvents'](_0x501be6){const _0x10f918=_0x4217c4;this['_pointerEvents']=_0x501be6;if(!this[_0x10f918(0x14a)])return;_0x501be6?this['canvas']['style']['pointer-events']=_0x10f918(0xcf):this['canvas']['style']['pointer-events']='none';}get['particlesNumber'](){const _0xaefd62=_0x4217c4;return this['options'][_0xaefd62(0x17b)];}set['particlesNumber'](_0x57e45e){this['options']['particlesNumber']=_0x57e45e,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{this['redraw']();},0x1f4);}get['speedRate'](){return this['options']['speedRate'];}set['speedRate'](_0xe5f4a6){const _0x349421=_0x4217c4;this[_0x349421(0xba)]['speedRate']=_0xe5f4a6,this['windField']&&(this['windField'][_0x349421(0xc9)]=_0xe5f4a6);}get['maxAge'](){return this['options']['maxAge'];}set[_0x4217c4(0x146)](_0x238523){const _0x51051f=_0x4217c4;this['options']['maxAge']=_0x238523,this[_0x51051f(0x155)]&&(this[_0x51051f(0x155)]['maxAge']=_0x238523);}get['data'](){return this['windData'];}set['data'](_0x3c1f2a){this['setData'](_0x3c1f2a);}['_showHook'](_0x420f9d){const _0x231b38=_0x4217c4;_0x420f9d?this['_addedHook']():(this['windData']&&(this['options']['data']=this['windData']),this[_0x231b38(0x17c)]());}['_mountedHook'](){const _0x5e34c4=_0x4217c4;this[_0x5e34c4(0xba)][_0x5e34c4(0xc4)]?this['initWorker']():this[_0x5e34c4(0x155)]=new CanvasWindField(this['options']);}['_addedHook'](){const _0x17ac32=_0x4217c4;this[_0x17ac32(0x14a)]=this['_createCanvas'](),this[_0x17ac32(0x119)]=this[_0x17ac32(0x14a)][_0x17ac32(0xbf)]('2d',{'willReadFrequently':!![]}),this['bindEvent'](),this['options']['data']&&this['setData'](this[_0x17ac32(0xba)]['data']);}['_removedHook'](){const _0x18f262=_0x4217c4;this['clear'](),this['unbindEvent'](),this['canvas']&&(this['_map']['container'][_0x18f262(0x153)](this['canvas']),delete this['canvas']);}[_0x4217c4(0xf1)](){const _0x35374d=_0x4217c4,_0x4b0da9=mars3d__namespace['DomUtil'][_0x35374d(0xa9)](_0x35374d(0x14a),'mars3d-canvasWind',this['_map']['container']);return _0x4b0da9[_0x35374d(0x163)]['position']=_0x35374d(0x131),_0x4b0da9[_0x35374d(0x163)]['top']='0px',_0x4b0da9['style']['left']='0px',_0x4b0da9['style'][_0x35374d(0xe6)]=this['_map'][_0x35374d(0xc8)]['canvas'][_0x35374d(0x178)]+'px',_0x4b0da9['style']['height']=this[_0x35374d(0xd0)]['scene'][_0x35374d(0x14a)]['clientHeight']+'px',_0x4b0da9['style'][_0x35374d(0x186)]=this['_pointerEvents']?'auto':'none',_0x4b0da9['style']['zIndex']=this['options']['zIndex']??0x9,_0x4b0da9['width']=this['_map']['scene']['canvas']['clientWidth'],_0x4b0da9[_0x35374d(0xfe)]=this['_map']['scene'][_0x35374d(0x14a)]['clientHeight'],_0x4b0da9;}['resize'](){const _0xc03c89=_0x4217c4;this['canvas']&&(this['canvas']['style']['width']=this['_map']['scene']['canvas'][_0xc03c89(0x178)]+'px',this[_0xc03c89(0x14a)]['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',this[_0xc03c89(0x14a)]['width']=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this['_map'][_0xc03c89(0xc8)]['canvas']['clientHeight']);}['bindEvent'](){const _0x4c86d1=_0x4217c4,_0x427394=this;let _0x1865c7=Date['now']();(function _0x57fbb2(){const _0x32c43b=_0x21fd;_0x427394[_0x32c43b(0xf0)]=window[_0x32c43b(0x142)](_0x57fbb2);if(_0x427394['show']&&_0x427394['windField']){const _0x1e668a=Date['now'](),_0x5b88cd=_0x1e668a-_0x1865c7;_0x5b88cd>_0x427394['frameTime']&&(_0x1865c7=_0x1e668a-_0x5b88cd%_0x427394['frameTime'],_0x427394[_0x32c43b(0x14c)]());}}(),window['addEventListener']('resize',this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x4c86d1(0x10a)]=![],this[_0x4c86d1(0xba)]['mouseHidden']&&(this[_0x4c86d1(0xd0)]['on'](mars3d__namespace['EventType'][_0x4c86d1(0x122)],this['_onMapWhellEvent'],this),this[_0x4c86d1(0xd0)]['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['on'](mars3d__namespace['EventType'][_0x4c86d1(0xd1)],this['_onMouseUpEvent'],this)));}[_0x4217c4(0xe3)](){const _0x441f10=_0x4217c4;window[_0x441f10(0x165)](this['animateFrame']),delete this['animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this[_0x441f10(0xd0)][_0x441f10(0xfa)](mars3d__namespace['EventType']['wheel'],this[_0x441f10(0xdb)],this),this[_0x441f10(0xd0)][_0x441f10(0xfa)](mars3d__namespace[_0x441f10(0x104)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map']['off'](mars3d__namespace[_0x441f10(0x104)][_0x441f10(0xd1)],this['_onMouseUpEvent'],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x471f1a){const _0xa1c5e0=_0x4217c4;clearTimeout(this[_0xa1c5e0(0x156)]);if(!this['show']||!this[_0xa1c5e0(0x14a)])return;this[_0xa1c5e0(0x14a)][_0xa1c5e0(0x163)][_0xa1c5e0(0x139)]='hidden',this[_0xa1c5e0(0x156)]=setTimeout(()=>{const _0x45430c=_0xa1c5e0;if(!this['show'])return;this[_0x45430c(0xac)](),this[_0x45430c(0x14a)]['style'][_0x45430c(0x139)]='visible';},0xc8);}['_onMouseDownEvent'](_0x5f6357){const _0x57d25d=_0x4217c4;this['mouse_down']=!![],this['_map']['off'](mars3d__namespace[_0x57d25d(0x104)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace[_0x57d25d(0x104)][_0x57d25d(0x117)],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0x5a3ea7){const _0x3a5a00=_0x4217c4;if(!this[_0x3a5a00(0xe7)]||!this['canvas'])return;this[_0x3a5a00(0x197)]&&(this['canvas']['style']['visibility']=_0x3a5a00(0xd3),this[_0x3a5a00(0x10a)]=!![]);}['_onMouseUpEvent'](_0x2f6a72){const _0x415eb9=_0x4217c4;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType'][_0x415eb9(0x117)],this['_onMouseMoveEvent'],this),this['mouse_down']&&this['mouse_move']&&this['redraw'](),this[_0x415eb9(0x14a)][_0x415eb9(0x163)]['visibility']='visible',this['mouse_down']=![],this[_0x415eb9(0x10a)]=![];}[_0x4217c4(0x16f)](_0x5e862a){const _0x3490b2=_0x4217c4;this['clear'](),this[_0x3490b2(0x194)]=_0x5e862a,this['windField']['setDate'](_0x5e862a),this['redraw']();}[_0x4217c4(0xac)](){const _0x137cc5=_0x4217c4;if(!this['show'])return;this['windField']['setOptions'](this['options']),this[_0x137cc5(0x14c)]();}['update'](){const _0x3ab273=_0x4217c4;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0x3ab273(0xc4)])this['windField'][_0x3ab273(0x14c)]();else{const _0x266a12=this['windField']['getParticles']();this['_drawLines'](_0x266a12);}this['_updateIng']=![];}[_0x4217c4(0x110)](_0x5445e2){const _0x5e50b5=_0x4217c4;this['canvasContext'][_0x5e50b5(0x198)]='destination-in',this[_0x5e50b5(0x119)][_0x5e50b5(0x195)](0x0,0x0,this[_0x5e50b5(0xe4)],this['canvasHeight']),this['canvasContext']['globalCompositeOperation']='lighter',this[_0x5e50b5(0x119)]['globalAlpha']=0.9;const _0x77a33d=this[_0x5e50b5(0xd0)][_0x5e50b5(0xc8)][_0x5e50b5(0xb9)]!==Cesium['SceneMode']['SCENE3D'],_0xb6783=this['canvasWidth']*0.25;if(this['_colorRamp'])for(let _0x3c90ee=0x0,_0x459b59=_0x5445e2['length'];_0x3c90ee<_0x459b59;_0x3c90ee++){const _0x1e4269=_0x5445e2[_0x3c90ee],_0x67aa38=this['_tomap'](_0x1e4269[_0x5e50b5(0xc6)],_0x1e4269['lat'],_0x1e4269),_0x58a150=this['_tomap'](_0x1e4269[_0x5e50b5(0x185)],_0x1e4269['tlat'],_0x1e4269);if(!_0x67aa38||!_0x58a150)continue;if(_0x77a33d&&Math['abs'](_0x67aa38[0x0]-_0x58a150[0x0])>=_0xb6783)continue;this[_0x5e50b5(0x119)]['beginPath'](),this['canvasContext'][_0x5e50b5(0x12e)]=this[_0x5e50b5(0x12e)],this['canvasContext'][_0x5e50b5(0x180)]=this['_colorRamp']['getColor'](_0x1e4269['speed']),this['canvasContext'][_0x5e50b5(0xc1)](_0x67aa38[0x0],_0x67aa38[0x1]),this[_0x5e50b5(0x119)]['lineTo'](_0x58a150[0x0],_0x58a150[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext'][_0x5e50b5(0xcb)](),this['canvasContext']['lineWidth']=this[_0x5e50b5(0x12e)],this['canvasContext']['strokeStyle']=this[_0x5e50b5(0xfc)];for(let _0xa5a3d4=0x0,_0x342c74=_0x5445e2['length'];_0xa5a3d4<_0x342c74;_0xa5a3d4++){const _0x13ec1b=_0x5445e2[_0xa5a3d4],_0x32b363=this['_tomap'](_0x13ec1b['lng'],_0x13ec1b[_0x5e50b5(0x168)],_0x13ec1b),_0x5002ad=this['_tomap'](_0x13ec1b['tlng'],_0x13ec1b[_0x5e50b5(0x18b)],_0x13ec1b);if(!_0x32b363||!_0x5002ad)continue;if(_0x77a33d&&Math['abs'](_0x32b363[0x0]-_0x5002ad[0x0])>=_0xb6783)continue;this['canvasContext']['moveTo'](_0x32b363[0x0],_0x32b363[0x1]),this['canvasContext'][_0x5e50b5(0x145)](_0x5002ad[0x0],_0x5002ad[0x1]);}this[_0x5e50b5(0x119)][_0x5e50b5(0x128)]();}}['_tomap'](_0x4980af,_0x41eed3,_0x2462b3){const _0x4a3757=_0x4217c4,_0x354f63=Cesium[_0x4a3757(0x159)]['fromDegrees'](_0x4980af,_0x41eed3,this['fixedHeight']),_0x4d78a7=this['_map']['scene'];if(_0x4d78a7[_0x4a3757(0xb9)]===Cesium['SceneMode']['SCENE3D']){const _0x134dd0=new Cesium['EllipsoidalOccluder'](_0x4d78a7[_0x4a3757(0x12f)]['ellipsoid'],_0x4d78a7['camera']['positionWC']),_0xaf963=_0x134dd0[_0x4a3757(0x134)](_0x354f63);if(!_0xaf963)return _0x2462b3[_0x4a3757(0x10f)]=0x0,null;}const _0xa22a40=Cesium['SceneTransforms']['wgs84ToWindowCoordinates'](this['_map']['scene'],_0x354f63);return _0xa22a40?[_0xa22a40['x'],_0xa22a40['y']]:null;}[_0x4217c4(0xb1)](){this['windField']['clear'](),delete this['windData'];}[_0x4217c4(0xe2)](){const _0x4a3bef=_0x4217c4;this['worker']=new Worker(this[_0x4a3bef(0xba)]['worker']),this['worker'][_0x4a3bef(0x111)]=_0x2b4f18=>{const _0x50643=_0x4a3bef;this['_drawLines'](_0x2b4f18['data'][_0x50643(0xab)]),this['_updateIng2']=![];},this['windField']={'init':_0xc266af=>{const _0x186f91=_0x4a3bef;this[_0x186f91(0xc4)]['postMessage']({'type':'init','options':_0xc266af});},'setOptions':_0x5b9ec4=>{const _0x188ecd=_0x4a3bef;this[_0x188ecd(0xc4)]['postMessage']({'type':_0x188ecd(0x16b),'options':_0x5b9ec4});},'setDate':_0x3ea1ea=>{const _0x407dc8=_0x4a3bef;this['worker']['postMessage']({'type':_0x407dc8(0x13e),'data':_0x3ea1ea});},'update':()=>{const _0x461296=_0x4a3bef;if(this['_updateIng2'])return;this['_updateIng2']=!![],this[_0x461296(0xc4)]['postMessage']({'type':'update'});},'clear':()=>{this['worker']['postMessage']({'type':'clear'});}},this['windField'][_0x4a3bef(0xf7)](this[_0x4a3bef(0xba)]);}}mars3d__namespace['LayerUtil']['register'](_0x4217c4(0x100),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace[_0x4217c4(0x187)]=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x4217c4(0x187)]=CanvasWindField,exports[_0x4217c4(0xae)]=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
