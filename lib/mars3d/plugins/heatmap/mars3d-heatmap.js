/**
 * Mars3D平台插件,结合heatmap可视化功能插件  mars3d-heatmap
 *
 * 版本信息：v3.6.16
 * 编译日期：2023-12-10 22:08:48
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：免费公开版 ，2023-03-17
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d')), (window.h337 || require('@mars3d/heatmap.js'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d', '@mars3d/heatmap.js'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-heatmap"] = {}, global.mars3d, global.h337));
})(this, (function (exports, mars3d, h337) { 
'use strict';const _0x49e4e1=_0x1e28;(function(_0x3c8ef5,_0x152eff){const _0x219a30={_0x5093f3:0xeb,_0x125aee:0x10b,_0x47fc1e:0xe9,_0x5234ba:0x113,_0x2bebe9:0x10e,_0x52007d:0xe6},_0x2ebb2b=_0x1e28,_0x26e48e=_0x3c8ef5();while(!![]){try{const _0x30942b=-parseInt(_0x2ebb2b(0x10c))/0x1*(-parseInt(_0x2ebb2b(0x125))/0x2)+-parseInt(_0x2ebb2b(_0x219a30._0x5093f3))/0x3*(-parseInt(_0x2ebb2b(0xed))/0x4)+parseInt(_0x2ebb2b(_0x219a30._0x125aee))/0x5*(parseInt(_0x2ebb2b(_0x219a30._0x47fc1e))/0x6)+parseInt(_0x2ebb2b(0x109))/0x7*(-parseInt(_0x2ebb2b(_0x219a30._0x5234ba))/0x8)+parseInt(_0x2ebb2b(_0x219a30._0x2bebe9))/0x9*(parseInt(_0x2ebb2b(0x124))/0xa)+-parseInt(_0x2ebb2b(0x12c))/0xb*(parseInt(_0x2ebb2b(0x12d))/0xc)+-parseInt(_0x2ebb2b(_0x219a30._0x52007d))/0xd;if(_0x30942b===_0x152eff)break;else _0x26e48e['push'](_0x26e48e['shift']());}catch(_0x1b6a50){_0x26e48e['push'](_0x26e48e['shift']());}}}(_0x52a3,0xec9dc));function _0x52a3(){const _0x3fa3bf=['defineProperty','maxCanvasSize','mercator2lonlat','LayerUtil','blue','rgb(0,0,0)','length','lonlat2mercator','_positions','create','_container','_renderer','granularity','4529xLogfJ','layer','5JgPjXP','1205669mQunDh','type','54837cFNFgh','EllipsoidSurfaceAppearance','_map','width','StencilOperation','8264xKsKBz','lng','style','toDataURL','addGraphic','setPositions','round','gradientArc','KEEP','positions','push','canvas','_graphic','abs','Rectangle','_heat','_rectangle','810FoEkUU','2NQgjIo','bumpMap','get','_scale','in\x20vec3\x20position3DHigh;\x0a\x20\x20in\x20vec3\x20position3DLow;\x0a\x20\x20in\x20vec2\x20st;\x0a\x20\x20in\x20float\x20batchId;\x0a\x20\x20uniform\x20sampler2D\x20bumpMap_3;\x0a\x20\x20out\x20vec3\x20v_positionMC;\x0a\x20\x20out\x20vec3\x20v_positionEC;\x0a\x20\x20out\x20vec2\x20v_st;\x0a\x0a\x20\x20void\x20main()\x0a\x20\x20{\x0a\x20\x20\x20\x20vec4\x20p\x20=\x20czm_computePosition();\x0a\x20\x20\x20\x20v_positionMC\x20=\x20position3DHigh\x20+\x20position3DLow;\x0a\x20\x20\x20\x20v_positionEC\x20=\x20(czm_modelViewRelativeToEye\x20*\x20p).xyz;\x0a\x20\x20\x20\x20v_st\x20=\x20st;\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture(bumpMap_3,\x20v_st);\x0a\x20\x20\x20\x20float\x20centerBump\x20=\x20distance(vec3(0.0),color.rgb);\x0a\x20\x20\x20\x20vec3\x20upDir\x20=\x20normalize(v_positionMC.xyz);\x0a\x20\x20\x20\x20vec3\x20disPos\x20=\x20upDir\x20*\x20centerBump\x20*\x20','_getArcHeatCanvas','_updatePositionsHook','22ZWqkPM','393732ITNQwo','arcDirection','body','minCanvasSize','uniforms','parse','fromDegrees','heatStyle','xmax','_getHeatCanvas','Material','yellow','_createArcGraphic','graphic','lat','value','options','clear','_removedHook','_last_mBounds','min','36864438gYNEkK','rgb(255,255,255)','ymax','6912696piGxkx','Cartesian2','5062683BMzjJn','DomUtil','4PIMnsn','diffHeight','ymin','flyTo','xmin','_graphic2','configure','removeGraphic','PointTrans','clientHeight','_createGraphic','green','__esModule','LngLatPoint','_layer'];_0x52a3=function(){return _0x3fa3bf;};return _0x52a3();}function _interopNamespace(_0x15ef21){const _0x115da1={_0xf24dfd:0xfc,_0x9d1fc3:0x127};if(_0x15ef21&&_0x15ef21['__esModule'])return _0x15ef21;var _0x100f53=Object['create'](null);return _0x15ef21&&Object['keys'](_0x15ef21)['forEach'](function(_0x2a220f){const _0x4a3638=_0x1e28;if(_0x2a220f!=='default'){var _0x3e275c=Object['getOwnPropertyDescriptor'](_0x15ef21,_0x2a220f);Object[_0x4a3638(_0x115da1._0xf24dfd)](_0x100f53,_0x2a220f,_0x3e275c[_0x4a3638(_0x115da1._0x9d1fc3)]?_0x3e275c:{'enumerable':!![],'get':function(){return _0x15ef21[_0x2a220f];}});}}),_0x100f53['default']=_0x15ef21,_0x100f53;}var mars3d__namespace=_interopNamespace(mars3d),h337__namespace=_interopNamespace(h337),HeatMaterial='uniform\x20sampler2D\x20image;\x0a\x0aczm_material\x20czm_getMaterial(czm_materialInput\x20materialInput)\x20{\x0a\x20\x20czm_material\x20material\x20=\x20czm_getDefaultMaterial(materialInput);\x0a\x20\x20vec2\x20st\x20=\x20materialInput.st;\x0a\x20\x20vec4\x20colorImage\x20=\x20texture(image,\x20st);\x0a\x20\x20if(colorImage.rgb\x20==\x20vec3(1.0)\x20||\x20colorImage.rgb\x20==\x20vec3(0.0))\x20{\x0a\x20\x20\x20\x20discard;\x0a\x20\x20}\x0a\x20\x20material.diffuse\x20=\x20colorImage.rgb;\x0a\x20\x20material.alpha\x20=\x20colorImage.a;\x0a\x20\x20return\x20material;\x0a}\x0a';if(!h337__namespace[_0x49e4e1(0x105)])throw new Error('请引入\x20heatmap.js\x20库\x20');function _0x1e28(_0x803b7f,_0x4a4e85){const _0x52a3f6=_0x52a3();return _0x1e28=function(_0x1e2826,_0x53431b){_0x1e2826=_0x1e2826-0xd3;let _0x432d62=_0x52a3f6[_0x1e2826];return _0x432d62;},_0x1e28(_0x803b7f,_0x4a4e85);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace[_0x49e4e1(0x10a)]['BaseLayer'],DEF_HEATSTYLE={'maxOpacity':0.8,'minOpacity':0.1,'blur':0.85,'radius':0x19,'gradient':{0.4:_0x49e4e1(0x100),0.6:_0x49e4e1(0xf8),0.8:_0x49e4e1(0xdc),0.9:'red'}},DEF_STYLE={'arcRadiusScale':1.5,'arcBlurScale':1.5,'vertexFormat':Cesium['EllipsoidSurfaceAppearance']['VERTEX_FORMAT']};class HeatLayer extends BaseLayer{constructor(_0x3fe5fe={}){const _0x3c4825={_0x5655b6:0xf6,_0x15b542:0xe1,_0x11e4bd:0x115},_0x2c82ed=_0x49e4e1;super(_0x3fe5fe),this['options'][_0x2c82ed(0xfd)]=this['options']['maxCanvasSize']??document['body']['clientWidth'],this['options']['maxCanvasSize']=Math[_0x2c82ed(0xe5)](this['options']['maxCanvasSize'],0x1388),this['options']['minCanvasSize']=this['options'][_0x2c82ed(0xd4)]??document[_0x2c82ed(0xd3)][_0x2c82ed(_0x3c4825._0x5655b6)],this['options']['minCanvasSize']=Math['max'](this['options']['minCanvasSize'],0x2bc),this[_0x2c82ed(_0x3c4825._0x15b542)]['heatStyle']={...DEF_HEATSTYLE,...this['options']['heatStyle']},this['options']['style']={...DEF_STYLE,...this['options'][_0x2c82ed(_0x3c4825._0x11e4bd)]};}get['layer'](){return this['_layer'];}get['heatStyle'](){const _0x28f038={_0x132fba:0xe1},_0xecf9a1=_0x49e4e1;return this[_0xecf9a1(_0x28f038._0x132fba)][_0xecf9a1(0xd8)];}set[_0x49e4e1(0xd8)](_0x22052e){const _0x3df6bc={_0x39935b:0xd8,_0x197991:0xf3,_0x2ac44e:0x12b},_0x44190e=_0x49e4e1;this['options'][_0x44190e(_0x3df6bc._0x39935b)]=mars3d__namespace['Util']['merge'](this['options']['heatStyle'],_0x22052e),this['_heat']&&(this['_heat'][_0x44190e(_0x3df6bc._0x197991)](this['options'][_0x44190e(0xd8)]),this[_0x44190e(_0x3df6bc._0x2ac44e)](!![]));}get['style'](){const _0x2169cf={_0x311c21:0x115},_0x3dff8d=_0x49e4e1;return this[_0x3dff8d(0xe1)][_0x3dff8d(_0x2169cf._0x311c21)];}set['style'](_0x13369c){const _0x3d89e6=_0x49e4e1;this['options'][_0x3d89e6(0x115)]=mars3d__namespace['Util']['merge'](this['options'][_0x3d89e6(0x115)],_0x13369c);}get[_0x49e4e1(0x11c)](){const _0x3c66fa={_0x4c0136:0x104},_0x2f7589=_0x49e4e1;return this[_0x2f7589(_0x3c66fa._0x4c0136)];}set['positions'](_0x312166){this['setPositions'](_0x312166);}get['coordinates'](){const _0x197f6a={_0x2f6bc8:0x11d},_0x7d0c61=[];return this['points']['forEach'](_0x52c76c=>{const _0x46ba71=_0x1e28;_0x7d0c61[_0x46ba71(_0x197f6a._0x2f6bc8)](_0x52c76c['toArray']());}),_0x7d0c61;}get['rectangle'](){const _0x23e0bd=_0x49e4e1;return this[_0x23e0bd(0x123)];}['_setOptionsHook'](_0x4875a3,_0x273731){const _0x17323c={_0x2ba440:0x11c},_0x46ef2e=_0x49e4e1;_0x4875a3[_0x46ef2e(_0x17323c._0x2ba440)]&&(this['positions']=_0x4875a3['positions']);}['_mountedHook'](){this['style']['type']==='image'?this['_layer']=new mars3d__namespace['layer']['ImageLayer']({'crs':'EPSG:3857','private':!![]}):this['_layer']=new mars3d__namespace['layer']['GraphicLayer']({'private':!![]});}['_addedHook'](){const _0x27821d={_0x579bf3:0xf0},_0x3a40f0=_0x49e4e1;this['_map']['addLayer'](this['_layer']),this['_container']=mars3d__namespace[_0x3a40f0(0xec)]['create']('div','mars3d-heatmap\x20mars3d-hideDiv',this['_map']['container']),this['options']['positions']&&(this['positions']=this['options']['positions']),this['options'][_0x3a40f0(_0x27821d._0x579bf3)]&&this['flyToByAnimationEnd']();}[_0x49e4e1(0xe3)](){const _0x1e8c4f=_0x49e4e1;this['_container']&&(mars3d__namespace['DomUtil']['remove'](this['_container']),delete this['_container']),this['clear'](),this['_map']['removeLayer'](this[_0x1e8c4f(0xfb)]);}['addPosition'](_0x3921c8,_0x4e2d3a){this['_positions']=this['_positions']||[],this['_positions']['push'](_0x3921c8),this['_updatePositionsHook'](_0x4e2d3a);}[_0x49e4e1(0x118)](_0x225a11,_0x395034){const _0x12e752=_0x49e4e1;this['_positions']=_0x225a11,this[_0x12e752(0x12b)](_0x395034);}['clear'](){const _0x2cd964=_0x49e4e1;this[_0x2cd964(0x11f)]&&(this[_0x2cd964(0xfb)]['removeGraphic'](this['_graphic'],!![]),delete this['_graphic']),this['_graphic2']&&(this['_layer'][_0x2cd964(0xf4)](this['_graphic2'],!![]),delete this['_graphic2']);}[_0x49e4e1(0x12b)](_0x3a6a7a){const _0x23140d={_0x538a84:0x110,_0x3c735d:0x11c,_0x4e918f:0x102,_0x5cc385:0x115,_0x108db6:0xd5,_0x3345c3:0x126,_0x2a8c41:0xf2,_0x3b3f56:0xf2,_0x1d69f1:0xdd},_0x38e962=_0x49e4e1;if(!this['show']||!this[_0x38e962(_0x23140d._0x538a84)]||!this[_0x38e962(0x11c)]||this[_0x38e962(_0x23140d._0x3c735d)][_0x38e962(_0x23140d._0x4e918f)]===0x0)return this;const _0x4733ec=this[_0x38e962(0xda)]();if(this['style'][_0x38e962(0x10d)]==='image')this[_0x38e962(0xfb)]['setOptions']({'url':_0x4733ec[_0x38e962(0x116)]('image/png'),'rectangle':this['_rectangle'],'opacity':this[_0x38e962(_0x23140d._0x5cc385)]['opacity']});else this['style']['arc']?this[_0x38e962(0x11f)]&&_0x3a6a7a?(this['_graphic'][_0x38e962(0xd5)]['image']=_0x4733ec,this['_graphic'][_0x38e962(_0x23140d._0x108db6)][_0x38e962(_0x23140d._0x3345c3)]=this[_0x38e962(0x12a)](),this[_0x38e962(_0x23140d._0x2a8c41)]&&(this[_0x38e962(_0x23140d._0x3b3f56)][_0x38e962(0xd5)]['image']=_0x4733ec,this['_graphic2']['uniforms']['bumpMap']=this['_graphic']['uniforms']['bumpMap'])):this[_0x38e962(_0x23140d._0x1d69f1)](_0x4733ec):this['_graphic']&&_0x3a6a7a?this[_0x38e962(0x11f)]['uniforms']['image']=_0x4733ec:this[_0x38e962(0xf7)](_0x4733ec);return this;}['_createGraphic'](_0x1de899){const _0x51117f={_0x55b9bc:0xe2,_0x3ef0fa:0x10f,_0x4e9d1a:0xdb,_0xb36a0:0x117},_0x30f217=_0x49e4e1;this[_0x30f217(_0x51117f._0x55b9bc)](),this['_graphic']=new mars3d__namespace['graphic']['RectanglePrimitive']({...this['options'],'rectangle':this['_rectangle'],'appearance':new Cesium[(_0x30f217(_0x51117f._0x3ef0fa))]({'material':new Cesium[(_0x30f217(_0x51117f._0x4e9d1a))]({'fabric':{'uniforms':{'image':_0x1de899},'source':HeatMaterial},'translucent':!![]}),'flat':!![]})}),this['_layer'][_0x30f217(_0x51117f._0xb36a0)](this['_graphic']);}['_createArcGraphic'](_0x61d6fd){const _0x4659c5={_0xab2832:0x112,_0x2458f3:0x11b,_0x274995:0x11b,_0x2782c0:0x123,_0xdd4752:0x111,_0x2a2067:0x108,_0x1ffffb:0xea,_0x591a47:0x12a,_0x1e3f39:0xf2},_0x2fdaab=_0x49e4e1;this['clear']();const _0x49ce1a=Cesium['RenderState']['fromCache']({'cull':{'enabled':!![]},'depthTest':{'enabled':!![]},'stencilTest':{'enabled':!![],'frontFunction':Cesium['StencilFunction']['ALWAYS'],'frontOperation':{'fail':Cesium[_0x2fdaab(_0x4659c5._0xab2832)]['KEEP'],'zFail':Cesium['StencilOperation'][_0x2fdaab(_0x4659c5._0x2458f3)],'zPass':Cesium['StencilOperation']['REPLACE']},'backFunction':Cesium['StencilFunction']['ALWAYS'],'backOperation':{'fail':Cesium[_0x2fdaab(_0x4659c5._0xab2832)][_0x2fdaab(_0x4659c5._0x274995)],'zFail':Cesium['StencilOperation']['KEEP'],'zPass':Cesium[_0x2fdaab(_0x4659c5._0xab2832)]['REPLACE']},'reference':0x2,'mask':0x2},'blending':Cesium['BlendingState']['ALPHA_BLEND']}),_0x24db44=Math['floor'](this['style']['diffHeight']??this['_mBoundsMax']*0.02)+0.1;this['style'][_0x2fdaab(0xee)]&&delete this['style']['diffHeight'];const _0x154909=(this[_0x2fdaab(0x115)]['splitNum'],0x64);let _0x1fd7b6=Math['max'](this[_0x2fdaab(0x123)]['height'],this[_0x2fdaab(_0x4659c5._0x2782c0)][_0x2fdaab(_0x4659c5._0xdd4752)]);this['style'][_0x2fdaab(_0x4659c5._0x2a2067)]=_0x1fd7b6/=_0x154909;const _0x3c28c0=new Cesium['Material']({'fabric':{'uniforms':{'image':_0x61d6fd,'repeat':new Cesium[(_0x2fdaab(_0x4659c5._0x1ffffb))](0x1,0x1),'color':new Cesium['Color'](0x1,0x1,0x1,0x0),'bumpMap':this[_0x2fdaab(_0x4659c5._0x591a47)]()},'source':HeatMaterial},'translucent':!![]}),_0x427b56=this['style']['arcDirection']||0x1;this['_graphic']=new mars3d__namespace[(_0x2fdaab(0xde))]['RectanglePrimitive']({...this[_0x2fdaab(0xe1)],'rectangle':this[_0x2fdaab(0x123)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x49ce1a,'material':_0x3c28c0,'vertexShaderSource':getVertexShaderSource(_0x24db44*_0x427b56)})}),this['_layer']['addGraphic'](this['_graphic']),this['style'][_0x2fdaab(0x12e)]===0x0&&(this[_0x2fdaab(_0x4659c5._0x1e3f39)]=new mars3d__namespace['graphic']['RectanglePrimitive']({...this['options'],'rectangle':this[_0x2fdaab(0x123)],'appearance':new Cesium['EllipsoidSurfaceAppearance']({'flat':!![],'aboveGround':!![],'renderState':_0x49ce1a,'material':_0x3c28c0,'vertexShaderSource':getVertexShaderSource(-_0x24db44)})}),this[_0x2fdaab(0xfb)]['addGraphic'](this['_graphic2']));}['getRectangle'](_0x41eab6){const _0x2841de={_0x1ced9a:0x123},_0xdee2d2=_0x49e4e1;return _0x41eab6!==null&&_0x41eab6!==void 0x0&&_0x41eab6['isFormat']&&this[_0xdee2d2(0x123)]?mars3d__namespace['PolyUtil']['formatRectangle'](this['_rectangle']):this[_0xdee2d2(_0x2841de._0x1ced9a)];}['_getHeatCanvas'](){const _0x5c25c2={_0x4da1dd:0xe1,_0x2e4cff:0xd4,_0x2c316c:0xd4,_0x3f2cc5:0xfd,_0x33c7d8:0xe1,_0x3f8283:0x121,_0x46eb04:0xd7,_0x2fb687:0x105,_0x1e2cbe:0xf3,_0x2804a4:0xec},_0x6d8d3f={_0x5e5395:0xdf},_0x21fa58={_0x4971d4:0xd6,_0x2d83ab:0xe1,_0x5c6af8:0x114,_0x493f56:0xdf},_0x11f968=_0x49e4e1,_0x93caa=this['_positions'],_0x383777=[];let _0x458497,_0x1e1c96,_0x14d6e1,_0x3b34ca;_0x93caa['forEach'](_0x24aaea=>{const _0x95dc5=_0x1e28,_0xca9a7=mars3d__namespace[_0x95dc5(0xfa)][_0x95dc5(_0x21fa58._0x4971d4)](_0x24aaea);if(!_0xca9a7)return;_0xca9a7['value']=_0x24aaea[_0x95dc5(0xe0)]||0x1,!this[_0x95dc5(_0x21fa58._0x2d83ab)]['rectangle']&&(_0x458497===undefined?(_0x458497=_0xca9a7[_0x95dc5(_0x21fa58._0x5c6af8)],_0x1e1c96=_0xca9a7['lng'],_0x14d6e1=_0xca9a7['lat'],_0x3b34ca=_0xca9a7['lat']):(_0x458497=Math['min'](_0x458497,_0xca9a7[_0x95dc5(_0x21fa58._0x5c6af8)]),_0x1e1c96=Math['max'](_0x1e1c96,_0xca9a7['lng']),_0x14d6e1=Math[_0x95dc5(0xe5)](_0x14d6e1,_0xca9a7['lat']),_0x3b34ca=Math['max'](_0x3b34ca,_0xca9a7[_0x95dc5(_0x21fa58._0x493f56)]))),_0x383777['push'](_0xca9a7);});_0x458497===_0x1e1c96&&(_0x458497-=0.000001,_0x1e1c96+=0.000001);_0x14d6e1===_0x3b34ca&&(_0x14d6e1-=0.000001,_0x3b34ca+=0.000001);let _0x384424=this['options']['rectangle']||{'xmin':_0x458497,'xmax':_0x1e1c96,'ymin':_0x14d6e1,'ymax':_0x3b34ca};const _0x4990f5=getMercatorBounds(_0x384424),_0x16d4b3=Math['abs'](_0x4990f5[_0x11f968(0xd9)]-_0x4990f5['xmin']),_0x1a1b57=Math[_0x11f968(0x120)](_0x4990f5['ymax']-_0x4990f5['ymin']),_0x37a7a1=Math['max'](_0x16d4b3,_0x1a1b57),_0x40dbe2=Math['min'](_0x16d4b3,_0x1a1b57);this['_mBoundsMax']=_0x37a7a1;let _0x304b9d=0x1;if(_0x37a7a1>this['options']['maxCanvasSize'])_0x304b9d=_0x37a7a1/this['options'][_0x11f968(0xfd)],_0x40dbe2/_0x304b9d<this[_0x11f968(_0x5c25c2._0x4da1dd)]['minCanvasSize']&&(_0x304b9d=_0x40dbe2/this['options']['minCanvasSize']);else _0x40dbe2<this['options'][_0x11f968(_0x5c25c2._0x2e4cff)]&&(_0x304b9d=_0x40dbe2/this[_0x11f968(0xe1)][_0x11f968(_0x5c25c2._0x2c316c)],_0x37a7a1/_0x304b9d>this['options'][_0x11f968(_0x5c25c2._0x3f2cc5)]&&(_0x304b9d=_0x37a7a1/this[_0x11f968(_0x5c25c2._0x33c7d8)]['maxCanvasSize']));const _0x437470=this['heatStyle']['radius']*1.5,_0x499467=_0x16d4b3/_0x304b9d+_0x437470*0x2,_0x28d525=_0x1a1b57/_0x304b9d+_0x437470*0x2,_0x171d65=_0x437470*_0x304b9d;_0x4990f5['xmin']-=_0x171d65,_0x4990f5['ymin']-=_0x171d65,_0x4990f5['xmax']+=_0x171d65,_0x4990f5['ymax']+=_0x171d65,this['_scale']=_0x304b9d,_0x384424=geLatLngBounds(_0x4990f5),this['_rectangle']=Cesium[_0x11f968(_0x5c25c2._0x3f8283)][_0x11f968(_0x5c25c2._0x46eb04)](_0x384424['xmin'],_0x384424['ymin'],_0x384424['xmax'],_0x384424['ymax']);let _0x1d6170=_0x383777[0x0][_0x11f968(0xe0)]??0x1,_0x49d2bf=_0x383777[0x0]['value']??0x0;const _0x71ca29=[];_0x383777['forEach'](_0x4dde26=>{const _0x39fd68=_0x11f968,_0x572879=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x4dde26['lng'],_0x4dde26[_0x39fd68(_0x6d8d3f._0x5e5395)]]),_0x294a9f=_0x4dde26['value']||0x1,_0x3f2032=Math[_0x39fd68(0x119)]((_0x572879[0x0]-_0x4990f5['xmin'])/_0x304b9d),_0x3c67b0=Math['round']((_0x4990f5['ymax']-_0x572879[0x1])/_0x304b9d);_0x1d6170=Math['max'](_0x1d6170,_0x294a9f),_0x49d2bf=Math['min'](_0x49d2bf,_0x294a9f),_0x71ca29[_0x39fd68(0x11d)]({'x':_0x3f2032,'y':_0x3c67b0,'value':_0x294a9f});});const _0x202d35={'min':this['options']['min']??_0x49d2bf,'max':this['options']['max']??_0x1d6170,'data':_0x71ca29};this['_last_heatData']=_0x202d35;if(!this['_last_mBounds']||_0x4990f5['xmin']!==this['_last_mBounds']['xmin']||_0x4990f5[_0x11f968(0xef)]!==this['_last_mBounds']['ymin']||_0x4990f5['xmax']!==this['_last_mBounds']['xmax']||_0x4990f5['ymax']!==this['_last_mBounds']['ymax']){this[_0x11f968(0xe4)]=_0x4990f5,this['_container']['style']['cssText']='width:'+_0x499467+'px;height:'+_0x28d525+'px;';const _0xa0294e={...this[_0x11f968(0xd8)],'container':this[_0x11f968(0x106)]};!this['_heat']?this[_0x11f968(0x122)]=h337__namespace[_0x11f968(_0x5c25c2._0x2fb687)](_0xa0294e):this['_heat'][_0x11f968(_0x5c25c2._0x1e2cbe)](_0xa0294e);}this['_heat']['setData'](_0x202d35);const _0x4f903f=mars3d__namespace[_0x11f968(_0x5c25c2._0x2804a4)]['copyCanvas'](this[_0x11f968(0x122)][_0x11f968(0x107)]['canvas']);return _0x4f903f;}['_getArcHeatCanvas'](){const _0x1332b5={_0x1bde8c:0xf3,_0x28b2f4:0x115,_0x47fe7d:0x101,_0x3d508d:0xe7,_0x4acc47:0x122,_0x150ddd:0xe1},_0x26d8b3=_0x49e4e1;this['_heat'][_0x26d8b3(_0x1332b5._0x1bde8c)]({'radius':this['heatStyle']['radius']*this['style']['arcRadiusScale'],'blur':this['heatStyle']['blur']*this[_0x26d8b3(_0x1332b5._0x28b2f4)]['arcBlurScale'],'gradient':this['heatStyle'][_0x26d8b3(0x11a)]||{0.25:_0x26d8b3(_0x1332b5._0x47fe7d),0.55:'rgb(140,140,140)',0.85:'rgb(216,216,216)',0x1:_0x26d8b3(_0x1332b5._0x3d508d)}});const _0x2b0fee=mars3d__namespace['DomUtil']['copyCanvas'](this['_heat']['_renderer'][_0x26d8b3(0x11e)]);return this[_0x26d8b3(_0x1332b5._0x4acc47)]['configure'](this[_0x26d8b3(_0x1332b5._0x150ddd)][_0x26d8b3(0xd8)]),_0x2b0fee;}['getPointData'](_0x546d66){const _0x456df4={_0xaba70b:0xfa,_0xda0e81:0xf5,_0x16d890:0xf1,_0x5ee1ad:0xe8},_0xfb3bea=_0x49e4e1,_0xb22c27=mars3d__namespace[_0xfb3bea(_0x456df4._0xaba70b)]['parse'](_0x546d66);if(!_0xb22c27)return{};const _0x2b43c2=mars3d__namespace[_0xfb3bea(_0x456df4._0xda0e81)][_0xfb3bea(0x103)]([_0xb22c27['lng'],_0xb22c27['lat']]),_0x3e61bf=this['_last_mBounds'],_0x1d9bee=Math[_0xfb3bea(0x119)]((_0x2b43c2[0x0]-_0x3e61bf[_0xfb3bea(_0x456df4._0x16d890)])/this['_scale']),_0x49b2c7=Math['round']((_0x3e61bf[_0xfb3bea(_0x456df4._0x5ee1ad)]-_0x2b43c2[0x1])/this[_0xfb3bea(0x128)]),_0x199779=this['_heat']['getValueAt']({'x':_0x1d9bee,'y':_0x49b2c7}),_0x3b1c29=this['_heat']['_renderer']['ctx']['getImageData'](_0x1d9bee-0x1,_0x49b2c7-0x1,0x1,0x1)['data'];return{'x':_0x1d9bee,'y':_0x49b2c7,'value':_0x199779,'color':'rgba('+_0x3b1c29[0x0]+','+_0x3b1c29[0x1]+','+_0x3b1c29[0x2]+','+_0x3b1c29[0x3]+')'};}}mars3d__namespace[_0x49e4e1(0xff)]['register']('heat',HeatLayer),mars3d__namespace[_0x49e4e1(0x10a)]['HeatLayer']=HeatLayer,mars3d__namespace['h337']=h337__namespace;function getMercatorBounds(_0x1c6f30){const _0x56f5d1={_0x36a61c:0xf5,_0x22426c:0xef,_0x545118:0xe8},_0x267c89=_0x49e4e1,_0xd6bbb7=mars3d__namespace[_0x267c89(_0x56f5d1._0x36a61c)]['lonlat2mercator']([_0x1c6f30['xmin'],_0x1c6f30[_0x267c89(_0x56f5d1._0x22426c)]]),_0x48209e=mars3d__namespace['PointTrans']['lonlat2mercator']([_0x1c6f30['xmax'],_0x1c6f30[_0x267c89(_0x56f5d1._0x545118)]]);return{'xmin':_0xd6bbb7[0x0],'ymin':_0xd6bbb7[0x1],'xmax':_0x48209e[0x0],'ymax':_0x48209e[0x1]};}function geLatLngBounds(_0x41a2c9){const _0x155869={_0x28b4f9:0xf5,_0x3887ce:0xfe,_0x44068e:0xe8},_0x4c4be4=_0x49e4e1,_0x13d79d=mars3d__namespace[_0x4c4be4(_0x155869._0x28b4f9)][_0x4c4be4(_0x155869._0x3887ce)]([_0x41a2c9['xmin'],_0x41a2c9['ymin']]),_0x1f158b=mars3d__namespace['PointTrans'][_0x4c4be4(0xfe)]([_0x41a2c9[_0x4c4be4(0xd9)],_0x41a2c9[_0x4c4be4(_0x155869._0x44068e)]]);return{'xmin':_0x13d79d[0x0],'ymin':_0x13d79d[0x1],'xmax':_0x1f158b[0x0],'ymax':_0x1f158b[0x1]};}function getVertexShaderSource(_0x15b362){const _0x5bf71f={_0x4de0dd:0x129},_0x564153=_0x49e4e1;return _0x564153(_0x5bf71f._0x4de0dd)+_0x15b362+';\x0a\x20\x20\x20\x20p\x20+=vec4(disPos,0.0);\x0a\x20\x20\x20\x20gl_Position\x20=\x20czm_modelViewProjectionRelativeToEye\x20*\x20p;\x0a\x20\x20}\x0a';}exports['HeatLayer']=HeatLayer,Object['defineProperty'](exports,_0x49e4e1(0xf9),{'value':!![]});
}));
